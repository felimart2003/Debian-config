(self.webpackChunk=self.webpackChunk||[]).push([[274],{56732:(e,i,t)=>{t.r(i),t.d(i,{G2FeatureImpl:()=>T});var n=t(27378),s=t(14601),a=t(77176),l=t(98403),r=t(23239),o=t(57050),d=t(55649),h=t(13718),g=t(19751),p=t(5114),c=t(62874),m=t(14505),u=t(89456),_=t(81964);class v{constructor(e){this._params=e,this._subs=new s.w,this._emphasizedParagraph=r.h.create(p.none),this.paragraphs=this._params.highlightCollection.highlights.view((e=>e.map((e=>({id:e.meta.paragraphId,textRange:e.meta.paragraphTextRange,highlightRects:e.rects}))))),this.emphasizedParagraph=this._emphasizedParagraph.view(),this._subs.add(this._params.mouseData.pipe(h.U(c.S.hz30),g.skipBy(m.Z.eq),a.U((({client:e,offset:i})=>e&&i&&(0,_._N)(e,this._params.textFieldElement)?(0,o.zG)(p.fromNullable(this.paragraphs.get().find((e=>e.highlightRects.some((e=>u.UL.contains(i,e))))))):p.none))).subscribe(l.wW(this._emphasizedParagraph)))}dispose(){this._subs.unsubscribe()}}const S=n.lazy((()=>t.e(274).then(t.bind(t,60907)).then((({ParagraphHighlights:e})=>({default:e}))))),b=n.lazy((()=>t.e(274).then(t.bind(t,63408)).then((({Sidelines:e})=>({default:e})))));var w=t(66310),x=t(2844),C=t(48015),z=t(68435),f=t(52423);class y{constructor(e){this._params=e,this._subs=new s.w,this._logger=d.Y.create("G2SidelineCollectionImpl"),this._sidelines=r.h.create([]),this._sidelineById=r.h.create(new Map),this._emphasizedSideline=r.h.create(p.none),this._activeSideline=r.h.create(p.none),this._pinnedSideline=r.h.create(p.none),this.sidelines=this._sidelines.view(),this.emphasizedSideline=this._emphasizedSideline.view(),this.activeSideline=this._activeSideline.view(),this.pinnedSideline=this._pinnedSideline.view(),this._subs.add(this._params.paragraphCollection.paragraphs.pipe(w.w((e=>x.aj([this._params.integration.textFieldClientPoint,this._params.textFieldLayout.scroll.behavior]).pipe(a.U((([i,t])=>e.map((e=>{const n=function(e,i,t){const n=`g2-sideline-${e.textRange.start}-${e.textRange.end}`,s=(0,z.jr)(e.highlightRects);if(null===s)return null;const a={kind:"offsetPoint",...s},l=(0,f.Z)(a,{kind:"clientPoint",...i},t);return{id:n,paragraphId:e.id,anchorRect:l,textFieldClientPoint:i}}(e,i,t);return null===n?(this._logger.warn("Failed to create sideline for paragraph; skipping.",{paragraph:e}),null):n})).filter(C.Nf))))))).subscribe(l.wW(this._sidelines))),this._subs.add(this._sidelines.pipe(a.U((e=>e.reduce(((e,i)=>e.set(i.id,i)),new Map)))).subscribe(l.wW(this._sidelineById)))}_doesSidelineIdMatchRelevantSideline(e,i){return(0,o.zG)(i,p.fold((()=>!1),(i=>e===i.id)))}emphasizeSideline(e){this._logger.debug("Emphasizing sideline.",{sidelineId:e});const i=p.fromNullable(this._sidelineById.get().get(e));p.isSome(i)?this._emphasizedSideline.set(i):this._logger.warn("Tried to emphasized non-existing sideline, this is a no-op.")}unemphasizeSideline(e){this._logger.debug("Unemphasizing sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._emphasizedSideline.get())?this._emphasizedSideline.set(p.none):this._logger.warn("Tried to unemphasize sideline that is not emphasized, this is a no-op.",{sidelineId:e})}activateSideline(e){this._logger.debug("Activating sideline.",{sidelineId:e});const i=p.fromNullable(this._sidelineById.get().get(e));p.isSome(i)?(this._activeSideline.set(i),this.emphasizeSideline(e)):this._logger.warn("Tried to activate non-existing sideline, this is a no-op.",{sidelineId:e})}deactivateSideline(e){this._logger.debug("Deactivating sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._activeSideline.get())?this._activeSideline.set(p.none):this._logger.warn("Tried to deactivate sideline that is not active, this is a no-op.",{sidelineId:e})}pinSideline(e){this._logger.debug("Pinning sideline.",{sidelineId:e});const i=p.fromNullable(this._sidelineById.get().get(e));p.isSome(i)?(this._pinnedSideline.set(i),this.activateSideline(e)):this._logger.warn("Tried to pin non-existing sideline, this is a no-op.",{sidelineId:e})}unpinSideline(e){this._logger.debug("Unpinning sideline.",{sidelineId:e}),this._doesSidelineIdMatchRelevantSideline(e,this._pinnedSideline.get())?(this._pinnedSideline.set(p.none),this.deactivateSideline(e)):this._logger.warn("Tried to unpin sideline that is not pinned, this is a no-op.",{sidelineId:e})}dispose(){this._subs.unsubscribe()}}var F=t(85985),I=t(78674),E=t(93508),k=t(54951),P=t(7604),R=t(68006),L=t(98017);class G{constructor(e){this._params=e,this._subs=new s.w,this._logger=d.Y.create("G2ParagraphHighlightCollectionImpl"),this._highlightCollection=new k.C(this._params.geometryProvider,this._params.geometryLayout,(()=>this._params.textObserver.getCurrentTextMap()),(0,R.u)(),(0,P.WF)(this._params.textFieldLayout),(0,L.m)()),this.highlights=this._highlightCollection.geometry.view((e=>Array.from(e.values()))),this._subs.add(this._params.textObserver.contentChanges.async.pipe(F.h((e=>!e.deltaChange.isEmpty)),I.b(1e3),E.O(null),a.U((()=>function(e){let i=0,t=0;const n=[];for(;t<e.length;)"\n"===e.charAt(t)&&(i!==t&&n.push({start:i,end:t}),i=t+1),t++;return i!==t&&n.push({start:i,end:t}),n}(this._params.textObserver.getCurrentTextMap().getPlainText())))).subscribe((e=>{this._logger.debug("Updating paragraph highlight collection.",{paragraphTextRanges:e});const i=Array.from(this._highlightCollection.geometry.get().keys());this._highlightCollection.removeHighlights(i);for(const i of e){const e=`g2-paragraph-${i.start}-${i.end}`,t=P.y$.Id.create(e);this._highlightCollection.addHighlight(t,i,{highlightId:t,paragraphId:e,paragraphTextRange:i,alertId:e,highlightColor:null,highlightDisplayFormat:null,highlightLiveliness:null})}})))}dispose(){this._subs.unsubscribe()}}var O=t(61292),U=t(46297);class A{constructor(e){this._params=e,this._logger=d.Y.create("G2IntegrationGoogleDocs"),this.name="g2-google-docs-integration",this.textFieldClientPoint=this._params.textFieldLayout.rect.behavior.pipe(a.U((e=>{const i=this._params.textFieldElement.querySelector(U.gv);if(null!==i){const{left:t}=i.getBoundingClientRect();return{top:e.client.top,left:t}}return this._logger.warn("Failed to retrieve canvas content element, defaulting to text field layout rect, which may not be appropriate as a text field client point indicator for documents with pages."),e.client})))}}class B{constructor(e){this._params=e,this.name="g2-base-integration",this.textFieldClientPoint=this._params.textFieldLayout.rect.behavior.pipe(a.U((e=>e.client)))}}var M=t(20236),H=t(10389);class T{constructor(e){this._params=e,this._subs=new s.w,this._logger=d.Y.create("G2FeatureImpl"),this._alertFilter=r.h.create(o.W8),this._integration=(0,O.a9)(this._params.integrationName)?new A({textFieldLayout:this._params.textFieldLayout,textFieldElement:this._params.textFieldElement}):new B({textFieldLayout:this._params.textFieldLayout}),this._paragraphHighlightCollection=new G({textObserver:this._params.textObserver,geometryProvider:this._params.geometryProvider,geometryLayout:this._params.geometryLayout,textFieldLayout:this._params.textFieldLayout}),this._paragraphCollection=new v({highlightCollection:this._paragraphHighlightCollection,textFieldElement:this._params.textFieldElement,mouseData:this._params.mouseData}),this._sidelineCollection=new y({paragraphCollection:this._paragraphCollection,integration:this._integration,textFieldLayout:this._params.textFieldLayout}),this.alertFilter=this._alertFilter.view(),this._logger.debug("G2 initialized on:",this._params.integrationName),this._subs.add(this._params.alertClassification.visibleInlineAlertsFilter.pipe(a.U((e=>i=>{return e(i)&&(t=i,M.S.isTransformJsonCapiAlert(t)&&t.outcome===H.TC.correctness&&t.transformJSON.highlights.every((e=>"enclosing"!==e.type)));var t}))).subscribe(l.wW(this._alertFilter)))}get paragraphHighlightsUI(){return n.createElement(n.Suspense,{fallback:n.createElement(n.Fragment,null)},n.createElement(S,{paragraphs:this._paragraphCollection.paragraphs,activeSideline:this._sidelineCollection.activeSideline,pinnedSideline:this._sidelineCollection.pinnedSideline}))}get sidelinesUI(){return n.createElement(n.Suspense,{fallback:n.createElement(n.Fragment,null)},n.createElement(b,{sidelines:this._sidelineCollection.sidelines,emphasizedParagraph:this._paragraphCollection.emphasizedParagraph,emphasizedSideline:this._sidelineCollection.emphasizedSideline,activeSideline:this._sidelineCollection.activeSideline,pinnedSideline:this._sidelineCollection.pinnedSideline,onEmphasizeSideline:e=>this._sidelineCollection.emphasizeSideline(e),onUnemphasizeSideline:e=>this._sidelineCollection.unemphasizeSideline(e),onActivateSideline:e=>this._sidelineCollection.activateSideline(e),onDeactivateSideline:e=>this._sidelineCollection.deactivateSideline(e),onPinSideline:e=>this._sidelineCollection.pinSideline(e),onUnpinSideline:e=>this._sidelineCollection.unpinSideline(e)}))}dispose(){this._subs.unsubscribe(),this._paragraphHighlightCollection.dispose(),this._paragraphCollection.dispose(),this._sidelineCollection.dispose()}}},60907:(e,i,t)=>{t.r(i),t.d(i,{ParagraphHighlights:()=>g});var n=t(5114),s=t(8543),a=t(23239),l=t(54001),r=t(57050),o=t(27378),d=t(41572),h=t(71469);const g=({paragraphs:e,activeSideline:i,pinnedSideline:t})=>o.createElement(s.F.Fragment,null,a.h.combine(e,i,t,((e,i,t)=>o.createElement(d.L,{key:"g2",chunkName:"g2"},e.map((e=>e.highlightRects.map(((s,a)=>{return o.createElement("div",{key:`${e.id}-${a}`,...(0,l.Sh)(h.paragraphHighlightRect,(d=e.id,g=(0,r.zG)(t,n.map((e=>e.paragraphId))),p=(0,r.zG)(i,n.map((e=>e.paragraphId))),(0,r.zG)(g,n.map((e=>e===d)),n.alt((()=>(0,r.zG)(p,n.map((e=>e===d))))),n.getOrElse((()=>!1)))?h.paragraphHighlightRectActive:void 0)),style:{top:s.top,left:s.left,width:s.width,height:s.height}});var d,g,p}))))))))},63408:(e,i,t)=>{t.r(i),t.d(i,{Sidelines:()=>v});var n=t(5114),s=t(8543),a=t(23239),l=t(57050),r=t(27378),o=t(41572),d=t(54001),h=t(47385),g=t(46354),p=t(80463),c=t(22232);const m=({emphasized:e,signalColor:i,fillColor:t,height:n,onClick:s,onMouseOver:a,onMouseOut:l,onFocus:o,onBlur:m})=>r.createElement("button",{"data-testid":"grammarly-g2-sideline",...(0,d.Sh)(h.sideline,e?h.sidelineEmphasized:h.sidelineIdle,"blue"===t?h.sidelineFillBlue:void 0),style:{height:n},disabled:!e,onClick:e?s:void 0,onFocus:e?o:void 0,onBlur:e?m:void 0,onMouseOver:a,onMouseOut:l,"aria-label":"See rewrite suggestions"},"none"!==i&&r.createElement("div",{...(0,d.Sh)(h.sidelineSignal,(e=>{if("none"!==e)return"red"===e?h.sidelineSignalRed:"purple"===e?h.sidelineSignalPurple:void(0,c.L0)(e)})(i)),role:"status","aria-label":"Rewrite suggestions available"}),r.createElement(g.J,{...(0,d.Sh)(h.sidelineArrow,e?h.sidelineArrowEmphasized:h.sidelineArrowIdle),icon:p.b,accessibilityLabel:"",size:"small",variant:"none"!==t?"inverse":"default"}));var u=t(23437);function _(e,i,t,s,a){return(0,l.zG)(i,n.map((i=>i===e.id)),n.getOrElse((()=>(0,l.zG)(t,n.map((i=>i===e.id)),n.getOrElse((()=>!1)))||(0,l.zG)(s,n.map((i=>i===e.id)),n.getOrElse((()=>!1)))||(0,l.zG)(a,n.map((i=>i===e.paragraphId)),n.getOrElse((()=>!1))))))}const v=({sidelines:e,emphasizedParagraph:i,emphasizedSideline:t,activeSideline:d,pinnedSideline:h,onEmphasizeSideline:g,onUnemphasizeSideline:p,onActivateSideline:c,onDeactivateSideline:v,onPinSideline:S,onUnpinSideline:b})=>r.createElement(s.F.Fragment,null,a.h.combine(e,i,t,d,h,((e,i,t,a,d)=>r.createElement(o.L,{key:"g2",chunkName:"g2"},e.map((e=>r.createElement(s.F.span,{key:e.id,className:u.sidelinePositioner,style:{top:e.anchorRect.top,left:e.textFieldClientPoint.left,width:e.anchorRect.left-e.textFieldClientPoint.left},onMouseEnter:()=>g(e.id),onMouseLeave:()=>p(e.id)},r.createElement(m,{fillColor:"none",emphasized:_(e,(0,l.zG)(d,n.map((e=>e.id))),(0,l.zG)(a,n.map((e=>e.id))),(0,l.zG)(t,n.map((e=>e.id))),(0,l.zG)(i,n.map((e=>e.id)))),signalColor:"none",height:e.anchorRect.height,onClick:()=>S(e.id),onFocus:()=>S(e.id),onBlur:()=>b(e.id),onMouseOver:()=>c(e.id),onMouseOut:()=>v(e.id)}))))))))},46297:(e,i,t)=>{t.d(i,{$x:()=>l,F8:()=>m,Go:()=>s,Kt:()=>x,Lq:()=>d,Q2:()=>b,QR:()=>I,Qy:()=>v,Vk:()=>C,Wp:()=>n,XG:()=>a,_m:()=>p,d0:()=>h,f:()=>o,gH:()=>_,gL:()=>z,gv:()=>u,ij:()=>F,j5:()=>w,jW:()=>c,lO:()=>y,os:()=>S,rx:()=>f,uj:()=>g,y1:()=>r});const n=".kix-appview-editor",s=".docos-input",a=".docs-texteventtarget-iframe",l=".kix-cursor",r=".kix-cursor-caret",o="#docs-revisions-sidebar",d='#docs-toolbar-mode-switcher[aria-label="Viewing mode"]',h="#docs-toolbar-mode-switcher",g="edit-mode",p="suggest-mode",c="#titlebar-mode-indicator-container .titlebar-request-access-button",m="#titlebar-mode-indicator-container .kix-titlebar-request-access-button",u=".kix-canvas-tile-content",_="canvas.kix-canvas-tile-content:not(.docs-ui-unprintable *)",v=".kix-rotatingtilemanager:not(.docs-ui-unprintable *)",S=".kix-page-paginated.canvas-first-page",b="kix-page-canvas-compact-mode",w=".docs-horizontal-ruler",x=".docs-vertical-ruler",C="#fontSizeSelect input",z=".docs-ruler-background",f=".docs-ruler-background-inner",y=".docs-ruler-indent-first-line",F=".modal-dialog.docs-dialog .fatal-error-message",I='#docs-titlebar-share-client-button div[role="button"]'},47385:e=>{e.exports={sideline:"BhSZx",sidelineEmphasized:"n6ulf",sidelineFillBlue:"u56Pu",sidelineSignal:"KRUES",sidelineSignalRed:"O8Ye8",sidelineSignalPurple:"AnBeu",sidelineArrow:"YMmvo",sidelineArrowIdle:"B64tj",sidelineArrowEmphasized:"eQq2t"}},71469:e=>{e.exports={paragraphHighlightRect:"RJsDT",paragraphHighlightRectActive:"hjqdh"}},23437:e=>{e.exports={sidelinePositioner:"L7jHH"}},80463:(e,i,t)=>{t.d(i,{b:()=>s});var n=t(27378);const s=(0,t(91961).I)("color",(({title:e,titleId:i,desc:t,descId:s,...a})=>n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none",viewBox:"0 0 16 16","aria-hidden":"true",stroke:"transparent","aria-labelledby":i,"aria-describedby":s,...a},t?n.createElement("desc",{id:s},t):null,e?n.createElement("title",{id:i},e):null,n.createElement("path",{stroke:"#646B81",strokeLinecap:"round",d:"m2 5 6 6 6-6"}))))}}]);