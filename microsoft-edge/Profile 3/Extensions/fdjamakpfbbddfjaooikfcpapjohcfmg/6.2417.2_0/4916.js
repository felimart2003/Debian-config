"use strict";(globalThis.webpackChunk_dashlane_leeloo=globalThis.webpackChunk_dashlane_leeloo||[]).push([[4916],{682994:(e,t,i)=>{i.d(t,{s:()=>g}),i(696832);var s=i(364438),a=i(482598),n=i(133354),o=i(448430),r=i(488203);let l=function(e){return e.LastAdmin="LastAdmin",e.GroupSharing="GroupSharing",e.CollectionSharing="CollectionSharing",e.Generic="Generic",e}({});var c=i(365580),u=i(524130);const d=({reason:e,translations:t,goToSharingAccess:i,closeCantDeleteDialog:a})=>{const{translate:n}=(0,r.Z)(),o=((e,t)=>{const{groupSharingTitle:i,lastAdminTitle:s,collectionSharingTitle:a,genericErrorTitle:n}=e;switch(t){case l.LastAdmin:return s;case l.GroupSharing:return i;case l.CollectionSharing:return a;case l.Generic:return n;default:return(0,c.U)(t)}})(t,e),d=((e,t)=>{const{groupSharingSubtitle:i,lastAdminSubtitle:s,collectionSharingSubtitle:a,genericErrorSubtitle:n}=e;switch(t){case l.LastAdmin:return s;case l.GroupSharing:return i;case l.CollectionSharing:return a;case l.Generic:return n;default:return(0,c.U)(t)}})(t,e);return(0,u.tZ)(s.Vq,{isOpen:!0,onClose:a,title:null!=o?o:"",closeActionLabel:n("_common_dialog_dismiss_button"),actions:e===l.LastAdmin||l.GroupSharing||l.CollectionSharing?{primary:{children:t.lastAdminActionLabel,onClick:()=>{i(),a()}}}:void 0,children:d})};var m=i(837527);const S=({closeConfirmDeleteDialog:e,onDeleteConfirm:t,translations:i})=>{const{translate:a}=(0,r.Z)(),{confirmDeleteSubtitle:n,confirmDeleteTitle:o,confirmDeleteDismiss:l,confirmDeleteConfirm:c}=i;return(0,u.tZ)(s.Vq,{title:o,onClose:e,isOpen:!0,dialogClassName:m.Ht,closeActionLabel:a("_common_dialog_dismiss_button"),isDestructive:!0,actions:{primary:{children:c,onClick:t,id:"deletion-dialog-confirm-button"},secondary:{children:l,onClick:e,autoFocus:!0,id:"deletion-dialog-dismiss-button"}},children:n})},g=({closeConfirmDeleteDialog:e,goToSharingAccess:t,isVisible:i,itemId:c,onDeletionSuccess:m,sharingStatus:g,translations:_,vaultItemType:h,isShared:p,isSharedViaUserGroup:b,isItemInCollection:C,isLastAdmin:I})=>{const{showToast:y}=(0,s.pm)(),{translate:D}=(0,r.Z)(),{deleteVaultItems:A}=(0,a.u)(o.L);if(!i)return null;let T;return(p||g?.isShared)&&(b&&(T=l.GroupSharing),I&&(T=l.LastAdmin),C&&(T=l.CollectionSharing)),T&&t?(0,u.tZ)(d,{reason:T,translations:_,goToSharingAccess:t,closeCantDeleteDialog:e}):(0,u.tZ)(S,{closeConfirmDeleteDialog:e,onDeleteConfirm:async()=>{try{var e;(await A({ids:[c],vaultItemType:h})).tag===n.rq.Success?(y({description:null!=(e=_.deleteSuccessToast)?e:D("webapp_personal_info_edition_delete_success_toast")}),m()):y({description:D("_common_generic_error"),mood:"danger",isManualDismiss:!0})}catch(e){y({description:D("_common_generic_error"),mood:"danger",isManualDismiss:!0})}},translations:_})}},64676:(e,t,i)=>{i.r(t),i.d(t,{SecureNotesEdit:()=>W});var s=i(696832),a=i(15192),n=i(799852),o=i(133354),r=i(926897),l=i(448430),c=i(382706),u=i(45272),d=i(692077),m=i(832971),S=i(995445),g=i(348958),_=i(982466),h=i(361607),p=i(482598),b=i(310789),C=i(573623),I=i(207149),y=i(740300),D=i(488203),A=i(806697),T=i(86498),f=i(376452),w=i(682994),N=i(86541),v=i(326239),L=i(495795),E=i(99822),U=i(830894),V=i(773157),Z=i(899193),F=i(671785),O=i(420684),G=i(979808),q=i(301639),R=i(296352),k=i(285163),P=i(812027),B=i(524130);const{CONTENT:M,DOCUMENT_STORAGE:H,MORE_OPTIONS:X,SHARED_ACCESS:x}=N.SecureNoteTabs,z=(0,U.DP)((({note:e,noteCategories:t,isShared:i,isAdmin:a,isSharedViaUserGroup:n,isLastAdmin:m})=>{var S;const{translate:g}=(0,D.Z)(),{routes:_}=(0,d.Xo)(),U=(0,h._)(),z=(0,d.TH)(),Q=(0,F.aV)(),{updateVaultItem:W}=(0,p.u)(l.L),{navigateBack:K}=(0,R.u)(),{showAlert:Y}=(0,T.V)(),{shouldShowFrozenStateDialog:$}=(0,A.Ub)(),{addNoteToCollections:j}=(0,k.Q)(),{allCollections:J}=(0,P.b)(),[ee,te]=(0,s.useState)(M),[ie,se]=(0,s.useState)(!1),[ae]=(0,s.useState)(null),[ne,oe]=(0,s.useState)(!1),[re,le]=(0,s.useState)(!1),[ce,ue]=(0,s.useState)(!1),[de,me]=(0,s.useState)(!1),[Se,ge]=(0,s.useState)(e.isSecured),[_e,he]=(0,s.useState)(e.content),[pe,be]=(0,s.useState)(e.title),[Ce,Ie]=(0,s.useState)(e.color),[ye,De]=(0,s.useState)(e.spaceId),[Ae,Te]=(0,s.useState)([]),[fe,we]=(0,s.useState)(!1),{data:Ne,status:ve}=(0,G.r)(e.id),Le=Boolean(U.data?.sharingVault_web_Secure_Notes_Revamp_dev)||Boolean(U.data?.sharingVault_web_Secure_Notes_Revamp_prod),Ee=()=>Y(g("_common_generic_error"),b.BLW.ERROR),Ue=()=>{(0,O.P)(),z.pathname.includes(_.userSecureNotes)&&(0,u.Nc)(r.PageView.ItemSecureNoteList),K(_.userSecureNotes)},Ve=async(t=!0)=>{ue(!0);const i=null!=ae?ae:{spaceId:ye,type:Ce,category:e.categoryId,secured:Se};try{var s;const t=await W({vaultItemType:c.U.SecureNote,content:{content:_e,title:pe,id:e.id,attachments:[...null!=(s=e.attachments)?s:[]],...i},id:e.id});j(e.id,Ae),(0,C.hx)(t)&&Ee()}catch(e){Ee()}ue(!1),t?Ue():se(!1)},Ze=()=>{me(!0)},Fe=async t=>{me(!1),t.success&&(await y.C.commitSecureFile({secureFileInfo:t.secureFileInfo}),e.attachments?.push((0,Z.w)(t.secureFileInfo)),Ve(!1))},Oe=()=>se(!0),Ge=J.filter((t=>t.vaultItems.some((t=>t.id===e.id)))),qe=Ge.length||Ae.length,Re=!!e.attachments&&e.attachments.length>0,ke=!qe&&(Q||Re),Pe=Le?[M]:[M,X];i?Pe.push(x):ke&&Pe.push(H);const Be={confirmDeleteConfirm:g("webapp_secure_notes_edition_delete_confirm"),confirmDeleteDismiss:g("webapp_credential_edition_delete_dismiss"),confirmDeleteSubtitle:g("webapp_credential_edition_confirm_delete_subtitle"),confirmDeleteTitle:g("webapp_secure_notes_edition_delete_title"),lastAdminActionLabel:g("webapp_credential_edition_change_permissions"),lastAdminTitle:g("webapp_credential_edition_last_admin_title"),lastAdminSubtitle:g("webapp_credential_edition_last_admin_subtitle"),groupSharingTitle:g("webapp_secure_notes_edition_group_sharing_title"),groupSharingSubtitle:g("webapp_credential_edition_group_sharing_subtitle"),collectionSharingTitle:g("webapp_credential_edition_collection_sharing_title"),collectionSharingSubtitle:g("webapp_credential_edition_collection_sharing_subtitle"),genericErrorTitle:"webapp_account_recovery_generic_error_title",genericErrorSubtitle:"webapp_account_recovery_generic_error_subtitle"},Me={attachments:null!=(S=e.attachments)?S:[],category:e.categoryId?e.categoryId:"noCategory",content:e.content,id:e.id,limitedPermissions:i&&!a,secured:e.isSecured,spaceId:e.spaceId,title:e.title,type:e.color},He=e=>t=>{Oe(),e(t)},Xe=He(De),xe=He(Ie),ze=He(be),Qe=He(he),We=He(ge),Ke=i&&ve===o.rq.Success&&null!=(Ye=Ne?.count)?Ye:0;var Ye;const $e=Ge.filter((e=>e.isShared)).length>0;return(0,B.BX)(f.zI,{isViewingExistingItem:!0,itemHasBeenEdited:ie,onSubmit:()=>{Ve()},isUsingNewDesign:Le,submitPending:ce,secondaryActions:(()=>{switch(ee){case M:return[(s=e,!s||i&&!a||s.attachments?.length?null:(0,B.tZ)(q.Z,{tooltipPlacement:"top-start",sharing:(t=e.id,(0,E.A1)(t)),text:g("webapp_sharing_invite_share"),origin:r.Origin.ItemDetailView},"shareaction"))];case H:return[(0,B.tZ)(V.d,{isQuotaReached:!1,onFileUploadStarted:Ze,onFileUploadDone:Fe,isShared:i,itemId:e.id,dataType:"KWSecureNote",disabled:!!$},"uploadAction")];default:return[]}var t,s})(),onNavigateOut:Ue,onClickDelete:()=>oe(!0),ignoreCloseOnEscape:ne||re,isSomeDialogOpen:ne||fe,formId:"edit_securenote_panel",header:(0,B.tZ)(v.h,{activeTab:ee,backgroundColor:Me.type,displayDocumentStorage:Pe.includes(H),displaySharedAccess:Pe.includes(x),displayMoreOptions:Pe.includes(X),recipientsCount:Ke,setActiveTab:te,disabled:i&&!a,title:pe,setTitle:ze}),children:[(0,B.tZ)(L.T,{activeTab:ee,data:Me,content:null!=_e?_e:"",title:pe,color:Ce,spaceId:ye,isDisabled:!!$,isSecured:Se,setSpaceId:Xe,setColor:xe,setTitle:ze,setContent:Qe,setIsSecured:We,handleFileInfoDetached:t=>{e.attachments=e.attachments?.filter((e=>e.id!==t)),Ve(!1)},hasAttachment:Re,isAdmin:a,isSecureNoteRevampEnabled:Le,isSecureNoteAttachmentEnabled:Q,isShared:i,isUploading:de,noteCategories:t,onModifyData:Oe,onModalDisplayStateChange:le,saveSecureNoteOptions:async t=>{const{category:i,spaceId:s,type:a,secured:n}=t;ue(!0);const o={...e,spaceId:null!=s?s:"",type:I.L[a],category:i,secured:n};try{const t=await W({vaultItemType:c.U.SecureNote,content:o,id:e.id});(0,C.hx)(t)&&Ee(),ue(!1)}catch(e){Ee()}},setCollectionsToUpdate:Te,setHasDialogsOpenedByChildren:we}),(0,B.tZ)(w.s,{isVisible:ne,itemId:e.id,closeConfirmDeleteDialog:()=>oe(!1),goToSharingAccess:()=>{te(N.SecureNoteTabs.SHARED_ACCESS)},onDeletionSuccess:async()=>{e.attachments?.forEach((async e=>{const{id:t}=e;await y.C.deleteSecureFile({id:t})})),Ue()},isLastAdmin:m,isShared:i,isSharedViaUserGroup:n,isItemInCollection:$e,translations:Be,vaultItemType:c.U.SecureNote})]})})),Q=({note:e})=>{const{getPermissionForItem:t,getSharingStatusForItem:i,getIsLastAdminForItem:s}=(0,S.Y)(g.X,{getPermissionForItem:{queryParam:{itemId:e.id}},getSharingStatusForItem:{queryParam:{itemId:e.id}},getIsLastAdminForItem:{queryParam:{itemId:e.id}}},[]),a=(0,n.k)(l.L,"secureNoteCategory",{});if(t.status!==o.rq.Success||i.status!==o.rq.Success||s.status!==o.rq.Success||a.status!==o.rq.Success)return null;const{isShared:r,isSharedViaUserGroup:c}=i.data,{permission:u}=t.data,{isLastAdmin:d}=s.data,m=r&&u===_.y3.Admin;return(0,B.tZ)(z,{note:e,noteCategories:a.data,isShared:r,isAdmin:m,isSharedViaUserGroup:c,isLastAdmin:d})},W=e=>{const{routes:t}=(0,d.Xo)(),i=(0,d.UO)(),S=`{${i?.uuid}}`,g=(0,n.k)(l.L,"query",{vaultItemTypes:[c.U.SecureNote],ids:[S]}),_=s.useCallback((()=>g.status===o.rq.Success&&!g.data?.secureNotesResult.items&&((0,d.uX)(t.userSecureNotes),!0)),[g,t.userSecureNotes]);return s.useEffect((()=>{_()||(0,u.Nc)(r.PageView.ItemSecureNoteDetails)}),[_]),s.useEffect((()=>{_()}),[_,g]),g.status===o.rq.Loading?null:g.data?.secureNotesResult?.items?.length?(0,B.tZ)(Q,{note:g.data.secureNotesResult.items[0]}):e.location?.state?(0,B.tZ)(a.l_,{to:(0,m.rF)(e.location.state,t)}):(0,B.tZ)(a.l_,{to:t.userSecureNotes})}}}]);