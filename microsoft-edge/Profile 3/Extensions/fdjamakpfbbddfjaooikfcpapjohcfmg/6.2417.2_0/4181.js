"use strict";(globalThis.webpackChunk_dashlane_leeloo=globalThis.webpackChunk_dashlane_leeloo||[]).push([[4181],{438182:(e,t,a)=>{a.r(t),a.d(t,{CredentialAddPanel:()=>B});var s=a(696832),n=a(133354),o=a(718108),i=a(830894),l=a(526849),r=a(926897),u=a(310789),c=a(914662),d=a(573623),m=a(361607),p=a(482598),w=a(299074),g=a(448430),h=a(96862),I=a(382706),S=a(172721),_=a(982466),f=a(488203),P=a(86498),L=a(45272),y=a(108403),C=a(692077),E=a(806697),U=a(619122),b=a(376452),v=a(696397),A=a(199975),V=a(383849),k=a.n(V);var D=a(524130);const R=()=>{const{translate:e}=(0,f.Z)();return(0,D.tZ)(b.V9,{icon:(0,D.tZ)("div",{className:k()("icon--gEZfcCvjSg","dummyIcon--ix6eIwyFEN")}),title:e("webapp_credential_addition_website")})};var N,q=a(569029);const Z=["name","website"],x={name:"itemName",website:"URL"},T=({activeSpaces:e,onClose:t,protectedItemsUnlockerShown:a,openProtectedItemsUnlocker:n,areProtectedItemsUnlocked:o})=>{var i,V;const k=(0,s.createRef)(),[T,B]=(0,s.useState)(!1),{routes:M}=(0,C.Xo)(),{currentSpaceId:O}=(0,U.fV)(),X=(0,m._)(),F=(0,P.V)(),{translate:H}=(0,f.Z)(),z=(0,y.v0)(),W=!z.isLoading&&z.shouldShowAtOrOverLimitContent,{openDialog:j,shouldShowFrozenStateDialog:G}=(0,E.Ub)(),{createCollection:J,updateCollection:K}=(0,p.u)(w.v),{addItemToCollections:Y}=(0,p.u)(S.a),{createVaultItem:Q}=(0,p.u)(g.L),{updateCredentialPreferences:$}=(0,p.u)(q.I),[ee,te]=(0,s.useState)(!1),[ae,se]=(0,s.useState)(!1),ne=(0,C.TH)(),oe=(0,s.useRef)(ne.state?.previouslyGeneratedPassword),ie=Boolean(X.data?.sharingVault_web_Collection_Item_Permissions_dev)||Boolean(X.data?.sharingVault_web_Collection_Item_Permissions_prod),[le,re]=(0,s.useState)(Boolean(oe.current)),[ue,ce]=(0,s.useState)(!1),de=(()=>{const e=(0,C.CN)();return Z.reduce(((t,a)=>(t[x[a]||a]=e.get(a),t)),{})})(),me={alternativeUsername:"",email:"",itemName:"",linkedURLs:[],note:"",otpURL:"",password:null!=(i=oe.current)?i:"",spaceId:e.length>0&&!e[0].info?.personalSpaceEnabled?e[0].teamId:null!=O?O:"",username:"",...de,URL:null!=(V=ne.state?.website)?V:de.URL,onlyAutofillExactDomain:!1,requireMasterPassword:!1,useAutoLogin:!0},[pe,we]=(0,s.useState)(me);(0,s.useEffect)((()=>{const{onlyAutofillExactDomain:e,requireMasterPassword:t,useAutoLogin:a,...s}=pe,{onlyAutofillExactDomain:n,requireMasterPassword:o,useAutoLogin:i,...r}=me,u=!(0,l.equals)(pe,me)&&!W;re(u),ce(!(0,l.equals)(s,r))}),[pe]);const ge=()=>{te(!0)};(0,s.useEffect)((()=>{W&&ge(),G&&(j(),t())}),[W,G]),(0,s.useEffect)((()=>{(0,L.Nc)(r.PageView.ItemCredentialCreate)}),[]);const he=()=>F.showAlert(H("_common_generic_error"),u.BLW.ERROR),Ie=()=>{(0,L.Nc)(r.PageView.ItemCredentialList),ee?(0,C.uX)(M.userCredentials):t?t():(0,C.uX)(M.userCredentials)};return z.isLoading||null===G?null:(0,D.BX)(b.zI,{isUsingNewDesign:!0,isViewingExistingItem:!1,isSomeDialogOpen:ae,itemHasBeenEdited:le,onSubmit:async()=>{Boolean(k.current?.isFormValid())&&(B(!0),await(async()=>{const e=k.current?.getVaultItemCollections(),{onlyAutofillExactDomain:t,useAutoLogin:a,requireMasterPassword:s,...n}=pe,o=t!==me.onlyAutofillExactDomain||a!==me.useAutoLogin||s!==me.requireMasterPassword;try{const i=await Q({vaultItemType:I.U.Credential,content:n,shouldSkipSync:!!o});if(!(0,d.d6)(i))return void he();const l=(0,d.db)(i).id,r=[];o&&r.push($({credentialId:l,credentialUrl:n.URL,onlyAutofillExactDomain:t,useAutoLogin:a,requireMasterPassword:s,shouldSkipSync:e?.some((e=>e.isShared))})),e?.length&&r.push((async(e,t)=>{const a=[];for(const s of t)s.isShared?a.push({collectionId:s.id,permission:ie?_.y3.Limited:_.y3.Admin}):(s.vaultItems=[{id:e,type:c.dJ.KWAuthentifiant,url:pe.URL}],s.id?await K({id:s.id,collection:s,operationType:h.C.APPEND_VAULT_ITEMS}):await J({content:s}));a.length&&await Y({collectionPermissions:a,itemId:e})})(l,e)),await Promise.all(r)}catch(e){he()}})(),W?ge():Ie())},onNavigateOut:Ie,formId:"add_credential_panel",header:N||(N=(0,D.tZ)(R,{})),submitPending:T,children:[(0,D.tZ)(v.S,{ref:k,editableValues:pe,setEditableValues:we,readonlyValues:{id:"",limitedPermissions:!1,linkedURLs:[]},isNewItem:!0,signalEditedValues:()=>re(!0),activeSpaces:e,areProtectedItemsUnlocked:o,openProtectedItemsUnlocker:n,protectedItemsUnlockerShown:a,setHasOpenedDialogs:se}),ee&&(0,D.tZ)(A.e,{isVisible:ee,handleDismiss:Ie})]})},B=e=>{const t=(0,o.E)(),a=(0,i.tY)();return t.status!==n.rq.Success?null:(0,D.tZ)(T,{...e,activeSpaces:t.data,...a})}}}]);