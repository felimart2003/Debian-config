"use strict";(globalThis.webpackChunk_dashlane_amphora=globalThis.webpackChunk_dashlane_amphora||[]).push([[394],{53006:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},27571:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.abTestsLiveQueriesSlots=t.abTestsQueriesSlots=t.abTestsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.abTestsCommandsSlots={participateToUserABTest:(0,s.slot)()},t.abTestsQueriesSlots={getUserABTestVariant:(0,s.slot)()},t.abTestsLiveQueriesSlots={liveUserABTestVariant:(0,i.liveSlot)()}},28249:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(53006),t),i(r(27571),t)},29004:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(19240),t),i(r(69021),t)},19240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contactInfoLiveQueriesSlots=t.contactInfoQueriesSlots=t.contactInfoCommandsSlots=void 0;const s=r(30504),i=r(72345);t.contactInfoCommandsSlots={editContactInfo:(0,s.slot)(),refreshContactInfo:(0,s.slot)()},t.contactInfoQueriesSlots={getContactInfo:(0,s.slot)()},t.contactInfoLiveQueriesSlots={liveContactInfo:(0,i.liveSlot)()}},69021:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshContactInfoErrorCode=t.EditContactInfoErrorCode=void 0,function(e){e[e.EMPTY_EMAIL=0]="EMPTY_EMAIL",e[e.INVALID_EMAIL=1]="INVALID_EMAIL",e[e.UNKNOWN_ERROR=2]="UNKNOWN_ERROR"}(r||(t.EditContactInfoErrorCode=r={})),function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(s||(t.RefreshContactInfoErrorCode=s={}))},90041:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(83559),t)},83559:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.subscriptionCodeLiveQueriesSlots=t.subscriptionCodeQueriesSlots=void 0;const s=r(30504),i=r(72345);t.subscriptionCodeQueriesSlots={getSubscriptionCode:(0,s.slot)()},t.subscriptionCodeLiveQueriesSlots={liveSubscriptionCode:(0,i.liveSlot)()}},53042:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.AccountCreationCode=void 0,function(e){e[e.USER_EXISTS=0]="USER_EXISTS",e[e.USER_DOESNT_EXIST=1]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=2]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=3]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_DOESNT_EXIST_SSO_NON_PROVISIONED=4]="USER_DOESNT_EXIST_SSO_NON_PROVISIONED",e[e.USER_SSO_PROVISIONED=5]="USER_SSO_PROVISIONED",e[e.USER_NITRO_SSO_PROVISIONED=6]="USER_NITRO_SSO_PROVISIONED",e[e.USER_NOT_PROPOSED=7]="USER_NOT_PROPOSED"}(r||(t.AccountCreationCode=r={}))},12972:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.accountCreationLiveQueriesSlots=void 0;const s=r(72345);t.accountCreationLiveQueriesSlots={liveAccountCreated:(0,s.liveSlot)()}},33773:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(53042),t),i(r(12972),t)},16307:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.antiPhishingLiveQueriesSlots=void 0;const s=r(72345);t.antiPhishingLiveQueriesSlots={livePhishingURLList:(0,s.liveSlot)()}},65722:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(16307),t)},8850:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(14529),t),i(r(54876),t)},14529:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.twoFactorAuthenticationLiveQueriesSlots=t.twoFactorAuthenticationQueriesSlots=t.twoFactorAuthenticationCommandsSlots=void 0;const s=r(30504),i=r(72345);t.twoFactorAuthenticationCommandsSlots={refreshU2FDevicesList:(0,s.slot)(),removeU2FAuthenticator:(0,s.slot)(),refreshTwoFactorAuthenticationInfo:(0,s.slot)(),startTwoFactorAuthenticationEnableFlow:(0,s.slot)(),stopTwoFactorAuthenticationEnableFlow:(0,s.slot)(),continueTwoFactorAuthenticationEnableFlow:(0,s.slot)(),backTwoFactorAuthenticationEnableFlow:(0,s.slot)(),startTwoFactorAuthenticationDisableFlow:(0,s.slot)(),stopTwoFactorAuthenticationDisableFlow:(0,s.slot)(),continueTwoFactorAuthenticationDisableFlow:(0,s.slot)(),backTwoFactorAuthenticationDisableFlow:(0,s.slot)()},t.twoFactorAuthenticationQueriesSlots={getU2FDevicesList:(0,s.slot)(),getTwoFactorAuthenticationEnableStage:(0,s.slot)(),getTwoFactorAuthenticationDisableStage:(0,s.slot)()},t.twoFactorAuthenticationLiveQueriesSlots={liveU2FDevicesList:(0,i.liveSlot)(),liveTwoFactorAuthenticationEnableStage:(0,i.liveSlot)(),liveTwoFactorAuthenticationDisableStage:(0,i.liveSlot)()}},54876:(e,t)=>{var r,s,i,a,o;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestTOTPActivationError=t.TwoFactorAuthenticationDisableStages=t.TwoFactorAuthenticationEnableStages=t.RemoveU2FAuthenticatorError=t.RefreshU2FErrorCode=void 0,function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(r||(t.RefreshU2FErrorCode=r={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.NO_KEYHANDLE_FOUND="NO_KEYHANDLE_FOUND",e.WRONG_AUTHENTICATION_CODE="WRONG_AUTHENTICATION_CODE"}(s||(t.RemoveU2FAuthenticatorError=s={})),function(e){e.AUTHENTICATION_TYPE="AUTHENTICATION_TYPE",e.BACKUP_PHONE="BACKUP_PHONE",e.QR_CODE="QR_CODE",e.AUTHENTICATION_CODE="AUTHENTICATION_CODE",e.LOADING="LOADING",e.FINALIZING_CHANGES="FINALIZING_CHANGES",e.BACKUP_CODES="BACKUP_CODES",e.GENERIC_ERROR="GENERIC_ERROR",e.LOGOUT_REQUIRED="LOGOUT_REQUIRED",e.SUCCESS="SUCCESS"}(i||(t.TwoFactorAuthenticationEnableStages=i={})),function(e){e.CONFIRMATION="CONFIRMATION",e.AUTHENTICATION_CODE="AUTHENTICATION_CODE",e.BACKUP_CODE="BACKUP_CODE",e.FINALIZING_CHANGES="FINALIZING_CHANGES",e.SUCCESS="SUCCESS",e.LOGOUT_REQUIRED="LOGOUT_REQUIRED",e.GENERIC_ERROR="GENERIC_ERROR"}(a||(t.TwoFactorAuthenticationDisableStages=a={})),function(e){e.INTERNAL_ERROR="internal_error",e.CANNOT_SEED_FOR_USER_WITH_TOTP_ENABLED="cannot_seed_for_user_with_TOTP_enabled",e.OTP_FAILED="otp_failed",e.TOTP_TYPE_IS_NOT_SET_TO_EMAIL_TOKEN="totp_type_is_not_set_to_email_token",e.PHONE_VALIDATION_FAILED="phone_validation_failed"}(o||(t.RequestTOTPActivationError=o={}))},30156:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47817),t),i(r(1195),t)},1195:(e,t)=>{var r,s,i,a,o,n,c,l,d,u,p;Object.defineProperty(t,"__esModule",{value:!0}),t.InitUserVerificationWithWebAuthnError=t.RemoveWebAuthnAuthenticatorError=t.DisableWebAuthnAuthenticationError=t.OpenSessionWithWebAuthnAuthenticatorError=t.InitOpenSessionWithWebAuthnAuthenticatorError=t.RefreshAvailableWebAuthnAuthenticatorsError=t.RefreshWebAuthnAuthenticatorsError=t.RegisterWebAuthnAuthenticatorError=t.InitRegisterWebAuthnAuthenticatorError=t.EnableWebAuthnAuthenticationError=t.InitEnableWebAuthnAuthenticationError=t.WebAuthnCallTypes=void 0,t.WebAuthnCallTypes=Object.freeze({CREATE:"webauthn.create",GET:"webauthn.get"}),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(r||(t.InitEnableWebAuthnAuthenticationError=r={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.USER_HAS_OTP="USER_HAS_OTP",e.WEBAUTHN_SERVICE_INIT_FAILED="WEBAUTHN_SERVICE_INIT_FAILED"}(s||(t.EnableWebAuthnAuthenticationError=s={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(i||(t.InitRegisterWebAuthnAuthenticatorError=i={})),function(e){e.USER_HAS_OTP="USER_HAS_OTP",e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(a||(t.RegisterWebAuthnAuthenticatorError=a={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(o||(t.RefreshWebAuthnAuthenticatorsError=o={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MISSING_SESSION_KEYS_IN_STORE="MISSING_SESSION_KEYS_IN_STORE"}(n||(t.RefreshAvailableWebAuthnAuthenticatorsError=n={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNAVAILABLE_AUTHENTICATORS="UNAVAILABLE_AUTHENTICATORS",e.CANNOT_TRIGGER_WEBAUTHN_AUTHENTICATION="CANNOT_TRIGGER_WEBAUTHN_AUTHENTICATION"}(c||(t.InitOpenSessionWithWebAuthnAuthenticatorError=c={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.MP_MISSING_IN_SESSION_ERROR="MP_MISSING_IN_SESSION_ERROR"}(l||(t.OpenSessionWithWebAuthnAuthenticatorError=l={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.WEBAUTHN_SERVICE_DEACTIVATE_FAILED="WEBAUTHN_SERVICE_DEACTIVATE_FAILED",e.MISSING_LOGIN="MISSING_LOGIN"}(d||(t.DisableWebAuthnAuthenticationError=d={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.CANNOT_REMOVE_WEBAUTHN_AUTHENTICATOR="CANNOT_REMOVE_WEBAUTHN_AUTHENTICATOR"}(u||(t.RemoveWebAuthnAuthenticatorError=u={})),function(e){e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.LOGGED_OUT="LOGGED_OUT",e.CANNOT_REFRESH_WEBAUTHN_AUTHENTICATORS="CANNOT_REFRESH_WEBAUTHN_AUTHENTICATORS",e.CANNOT_FETCH_WEBAUTHN_CHALLENGE="CANNOT_FETCH_WEBAUTHN_CHALLENGE"}(p||(t.InitUserVerificationWithWebAuthnError=p={}))},47817:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webAuthnAuthenticationLiveQueriesSlots=t.webAuthnAuthenticationQueriesSlots=t.webAuthnAuthenticationCommandsSlots=void 0;const s=r(30504),i=r(72345);t.webAuthnAuthenticationCommandsSlots={enableWebAuthnAuthentication:(0,s.slot)(),initEnableWebAuthnAuthentication:(0,s.slot)(),refreshAvailableWebAuthnAuthenticators:(0,s.slot)(),refreshWebAuthnAuthenticators:(0,s.slot)(),initRegisterWebAuthnAuthenticator:(0,s.slot)(),registerWebAuthnAuthenticator:(0,s.slot)(),initOpenSessionWithWebAuthnAuthenticator:(0,s.slot)(),openSessionWithWebAuthnAuthenticator:(0,s.slot)(),disableWebAuthnAuthentication:(0,s.slot)(),removeWebAuthnAuthenticator:(0,s.slot)(),initUserVerificationWithWebAuthn:(0,s.slot)()},t.webAuthnAuthenticationQueriesSlots={getWebAuthnAuthenticators:(0,s.slot)(),getWebAuthnAuthenticationOptedIn:(0,s.slot)()},t.webAuthnAuthenticationLiveQueriesSlots={liveWebAuthnAuthenticators:(0,i.liveSlot)(),liveWebAuthnAuthenticationOptedIn:(0,i.liveSlot)()}},29814:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.authenticationLiveQueriesSlots=t.authenticationQueriesSlots=t.authenticationCommandsSlots=void 0;const s=r(30504),i=r(72345),a=r(8850),o=r(30156);t.authenticationCommandsSlots=(0,s.combineEvents)({registerDevice:(0,s.slot)(),requestExtraDeviceToken:(0,s.slot)(),requestEmailToken:(0,s.slot)(),requestPaymentUpdateAuthenticationToken:(0,s.slot)(),setReactivationStatus:(0,s.slot)(),disableAutologin:(0,s.slot)()},o.webAuthnAuthenticationCommandsSlots,a.twoFactorAuthenticationCommandsSlots),t.authenticationQueriesSlots=(0,s.combineEvents)({getHasOtp2Type:(0,s.slot)(),getUserOtpType:(0,s.slot)(),getReactivationStatus:(0,s.slot)(),getAvailableUserVerificationMethods:(0,s.slot)()},o.webAuthnAuthenticationQueriesSlots,a.twoFactorAuthenticationQueriesSlots),t.authenticationLiveQueriesSlots=(0,s.combineEvents)({liveReactivationStatus:(0,i.liveSlot)()},o.webAuthnAuthenticationLiveQueriesSlots,a.twoFactorAuthenticationLiveQueriesSlots)},25098:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29814),t),i(r(52632),t),i(r(8850),t),i(r(30156),t)},52632:(e,t)=>{var r,s,i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.AuthenticationCode=t.OtpType=t.UserVerificationMethods=t.PersistData=t.ReactivationStatus=t.EmailTokenApiError=void 0,t.EmailTokenApiError="SEND_TOKEN_FAILED",function(e){e.DISABLED="DISABLED",e.CLASSIC="CLASSIC",e.WEBAUTHN="WEBAUTHN"}(r||(t.ReactivationStatus=r={})),function(e){e[e.PERSIST_DATA_YES=0]="PERSIST_DATA_YES",e[e.PERSIST_DATA_NO=1]="PERSIST_DATA_NO"}(s||(t.PersistData=s={})),t.UserVerificationMethods=Object.freeze({MasterPassword:"masterPassword",Webauthn:"webauthn"}),function(e){e[e.NO_OTP=0]="NO_OTP",e[e.OTP_NEW_DEVICE=1]="OTP_NEW_DEVICE",e[e.OTP_LOGIN=2]="OTP_LOGIN"}(i||(t.OtpType=i={})),function(e){e[e.INVALID_LOGIN=0]="INVALID_LOGIN",e[e.EMPTY_LOGIN=1]="EMPTY_LOGIN",e[e.EMPTY_MASTER_PASSWORD=2]="EMPTY_MASTER_PASSWORD",e[e.EMPTY_ENCRYPTED_KEY=3]="EMPTY_ENCRYPTED_KEY",e[e.INVALID_ENCRYPTED_KEY=4]="INVALID_ENCRYPTED_KEY",e[e.EMPTY_TOKEN=5]="EMPTY_TOKEN",e[e.EMPTY_OTP=6]="EMPTY_OTP",e[e.SEND_TOKEN_FAILED=7]="SEND_TOKEN_FAILED",e[e.UKI_REGISTRATION_FAILED=8]="UKI_REGISTRATION_FAILED",e[e.REGISTER_DEVICE_FAILED=9]="REGISTER_DEVICE_FAILED",e[e.BUSINESS_ERROR=10]="BUSINESS_ERROR",e[e.USER_DOESNT_EXIST=11]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=12]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=13]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_UNAUTHORIZED=14]="USER_UNAUTHORIZED",e[e.WRONG_PASSWORD=15]="WRONG_PASSWORD",e[e.DATA_TAMPERED_ERROR=16]="DATA_TAMPERED_ERROR",e[e.LOGGEDIN=17]="LOGGEDIN",e[e.ASK_TOKEN=18]="ASK_TOKEN",e[e.ASK_OTP=19]="ASK_OTP",e[e.ASK_MASTER_PASSWORD=20]="ASK_MASTER_PASSWORD",e[e.USE_LOCAL_UKI=21]="USE_LOCAL_UKI",e[e.ASK_DASHLANE_AUTHENTICATOR=22]="ASK_DASHLANE_AUTHENTICATOR",e[e.OTP_NOT_VALID=23]="OTP_NOT_VALID",e[e.OTP_TOO_MANY_ATTEMPTS=24]="OTP_TOO_MANY_ATTEMPTS",e[e.OTP_ALREADY_USED=25]="OTP_ALREADY_USED",e[e.BACKUP_CODE_NOT_VALID=26]="BACKUP_CODE_NOT_VALID",e[e.TOKEN_NOT_VALID=27]="TOKEN_NOT_VALID",e[e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED=28]="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e[e.SERVER_KEY_MISSING=29]="SERVER_KEY_MISSING",e[e.TOKEN_LOCKED=30]="TOKEN_LOCKED",e[e.TOKEN_TOO_MANY_ATTEMPTS=31]="TOKEN_TOO_MANY_ATTEMPTS",e[e.TOKEN_ACCOUNT_LOCKED=32]="TOKEN_ACCOUNT_LOCKED",e[e.TOKEN_EXPIRED=33]="TOKEN_EXPIRED",e[e.NO_ACTIVE_AUTHENTICATOR=34]="NO_ACTIVE_AUTHENTICATOR",e[e.FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE=35]="FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE",e[e.DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION=36]="DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION",e[e.DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED=37]="DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED",e[e.TOKEN_PROVIDED_FOR_LOCAL_SESSION=38]="TOKEN_PROVIDED_FOR_LOCAL_SESSION",e[e.DEVICE_ALREADY_REGISTERED=39]="DEVICE_ALREADY_REGISTERED",e[e.OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION=40]="OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION",e[e.DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP=41]="DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP",e[e.UNKNOWN_SYNC_ERROR=42]="UNKNOWN_SYNC_ERROR",e[e.INVALID_UKI=43]="INVALID_UKI",e[e.UNKNOWN_UKI=44]="UNKNOWN_UKI",e[e.UNKNOWN_ERROR=45]="UNKNOWN_ERROR",e[e.UNEXPECTED_OTP_TYPE=46]="UNEXPECTED_OTP_TYPE",e[e.UNAUTHORIZED=47]="UNAUTHORIZED",e[e.UNAUTHORIZED_NOT_VALID_CONTENT=48]="UNAUTHORIZED_NOT_VALID_CONTENT",e[e.NETWORK_ERROR=49]="NETWORK_ERROR",e[e.THROTTLED=50]="THROTTLED",e[e.SESSION_ALREADY_OPENED=51]="SESSION_ALREADY_OPENED",e[e.INVALID_SESSION=52]="INVALID_SESSION",e[e.DEVICE_NOT_REGISTERED=53]="DEVICE_NOT_REGISTERED",e[e.MISSING_APP_KEYS=54]="MISSING_APP_KEYS",e[e.PROVIDE_EXTRA_DEVICE_TOKEN=55]="PROVIDE_EXTRA_DEVICE_TOKEN",e[e.PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE=56]="PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE",e[e.PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE=57]="PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE",e[e.ASK_OTP_FOR_NEW_DEVICE=58]="ASK_OTP_FOR_NEW_DEVICE",e[e.TEAM_GENERIC_ERROR=59]="TEAM_GENERIC_ERROR",e[e.SSO_LOGIN_BYPASS=60]="SSO_LOGIN_BYPASS",e[e.SSO_VERIFICATION_FAILED=61]="SSO_VERIFICATION_FAILED",e[e.SSO_BLOCKED=62]="SSO_BLOCKED",e[e.CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION=63]="CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION",e[e.USER_DOESNT_EXIST_SSO=64]="USER_DOESNT_EXIST_SSO"}(a||(t.AuthenticationCode=a={}))},1295:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.autofillDataQueriesSlots=void 0;const s=r(30504);t.autofillDataQueriesSlots={getSingleAddressForAutofill:(0,s.slot)(),getMultipleAddressesForAutofill:(0,s.slot)(),getSingleBankAccountForAutofill:(0,s.slot)(),getMultipleBankAccountsForAutofill:(0,s.slot)(),getSingleCompanyForAutofill:(0,s.slot)(),getMultipleCompaniesForAutofill:(0,s.slot)(),getSingleCredentialForAutofill:(0,s.slot)(),getMultipleCredentialsForAutofill:(0,s.slot)(),getSingleDriverLicenseForAutofill:(0,s.slot)(),getMultipleDriverLicensesForAutofill:(0,s.slot)(),getSingleEmailForAutofill:(0,s.slot)(),getMultipleEmailsForAutofill:(0,s.slot)(),getSingleFiscalIdForAutofill:(0,s.slot)(),getMultipleFiscalIdsForAutofill:(0,s.slot)(),getSingleGeneratedPasswordForAutofill:(0,s.slot)(),getMultipleGeneratedPasswordsForAutofill:(0,s.slot)(),getSingleIdCardForAutofill:(0,s.slot)(),getMultipleIdCardsForAutofill:(0,s.slot)(),getSingleIdentityForAutofill:(0,s.slot)(),getMultipleIdentitiesForAutofill:(0,s.slot)(),getSingleNoteForAutofill:(0,s.slot)(),getMultipleNotesForAutofill:(0,s.slot)(),getSinglePasskeyForAutofill:(0,s.slot)(),getSinglePassportForAutofill:(0,s.slot)(),getMultiplePassportsForAutofill:(0,s.slot)(),getSinglePaymentCardForAutofill:(0,s.slot)(),getMultiplePaymentCardsForAutofill:(0,s.slot)(),getSinglePersonalWebsiteForAutofill:(0,s.slot)(),getMultiplePersonalWebsitesForAutofill:(0,s.slot)(),getSinglePhoneForAutofill:(0,s.slot)(),getMultiplePhonesForAutofill:(0,s.slot)(),getSingleSocialSecurityIdForAutofill:(0,s.slot)(),getMultipleSocialSecurityIdsForAutofill:(0,s.slot)(),getAutofillSettingOnUrlForAutofill:(0,s.slot)()}},94372:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1295),t),i(r(37905),t),i(r(60188),t),i(r(42362),t)},60188:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},37905:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.AutofillOptions=void 0,function(e){e.ANALYSIS_ENABLED_ON_ALL_FORMS="ANALYSIS_ENABLED_ON_ALL_FORMS",e.ANALYSIS_ENABLED_ONLY_ON_LOGINS_AND_PASSWORDS="ANALYSIS_ENABLED_ONLY_ON_LOGINS_AND_PASSWORDS"}(r||(t.AutofillOptions=r={}))},42362:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.vaultSourceTypeToDataModelTypeMap=void 0;const s=r(62864),i=r(44225);t.vaultSourceTypeToDataModelTypeMap={[s.VaultSourceType.Address]:i.DataModelType.KWAddress,[s.VaultSourceType.BankAccount]:i.DataModelType.KWBankStatement,[s.VaultSourceType.Company]:i.DataModelType.KWCompany,[s.VaultSourceType.Credential]:i.DataModelType.KWAuthentifiant,[s.VaultSourceType.DriverLicense]:i.DataModelType.KWDriverLicence,[s.VaultSourceType.Email]:i.DataModelType.KWEmail,[s.VaultSourceType.FiscalId]:i.DataModelType.KWFiscalStatement,[s.VaultSourceType.GeneratedPassword]:i.DataModelType.KWGeneratedPassword,[s.VaultSourceType.IdCard]:i.DataModelType.KWIDCard,[s.VaultSourceType.Identity]:i.DataModelType.KWIdentity,[s.VaultSourceType.NoteCategory]:i.DataModelType.KWSecureNoteCategory,[s.VaultSourceType.Note]:i.DataModelType.KWSecureNote,[s.VaultSourceType.Passkey]:i.DataModelType.KWPasskey,[s.VaultSourceType.Passport]:i.DataModelType.KWPassport,[s.VaultSourceType.PaymentCard]:i.DataModelType.KWPaymentMean_creditCard,[s.VaultSourceType.PersonalWebsite]:i.DataModelType.KWPersonalWebsite,[s.VaultSourceType.Phone]:i.DataModelType.KWPhone,[s.VaultSourceType.SocialSecurityId]:i.DataModelType.KWSocialSecurityStatement,[s.VaultSourceType.Secret]:i.DataModelType.KWSecret}},39229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonApiConnector=void 0;const s=r(30504),i=r(52240),a=r(78178),o=r(90397);t.CarbonApiConnector=(0,s.combineEvents)(i.carbonCommandsSlots,a.carbonQueriesSlots,o.carbonLiveQueriesSlots)},52240:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonCommandsSlots=void 0;const s=r(30504),i=r(28249),a=r(29004),o=r(25098),n=r(15874),c=r(50459),l=r(14811),d=r(30897),u=r(65005),p=r(29450),h=r(96035),m=r(6666),g=r(15925),v=r(68183),y=r(6768),_=r(58290),f=r(78779),S=r(37174),E=r(60687),b=r(77277),w=r(49106),A=r(68440),C=r(34852),I=r(31525),T=r(9987),P=r(57369),O=r(22162),R=r(31955),D=r(88219);t.carbonCommandsSlots=(0,s.combineEvents)(i.abTestsCommandsSlots,o.authenticationCommandsSlots,n.changeMasterPasswordCommandsSlots,a.contactInfoCommandsSlots,c.cryptoMigrationCommandsSlots,l.darkWebInsightsCommandsSlots,d.dataManagementCommandsSlots,g.eventLoggerCommandsSlots,v.exceptionCommandsSlots,u.familyCommandsSlots,h.globalExtensionSettingsCommandsSlots,m.healthCommandsSlots,y.loginCommandsSlots,_.loginNotificationsCommandsSlots,f.loginStepInfoCommandsSlots,S.notificationsCommandsSlots,E.openSessionCommandsSlots,b.passwordGeneratorCommandsSlots,w.paymentsCommandsSlots,A.protectedItemsUnlockerCommandsSlots,C.recoveryCommandsSlots,p.remoteFileCommandsSlots,I.sharingCommandsSlots,T.teamCommandsSlots,P.teamAdminCommandsSlots,O.userMessagesCommandsSlots,R.vpnCommandsSlots,D.deviceCommandsSlots)},90397:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonLiveQueriesSlots=void 0;const s=r(30504),i=r(28249),a=r(29004),o=r(90041),n=r(33773),c=r(65722),l=r(25098),d=r(30897),u=r(15874),p=r(50459),h=r(29450),m=r(24875),g=r(58290),v=r(78779),y=r(37174),_=r(60687),f=r(68440),S=r(34852),E=r(31525),b=r(57369),w=r(22162),A=r(31955);t.carbonLiveQueriesSlots=(0,s.combineEvents)(i.abTestsLiveQueriesSlots,n.accountCreationLiveQueriesSlots,c.antiPhishingLiveQueriesSlots,l.authenticationLiveQueriesSlots,u.changeMasterPasswordLiveQueriesSlots,a.contactInfoLiveQueriesSlots,p.cryptoMigrationLiveQueriesSlots,d.dataManagementLiveQueriesSlots,m.killswitchLiveQueriesSlots,g.loginNotificationsLiveQueriesSlots,v.loginStepInfoLiveQueriesSlots,y.notificationsLiveQueriesSlots,_.openSessionLiveQueriesSlots,f.protectedItemsUnlockerLiveQueriesSlots,S.recoveryLiveQueriesSlots,h.remoteFilesLiveQueriesSlots,E.sharingLiveQueriesSlots,o.subscriptionCodeLiveQueriesSlots,b.teamAdminLiveQueriesSlots,w.userMessagesLiveQueriesSlots,A.vpnLiveQueriesSlots)},78178:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonQueriesSlots=void 0;const s=r(30504),i=r(28249),a=r(29004),o=r(90041),n=r(25098),c=r(94372),l=r(30897),d=r(50459),u=r(88219),p=r(80898),h=r(29450),m=r(24875),g=r(58290),v=r(78779),y=r(37174),_=r(60687),f=r(77277),S=r(49106),E=r(68440),b=r(34852),w=r(98655),A=r(31525),C=r(9987),I=r(57369),T=r(22162),P=r(31955);t.carbonQueriesSlots=(0,s.combineEvents)(i.abTestsQueriesSlots,n.authenticationQueriesSlots,c.autofillDataQueriesSlots,a.contactInfoQueriesSlots,d.cryptoMigrationQueriesSlots,l.dataManagementQueriesSlots,u.deviceQueriesSlots,p.featureQueriesSlots,m.killswitchQueriesSlots,g.loginNotificationsQueriesSlots,v.loginStepInfoQueriesSlots,y.notificationsQueriesSlots,_.openSessionQueriesSlots,f.passwordGeneratorQueriesSlots,S.paymentsQueriesSlots,E.protectedItemsUnlockerQueriesSlots,b.recoveryQueriesSlots,h.remoteFilesQueriesSlots,A.sharingQueriesSlots,w.staticDataQueriesSlots,o.subscriptionCodeQueriesSlots,C.teamQueriesSlots,I.teamAdminQueriesSlots,T.userMessagesQueriesSlots,P.vpnQueriesSlots)},8438:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(52240),t),i(r(90397),t),i(r(78178),t),i(r(39229),t)},72345:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(60283),t),i(r(910),t),i(r(8438),t),i(r(53143),t)},910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},60283:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.liveSlot=void 0;const s=r(30504),i={noBuffer:!0};t.liveSlot=()=>(0,s.slot)(i)},53143:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},35715:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonDebugConnector=void 0;const s=r(30504);t.CarbonDebugConnector={log:(0,s.slot)(),info:(0,s.slot)(),warning:(0,s.slot)(),error:(0,s.slot)()}},11873:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},80112:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(35715),t),i(r(11873),t)},79702:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonDiagnosticConnector=void 0;const s=r(30504);t.CarbonDiagnosticConnector={decipheringDiagnosticLogEvent:(0,s.slot)()}},31427:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},55334:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(79702),t),i(r(31427),t)},80213:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.changeMasterPasswordLiveQueriesSlots=t.changeMasterPasswordCommandsSlots=void 0;const s=r(30504),i=r(72345);t.changeMasterPasswordCommandsSlots={changeMasterPassword:(0,s.slot)()},t.changeMasterPasswordLiveQueriesSlots={liveChangeMasterPasswordStatus:(0,i.liveSlot)()}},15874:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(80213),t),i(r(14776),t)},14776:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ChangeMasterPasswordStepNeeded=t.ChangeMasterPasswordCode=t.ChangeMPFlowPath=void 0,function(e){e.USER_CHANGING_MP="USER_CHANGING_MP",e.MP_TO_SSO="MP_TO_SSO",e.SSO_TO_MP="SSO_TO_MP",e.TO_EMAIL_TOKEN="EMAIL_TOKEN",e.ADMIN_ASSISTED_RECOVERY="ADMIN_ASSISTED_RECOVERY",e.ACCOUNT_RECOVERY_KEY="ACCOUNT_RECOVERY_KEY"}(r||(t.ChangeMPFlowPath=r={})),function(e){e.FEATURE_BLOCKED="feature_blocked",e.INNACTIVE_SESSION="inactive_session",e.INVALID_TOKEN="invalid_token",e.OTP_PROBLEM="otp_problem",e.MP_ERROR="mp_error",e.MP_STRENGTH_ERROR="mp_strength_error",e.SUCCESS="success",e.SYNC_PROGRESS="sync_in_progress",e.UNKNOWN_ERROR="unknown_error",e.WRONG_PASSWORD="wrong_password",e.UNEXPECTED_STATE="unexpected_state"}(s||(t.ChangeMasterPasswordCode=s={})),function(e){e.DOWNLOAD="download",e.DECRYPTING="decrypting",e.ENCRYPTING="encrypting",e.UPLOADING="uploading",e.DONE="done",e.ERROR="error"}(i||(t.ChangeMasterPasswordStepNeeded=i={}))},23411:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.cryptoMigrationLiveQueriesSlots=t.cryptoMigrationQueriesSlots=t.cryptoMigrationCommandsSlots=void 0;const s=r(30504),i=r(72345);t.cryptoMigrationCommandsSlots={changeUserCrypto:(0,s.slot)()},t.cryptoMigrationQueriesSlots={getCanUserChangeCrypto:(0,s.slot)(),getUserDerivationMethod:(0,s.slot)()},t.cryptoMigrationLiveQueriesSlots={liveUserDerivationMethod:(0,i.liveSlot)()}},50459:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(23411),t),i(r(92490),t)},92490:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.SupportedDerivationMethods=t.CryptoMigrationApiErrorType=void 0,function(e){e.ChangeUserCryptoFailed="CHANGE_USER_CRYPTO_FAILED"}(r||(t.CryptoMigrationApiErrorType=r={})),function(e){e.ARGON2D="argon2d",e.PBKDF2="pbkdf2",e.KWC3="kwc3"}(s||(t.SupportedDerivationMethods=s={}))},10130:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.darkWebInsightsCommandsSlots=void 0;const s=r(30504);t.darkWebInsightsCommandsSlots={getDarkWebInsightsReportResults:(0,s.slot)(),getDarkWebInsightsSummary:(0,s.slot)()}},14811:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(10130),t),i(r(76128),t)},76128:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.EmailIncidentViewStatuses=t.DarkWebInsightsBreachType=t.DarkWebInsightsApiErrorType=void 0,function(e){e.GetDarkWebInsightsFailed="GET_DARK_WEB_INSIGHTS_FAILED",e.GetDarkWebInsightsSummaryFailed="GET_DARK_WEB_INSIGHTS_SUMMARY_FAILED"}(r||(t.DarkWebInsightsApiErrorType=r={})),function(e){e.Password="password",e.CreditCard="creditcard",e.IPAddress="ip",e.MailingAddress="address",e.Phone="phone",e.Email="email",e.Social="social",e.GeoLocation="geolocation",e.UserName="username",e.PersonalInfo="personalinfo"}(s||(t.DarkWebInsightsBreachType=s={})),t.EmailIncidentViewStatuses=Object.freeze({New:"new",Viewed:"viewed"})},47495:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isAddress=void 0,t.isAddress=function(e){return Boolean(e)&&"KWAddress"===e.kwType}},76647:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isBankAccount=void 0,t.isBankAccount=function(e){return Boolean(e)&&"KWBankStatement"===e.kwType}},15381:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isBreach=t.BreachStatus=void 0,function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(r||(t.BreachStatus=r={})),t.isBreach=function(e){return Boolean(e)&&"KWSecurityBreach"===e.kwType}},39093:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCollection=void 0,t.isCollection=function(e){return Boolean(e)&&"KWCollection"===e.kwType}},270:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isObjectLocalized=t.isDataModelObject=t.dataModelTypes=t.transactionTypes=t.getTransactionTypeFromDataModelType=t.getDataModelTypeFromTransactionType=t.TRANSACTION_TYPE_TO_DATAMODEL_TYPE=t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE=t.TransactionType=t.DataModelType=t.getLocalFormat=t.Country=void 0;const s=r(50415);var i;!function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW",e.AQ="AQ",e.AX="AX",e.BV="BV",e.CC="CC",e.CX="CX",e.EH="EH",e.GS="GS",e.HM="HM",e.PN="PN",e.SJ="SJ",e.UM="UM"}(i||(t.Country=i={})),t.getLocalFormat=function(e){return e.LocaleFormat},t.DataModelType=(0,s.Enum)("KWAddress","KWAuthCategory","KWAuthentifiant","KWBankStatement","KWCollection","KWCompany","KWDataChangeHistory","KWDriverLicence","KWEmail","KWFiscalStatement","KWGeneratedPassword","KWIDCard","KWIdentity","KWMerchand","KWMiscData","KWPasskey","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWPurchaseAccount","KWPurchaseCategory","KWPurchasePaidBasket","KWPurchaseTrueArticle","KWSecret","KWSecureFileInfo","KWSecureNote","KWSecureNoteCategory","KWSecurityBreach","KWSettingsManagerApp","KWSocialSecurityStatement","KWWebSite"),t.TransactionType=(0,s.Enum)("ADDRESS","AUTHENTIFIANT","AUTH_CATEGORY","BANKACCESS","BANKACCOUNT","BANKCATEGORY","BANKINSTITUTION","BANKSITE","BANKSTATEMENT","BANKTRANSACTION","COLLECTION","COMPANY","DATA_CHANGE_HISTORY","DATA_USAGE_HISTORY","DEFAULT_AUTHENTIFIANT","DEFAULT_CONFIDENTIAL","DEFAULT_IDENTITY","DEFAULT_MISC","DEFAULT_PAYMENTMEANS","DEFAULT_REWARDCARD","DRIVERLICENCE","EMAIL","EMERGENCY_BUNDLE_FULL","EMERGENCY_BUNDLE_LITE","FULLBACKUP","FISCALSTATEMENT","GENERATED_PASSWORD","IDCARD","IDENTITY","INVOICEACCESS","INVOICEELEMENT","INVOICEINSTITUTION","MERCHANT","MISCDATA","PASSKEY","PASSPORT","PAYMENTMEANS_CREDITCARD","PAYMENTMEAN_PAYPAL","PERSONALWEBSITE","PHONE","POINTS","PURCHASEABANDONNEDBASKET","PURCHASEACCOUNT","PURCHASEARTICLE","PURCHASEBASKET","PURCHASEDELIVERYARTICLE","PURCHASEOPTIONARTICLE","PURCHASEPAIDBASKET","PURCHASE_CATEGORY","REWARDCARD","SECRET","SECUREFILEINFO","SECURENOTE","SECURENOTE_CATEGORY","SECURITYALERT","SECURITYALERTS","SECURITYBREACH","SETTINGS","SHARING_GROUP","SOCIALSECURITYSTATEMENT","WEBSITE"),t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE={KWAddress:t.TransactionType.ADDRESS,KWAuthCategory:t.TransactionType.AUTH_CATEGORY,KWAuthentifiant:t.TransactionType.AUTHENTIFIANT,KWCollection:t.TransactionType.COLLECTION,KWBankStatement:t.TransactionType.BANKSTATEMENT,KWCompany:t.TransactionType.COMPANY,KWDataChangeHistory:t.TransactionType.DATA_CHANGE_HISTORY,KWDriverLicence:t.TransactionType.DRIVERLICENCE,KWEmail:t.TransactionType.EMAIL,KWFiscalStatement:t.TransactionType.FISCALSTATEMENT,KWGeneratedPassword:t.TransactionType.GENERATED_PASSWORD,KWIDCard:t.TransactionType.IDCARD,KWIdentity:t.TransactionType.IDENTITY,KWMerchand:t.TransactionType.MERCHANT,KWMiscData:t.TransactionType.MISCDATA,KWPasskey:t.TransactionType.PASSKEY,KWPassport:t.TransactionType.PASSPORT,KWPaymentMean_creditCard:t.TransactionType.PAYMENTMEANS_CREDITCARD,KWPaymentMean_paypal:t.TransactionType.PAYMENTMEAN_PAYPAL,KWPersonalWebsite:t.TransactionType.PERSONALWEBSITE,KWPhone:t.TransactionType.PHONE,KWPurchaseAccount:t.TransactionType.PURCHASEACCOUNT,KWPurchaseCategory:t.TransactionType.PURCHASE_CATEGORY,KWPurchasePaidBasket:t.TransactionType.PURCHASEPAIDBASKET,KWPurchaseTrueArticle:t.TransactionType.PURCHASEARTICLE,KWSecret:t.TransactionType.SECRET,KWSecureFileInfo:t.TransactionType.SECUREFILEINFO,KWSecureNote:t.TransactionType.SECURENOTE,KWSecureNoteCategory:t.TransactionType.SECURENOTE_CATEGORY,KWSecurityBreach:t.TransactionType.SECURITYBREACH,KWSettingsManagerApp:t.TransactionType.SETTINGS,KWSocialSecurityStatement:t.TransactionType.SOCIALSECURITYSTATEMENT,KWWebSite:t.TransactionType.WEBSITE},t.TRANSACTION_TYPE_TO_DATAMODEL_TYPE=Object.values(t.DataModelType).reduce(((e,r)=>(e[t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE[r]]=r,e)),{}),t.getDataModelTypeFromTransactionType=function(e){const r=t.TRANSACTION_TYPE_TO_DATAMODEL_TYPE[e];if(!r)throw new Error(`No DataModelType found for TransactionType '${e}'`);return r},t.getTransactionTypeFromDataModelType=function(e){if(!t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE[e])throw new Error(`No TransactionType found for DataModelType ${e}`);return t.DATAMODEL_TYPE_TO_TRANSACTION_TYPE[e]},t.transactionTypes=s.Enum.keys(t.TransactionType),t.dataModelTypes=s.Enum.keys(t.DataModelType);t.isDataModelObject=e=>!!e.LocaleFormat&&"string"==typeof e.SpaceId,t.isObjectLocalized=function(e){return Boolean(e)&&("KWPhone"===e.kwType||"KWIdentity"===e.kwType||"KWAddress"===e.kwType||"KWBankStatement"===e.kwType)}},59761:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompany=void 0,t.isCompany=function(e){return Boolean(e)&&"KWCompany"===e.kwType}},77467:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCredential=t.isCredentialCategory=void 0,t.isCredentialCategory=function(e){return Boolean(e)&&"KWAuthCategory"===e.kwType},t.isCredential=function(e){return Boolean(e)&&"KWAuthentifiant"===e.kwType}},79840:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isDriverLicense=void 0,t.isDriverLicense=function(e){return Boolean(e)&&"KWDriverLicence"===e.kwType}},21563:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isEmail=void 0,t.isEmail=function(e){return Boolean(e)&&"KWEmail"===e.kwType}},19200:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},71148:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isFiscalId=void 0,t.isFiscalId=function(e){return Boolean(e)&&"KWFiscalStatement"===e.kwType}},34314:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isGeneratedPassword=void 0,t.isGeneratedPassword=function(e){return Boolean(e)&&"KWGeneratedPassword"===e.kwType}},33092:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},45633:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isIdCard=void 0,t.isIdCard=function(e){return Boolean(e)&&"KWIDCard"===e.kwType}},36070:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isIdentity=void 0,t.isIdentity=function(e){return Boolean(e)&&"KWIdentity"===e.kwType}},15578:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LinkedWebsiteSource=void 0,function(e){e.Manual="manual",e.Remember="remember"}(r||(t.LinkedWebsiteSource=r={}))},25353:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isNote=t.isNoteCategory=t.NoteTypes=void 0,t.NoteTypes=["GRAY","PURPLE","GREEN","BLUE","YELLOW","ORANGE","PINK","BROWN","RED"],t.isNoteCategory=function(e){return Boolean(e)&&"KWSecureNoteCategory"===e.kwType},t.isNote=function(e){return Boolean(e)&&"KWSecureNote"===e.kwType}},9455:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPasskey=void 0,t.isPasskey=function(e){return Boolean(e)&&"KWPasskey"===e.kwType}},38275:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPassport=void 0,t.isPassport=function(e){return Boolean(e)&&"KWPassport"===e.kwType}},12728:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPaymentCard=t.PaymentCardColor=t.PaymentCardType=void 0;const s=r(50415);t.PaymentCardType=(0,s.Enum)("PAYMENT_TYPE_VISA","PAYMENT_TYPE_MASTERCARD","PAYMENT_TYPE_AMEX","PAYMENT_TYPE_DISCOVER","PAYMENT_TYPE_JCB","PAYMENT_TYPE_DINERSCLUB"),t.PaymentCardColor=(0,s.Enum)("BLACK","SILVER","WHITE","RED","ORANGE","GOLD","BLUE_1","BLUE_2","GREEN_1","GREEN_2"),t.isPaymentCard=function(e){return Boolean(e)&&"KWPaymentMean_creditCard"===e.kwType}},76756:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPaypalAccount=void 0,t.isPaypalAccount=function(e){return Boolean(e)&&"KWPaymentMean_paypal"===e.kwType}},95701:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPersonalSettings=void 0,t.isPersonalSettings=function(e){return Boolean(e)&&"KWSettingsManagerApp"===e.kwType}},41667:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPersonalWebsite=void 0,t.isPersonalWebsite=function(e){return Boolean(e)&&"KWPersonalWebsite"===e.kwType}},91760:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isPhone=t.PhoneType=void 0;const s=r(50415);t.PhoneType=(0,s.Enum)("PHONE_TYPE_ANY","PHONE_TYPE_MOBILE","PHONE_TYPE_LANDLINE","PHONE_TYPE_FAX","PHONE_TYPE_WORK_MOBILE","PHONE_TYPE_WORK_LANDLINE","PHONE_TYPE_WORK_FAX"),t.isPhone=function(e){return Boolean(e)&&"KWPhone"===e.kwType}},98661:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSecret=void 0,t.isSecret=function(e){return Boolean(e)&&"KWSecret"===e.kwType}},33952:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSecureFileInfo=void 0,t.isSecureFileInfo=function(e){return Boolean(e)&&"KWSecureFileInfo"===e.kwType}},96949:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isSocialSecurityId=void 0,t.isSocialSecurityId=function(e){return Boolean(e)&&"KWSocialSecurityStatement"===e.kwType}},47357:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47495),t),i(r(76647),t),i(r(15381),t),i(r(39093),t),i(r(270),t),i(r(59761),t),i(r(77467),t),i(r(79840),t),i(r(21563),t),i(r(19200),t),i(r(71148),t),i(r(34314),t),i(r(33092),t),i(r(45633),t),i(r(36070),t),i(r(15578),t),i(r(25353),t),i(r(9455),t),i(r(38275),t),i(r(12728),t),i(r(76756),t),i(r(95701),t),i(r(41667),t),i(r(91760),t),i(r(98661),t),i(r(33952),t),i(r(96949),t)},24635:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},44225:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47357),t),i(r(24635),t)},34694:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceCommandsSlots=t.deviceQueriesSlots=void 0;const s=r(30504);t.deviceQueriesSlots={getAnonymousComputerId:(0,s.slot)(),getPlatformInfo:(0,s.slot)()},t.deviceCommandsSlots={cleanRemotelyRemovedProfiles:(0,s.slot)()}},88219:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(34694),t)},98792:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceLimitCapabilityConnector=void 0;const s=r(30504);t.DeviceLimitCapabilityConnector={deviceLimitCapabilityUpdated:(0,s.slot)()}},43245:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(98792),t)},99103:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},70242:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionCarbonConnector=void 0;const s=r(30504);t.ExtensionCarbonConnector={loginStatusChanged:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),deactivateDeviceResult:(0,s.slot)({noBuffer:!0}),changeDeviceNameResult:(0,s.slot)({noBuffer:!0}),accountFeaturesChanged:(0,s.slot)({noBuffer:!0}),webOnboardingModeUpdated:(0,s.slot)({noBuffer:!0}),askWebsiteInfo:(0,s.slot)({noBuffer:!0}),getAccountInfo:(0,s.slot)({noBuffer:!0}),getAnonymousLogsMetadata:(0,s.slot)({noBuffer:!0}),checkIfMasterPasswordIsValid:(0,s.slot)({noBuffer:!0}),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionWithMasterPassword:(0,s.slot)({noBuffer:!0}),openExtraDeviceSession:(0,s.slot)({noBuffer:!0}),openSessionWithExtraDeviceToken:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)({noBuffer:!0}),closeSession:(0,s.slot)({noBuffer:!0}),lockSession:(0,s.slot)({noBuffer:!0}),exceptionLog:(0,s.slot)({noBuffer:!0}),getDevicesList:(0,s.slot)({noBuffer:!0}),getLocalAccountsList:(0,s.slot)({noBuffer:!0}),deactivateDevice:(0,s.slot)({noBuffer:!0}),changeDeviceName:(0,s.slot)({noBuffer:!0}),updateWebOnboardingMode:(0,s.slot)({noBuffer:!0})}},28413:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(70242),t)},56376:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionDebugConnector=void 0;const s=r(30504);t.ExtensionDebugConnector={getExtensionId:(0,s.slot)(),switchExtensionToStandalone:(0,s.slot)(),showInput:(0,s.slot)(),showFormOnPage:(0,s.slot)(),signalTti:(0,s.slot)(),signalDatabasesSent:(0,s.slot)()}},13981:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtensionDebugEventType=void 0;const s=r(50415);t.ExtensionDebugEventType=(0,s.Enum)("GET_EXTENSION_ID","SIGNAL_TTI","DATABASES_SEND","SHOW_INPUT","SHOW_FORM_ON_PAGE","SWITCH_TO_STANDALONE")},91609:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(56376),t),i(r(13981),t)},21818:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.familyCommandsSlots=void 0;const s=r(30504);t.familyCommandsSlots={getFamilyDetails:(0,s.slot)(),joinFamily:(0,s.slot)(),leaveFamily:(0,s.slot)(),removeFamilyMember:(0,s.slot)(),resetFamilyJoinToken:(0,s.slot)()}},65005:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(21818),t),i(r(50647),t)},50647:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.FamilyRenewalPlatform=t.FamilyMemberRoles=t.FamilyStatusCode=t.JoinFamilyUserStatus=void 0,function(e){e.NEW_USER="NEW_USER",e.EXISTING_FREE_USER="EXISTING_FREE_USER",e.EXISTING_PREMIUM_USER="EXISTING_PREMIUM_USER"}(r||(t.JoinFamilyUserStatus=r={})),function(e){e[e.DISCONTINUED=0]="DISCONTINUED",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_PLUS=2]="PREMIUM_PLUS"}(s||(t.FamilyStatusCode=s={})),t.FamilyMemberRoles=Object.freeze({ADMIN:"admin",REGULAR:"regular",REMOVED:"removed"}),function(e){e.IOS_APP_STORE="ios",e.MAC_STORE="mac",e.PLAY_STORE="playstore"}(i||(t.FamilyRenewalPlatform=i={}))},33824:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.featureQueriesSlots=void 0;const s=r(30504);t.featureQueriesSlots={getHasFeature:(0,s.slot)(),getFeatures:(0,s.slot)()}},80898:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(78674),t),i(r(33824),t)},78674:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},4126:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.remoteFilesLiveQueriesSlots=t.remoteFilesQueriesSlots=t.remoteFileCommandsSlots=void 0;const s=r(30504),i=r(72345);t.remoteFileCommandsSlots={decipherRemoteFile:(0,s.slot)()},t.remoteFilesQueriesSlots={getFileContent:(0,s.slot)()},t.remoteFilesLiveQueriesSlots={liveFileMeta:(0,i.liveSlot)()}},29450:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4126),t),i(r(46046),t)},46046:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FileNamesList=t.SERVER_ERROR_HTTP_STATUS=t.UNSPECIFIED_ERROR=t.FILE_NOT_UPDATED=t.FILE_NOT_FOUND_HTTP_STATUS=t.NO_CURRENT_UPDATE_HTTP_STATUS=t.UPDATE_AVAILABLE_HTTP_STATUS=void 0,t.UPDATE_AVAILABLE_HTTP_STATUS="update_available",t.NO_CURRENT_UPDATE_HTTP_STATUS="unknown_revision",t.FILE_NOT_FOUND_HTTP_STATUS="not_found",t.FILE_NOT_UPDATED="not_updated",t.UNSPECIFIED_ERROR="unspecified_error",t.SERVER_ERROR_HTTP_STATUS="error_server",t.FileNamesList=["phishing_urls_test.json"]},44605:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.globalExtensionSettingsCommandsSlots=void 0;const s=r(30504);t.globalExtensionSettingsCommandsSlots={setGlobalExtensionSettings:(0,s.slot)(),getGlobalExtensionSettings:(0,s.slot)()}},96035:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(44605),t),i(r(73054),t)},73054:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},15044:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.healthCommandsSlots=void 0;const s=r(30504);t.healthCommandsSlots={evaluatePassword:(0,s.slot)()}},6666:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(15044),t),i(r(14836),t)},14836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},24875:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(38561),t)},38561:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.killswitchLiveQueriesSlots=t.killswitchQueriesSlots=void 0;const s=r(30504),i=r(72345);t.killswitchQueriesSlots={getIsBrazeContentDisabled:(0,s.slot)(),getIsLoginFlowMigrationDisabled:(0,s.slot)(),getIsAutoSSOLoginDisabled:(0,s.slot)()},t.killswitchLiveQueriesSlots={liveIsBrazeContentDisabled:(0,i.liveSlot)(),liveIsLoginFlowMigrationDisabled:(0,i.liveSlot)(),liveIsAutoSSOLoginDisabled:(0,i.liveSlot)()}},28730:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonLeelooConnector=void 0;const s=r(30504);t.CarbonLeelooConnector={abTestingChanged:(0,s.slot)(),loginStatusChanged:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)(),spaceDataUpdated:(0,s.slot)(),teamAdminDataUpdated:(0,s.slot)(),credentialLoginUrlRetrieved:(0,s.slot)(),deactivateDeviceResult:(0,s.slot)(),changeDeviceNameResult:(0,s.slot)(),accountFeaturesChanged:(0,s.slot)(),updatePaymentCardTokenResult:(0,s.slot)(),webOnboardingModeUpdated:(0,s.slot)(),currentLocationUpdated:(0,s.slot)(),checkDirectorySyncKeyRequest:(0,s.slot)(),encryptSettingsResultUpdated:(0,s.slot)(),confirmCreateAccountResultUpdated:(0,s.slot)(),sendSharingResponseResult:(0,s.slot)(),serverSidePairingStatusChanged:(0,s.slot)(),getUki:(0,s.slot)(),getAccountInfo:(0,s.slot)(),getDevicesList:(0,s.slot)(),getLocalAccountsList:(0,s.slot)(),getTemporaryToken:(0,s.slot)(),deactivateDevice:(0,s.slot)(),changeDeviceName:(0,s.slot)(),getInvoices:(0,s.slot)(),getPersonalSettings:(0,s.slot)(),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionWithMasterPassword:(0,s.slot)({noBuffer:!0}),openExtraDeviceSession:(0,s.slot)({noBuffer:!0}),openSessionWithExtraDeviceToken:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)(),closeSession:(0,s.slot)(),lockSession:(0,s.slot)({noBuffer:!0}),cancelPremiumSubscription:(0,s.slot)(),createUserGroup:(0,s.slot)(),deleteUserGroup:(0,s.slot)(),renameUserGroup:(0,s.slot)(),inviteUserGroupMembers:(0,s.slot)(),revokeUserGroupMembers:(0,s.slot)(),updateUserGroupMembers:(0,s.slot)(),teamUpdated:(0,s.slot)(),createAccountStep1:(0,s.slot)(),createAccountStep2:(0,s.slot)(),checkLogin:(0,s.slot)(),savePersonalDataItem:(0,s.slot)(),removePersonalDataItem:(0,s.slot)(),savePaymentCard:(0,s.slot)(),getMasterPasswordResetDemandList:(0,s.slot)(),acceptMasterPasswordResetDemand:(0,s.slot)(),checkIfMasterPasswordIsValid:(0,s.slot)(),declineMasterPasswordResetDemand:(0,s.slot)(),getMembers:(0,s.slot)(),addTeamAdmin:(0,s.slot)(),removeTeamAdmin:(0,s.slot)(),setTeamSettings:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)(),checkDirectorySyncKeyResponse:(0,s.slot)(),queryStaticDataCollections:(0,s.slot)(),sendSharingResponse:(0,s.slot)(),revokeSharing:(0,s.slot)(),updateSharingPermission:(0,s.slot)(),setPendingElementsAsSeen:(0,s.slot)(),resumeSession:(0,s.slot)(),exceptionLog:(0,s.slot)()}},17317:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(28730),t),i(r(31291),t)},31291:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.RemovePersonalDataItemFailureReason=void 0,function(e){e[e.LEAVE_SHARING_FAILED=0]="LEAVE_SHARING_FAILED",e[e.FORBIDDEN_LAST_ADMIN=1]="FORBIDDEN_LAST_ADMIN",e[e.FORBIDDEN_GROUP_ITEM=2]="FORBIDDEN_GROUP_ITEM",e[e.NOT_AUTHORIZED=3]="NOT_AUTHORIZED",e[e.NOT_FOUND=4]="NOT_FOUND",e[e.INTERNAL_ERROR=5]="INTERNAL_ERROR"}(r||(t.RemovePersonalDataItemFailureReason=r={}))},29182:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.eventLoggerCommandsSlots=void 0;const s=r(30504);t.eventLoggerCommandsSlots={logEvent:(0,s.slot)(),logPageView:(0,s.slot)(),flushQueue:(0,s.slot)()}},15925:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29182),t),i(r(40035),t)},40035:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.StyxApiResult=void 0,function(e){e[e.AllBatchesSent=0]="AllBatchesSent",e[e.SomeBatchesSent=1]="SomeBatchesSent",e[e.NoBatchesSent=2]="NoBatchesSent"}(r||(t.StyxApiResult=r={}))},63054:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exceptionCommandsSlots=void 0;const s=r(30504);t.exceptionCommandsSlots={logException:(0,s.slot)()}},68183:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(63054),t),i(r(96103),t)},96103:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionCriticality=void 0,function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(r||(t.ExceptionCriticality=r={}))},87940:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationBuildType=t.LoggingEventType=void 0;const s=r(50415);t.LoggingEventType=(0,s.Enum)("EXCEPTION_LOG");var i=r(90693);Object.defineProperty(t,"ApplicationBuildType",{enumerable:!0,get:function(){return i.ApplicationBuildType}})},6768:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(65063),t),i(r(24309),t)},65063:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginCommandsSlots=void 0;const s=r(30504);t.loginCommandsSlots={abortDeviceLimitFlow:(0,s.slot)(),loginViaSSO:(0,s.slot)(),unlinkPreviousDevice:(0,s.slot)(),unlinkMultipleDevices:(0,s.slot)()}},24309:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.LoginViaSsoCode=t.SsoMigrationServerMethod=t.LoginResultEnum=void 0,function(e){e[e.MasterPasswordMissing=0]="MasterPasswordMissing",e[e.DeviceAuthenticationMissing=1]="DeviceAuthenticationMissing",e[e.TokenMissing=2]="TokenMissing",e[e.OTPMissing=3]="OTPMissing",e[e.AskPersistData=4]="AskPersistData",e[e.LoggedIn=5]="LoggedIn",e[e.ExtraDeviceTokenMissing=6]="ExtraDeviceTokenMissing",e[e.SSOLogin=7]="SSOLogin",e[e.DeviceLimitFlow=8]="DeviceLimitFlow",e[e.DashlaneAuthenticatorApprovalMissing=9]="DashlaneAuthenticatorApprovalMissing",e[e.DashlaneAuthenticatorApprovalCancelled=10]="DashlaneAuthenticatorApprovalCancelled",e[e.MasterPasswordLess=11]="MasterPasswordLess"}(r||(t.LoginResultEnum=r={})),function(e){e.SSO="sso",e.MP="master_password"}(s||(t.SsoMigrationServerMethod=s={})),function(e){e.SUCCESS="SUCCESS",e.ASK_NEW_MP="ASK_NEW_MP",e.EMPTY_LOGIN="EMPTY_LOGIN",e.INNACTIVE_SESSION="INNACTIVE_SESSION",e.SSO_VERIFICATION_FAILED="SSO_VERIFICATION_FAILED",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.UNSUPPORTED_TRANSITION="UNSUPPORTED_TRANSITION",e.WRONG_PASSWORD="WRONG_PASSWORD",e.SSO_LOGIN_CORRUPT="SSO_LOGIN_CORRUPT"}(i||(t.LoginViaSsoCode=i={}))},58290:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(23903),t),i(r(53168),t)},53168:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginNotificationsLiveQueriesSlots=t.loginNotificationsQueriesSlots=t.loginNotificationsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.loginNotificationsCommandsSlots={addLoginNotification:(0,s.slot)(),clearAllStoredLoginNotification:(0,s.slot)()},t.loginNotificationsQueriesSlots={getLoginNotifications:(0,s.slot)()},t.loginNotificationsLiveQueriesSlots={liveLoginNotifications:(0,i.liveSlot)()}},23903:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LoginNotificationType=void 0,function(e){e.RELOGIN_NEEDED="RELOGIN_NEEDED",e.SSO_FEATURE_BLOCKED="SSO_FEATURE_BLOCKED",e.SSO_SETUP_ERROR="SSO_SETUP_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR",e.TEAM_ACCEPTANCE_SUCCESS="TEAM_ACCEPTANCE_SUCCESS",e.TEAM_ACCEPTANCE_ERROR="TEAM_ACCEPTANCE_ERROR"}(r||(t.LoginNotificationType=r={}))},78779:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(12249),t),i(r(3455),t)},12249:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.loginStepInfoLiveQueriesSlots=t.loginStepInfoQueriesSlots=t.loginStepInfoCommandsSlots=void 0;const s=r(30504),i=r(72345);t.loginStepInfoCommandsSlots={updateLoginStepInfo:(0,s.slot)(),resetLoginStepInfo:(0,s.slot)()},t.loginStepInfoQueriesSlots={getLoginStepInfo:(0,s.slot)()},t.loginStepInfoLiveQueriesSlots={liveLoginStepInfo:(0,i.liveSlot)()}},3455:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LoginStep=void 0,function(e){e.Email="email",e.Welcome="welcome",e.OTP1="OTP1",e.OTP2="OTP2",e.BackupCodeOTP1="backupCodeOTP1",e.BackupCodeOTP2="backupCodeOTP2",e.OTPToken="token",e.Password="password",e.SSO="SSO",e.ActivateSSO="activateSSO",e.WebAuthn="webAuthn",e.WebAuthnError="webAuthnError",e.DeviceLimitReached="deviceLimitReached",e.DashlaneAuthenticator="dashlaneAuthenticator",e.PasswordLess="passwordLess"}(r||(t.LoginStep=r={}))},66478:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},48905:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},25460:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonMaverickConnector=void 0;const s=r(30504);t.CarbonMaverickConnector={savePersonalDataItem:(0,s.slot)(),filledDataItem:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)()}},98521:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(25460),t),i(r(58962),t)},58962:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},37174:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5264),t),i(r(28155),t)},28155:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.notificationsLiveQueriesSlots=t.notificationsQueriesSlots=t.notificationsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.notificationsCommandsSlots={markNotificationAsInteracted:(0,s.slot)(),markNotificationAsSeen:(0,s.slot)(),markNotificationAsUnseen:(0,s.slot)()},t.notificationsQueriesSlots={getNotificationStatus:(0,s.slot)()},t.notificationsLiveQueriesSlots={liveNotificationStatus:(0,i.liveSlot)()}},5264:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.NotificationStatus=t.NotificationName=void 0,function(e){e.PaymentFailureChurning="paymentFailureChurning",e.PaymentFailureChurned="paymentFailureChurned",e.SwitchToMlAnalysisEngine="switchToMlAnalysisEngine",e.DWMb2bAutoEnrollTooltip="dWMb2bAutoEnrollTooltip",e.TacGetTheExtensionBanner="tacGetTheExtensionBanner",e.TacEnableAccountRecoveryBanner="tacEnableAccountRecoveryBanner",e.TacOnlyOneAdminBanner="tacOnlyOneAdminBanner",e.TacDarkWebInsightsNewBadge="tacDarkWebInsightsNewBadge",e.PasswordHistoryBanner="passwordHistoryBanner",e.SharingCenterDisabledBanner="sharingCenterDisabledBanner",e.AccountRecoveryAvailableAdminTooltip="accountRecoveryAvailableAdminTooltip",e.AccountRecoveryAvailableEmployeeDialog="accountRecoveryAvailableEmployeeDialog",e.ActivateInviteLink="activateInviteLink",e.MpToSsoMigrationDoneDialog="mpToSsoMigrationDoneDialog"}(r||(t.NotificationName=r={})),function(e){e.Interacted="interacted",e.Seen="seen",e.Unseen="unseen"}(s||(t.NotificationStatus=s={}))},36632:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(58355),t)},58355:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebOnboardingPopoverStep=t.WebOnboardingLeelooStep=void 0;const s=r(50415);t.WebOnboardingLeelooStep=(0,s.Enum)("SHOW_LOGIN_USING_EXTENSION_NOTIFICATION","SHOW_SAVE_SITES_DIALOG","SHOW_PASSWORD_SAVE_SUCCESS","SHOW_WEB_SAVE_AND_AUTOLOGIN_COMPLETED","SHOW_PASSWORD_IMPORT","SHOW_GET_MOBILE_DIALOG"),t.WebOnboardingPopoverStep=(0,s.Enum)("SHOW_LOGIN_NOTIFICATION")},24281:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.Platform=void 0,function(e){e[e.Android=0]="Android",e[e.CarbonTests=1]="CarbonTests",e[e.CarbonUnknown=2]="CarbonUnknown",e[e.DesktopLegacyMacOS=3]="DesktopLegacyMacOS",e[e.DesktopLegacyWindows=4]="DesktopLegacyWindows",e[e.DesktopUWP=5]="DesktopUWP",e[e.IPad=6]="IPad",e[e.IPhone=7]="IPhone",e[e.IPod=8]="IPod",e[e.StandaloneExtension=9]="StandaloneExtension",e[e.TeamAdminConsole=10]="TeamAdminConsole",e[e.WebApp=11]="WebApp",e[e.WebAppDev=12]="WebAppDev"}(r||(t.Platform=r={}))},68557:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformView=void 0,function(e){e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp"}(r||(t.PlatformView=r={}))},54982:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.LoginDeviceLimitFlowStage=void 0,function(e){e.OneDeviceLimitReached="OneDeviceLimitReached",e.MultipleDevicesLimitReached="MultipleDevicesLimitReached",e.UnlinkingAndOpeningSession="UnlinkingAndOpeningSession",e.UnlinkingMultipleDevicesError="UnlinkingMultipleDevicesError",e.RefreshingDeviceLimitStatus="RefreshingDeviceLimitStatus",e.OpeningSessionAfterDeviceLimitRemoval="OpeningSessionAfterDeviceLimitRemoval",e.DeviceLimitDone="DeviceLimitDone"}(r||(t.LoginDeviceLimitFlowStage=r={}))},38340:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},43556:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.AbortDeviceLimitFlowError=void 0,function(e){e.UnexpectedError="UNEXPECTED_ERROR"}(r||(t.AbortDeviceLimitFlowError=r={}))},96197:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(43556),t),i(r(93522),t),i(r(44270),t),i(r(54982),t),i(r(38340),t),i(r(68557),t),i(r(61445),t),i(r(53240),t),i(r(24281),t)},93522:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UNEXPECTED_ERROR=t.USER_STILL_OVERFLOWING=void 0,t.USER_STILL_OVERFLOWING="USER_STILL_OVERFLOWING",t.UNEXPECTED_ERROR="UNEXPECTED_ERROR"},53240:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},44270:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UnlinkPreviousDeviceError=void 0,function(e){e.UnexpectedError="UNEXPECTED_ERROR"}(r||(t.UnlinkPreviousDeviceError=r={}))},61445:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},84369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deviceLimitLiveSlots=t.deviceLimitSlots=void 0;const s=r(30504),i=r(72345);t.deviceLimitSlots={getLoginDeviceLimitFlow:(0,s.slot)()},t.deviceLimitLiveSlots={liveLoginDeviceLimitFlow:(0,i.liveSlot)()}},76758:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(26749),t)},89391:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.twoFactorStatusLiveSlots=t.twoFactorStatusSlots=void 0;const s=r(30504),i=r(72345);t.twoFactorStatusSlots={getTwoFactorAuthenticationInfo:(0,s.slot)()},t.twoFactorStatusLiveSlots={liveTwoFactorAuthenticationInfo:(0,i.liveSlot)()}},26749:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.ENFORCE_TWO_FACTOR_AUTHENTICATION_ENABLED_VALUES=t.TwoFactorAuthenticationInfoRequestStatus=t.TwoFactorAuthenticationType=void 0,function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(r||(t.TwoFactorAuthenticationType=r={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(s||(t.TwoFactorAuthenticationInfoRequestStatus=s={})),function(e){e.LOGIN="login",e.NEW_DEVICE="newDevice",e.DISABLED="disabled"}(i||(i={})),t.ENFORCE_TWO_FACTOR_AUTHENTICATION_ENABLED_VALUES=[i.LOGIN,i.NEW_DEVICE]},60687:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(89884),t),i(r(22574),t),i(r(96197),t),i(r(76758),t)},22574:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.openSessionCommandsSlots=t.openSessionLiveQueriesSlots=t.openSessionQueriesSlots=void 0;const s=r(30504),i=r(72345),a=r(84369),o=r(89391);t.openSessionQueriesSlots={getLoginStatus:(0,s.slot)(),getLocalAccounts:(0,s.slot)(),getIsSSOUser:(0,s.slot)(),getSSOMigrationInfo:(0,s.slot)(),getSessionInfo:(0,s.slot)(),getMasterPasswordAndServerKey:(0,s.slot)(),getUserCryptoSettings:(0,s.slot)(),getSyncInfo:(0,s.slot)(),getIsSyncInProgress:(0,s.slot)(),getPremiumStatus:(0,s.slot)(),getNodePremiumStatus:(0,s.slot)(),getSubscriptionInformation:(0,s.slot)(),getActiveSpaces:(0,s.slot)(),getSSOProviderInfo:(0,s.slot)(),getUserLogin:(0,s.slot)(),getPublicUserId:(0,s.slot)(),getAnalyticsInstallationId:(0,s.slot)(),getUserLoginStatus:(0,s.slot)(),getWebOnboardingMode:(0,s.slot)(),getIsPaymentFailureChurningDismissed:(0,s.slot)(),getCredentialSearchOrder:(0,s.slot)(),getDidOpen:(0,s.slot)(),getPlatformName:(0,s.slot)(),getAccountAuthenticationType:(0,s.slot)(),...a.deviceLimitSlots,...o.twoFactorStatusSlots},t.openSessionLiveQueriesSlots={liveLoginStatus:(0,i.liveSlot)(),liveDidOpen:(0,i.liveSlot)(),liveIsSSOUser:(0,i.liveSlot)(),liveSSOMigrationInfo:(0,i.liveSlot)(),liveSessionInfo:(0,i.liveSlot)(),liveSyncInfo:(0,i.liveSlot)(),liveIsSyncInProgress:(0,i.liveSlot)(),livePremiumStatus:(0,i.liveSlot)(),liveServiceProviderUrl:(0,i.liveSlot)(),liveWebOnboardingMode:(0,i.liveSlot)(),liveSubscriptionInformation:(0,i.liveSlot)(),...a.deviceLimitLiveSlots,...o.twoFactorStatusLiveSlots},t.openSessionCommandsSlots={validateToken:(0,s.slot)(),validateMasterPassword:(0,s.slot)(),resetProtectedItemAutofillTimer:(0,s.slot)(),forceSync:(0,s.slot)(),updatePremiumChurningDismissDate:(0,s.slot)(),setCredentialSearchOrder:(0,s.slot)(),refreshSubscriptionInformation:(0,s.slot)(),updateAccountRecoveryKeyPersonalSettings:(0,s.slot)()}},89884:(e,t)=>{var r,s,i,a,o,n,c;Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialSearchOrder=t.SSOMigrationType=t.SpaceStatus=t.SpaceTiers=t.B2CPlanFeatures=t.SyncStatuses=t.ServerSidePairingStatus=t.possibleAdminPermissions=t.groupPermissions=t.PlanTypes=t.PremiumLogTypes=t.CapabilityKeys=t.PremiumStatusCode=void 0,function(e){e[e.NO_PREMIUM=0]="NO_PREMIUM",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_CANCELLED=2]="PREMIUM_CANCELLED",e[e.OLD_ACCOUNT=3]="OLD_ACCOUNT",e[e.NEW_USER=4]="NEW_USER",e[e.GRACE_PERIOD=5]="GRACE_PERIOD"}(r||(t.PremiumStatusCode=r={})),t.CapabilityKeys=["adminPolicies","autofillWithPhishingPrevention","collectionSharing","creditMonitoring","dataLeak","devicesLimit","identityRestoration","identityTheftProtection","multipleAccounts","passwordsLimit","phoneSupport","secretManagement","secureFiles","secureNotes","secureWiFi","securityBreach","sharingLimit","sync","yubikey","scim","sso","collectionSharing"],t.PremiumLogTypes=Object.freeze({freeTrialGranted:"free_trial_granted",premiumGranted:"premium_granted",renewed:"renewed",subscribed:"subscribed",crosssellPurchased:"crosssell_purchased",setAsLegacy:"set_as_legacy",familyCreated:"family_created",familyRenewed:"family_renewed"}),t.PlanTypes=Object.freeze({Amazon:"amazon",FreeTrial:"free_trial",Invoice:"invoice",IOS:"ios",IOSRenewable:"ios_renewable",Legacy:"legacy",Mac:"mac",MacRenewable:"mac_renewable",Offer:"offer",Partner:"partner",Paypal:"paypal",PaypalRenewable:"paypal_renewable",Playstore:"playstore",PlaystoreRenewable:"playstore_renewable",Stripe:"stripe"}),t.groupPermissions=["GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"],t.possibleAdminPermissions=["FULL","BILLING",...t.groupPermissions],function(e){e[e.UNPAIRED=0]="UNPAIRED",e[e.PAIRED=1]="PAIRED"}(s||(t.ServerSidePairingStatus=s={})),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(i||(t.SyncStatuses=i={})),function(e){e.not_in_team="not_in_team",e.proposed="proposed",e.in_team="in_team"}(a||(a={})),t.B2CPlanFeatures=Object.freeze({Premium:"premium",Essentials:"essentials",Premiumplus:"premiumplus",BackupForAll:"backup-for-all"}),t.SpaceTiers=Object.freeze({Team:"team",Business:"business",Legacy:"legacy",Entreprise:"entreprise",Free:"free",Starter:"starter",EntryLevel:"entry_level"}),function(e){e.Accepted="accepted",e.Pending="pending",e.Proposed="proposed",e.Refused="refused",e.Removed="removed",e.Revoked="revoked",e.Unproposed="unproposed"}(o||(t.SpaceStatus=o={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(n||(t.SSOMigrationType=n={})),function(e){e.NAME="name",e.DATE="date"}(c||(t.CredentialSearchOrder=c={}))},77277:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(20188),t),i(r(59417),t)},20188:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passwordGeneratorQueriesSlots=t.passwordGeneratorCommandsSlots=void 0;const s=r(30504);t.passwordGeneratorCommandsSlots={generatePassword:(0,s.slot)(),generateAndSavePassword:(0,s.slot)(),savePasswordGenerationSettings:(0,s.slot)()},t.passwordGeneratorQueriesSlots={getPasswordGenerationSettings:(0,s.slot)()}},59417:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},49106:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(54841),t),i(r(77492),t)},54841:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.paymentsQueriesSlots=t.paymentsCommandsSlots=void 0;const s=r(30504);t.paymentsCommandsSlots={cancelAutoRenew:(0,s.slot)(),downloadCustomerInvoice:(0,s.slot)(),fetchInvoiceList:(0,s.slot)(),requestRefund:(0,s.slot)()},t.paymentsQueriesSlots={getInvoicesCount:(0,s.slot)(),getInvoiceList:(0,s.slot)(),getInvoiceListYears:(0,s.slot)()}},77492:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.OrderDir=void 0,function(e){e.ascending="ascending",e.descending="descending"}(r||(t.OrderDir=r={}))},68440:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(53379),t),i(r(84493),t)},53379:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.protectedItemsUnlockerLiveQueriesSlots=t.protectedItemsUnlockerQueriesSlots=t.protectedItemsUnlockerCommandsSlots=void 0;const s=r(30504),i=r(72345);t.protectedItemsUnlockerCommandsSlots={disableCredentialProtection:(0,s.slot)(),unlockProtectedItems:(0,s.slot)()},t.protectedItemsUnlockerQueriesSlots={vaultLockDate:(0,s.slot)()},t.protectedItemsUnlockerLiveQueriesSlots={liveVaultLockDate:(0,i.liveSlot)()}},84493:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DisableCredentialProtectionStatus=t.unlockProtectedItemsWrongPasswordError=t.UnlockProtectedItemsStatus=void 0,function(e){e.SUCCESS="success",e.ERROR="error"}(r||(t.UnlockProtectedItemsStatus=r={})),t.unlockProtectedItemsWrongPasswordError="WRONG PASSWORD",function(e){e.SUCCESS="success",e.ERROR="error"}(s||(t.DisableCredentialProtectionStatus=s={}))},34852:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(36569),t),i(r(6461),t)},36569:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.recoveryLiveQueriesSlots=t.recoveryQueriesSlots=t.recoveryCommandsSlots=void 0;const s=r(30504),i=r(72345);t.recoveryCommandsSlots={activateAccountRecovery:(0,s.slot)(),setupMasterPasswordForRecovery:(0,s.slot)(),deactivateAccountRecovery:(0,s.slot)(),registerDeviceForRecovery:(0,s.slot)(),startAccountRecovery:(0,s.slot)(),sendRecoveryRequest:(0,s.slot)(),cancelRecoveryRequest:(0,s.slot)(),checkRecoveryRequestStatus:(0,s.slot)(),recoverUserData:(0,s.slot)(),checkDoesLocalRecoveryKeyExist:(0,s.slot)(),isRecoveryRequestPending:(0,s.slot)()},t.recoveryQueriesSlots={getRecoveryOptInSetting:(0,s.slot)(),getShouldShowFeatureActivationModal:(0,s.slot)(),getAccountRecoveryRequestCount:(0,s.slot)()},t.recoveryLiveQueriesSlots={liveAccountRecoveryRequestCount:(0,i.liveSlot)()}},6461:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.RequestStatus=t.RecoveryApiErrorType=void 0,function(e){e.CheckRecoveryStatusFailed="CHECK_RECOVERY_STATUS_FAILED",e.RecoverySetupFailed="RECOVERY_SETUP_FAILED",e.RecoveryDeactivationFailed="RECOVERY_DEACTIVATION_FAILED",e.RecoveryRequestFailed="RECOVERY_REQUEST_FAILED",e.RegisterDeviceFailed="REGISTER_DEVICE_FAILED",e.SetupMasterPasswordForRecoveryFailed="SETUP_MASTERPASSWORD_FOR_RECOVERY_FAILED",e.CancelRecoveryRequestFailed="CANCEL_RECOVERY_REQUEST_FAILED",e.RecoverUserDataFailed="RECOVER_REQUEST_FAILED",e.CheckLocalRecoveryKeyFailed="CHECK_LOCAL_RECOVERY_KEY_FAILED",e.StartAccountRecoveryFailed="START_ACCOUNT_RECOVERY_FAILED",e.AccountRecoveryNotAvailableError="ACCOUNT_RECOVERY_NOT_AVAILABLE_ERROR",e.IsRecoveryRequestPendingFailed="IS_RECOVERY_REQUEST_PENDING_FAILED"}(r||(t.RecoveryApiErrorType=r={})),function(e){e.PENDING="PENDING",e.APPROVED="APPROVED",e.REFUSED="REFUSED",e.OVERRIDDEN="OVERRIDDEN",e.CANCELED="CANCELED"}(s||(t.RequestStatus=s={}))},54205:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.isPIPersonalWebsiteEvent=t.isPIEmailEvent=t.isPICompanyEvent=t.isPIAddressEvent=t.isPIPhoneEvent=t.isPIIdentityEvent=t.isPersonalInfoEvent=t.SaveOrigin=void 0,function(e){e.MANUAL="MANUAL",e.MAV_DATACAPTURE="MAV_DATACAPTURE",e.MAV_SAVE_CREDENTIAL="MAV_SAVE_CREDENTIAL",e.IMPORT="IMPORT"}(r||(t.SaveOrigin=r={})),t.isPersonalInfoEvent=function(e){return["KWCompany","KWEmail","KWPersonalWebsite","KWIdentity","KWAddress","KWPhone"].some((t=>Boolean(e)&&e.kwType===t))},t.isPIIdentityEvent=function(e){return Boolean(e)&&"KWIdentity"===e.kwType},t.isPIPhoneEvent=function(e){return Boolean(e)&&"KWPhone"===e.kwType},t.isPIAddressEvent=function(e){return Boolean(e)&&"KWAddress"===e.kwType},t.isPICompanyEvent=function(e){return Boolean(e)&&"KWCompany"===e.kwType},t.isPIEmailEvent=function(e){return Boolean(e)&&"KWEmail"===e.kwType},t.isPIPersonalWebsiteEvent=function(e){return Boolean(e)&&"KWPersonalWebsite"===e.kwType}},19635:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(54205),t)},12891:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},99714:(e,t)=>{var r,s,i,a;Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateSharingPermissionFailureReason=t.RevokeSharingFailureReason=t.SharingResponseStatus=t.ShareItemFailureReason=t.isGroupRecipient=t.isUserRecipient=void 0,t.isUserRecipient=function(e){return Boolean(e)&&"user"===e.type},t.isGroupRecipient=function(e){return Boolean(e)&&"userGroup"===e.type},function(e){e[e.ITEM_DOESNT_EXIST=0]="ITEM_DOESNT_EXIST",e[e.LIMIT_EXCEEDED=1]="LIMIT_EXCEEDED",e[e.ITEM_HAS_ATTACHMENTS=2]="ITEM_HAS_ATTACHMENTS",e[e.SHARING_FAILED=3]="SHARING_FAILED"}(r||(t.ShareItemFailureReason=r={})),function(e){e[e.Accept=0]="Accept",e[e.Refuse=1]="Refuse"}(s||(t.SharingResponseStatus=s={})),function(e){e[e.FORBIDDEN=0]="FORBIDDEN",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.REVOKE_FAILED=2]="REVOKE_FAILED"}(i||(t.RevokeSharingFailureReason=i={})),function(e){e[e.FORBIDDEN=0]="FORBIDDEN",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.UPDATE_FAILED=2]="UPDATE_FAILED"}(a||(t.UpdateSharingPermissionFailureReason=a={}))},18497:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},59296:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},82130:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(59296),t),i(r(18497),t),i(r(99714),t)},31525:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(82130),t),i(r(57926),t),i(r(75841),t)},57926:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.sharingCommandsSlots=t.sharingLiveQueriesSlots=t.sharingQueriesSlots=void 0;const s=r(30504),i=r(72345);t.sharingQueriesSlots={getAllSharedItemIds:(0,s.slot)(),getMyAcceptedUserGroups:(0,s.slot)(),getSharingCapacity:(0,s.slot)(),getUserGroups:(0,s.slot)(),getUserGroup:(0,s.slot)(),getUserGroupMembers:(0,s.slot)(),getSharingUsers:(0,s.slot)(),getSharingUserPermissionLevel:(0,s.slot)()},t.sharingLiveQueriesSlots={liveAllSharedItemIds:(0,i.liveSlot)(),liveMyAcceptedUserGroups:(0,i.liveSlot)(),liveSharingCapacity:(0,i.liveSlot)(),liveUserGroups:(0,i.liveSlot)(),liveSharingUsers:(0,i.liveSlot)(),liveSharingUserPermissionLevel:(0,i.liveSlot)()},t.sharingCommandsSlots={convertItemToDashlaneXml:(0,s.slot)(),shareItem:(0,s.slot)()}},75841:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},58575:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},84470:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},74226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},60292:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.StaticDataQueryType=void 0,function(e){e[e.CALLING_CODES=0]="CALLING_CODES",e[e.GEOGRAPHIC_STATES=1]="GEOGRAPHIC_STATES"}(r||(t.StaticDataQueryType=r={}))},58462:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GeographicStateLevel=void 0,function(e){e[e.LEVEL_0=0]="LEVEL_0",e[e.LEVEL_1=1]="LEVEL_1"}(r||(t.GeographicStateLevel=r={}))},98655:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.StaticDataQueryType=void 0;var a=r(60292);Object.defineProperty(t,"StaticDataQueryType",{enumerable:!0,get:function(){return a.StaticDataQueryType}}),i(r(74226),t),i(r(58462),t),i(r(35324),t),i(r(78017),t)},78017:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.staticDataQueriesSlots=void 0;const s=r(30504);t.staticDataQueriesSlots={getAllBanks:(0,s.slot)(),getAllCallingCodes:(0,s.slot)(),getBanks:(0,s.slot)(),getSecureDocumentsExtensionsList:(0,s.slot)()}},35324:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},1659:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9987:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(84797),t),i(r(77030),t)},84797:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.teamCommandsSlots=t.teamQueriesSlots=void 0;const s=r(30504);t.teamQueriesSlots={getIsRecoveryEnabled:(0,s.slot)()},t.teamCommandsSlots={getTeamInfo:(0,s.slot)(),computePlanPricing:(0,s.slot)()}},77030:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ComputePlanPricingErrorType=void 0,function(e){e.ComputePlanPricingFailed="COMPUTE_PLAN_PRICING_FAILED",e.NotBillingAdmin="NOT_BILLING_ADMIN"}(r||(t.ComputePlanPricingErrorType=r={}))},83891:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GetAuditLogQueryResultsStates=t.ApiAuditLogsErrorType=void 0,function(e){e.StartAuditLogsQueryFailed="START_AUDIT_LOGS_QUERY_FAILED",e.GetAuditLogQueryResultsFailed="GET_AUDIT_LOG_QUERY_RESULTS_FAILED"}(r||(t.ApiAuditLogsErrorType=r={})),t.GetAuditLogQueryResultsStates=Object.freeze({Queued:"QUEUED",Running:"RUNNING",Succeeded:"SUCCEEDED",Failed:"FAILED",Cancelled:"CANCELLED"})},76198:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.TeamDevicePlatform=void 0,function(e){e.SSO_CONNECTOR="sso_connector",e.ENCRYPTION_SERVICE="encryption_service",e.NITRO="nitro_encryption_service"}(r||(t.TeamDevicePlatform=r={}))},56254:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},31197:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DomainStatus=t.DomainStatusResponses=void 0,t.DomainStatusResponses=Object.freeze({pending:"pending",valid:"valid",expired:"expired",invalid:"invalid"}),t.DomainStatus=t.DomainStatusResponses},62236:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EncryptionServiceRestartStatusCodes=void 0,t.EncryptionServiceRestartStatusCodes=Object.freeze({OK:"OK",ES_UNREACHABLE:"ES_UNREACHABLE",ES_CONFIG_RELOAD_FAILURE:"ES_CONFIG_RELOAD_FAILURE",ES_INTERNAL_NETWORK_ERROR:"ES_INTERNAL_NETWORK_ERROR"})},59226:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DomainDeletionFailed=t.DomainCannotBeDeactivated=t.DomainNotFound=t.DomainCannotContainUppercaseLetters=t.DomainNotValidForTeam=t.DomainContainsNonTeamUsers=t.InvalidPublicDomain=t.DomainAlreadyExists=t.TeamDoesNotExist=t.ServerError=t.InsufficientTier=t.TeamDeviceEncryptedConfigNotFound=t.InvalidTeamDeviceLogin=t.InvalidRequestError=t.DeviceAccountMappingAlreadyExists=t.DeviceKeyNotFound=t.UnknownTeamAdminError=t.NotAdmin=t.DeactivatedTeamDevice=t.BasicConfigNotFound=void 0,t.BasicConfigNotFound="BASIC_CONFIGURATION_NOT_FOUND",t.DeactivatedTeamDevice="DEACTIVATED_TEAM_DEVICE",t.NotAdmin="NOT_ADMIN",t.UnknownTeamAdminError="UNKNOWN_ERROR",t.DeviceKeyNotFound="DEVICE_KEY_NOT_FOUND",t.DeviceAccountMappingAlreadyExists="DEVICE_ACCOUNT_MAPPING_ALREADY_EXISTS",t.InvalidRequestError="invalid_request_error",t.InvalidTeamDeviceLogin="INVALID_TEAM_DEVICE_LOGIN",t.TeamDeviceEncryptedConfigNotFound="TEAM_DEVICE_CONFIGURATION_NOT_FOUND",t.InsufficientTier="INSUFFICIENT_TIER",t.ServerError="server_error",t.TeamDoesNotExist="TEAM_DOES_NOT_EXIST",t.DomainAlreadyExists="DOMAIN_ALREADY_EXISTS",t.InvalidPublicDomain="INVALID_PUBLIC_DOMAIN",t.DomainContainsNonTeamUsers="DOMAIN_CONTAINS_EXISTING_NONTEAM_USERS",t.DomainNotValidForTeam="DOMAIN_NOT_VALID_FOR_TEAM",t.DomainCannotContainUppercaseLetters="DOMAIN_CANNOT_CONTAIN_UPPERCASE_LETTERS",t.DomainNotFound="DOMAIN_NOT_FOUND",t.DomainCannotBeDeactivated="DOMAIN_CANNOT_BE_DEACTIVATED",t.DomainDeletionFailed="DOMAIN_DELETION_FAILED"},57369:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.UnknownTeamAdminError=t.TeamDeviceEncryptedConfigNotFound=void 0;var a=r(59226);Object.defineProperty(t,"TeamDeviceEncryptedConfigNotFound",{enumerable:!0,get:function(){return a.TeamDeviceEncryptedConfigNotFound}}),Object.defineProperty(t,"UnknownTeamAdminError",{enumerable:!0,get:function(){return a.UnknownTeamAdminError}}),i(r(9825),t),i(r(83891),t),i(r(76198),t),i(r(56254),t),i(r(31197),t),i(r(62236),t),i(r(36471),t),i(r(34059),t),i(r(17023),t),i(r(21310),t),i(r(15770),t),i(r(10434),t)},36471:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.InviteLinkResponseErrorCode=void 0,function(e){e.NotAdmin="not_admin",e.TeamKeyNotFound="TEAM_KEY_NOT_FOUND",e.InviteLinkNotFound="TEAM_INVITE_LINK_NOT_FOUND",e.UserInviteLinkNotFound="USER_TEAM_INVITE_TOKEN_NOT_FOUND"}(r||(t.InviteLinkResponseErrorCode=r={}))},34059:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.GetRecoveryCodesAsTeamCaptainErrorCode=void 0,function(e){e.NotAdmin="not_billing_admin",e.InternalError="internal_error",e.UnknownError="UNKNOWN_ERROR"}(r||(t.GetRecoveryCodesAsTeamCaptainErrorCode=r={}))},17023:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.IDPMetadataParseErrors=t.IDPXmlParseErrors=void 0,function(e){e.XML_PARSE_FAILED="xml_parse_failed"}(r||(t.IDPXmlParseErrors=r={})),function(e){e.KEY_DESCRIPTOR_NOT_FOUND="key_descriptor_not_found",e.IDP_ENTRYPOINT_NOT_FOUND="idp_entrypoint_not_found",e.INVALID_IDP_SSO_DESCRIPTOR="invalid_idp_sso_descriptor",e.MISSING_CERTIFICATE="missing_certificate",e.MULTIPLE_CERTIFICATES="multiple_certificates",e.CERTIFICATE_TOO_SHORT="certificate_too_short",e.CERTIFICATE_TOO_LONG="certificate_too_long ",e.CERTIFICATE_DECODE_FAILED="certificate_decode_failed",e.INVALID_ENTRYPOINT="invalid_entrypoint"}(s||(t.IDPMetadataParseErrors=s={}))},21310:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},10434:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.teamAdminCommandsSlots=t.teamAdminLiveQueriesSlots=t.teamAdminQueriesSlots=void 0;const s=r(30504),i=r(72345);t.teamAdminQueriesSlots={getAdministrableUserGroup:(0,s.slot)(),getAdministrableUserGroups:(0,s.slot)(),isGroupNameAvailable:(0,s.slot)(),getAdminProvisioningKey:(0,s.slot)()},t.teamAdminLiveQueriesSlots={liveAdministrableUserGroup:(0,i.liveSlot)(),liveAdministrableUserGroups:(0,i.liveSlot)(),liveAdminProvisioningKey:(0,i.liveSlot)()},t.teamAdminCommandsSlots={registerTeamDomain:(0,s.slot)(),completeTeamDomainRegistration:(0,s.slot)(),deactivateTeamDomain:(0,s.slot)(),getTeamDomains:(0,s.slot)(),getTeamDevice:(0,s.slot)(),listTeamDevices:(0,s.slot)(),deactivateTeamDevice:(0,s.slot)(),registerTeamDevice:(0,s.slot)(),registerTeamDeviceAccount:(0,s.slot)(),getEncryptionServiceConfig:(0,s.slot)(),generateAndSaveEncryptionServiceConfig:(0,s.slot)(),clearSelfHostedESSettings:(0,s.slot)(),getTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamSettings:(0,s.slot)(),parseMetadataFields:(0,s.slot)(),persistAdminProvisioningKey:(0,s.slot)(),removeAdminProvisioningKey:(0,s.slot)(),createSSOConnectorConfig:(0,s.slot)(),generateSSOConnectorKey:(0,s.slot)(),startAuditLogsQuery:(0,s.slot)(),getAuditLogQueryResults:(0,s.slot)(),getRecoveryCodesAsTeamCaptain:(0,s.slot)(),createInviteLink:(0,s.slot)(),changeInviteLinkTeamKey:(0,s.slot)(),toggleInviteLink:(0,s.slot)(),getInviteLink:(0,s.slot)(),requestInviteLinkToken:(0,s.slot)(),getInviteLinkForAdmin:(0,s.slot)(),getLastADSyncDate:(0,s.slot)(),getSpecialUserGroupInviteValuesForMemberInTeam:(0,s.slot)(),getSpecialUserGroupRevision:(0,s.slot)()}},15770:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},9825:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TeamMemberSSOStatuses=void 0,t.TeamMemberSSOStatuses=Object.freeze({Activated:"activated",PendingActivation:"pending_activation",PendingDeactivation:"pending_deactivation"})},22162:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(62485),t),i(r(86174),t)},62485:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UserMessageTypes=void 0,function(e){e.DEFAULT="default",e.TRIAL_EXPIRED="trial_expired",e.WEB_STORE="web_store",e.DASHBOARD_UPRADE="dashboard_upgrade",e.SHARING_CENTER_FAMILY="sharing_center_family",e.SHARING_CENTER_WORK="sharing_center_work"}(r||(t.UserMessageTypes=r={}))},86174:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.userMessagesCommandsSlots=t.userMessagesLiveQueriesSlots=t.userMessagesQueriesSlots=void 0;const s=r(30504),i=r(72345);t.userMessagesQueriesSlots={getVisibleUserMessages:(0,s.slot)(),getUserMessages:(0,s.slot)()},t.userMessagesLiveQueriesSlots={liveUserMessages:(0,i.liveSlot)(),liveVisibleUserMessages:(0,i.liveSlot)()},t.userMessagesCommandsSlots={dismissUserMessages:(0,s.slot)(),addUserMessage:(0,s.slot)()}},31955:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(73955),t),i(r(25625),t)},73955:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.VpnDisabledReason=t.VpnAccountActivationErrorType=t.VpnAccountStatusType=void 0,function(e){e.Activated="Activated",e.Activating="Activating",e.Error="Error",e.NotFound="NotFound",e.Ready="Ready"}(r||(t.VpnAccountStatusType=r={})),function(e){e.ServerError="ServerError",e.AccountAlreadyExistError="AccountAlreadyExist"}(s||(t.VpnAccountActivationErrorType=s={})),function(e){e.InTeam="InTeam",e.NotPremium="NotPremium",e.NoPayment="NoPayment",e.Other="Other"}(i||(t.VpnDisabledReason=i={}))},25625:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.vpnCommandsSlots=t.vpnLiveQueriesSlots=t.vpnQueriesSlots=void 0;const s=r(30504),i=r(72345);t.vpnQueriesSlots={getVpnAccount:(0,s.slot)(),getVpnCapabilitySetting:(0,s.slot)()},t.vpnLiveQueriesSlots={liveVpnAccount:(0,i.liveSlot)()},t.vpnCommandsSlots={activateVpnAccount:(0,s.slot)(),clearVpnAccountErrors:(0,s.slot)(),completeVpnAccountActivation:(0,s.slot)()}},13006:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=r(90693),i=r(29285),a=r(89885),o=r(41578),n=r(61184),c=r(65741),l=r(60467),d=r(29597),u=r(92137);o.sharingItemsApi,s.taskTrackingApi,i.activityLogsApi,a.vaultItemsCrudApi,l.AuthenticationFlowContracts.authenticationFlowApi,l.DeviceTransferContracts.deviceTransferApi,l.pinCodeApi,d.sessionApi,u.masterPasswordSecurityApi,n.passwordHealthApi,c.carbonLegacyApi,d.changeMasterPasswordApi,o.sharingCollectionsApi,o.sharingInvitesApi,a.vaultOrganizationApi,s.featureFlipsApi,s.webServicesApi},65741:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.carbonLegacyApi=void 0;const s=r(90693),i=r(99765),a=r(70314),o=r(78515);t.carbonLegacyApi=(0,s.defineModuleApi)({name:"carbon-legacy",commands:i.commands,queries:o.queries,events:a.events})},49420:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CarbonLegacyClient=void 0;const s=r(90693),i=r(65741);class a extends((0,s.defineModuleClient)(i.carbonLegacyApi)){}t.CarbonLegacyClient=a,(0,s.registerModuleClient)(i.carbonLegacyApi,a)},99765:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.commands=t.commandsFromCarbonAPI=t.MitigationDeleteGrapheneUserDataCommand=t.CarbonLegacyLeelooCommand=t.CarbonCommand=void 0;const s=r(90693),i=r(72345),a=r(16229);class o extends((0,s.defineCarbonCommand)({scope:s.UseCaseScope.Device})){}t.CarbonCommand=o;class n extends((0,s.defineCarbonCommand)({scope:s.UseCaseScope.Device})){}t.CarbonLegacyLeelooCommand=n;class c extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.MitigationDeleteGrapheneUserDataCommand=c,t.commandsFromCarbonAPI=(0,a.createCommandContractsFromConnector)(i.carbonCommandsSlots),t.commands={...t.commandsFromCarbonAPI,CarbonCommand:o,CarbonLegacyLeelooCommand:n,MitigationDeleteGrapheneUserDataCommand:c}},70314:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.events=t.CarbonLegacyDeviceRemotelyDeleted=t.CarbonLegacyEvent=t.CarbonCommandResultEvent=void 0;const s=r(90693);class i extends((0,s.defineEvent)({scope:s.UseCaseScope.Device})){}t.CarbonCommandResultEvent=i;class a extends((0,s.defineEvent)({scope:s.UseCaseScope.Device})){}t.CarbonLegacyEvent=a;class o extends((0,s.defineEvent)({scope:s.UseCaseScope.Device})){}t.CarbonLegacyDeviceRemotelyDeleted=o,t.events={CarbonCommandResultEvent:i,CarbonLegacyEvent:a,CarbonLegacyDeviceRemotelyDeleted:o}},78515:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.queries=t.queriesFromCarbonAPI=t.CarbonStateListQuery=t.CarbonStateQuery=void 0;const s=r(90693),i=r(72345),a=r(16229);class o extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.CarbonStateQuery=o;class n extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.CarbonStateListQuery=n,t.queriesFromCarbonAPI=(0,a.createQueryContractsFromConnectors)(i.carbonQueriesSlots,i.carbonLiveQueriesSlots),t.queries={...t.queriesFromCarbonAPI,CarbonStateQuery:o,CarbonStateListQuery:n}},83496:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(78515),t),i(r(70314),t),i(r(99765),t),i(r(76931),t),i(r(65741),t),i(r(49420),t)},16229:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createQueryContractsFromConnectors=t.createCommandContractsFromConnector=void 0;const s=r(90693);t.createCommandContractsFromConnector=function(e){return Object.keys(e).reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Command`]:(0,s.defineCarbonCommand)({scope:s.UseCaseScope.Device})})),{})},t.createQueryContractsFromConnectors=function(e,t){return[...Object.keys(e),...Object.keys(t)].reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Query`]:(0,s.defineQuery)({scope:s.UseCaseScope.Device})})),{})}},76931:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LEGACY_CARBON_LEELOO_USED_COMMANDS=void 0;t.LEGACY_CARBON_LEELOO_USED_COMMANDS=["lockSession","closeSession","cancelDashlaneAuthenticatorRegistration","openSession","openSessionWithMasterPassword","openSessionWithDashlaneAuthenticator","openSessionWithExtraDeviceToken","openSessionWithOTP","openSessionWithOTPForNewDevice","openSessionWithToken","openSessionResendToken","removePersonalDataItem","savePersonalDataItem","sessionForceSync","getLocalAccountsList"]},23446:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(5865),t)},5865:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},85530:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.breachesCommandsSlots=t.breachesLiveQueriesSlots=t.breachesQueriesSlots=void 0;const s=r(30504),i=r(72345);t.breachesQueriesSlots={getBreach:(0,s.slot)(),getBreaches:(0,s.slot)(),getBreachesPage:(0,s.slot)(),getBreachesPaginationToken:(0,s.slot)(),getBreachesUpdateStatus:(0,s.slot)()},t.breachesLiveQueriesSlots={liveBreach:(0,i.liveSlot)(),liveBreaches:(0,i.liveSlot)(),liveBreachesBatch:(0,i.liveSlot)(),liveBreachesUpdaterStatus:(0,i.liveSlot)()},t.breachesCommandsSlots={updateBreachStatus:(0,s.slot)()}},59870:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(85530),t),i(r(56476),t)},56476:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.BreachesUpdaterStatus=t.BreachLeakedDataType=void 0,function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(r||(t.BreachLeakedDataType=r={})),function(e){e.UNKNOWN="unknown",e.SYNCING="syncing",e.SKIPPED="skipped",e.UNCHANGED="unchanged",e.UPDATED="updated",e.ERROR="error"}(s||(t.BreachesUpdaterStatus=s={}))},21528:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.collectionsCommandsSlots=void 0;const s=r(30504);t.collectionsCommandsSlots={addCollection:(0,s.slot)(),deleteCollection:(0,s.slot)(),removeItemsFromCollections:(0,s.slot)(),updateCollection:(0,s.slot)()}},23328:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(21528),t),i(r(2868),t)},2868:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},40466:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(95331),t),i(r(347),t)},95331:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.credentialsLiveQueriesSlots=t.credentialsQueriesSlots=t.credentialsCommandsSlots=void 0;const s=r(30504),i=r(72345);t.credentialsCommandsSlots={addCredential:(0,s.slot)(),updateCredential:(0,s.slot)(),updateLinkedWebsites:(0,s.slot)()},t.credentialsQueriesSlots={getCredential:(0,s.slot)(),getCredentialCategories:(0,s.slot)(),getCredentials:(0,s.slot)(),getCredentialsByDomain:(0,s.slot)(),getCredentialsCount:(0,s.slot)(),getCredentialsPage:(0,s.slot)(),getCredentialsPaginationToken:(0,s.slot)(),getDashlaneDefinedLinkedWebsites:(0,s.slot)(),getShouldShowRequireMasterPassword:(0,s.slot)()},t.credentialsLiveQueriesSlots={liveCredential:(0,i.liveSlot)(),liveCredentials:(0,i.liveSlot)(),liveCredentialsByDomain:(0,i.liveSlot)(),liveCredentialsBatch:(0,i.liveSlot)(),liveCredentialsCount:(0,i.liveSlot)()}},347:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.CredentialLimitStatus=void 0,function(e){e.Unlimited="unlimited",e.UnderLimit="underLimit",e.NearLimit="nearLimit",e.AtOrAboveLimit="atOrAboveLimit"}(r||(t.CredentialLimitStatus=r={}))},54613:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.duplicationCommandsSlots=void 0;const s=r(30504);t.duplicationCommandsSlots={duplicateVaultItem:(0,s.slot)()}},55301:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(54613),t),i(r(11379),t)},11379:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},55552:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.exportCommandsSlots=t.exportQueriesSlots=void 0;const s=r(30504);t.exportQueriesSlots={getIsForcedDomainsEnabled:(0,s.slot)()},t.exportCommandsSlots={getPersonalDataExport:(0,s.slot)()}},10362:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(55552),t),i(r(82),t)},82:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GetPersonalDataExportErrorMessage=void 0;var r;!function(e){e.UNSUPPORTED_DATATYPE_ERROR="Unsupported Data Export Type",e.UNDEFINED_PASSWORD_ERROR="Undefined Password"}(r||(t.GetPersonalDataExportErrorMessage=r={}))},86575:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.generatedPasswordsCommandsSlots=t.generatedPasswordsLiveQueriesSlots=t.generatedPasswordsQueriesSlots=void 0;const s=r(30504),i=r(72345);t.generatedPasswordsQueriesSlots={getGeneratedPassword:(0,s.slot)(),getGeneratedPasswordsCount:(0,s.slot)(),getGeneratedPasswords:(0,s.slot)(),getGeneratedPasswordsPage:(0,s.slot)(),getGeneratedPasswordsPaginationToken:(0,s.slot)()},t.generatedPasswordsLiveQueriesSlots={liveGeneratedPasswordsCount:(0,i.liveSlot)(),liveGeneratedPasswords:(0,i.liveSlot)()},t.generatedPasswordsCommandsSlots={saveGeneratedPassword:(0,s.slot)()}},20703:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(86575),t),i(r(99308),t)},99308:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},25632:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.driverLicensesCommandsSlots=void 0;const s=r(30504);t.driverLicensesCommandsSlots={addDriverLicense:(0,s.slot)(),editDriverLicense:(0,s.slot)()}},57155:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(25632),t),i(r(93910),t)},93910:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},65671:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.fiscalsIdCommandsSlots=void 0;const s=r(30504);t.fiscalsIdCommandsSlots={addFiscalId:(0,s.slot)(),editFiscalId:(0,s.slot)()}},49258:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(65671),t),i(r(83059),t)},83059:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},90232:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.idCardsCommandsSlots=void 0;const s=r(30504);t.idCardsCommandsSlots={addIdCard:(0,s.slot)(),editIdCard:(0,s.slot)()}},13538:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(90232),t),i(r(26328),t)},26328:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},61470:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(16281),t),i(r(57155),t),i(r(49258),t),i(r(13538),t),i(r(73758),t),i(r(74847),t),i(r(68955),t)},73758:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4922),t),i(r(86924),t)},4922:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passportsCommandsSlots=void 0;const s=r(30504);t.passportsCommandsSlots={addPassport:(0,s.slot)(),editPassport:(0,s.slot)()}},86924:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},16281:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.idsCommandsSlots=void 0;const s=r(30504),i=r(57155),a=r(65671),o=r(13538),n=r(73758),c=r(74847);t.idsCommandsSlots=(0,s.combineEvents)(i.driverLicensesCommandsSlots,a.fiscalsIdCommandsSlots,o.idCardsCommandsSlots,n.passportsCommandsSlots,c.socialSecurityIdsCommandsSlots)},74847:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(44771),t),i(r(41022),t)},44771:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.socialSecurityIdsCommandsSlots=void 0;const s=r(30504);t.socialSecurityIdsCommandsSlots={addSocialSecurityId:(0,s.slot)(),editSocialSecurityId:(0,s.slot)()}},41022:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},68955:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateIdResultErrorCode=t.AddIdResultErrorCode=t.IdErrorCode=void 0,function(e){e.INTERNAL_ERROR="INTERNAL_ERROR",e.NOT_AUTHENTICATED="NOT_AUTHENTICATED",e.NOT_FOUND="NOT_FOUND"}(r||(t.IdErrorCode=r={})),function(e){e.MISSING_ID_NUMBER="MISSING_ID_NUMBER"}(s||(t.AddIdResultErrorCode=s={})),function(e){e.MISSING_ID_NUMBER="MISSING_ID_NUMBER"}(i||(t.UpdateIdResultErrorCode=i={}))},60655:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.importCommandsSlots=t.importLiveQueriesSlots=t.importQueriesSlots=void 0;const s=r(30504),i=r(72345);t.importQueriesSlots={getImportPersonalDataStatus:(0,s.slot)()},t.importLiveQueriesSlots={liveImportPersonalDataStatus:(0,i.liveSlot)()},t.importCommandsSlots={importPersonalData:(0,s.slot)(),previewPersonalData:(0,s.slot)(),dismissPersonalDataImportNotifications:(0,s.slot)()}},7716:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(60655),t),i(r(42393),t)},42393:(e,t)=>{var r,s,i,a,o,n;Object.defineProperty(t,"__esModule",{value:!0}),t.PreviewPersonalDataErrorType=t.ImportPersonalDataStateType=t.ImportPersonalDataErrorType=t.ImportFormats=t.ImportSource=t.SupportedVaultTypes=void 0,function(e){e.CREDENTIAL="credentials",e.NOTE="notes",e.PAYMENT_CARD="paymentCards",e.BANK_ACCOUNT="bankAccounts",e.COLLECTION="collections"}(r||(t.SupportedVaultTypes=r={})),function(e){e["1Password"]="1password",e.Bitwarden="bitwarden",e.Chrome="chrome",e.Dash="dash",e.Edge="edge",e.Firefox="firefox",e.Keepass="keepass",e.Keeper="keeper",e.Lastpass="lastpass",e.Other="other",e.Safari="safari"}(s||(t.ImportSource=s={})),function(e){e.Csv="csv",e.Dash="dash"}(i||(t.ImportFormats=i={})),function(e){e.Unavailable="unavailable",e.Unknown="unknown"}(a||(t.ImportPersonalDataErrorType=a={})),function(e){e.Idle="idle",e.Processing="processing",e.Success="success",e.Error="error"}(o||(t.ImportPersonalDataStateType=o={})),function(e){e.BadPassword="bad_password",e.Unavailable="unavailable",e.InvalidFormat="invalid",e.Unknown="unknown"}(n||(t.PreviewPersonalDataErrorType=n={}))},30897:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(57882),t),i(r(88295),t),i(r(63571),t),i(r(23446),t),i(r(59870),t),i(r(23328),t),i(r(40466),t),i(r(10362),t),i(r(61470),t),i(r(7716),t),i(r(76354),t),i(r(13995),t),i(r(42366),t),i(r(27958),t),i(r(91480),t),i(r(44015),t),i(r(32487),t),i(r(62061),t),i(r(35643),t),i(r(48934),t),i(r(20703),t),i(r(34237),t),i(r(55301),t)},76354:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(9092),t)},9092:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateLinkedWebsitesError=void 0,function(e){e.CredentialUpdateError="credentialUpdateError"}(r||(t.UpdateLinkedWebsitesError=r={}))},62061:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(91583),t),i(r(1172),t)},91583:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passkeyCommandsSlots=t.passkeyLiveQueriesSlots=t.passkeyQueriesSlots=void 0;const s=r(30504),i=r(72345);t.passkeyQueriesSlots={getPasskey:(0,s.slot)(),getPasskeys:(0,s.slot)(),getPasskeysForDomain:(0,s.slot)()},t.passkeyLiveQueriesSlots={livePasskey:(0,i.liveSlot)(),livePasskeys:(0,i.liveSlot)()},t.passkeyCommandsSlots={addPasskey:(0,s.slot)(),updatePasskey:(0,s.slot)(),deletePasskey:(0,s.slot)()}},1172:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DeletePasskeyErrorCode=void 0,function(e){e[e.NOT_AUTHORIZED=0]="NOT_AUTHORIZED",e[e.NOT_FOUND=1]="NOT_FOUND",e[e.INTERNAL_ERROR=2]="INTERNAL_ERROR"}(r||(t.DeletePasskeyErrorCode=r={}))},35643:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(29477),t),i(r(38161),t)},29477:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.passwordHistoryLiveQueriesSlots=t.passwordHistoryQueriesSlots=void 0;const s=r(30504),i=r(72345);t.passwordHistoryQueriesSlots={getHasPasswordHistory:(0,s.slot)(),getPasswordHistoryPage:(0,s.slot)(),getPasswordHistoryPaginationToken:(0,s.slot)()},t.passwordHistoryLiveQueriesSlots={livePasswordHistory:(0,i.liveSlot)(),livePasswordHistoryBatch:(0,i.liveSlot)()}},38161:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.PasswordHistoryItemType=void 0,function(e){e.Credential="credential",e.Generated="generated"}(r||(t.PasswordHistoryItemType=r={}))},48934:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(75161),t),i(r(40672),t)},75161:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.paymentCardCommandsSlots=t.paymentCardLiveQueriesSlots=t.paymentCardQueriesSlots=void 0;const s=r(30504),i=r(72345);t.paymentCardQueriesSlots={getPaymentCard:(0,s.slot)(),getPaymentCards:(0,s.slot)()},t.paymentCardLiveQueriesSlots={livePaymentCard:(0,i.liveSlot)(),livePaymentCards:(0,i.liveSlot)()},t.paymentCardCommandsSlots={addPaymentCard:(0,s.slot)(),updatePaymentCard:(0,s.slot)(),deletePaymentCard:(0,s.slot)()}},40672:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DeletePaymentCardErrorCode=t.PaymentCardSaveResultErrorCode=void 0,function(e){e.EMPTY_CARD_NUMBER_AND_SECURITY_CODE="EMPTY_CARD_NUMBER_AND_SECURITY_CODE",e.NOT_FOUND="NOT_FOUND"}(r||(t.PaymentCardSaveResultErrorCode=r={})),function(e){e.NOT_AUTHORIZED="NOT_AUTHORIZED",e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR"}(s||(t.DeletePaymentCardErrorCode=s={}))},46329:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(1721),t)},1721:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},5746:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(4249),t)},4249:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},47413:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(836),t)},836:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},8400:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(67369),t)},67369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},63571:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(46329),t),i(r(5746),t),i(r(47413),t),i(r(8400),t),i(r(87893),t),i(r(60776),t)},60776:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(68813),t)},68813:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},87893:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(63142),t)},63142:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},13995:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(56894),t),i(r(17013),t)},56894:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.secretLiveQueriesSlots=t.secretQueriesSlots=void 0;const s=r(30504),i=r(72345);t.secretQueriesSlots={getSecretsCount:(0,s.slot)()},t.secretLiveQueriesSlots={liveSecrets:(0,i.liveSlot)(),liveSecretsCount:(0,i.liveSlot)()}},17013:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteSecretErrorCode=void 0,function(e){e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e.LEAVE_SHARING_FAILED="LEAVE_SHARING_FAILED",e.LEAVE_SHARING_FORBIDDEN_LAST_ADMIN="LEAVE_SHARING_FORBIDDEN_LAST_ADMIN",e.LEAVE_SHARING_FORBIDDEN_GROUP_ITEM="LEAVE_SHARING_FORBIDDEN_GROUP_ITEM"}(r||(t.DeleteSecretErrorCode=r={}))},42366:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(70954),t),i(r(1376),t)},70954:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.secureFilesCommandsSlots=t.secureFilesLiveQueriesSlots=t.secureFilesQueriesSlots=void 0;const s=r(30504),i=r(72345);t.secureFilesQueriesSlots={getSecureFilesQuota:(0,s.slot)(),getSecureFilesInfoList:(0,s.slot)(),getFileDownloadProgress:(0,s.slot)(),getFileUploadProgress:(0,s.slot)()},t.secureFilesLiveQueriesSlots={liveSecureFilesQuota:(0,i.liveSlot)(),liveFileDownloadProgress:(0,i.liveSlot)(),liveFileUploadProgress:(0,i.liveSlot)()},t.secureFilesCommandsSlots={downloadSecureFile:(0,s.slot)(),chunkTransferDone:(0,s.slot)(),deleteSecureFile:(0,s.slot)(),addSecureFile:(0,s.slot)(),validateSecureFile:(0,s.slot)(),commitSecureFile:(0,s.slot)(),initSecureFilesStorageInfo:(0,s.slot)(),clearSecureFileState:(0,s.slot)()}},1376:(e,t)=>{var r,s,i;Object.defineProperty(t,"__esModule",{value:!0}),t.FileUploadStatus=t.FileDownloadStatus=t.SecureFileResultErrorCode=void 0,function(e){e.MAX_CONTENT_LENGTH_EXCEEDED="MAX_CONTENT_LENGTH_EXCEEDED",e.QUOTA_EXCEEDED="QUOTA_EXCEEDED",e.INVALID_FILE_TYPE="INVALID_FILE_TYPE",e.INTERNAL_ERROR="INTERNAL_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.FILE_NOT_FOUND="FILE_NOT_FOUND"}(r||(t.SecureFileResultErrorCode=r={})),function(e){e.Initial="Initial",e.Downloading="Downloading",e.Deciphering="Deciphering",e.Error="Error",e.ChunkReady="ChunkReady",e.ChunkDownloaded="ChunkDownloaded",e.TransferComplete="TransferComplete"}(s||(t.FileDownloadStatus=s={})),function(e){e.None="None",e.Initial="Initial",e.Uploading="Uploading",e.Ciphering="Ciphering",e.Done="Done",e.Error="Error"}(i||(t.FileUploadStatus=i={}))},27958:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(32376),t),i(r(20397),t)},32376:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.secureNoteCategoryCommandsSlots=void 0;const s=r(30504);t.secureNoteCategoryCommandsSlots={setupDefaultNoteCategories:(0,s.slot)()}},20397:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},91480:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(47110),t),i(r(5721),t)},47110:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.noteLiveQueriesSlots=t.noteQueriesSlots=void 0;const s=r(30504),i=r(72345);t.noteQueriesSlots={getNote:(0,s.slot)(),getNoteCategories:(0,s.slot)(),getNotes:(0,s.slot)(),getNotesCount:(0,s.slot)(),getNotesPage:(0,s.slot)(),getNotesPaginationToken:(0,s.slot)()},t.noteLiveQueriesSlots={liveNote:(0,i.liveSlot)(),liveNotes:(0,i.liveSlot)(),liveNotesBatch:(0,i.liveSlot)(),liveNotesCount:(0,i.liveSlot)()}},5721:(e,t)=>{var r,s;Object.defineProperty(t,"__esModule",{value:!0}),t.DeleteSecureNoteErrorCode=t.SecureNoteSaveResultErrorCode=void 0,function(e){e.NOT_FOUND="NOT_FOUND"}(r||(t.SecureNoteSaveResultErrorCode=r={})),function(e){e.NOT_FOUND="NOT_FOUND",e.INTERNAL_ERROR="INTERNAL_ERROR",e.LEAVE_SHARING_FAILED="LEAVE_SHARING_FAILED",e.LEAVE_SHARING_FORBIDDEN_LAST_ADMIN="LEAVE_SHARING_FORBIDDEN_LAST_ADMIN",e.LEAVE_SHARING_FORBIDDEN_GROUP_ITEM="LEAVE_SHARING_FORBIDDEN_GROUP_ITEM"}(s||(t.DeleteSecureNoteErrorCode=s={}))},44015:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(12451),t),i(r(76646),t)},12451:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.settingsCommandsSlots=t.settingsLiveQueriesSlots=t.settingsQueriesSlots=void 0;const s=r(30504),i=r(72345);t.settingsQueriesSlots={getAnonymousUserId:(0,s.slot)(),getIsUrlBanished:(0,s.slot)(),arePasswordsProtected:(0,s.slot)(),areRichIconsEnabled:(0,s.slot)()},t.settingsLiveQueriesSlots={liveArePasswordsProtected:(0,i.liveSlot)(),liveAreRichIconsEnabled:(0,i.liveSlot)()},t.settingsCommandsSlots={toggleDashlane:(0,s.slot)(),updateProtectPasswordsSetting:(0,s.slot)(),updateAutofillSettings:(0,s.slot)(),updateRichIconsSetting:(0,s.slot)()}},76646:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},57882:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.dataManagementCommandsSlots=t.dataManagementLiveQueriesSlots=t.dataManagementQueriesSlots=void 0;const s=r(30504),i=r(59870),a=r(23328),o=r(40466),n=r(10362),c=r(20703),l=r(61470),d=r(7716),u=r(62061),p=r(35643),h=r(48934),m=r(42366),g=r(27958),v=r(91480),y=r(44015),_=r(32487),f=r(34237),S=r(13995),E=r(54613);t.dataManagementQueriesSlots=(0,s.combineEvents)(i.breachesQueriesSlots,o.credentialsQueriesSlots,n.exportQueriesSlots,c.generatedPasswordsQueriesSlots,d.importQueriesSlots,v.noteQueriesSlots,u.passkeyQueriesSlots,p.passwordHistoryQueriesSlots,h.paymentCardQueriesSlots,S.secretQueriesSlots,m.secureFilesQueriesSlots,y.settingsQueriesSlots,_.spacesQueriesSlots,f.vaultQueriesSlots),t.dataManagementLiveQueriesSlots=(0,s.combineEvents)(i.breachesLiveQueriesSlots,o.credentialsLiveQueriesSlots,c.generatedPasswordsLiveQueriesSlots,d.importLiveQueriesSlots,v.noteLiveQueriesSlots,u.passkeyLiveQueriesSlots,p.passwordHistoryLiveQueriesSlots,h.paymentCardLiveQueriesSlots,S.secretLiveQueriesSlots,m.secureFilesLiveQueriesSlots,y.settingsLiveQueriesSlots),t.dataManagementCommandsSlots=(0,s.combineEvents)(i.breachesCommandsSlots,a.collectionsCommandsSlots,o.credentialsCommandsSlots,n.exportCommandsSlots,c.generatedPasswordsCommandsSlots,l.idsCommandsSlots,d.importCommandsSlots,u.passkeyCommandsSlots,h.paymentCardCommandsSlots,m.secureFilesCommandsSlots,g.secureNoteCategoryCommandsSlots,y.settingsCommandsSlots,f.vaultCommandsSlots,E.duplicationCommandsSlots)},32487:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(3316),t),i(r(81774),t)},3316:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.spacesQueriesSlots=void 0;const s=r(30504);t.spacesQueriesSlots={getSpace:(0,s.slot)(),getSpaces:(0,s.slot)()}},81774:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},88295:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},34237:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(52810),t),i(r(76417),t)},52810:(e,t)=>{var r;Object.defineProperty(t,"__esModule",{value:!0}),t.VaultItemDisableProtectionMode=void 0,function(e){e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting"}(r||(t.VaultItemDisableProtectionMode=r={}))},76417:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.vaultCommandsSlots=t.vaultQueriesSlots=void 0;const s=r(30504);t.vaultQueriesSlots={},t.vaultCommandsSlots={disableVaultItemProtection:(0,s.slot)()}},32626:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(72345),t),i(r(28413),t),i(r(17317),t),i(r(98521),t),i(r(80112),t),i(r(55334),t),i(r(91609),t),i(r(99103),t),i(r(29004),t),i(r(90041),t),i(r(65722),t),i(r(25098),t),i(r(94372),t),i(r(15874),t),i(r(50459),t),i(r(14811),t),i(r(30897),t),i(r(88219),t),i(r(43245),t),i(r(65005),t),i(r(80898),t),i(r(29450),t),i(r(96035),t),i(r(6666),t),i(r(24875),t),i(r(87940),t),i(r(15925),t),i(r(68183),t),i(r(6768),t),i(r(58290),t),i(r(78779),t),i(r(37174),t),i(r(60687),t),i(r(36632),t),i(r(77277),t),i(r(49106),t),i(r(68440),t),i(r(34852),t),i(r(31525),t),i(r(28249),t),i(r(33773),t),i(r(84470),t),i(r(58575),t),i(r(9987),t),i(r(57369),t),i(r(1659),t),i(r(48905),t),i(r(66478),t),i(r(12891),t),i(r(98655),t),i(r(44225),t),i(r(19635),t),i(r(22162),t),i(r(31955),t),i(r(83496),t),i(r(13006),t)},5933:(e,t,r)=>{r.d(t,{KV:()=>n,co:()=>o,td:()=>a});var s=r(30504),i=r(55432);const a={participateToUserABTest:(0,s.slot)()},o={getUserABTestVariant:(0,s.slot)()},n={liveUserABTestVariant:(0,i.H)()}},16537:(e,t,r)=>{r.d(t,{PG:()=>o,PO:()=>a,cN:()=>n});var s=r(30504),i=r(55432);const a={editContactInfo:(0,s.slot)(),refreshContactInfo:(0,s.slot)()},o={getContactInfo:(0,s.slot)()},n={liveContactInfo:(0,i.H)()}},57317:(e,t,r)=>{r.d(t,{E:()=>a,b:()=>o});var s=r(30504),i=r(55432);const a={getSubscriptionCode:(0,s.slot)()},o={liveSubscriptionCode:(0,i.H)()}},53927:(e,t,r)=>{r.d(t,{zR:()=>u,QR:()=>h,ke:()=>p});var s=r(30504),i=r(55432);const a={refreshU2FDevicesList:(0,s.slot)(),removeU2FAuthenticator:(0,s.slot)(),refreshTwoFactorAuthenticationInfo:(0,s.slot)(),startTwoFactorAuthenticationEnableFlow:(0,s.slot)(),stopTwoFactorAuthenticationEnableFlow:(0,s.slot)(),continueTwoFactorAuthenticationEnableFlow:(0,s.slot)(),backTwoFactorAuthenticationEnableFlow:(0,s.slot)(),startTwoFactorAuthenticationDisableFlow:(0,s.slot)(),stopTwoFactorAuthenticationDisableFlow:(0,s.slot)(),continueTwoFactorAuthenticationDisableFlow:(0,s.slot)(),backTwoFactorAuthenticationDisableFlow:(0,s.slot)()},o={getU2FDevicesList:(0,s.slot)(),getTwoFactorAuthenticationEnableStage:(0,s.slot)(),getTwoFactorAuthenticationDisableStage:(0,s.slot)()},n={liveU2FDevicesList:(0,i.H)(),liveTwoFactorAuthenticationEnableStage:(0,i.H)(),liveTwoFactorAuthenticationDisableStage:(0,i.H)()},c={enableWebAuthnAuthentication:(0,s.slot)(),initEnableWebAuthnAuthentication:(0,s.slot)(),refreshAvailableWebAuthnAuthenticators:(0,s.slot)(),refreshWebAuthnAuthenticators:(0,s.slot)(),initRegisterWebAuthnAuthenticator:(0,s.slot)(),registerWebAuthnAuthenticator:(0,s.slot)(),initOpenSessionWithWebAuthnAuthenticator:(0,s.slot)(),openSessionWithWebAuthnAuthenticator:(0,s.slot)(),disableWebAuthnAuthentication:(0,s.slot)(),removeWebAuthnAuthenticator:(0,s.slot)(),initUserVerificationWithWebAuthn:(0,s.slot)()},l={getWebAuthnAuthenticators:(0,s.slot)(),getWebAuthnAuthenticationOptedIn:(0,s.slot)()},d={liveWebAuthnAuthenticators:(0,i.H)(),liveWebAuthnAuthenticationOptedIn:(0,i.H)()},u=(0,s.combineEvents)({registerDevice:(0,s.slot)(),requestExtraDeviceToken:(0,s.slot)(),requestEmailToken:(0,s.slot)(),requestPaymentUpdateAuthenticationToken:(0,s.slot)(),setReactivationStatus:(0,s.slot)(),disableAutologin:(0,s.slot)()},c,a),p=(0,s.combineEvents)({getHasOtp2Type:(0,s.slot)(),getUserOtpType:(0,s.slot)(),getReactivationStatus:(0,s.slot)(),getAvailableUserVerificationMethods:(0,s.slot)()},l,o),h=(0,s.combineEvents)({liveReactivationStatus:(0,i.H)()},d,n)},22450:(e,t,r)=>{r.d(t,{_V:()=>o,jP:()=>i});var s,i;!function(e){e.DISABLED="DISABLED",e.CLASSIC="CLASSIC",e.WEBAUTHN="WEBAUTHN"}(s||(s={})),function(e){e[e.PERSIST_DATA_YES=0]="PERSIST_DATA_YES",e[e.PERSIST_DATA_NO=1]="PERSIST_DATA_NO"}(i||(i={}));Object.freeze({MasterPassword:"masterPassword",Webauthn:"webauthn"});var a,o;!function(e){e[e.NO_OTP=0]="NO_OTP",e[e.OTP_NEW_DEVICE=1]="OTP_NEW_DEVICE",e[e.OTP_LOGIN=2]="OTP_LOGIN"}(a||(a={})),function(e){e[e.INVALID_LOGIN=0]="INVALID_LOGIN",e[e.EMPTY_LOGIN=1]="EMPTY_LOGIN",e[e.EMPTY_MASTER_PASSWORD=2]="EMPTY_MASTER_PASSWORD",e[e.EMPTY_ENCRYPTED_KEY=3]="EMPTY_ENCRYPTED_KEY",e[e.INVALID_ENCRYPTED_KEY=4]="INVALID_ENCRYPTED_KEY",e[e.EMPTY_TOKEN=5]="EMPTY_TOKEN",e[e.EMPTY_OTP=6]="EMPTY_OTP",e[e.SEND_TOKEN_FAILED=7]="SEND_TOKEN_FAILED",e[e.UKI_REGISTRATION_FAILED=8]="UKI_REGISTRATION_FAILED",e[e.REGISTER_DEVICE_FAILED=9]="REGISTER_DEVICE_FAILED",e[e.BUSINESS_ERROR=10]="BUSINESS_ERROR",e[e.USER_DOESNT_EXIST=11]="USER_DOESNT_EXIST",e[e.USER_DOESNT_EXIST_UNLIKELY_MX=12]="USER_DOESNT_EXIST_UNLIKELY_MX",e[e.USER_DOESNT_EXIST_INVALID_MX=13]="USER_DOESNT_EXIST_INVALID_MX",e[e.USER_UNAUTHORIZED=14]="USER_UNAUTHORIZED",e[e.WRONG_PASSWORD=15]="WRONG_PASSWORD",e[e.DATA_TAMPERED_ERROR=16]="DATA_TAMPERED_ERROR",e[e.LOGGEDIN=17]="LOGGEDIN",e[e.ASK_TOKEN=18]="ASK_TOKEN",e[e.ASK_OTP=19]="ASK_OTP",e[e.ASK_MASTER_PASSWORD=20]="ASK_MASTER_PASSWORD",e[e.USE_LOCAL_UKI=21]="USE_LOCAL_UKI",e[e.ASK_DASHLANE_AUTHENTICATOR=22]="ASK_DASHLANE_AUTHENTICATOR",e[e.OTP_NOT_VALID=23]="OTP_NOT_VALID",e[e.OTP_TOO_MANY_ATTEMPTS=24]="OTP_TOO_MANY_ATTEMPTS",e[e.OTP_ALREADY_USED=25]="OTP_ALREADY_USED",e[e.BACKUP_CODE_NOT_VALID=26]="BACKUP_CODE_NOT_VALID",e[e.TOKEN_NOT_VALID=27]="TOKEN_NOT_VALID",e[e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED=28]="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e[e.SERVER_KEY_MISSING=29]="SERVER_KEY_MISSING",e[e.TOKEN_LOCKED=30]="TOKEN_LOCKED",e[e.TOKEN_TOO_MANY_ATTEMPTS=31]="TOKEN_TOO_MANY_ATTEMPTS",e[e.TOKEN_ACCOUNT_LOCKED=32]="TOKEN_ACCOUNT_LOCKED",e[e.TOKEN_EXPIRED=33]="TOKEN_EXPIRED",e[e.NO_ACTIVE_AUTHENTICATOR=34]="NO_ACTIVE_AUTHENTICATOR",e[e.FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE=35]="FAILED_TO_CONTACT_AUTHENTICATOR_DEVICE",e[e.DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION=36]="DASHLANE_AUTHENTICATOR_ASKED_FOR_LOCAL_SESSION",e[e.DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED=37]="DASHLANE_AUTHENTICATOR_LOGIN_CANCELLED",e[e.TOKEN_PROVIDED_FOR_LOCAL_SESSION=38]="TOKEN_PROVIDED_FOR_LOCAL_SESSION",e[e.DEVICE_ALREADY_REGISTERED=39]="DEVICE_ALREADY_REGISTERED",e[e.OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION=40]="OTP_PROVIDED_FOR_LOCAL_NON_OTP_SESSION",e[e.DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP=41]="DIFFERENT_LOGIN_PROVIDED_WITH_TOKEN_OR_OTP",e[e.UNKNOWN_SYNC_ERROR=42]="UNKNOWN_SYNC_ERROR",e[e.INVALID_UKI=43]="INVALID_UKI",e[e.UNKNOWN_UKI=44]="UNKNOWN_UKI",e[e.UNKNOWN_ERROR=45]="UNKNOWN_ERROR",e[e.UNEXPECTED_OTP_TYPE=46]="UNEXPECTED_OTP_TYPE",e[e.UNAUTHORIZED=47]="UNAUTHORIZED",e[e.UNAUTHORIZED_NOT_VALID_CONTENT=48]="UNAUTHORIZED_NOT_VALID_CONTENT",e[e.NETWORK_ERROR=49]="NETWORK_ERROR",e[e.THROTTLED=50]="THROTTLED",e[e.SESSION_ALREADY_OPENED=51]="SESSION_ALREADY_OPENED",e[e.INVALID_SESSION=52]="INVALID_SESSION",e[e.DEVICE_NOT_REGISTERED=53]="DEVICE_NOT_REGISTERED",e[e.MISSING_APP_KEYS=54]="MISSING_APP_KEYS",e[e.PROVIDE_EXTRA_DEVICE_TOKEN=55]="PROVIDE_EXTRA_DEVICE_TOKEN",e[e.PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE=56]="PROVIDE_MASTER_PASSWORD_FOR_EXTRA_DEVICE",e[e.PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE=57]="PROVIDE_MASTER_PASSWORD_AND_SERVER_KEY_FOR_EXTRA_DEVICE",e[e.ASK_OTP_FOR_NEW_DEVICE=58]="ASK_OTP_FOR_NEW_DEVICE",e[e.TEAM_GENERIC_ERROR=59]="TEAM_GENERIC_ERROR",e[e.SSO_LOGIN_BYPASS=60]="SSO_LOGIN_BYPASS",e[e.SSO_VERIFICATION_FAILED=61]="SSO_VERIFICATION_FAILED",e[e.SSO_BLOCKED=62]="SSO_BLOCKED",e[e.CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION=63]="CLIENT_VERSION_DOES_NOT_SUPPORT_SSO_MIGRATION",e[e.USER_DOESNT_EXIST_SSO=64]="USER_DOESNT_EXIST_SSO"}(o||(o={}))},49594:(e,t,r)=>{r.d(t,{X:()=>n});var s=r(30504),i=r(66302),a=r(38344),o=r(33820);const n=(0,s.combineEvents)(i.z,a.r,o.z)},66302:(e,t,r)=>{r.d(t,{z:()=>N});var s=r(30504),i=r(5933),a=r(16537),o=r(53927),n=r(38429),c=r(61045);const l={getDarkWebInsightsReportResults:(0,s.slot)(),getDarkWebInsightsSummary:(0,s.slot)()};var d=r(44632);const u={getFamilyDetails:(0,s.slot)(),joinFamily:(0,s.slot)(),leaveFamily:(0,s.slot)(),removeFamilyMember:(0,s.slot)(),resetFamilyJoinToken:(0,s.slot)()};var p=r(64128);const h={setGlobalExtensionSettings:(0,s.slot)(),getGlobalExtensionSettings:(0,s.slot)()},m={evaluatePassword:(0,s.slot)()},g={logEvent:(0,s.slot)(),logPageView:(0,s.slot)(),flushQueue:(0,s.slot)()},v={logException:(0,s.slot)()},y={abortDeviceLimitFlow:(0,s.slot)(),loginViaSSO:(0,s.slot)(),unlinkPreviousDevice:(0,s.slot)(),unlinkMultipleDevices:(0,s.slot)()};var _=r(94883),f=r(22955),S=r(8755),E=r(52215),b=r(38578),w=r(73298),A=r(52860),C=r(77507),I=r(27794),T=r(73762),P=r(77253),O=r(89210),R=r(71316),D=r(92753);const N=(0,s.combineEvents)(i.td,o.zR,n.v,a.PO,c.rU,l,d.fv,g,v,u,h,m,y,_._m,f.vq,S.U$,E.of,b.r,w._,A.gQ,C.$k,p.H9,I.uG,T.b,P.hO,O.Kr,R.lp,D.n)},33820:(e,t,r)=>{r.d(t,{z:()=>I});var s=r(30504),i=r(5933),a=r(16537),o=r(57317),n=r(55432);const c={liveAccountCreated:(0,n.H)()},l={livePhishingURLList:(0,n.H)()};var d=r(53927),u=r(44632),p=r(38429),h=r(61045),m=r(64128),g=r(64001),v=r(94883),y=r(22955),_=r(8755),f=r(52215),S=r(52860),E=r(77507),b=r(27794),w=r(77253),A=r(89210),C=r(71316);const I=(0,s.combineEvents)(i.KV,c,l,d.QR,p.F,a.cN,h.vF,u.QX,g.b,v.Rj,y._1,_.iX,f.K1,S.qN,E.EX,m.YW,b.Ll,o.b,w.dN,A.kh,C.fD)},38344:(e,t,r)=>{r.d(t,{r:()=>O});var s=r(30504),i=r(5933),a=r(16537),o=r(57317),n=r(53927);const c={getSingleAddressForAutofill:(0,s.slot)(),getMultipleAddressesForAutofill:(0,s.slot)(),getSingleBankAccountForAutofill:(0,s.slot)(),getMultipleBankAccountsForAutofill:(0,s.slot)(),getSingleCompanyForAutofill:(0,s.slot)(),getMultipleCompaniesForAutofill:(0,s.slot)(),getSingleCredentialForAutofill:(0,s.slot)(),getMultipleCredentialsForAutofill:(0,s.slot)(),getSingleDriverLicenseForAutofill:(0,s.slot)(),getMultipleDriverLicensesForAutofill:(0,s.slot)(),getSingleEmailForAutofill:(0,s.slot)(),getMultipleEmailsForAutofill:(0,s.slot)(),getSingleFiscalIdForAutofill:(0,s.slot)(),getMultipleFiscalIdsForAutofill:(0,s.slot)(),getSingleGeneratedPasswordForAutofill:(0,s.slot)(),getMultipleGeneratedPasswordsForAutofill:(0,s.slot)(),getSingleIdCardForAutofill:(0,s.slot)(),getMultipleIdCardsForAutofill:(0,s.slot)(),getSingleIdentityForAutofill:(0,s.slot)(),getMultipleIdentitiesForAutofill:(0,s.slot)(),getSingleNoteForAutofill:(0,s.slot)(),getMultipleNotesForAutofill:(0,s.slot)(),getSinglePasskeyForAutofill:(0,s.slot)(),getSinglePassportForAutofill:(0,s.slot)(),getMultiplePassportsForAutofill:(0,s.slot)(),getSinglePaymentCardForAutofill:(0,s.slot)(),getMultiplePaymentCardsForAutofill:(0,s.slot)(),getSinglePersonalWebsiteForAutofill:(0,s.slot)(),getMultiplePersonalWebsitesForAutofill:(0,s.slot)(),getSinglePhoneForAutofill:(0,s.slot)(),getMultiplePhonesForAutofill:(0,s.slot)(),getSingleSocialSecurityIdForAutofill:(0,s.slot)(),getMultipleSocialSecurityIdsForAutofill:(0,s.slot)(),getAutofillSettingOnUrlForAutofill:(0,s.slot)()};var l=r(44632),d=r(61045),u=r(92753);const p={getHasFeature:(0,s.slot)(),getFeatures:(0,s.slot)()};var h=r(64128),m=r(64001),g=r(94883),v=r(22955),y=r(8755),_=r(52215),f=r(38578),S=r(73298),E=r(52860),b=r(77507);const w={getAllBanks:(0,s.slot)(),getAllCallingCodes:(0,s.slot)(),getBanks:(0,s.slot)(),getSecureDocumentsExtensionsList:(0,s.slot)()};var A=r(27794),C=r(73762),I=r(77253),T=r(89210),P=r(71316);const O=(0,s.combineEvents)(i.co,n.ke,c,a.PG,d.kQ,l.pz,u.C,p,m.c,g.Xz,v.xP,y.Ie,_.A2,f.H,S.P,E.UW,b.q9,h.JQ,A.i1,w,o.E,C.N,I.XJ,T.Vz,P.T4)},55432:(e,t,r)=>{r.d(t,{H:()=>a});var s=r(30504);const i={noBuffer:!0},a=()=>(0,s.slot)(i)},62029:(e,t,r)=>{r.d(t,{o:()=>i});var s=r(30504);const i={log:(0,s.slot)(),info:(0,s.slot)(),warning:(0,s.slot)(),error:(0,s.slot)()}},38429:(e,t,r)=>{r.d(t,{F:()=>o,v:()=>a});var s=r(30504),i=r(55432);const a={changeMasterPassword:(0,s.slot)()},o={liveChangeMasterPasswordStatus:(0,i.H)()}},61045:(e,t,r)=>{r.d(t,{kQ:()=>o,rU:()=>a,vF:()=>n});var s=r(30504),i=r(55432);const a={changeUserCrypto:(0,s.slot)()},o={getCanUserChangeCrypto:(0,s.slot)(),getUserDerivationMethod:(0,s.slot)()},n={liveUserDerivationMethod:(0,i.H)()}},57789:(e,t,r)=>{function s(e){return Boolean(e)&&"KWAuthentifiant"===e.kwType}r.d(t,{G:()=>s})},18952:(e,t,r)=>{r.d(t,{z:()=>s});const s=(0,r(50415).Enum)("PHONE_TYPE_ANY","PHONE_TYPE_MOBILE","PHONE_TYPE_LANDLINE","PHONE_TYPE_FAX","PHONE_TYPE_WORK_MOBILE","PHONE_TYPE_WORK_LANDLINE","PHONE_TYPE_WORK_FAX")},92753:(e,t,r)=>{r.d(t,{C:()=>i,n:()=>a});var s=r(30504);const i={getAnonymousComputerId:(0,s.slot)(),getPlatformInfo:(0,s.slot)()},a={cleanRemotelyRemovedProfiles:(0,s.slot)()}},98558:(e,t,r)=>{r.d(t,{D:()=>s});const s={deviceLimitCapabilityUpdated:(0,r(30504).slot)()}},98052:(e,t,r)=>{r.d(t,{z:()=>i});var s=r(30504);const i={loginStatusChanged:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),deactivateDeviceResult:(0,s.slot)({noBuffer:!0}),changeDeviceNameResult:(0,s.slot)({noBuffer:!0}),accountFeaturesChanged:(0,s.slot)({noBuffer:!0}),webOnboardingModeUpdated:(0,s.slot)({noBuffer:!0}),askWebsiteInfo:(0,s.slot)({noBuffer:!0}),getAccountInfo:(0,s.slot)({noBuffer:!0}),getAnonymousLogsMetadata:(0,s.slot)({noBuffer:!0}),checkIfMasterPasswordIsValid:(0,s.slot)({noBuffer:!0}),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionWithMasterPassword:(0,s.slot)({noBuffer:!0}),openExtraDeviceSession:(0,s.slot)({noBuffer:!0}),openSessionWithExtraDeviceToken:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)({noBuffer:!0}),closeSession:(0,s.slot)({noBuffer:!0}),lockSession:(0,s.slot)({noBuffer:!0}),exceptionLog:(0,s.slot)({noBuffer:!0}),getDevicesList:(0,s.slot)({noBuffer:!0}),getLocalAccountsList:(0,s.slot)({noBuffer:!0}),deactivateDevice:(0,s.slot)({noBuffer:!0}),changeDeviceName:(0,s.slot)({noBuffer:!0}),updateWebOnboardingMode:(0,s.slot)({noBuffer:!0})}},64128:(e,t,r)=>{r.d(t,{H9:()=>a,JQ:()=>o,YW:()=>n});var s=r(30504),i=r(55432);const a={decipherRemoteFile:(0,s.slot)()},o={getFileContent:(0,s.slot)()},n={liveFileMeta:(0,i.H)()}},64001:(e,t,r)=>{r.d(t,{b:()=>o,c:()=>a});var s=r(30504),i=r(55432);const a={getIsBrazeContentDisabled:(0,s.slot)(),getIsLoginFlowMigrationDisabled:(0,s.slot)(),getIsAutoSSOLoginDisabled:(0,s.slot)()},o={liveIsBrazeContentDisabled:(0,i.H)(),liveIsLoginFlowMigrationDisabled:(0,i.H)(),liveIsAutoSSOLoginDisabled:(0,i.H)()}},92486:(e,t,r)=>{r.d(t,{N:()=>i});var s=r(30504);const i={abTestingChanged:(0,s.slot)(),loginStatusChanged:(0,s.slot)({noBuffer:!0}),openSessionProgressChanged:(0,s.slot)({noBuffer:!0}),openSessionTokenSent:(0,s.slot)({noBuffer:!0}),openSessionDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),openSessionOTPSent:(0,s.slot)({noBuffer:!0}),openSessionOTPForNewDeviceRequired:(0,s.slot)({noBuffer:!0}),openSessionAskMasterPassword:(0,s.slot)({noBuffer:!0}),openSessionTokenWarning:(0,s.slot)({noBuffer:!0}),openSessionExtraDeviceTokenRequired:(0,s.slot)({noBuffer:!0}),openSessionSsoRedirectionToIdpRequired:(0,s.slot)({noBuffer:!0}),openSessionMasterPasswordLess:(0,s.slot)({noBuffer:!0}),openSessionFailed:(0,s.slot)({noBuffer:!0}),sessionSyncStatus:(0,s.slot)({noBuffer:!0}),localAccountsListUpdated:(0,s.slot)(),spaceDataUpdated:(0,s.slot)(),teamAdminDataUpdated:(0,s.slot)(),credentialLoginUrlRetrieved:(0,s.slot)(),deactivateDeviceResult:(0,s.slot)(),changeDeviceNameResult:(0,s.slot)(),accountFeaturesChanged:(0,s.slot)(),updatePaymentCardTokenResult:(0,s.slot)(),webOnboardingModeUpdated:(0,s.slot)(),currentLocationUpdated:(0,s.slot)(),checkDirectorySyncKeyRequest:(0,s.slot)(),encryptSettingsResultUpdated:(0,s.slot)(),confirmCreateAccountResultUpdated:(0,s.slot)(),sendSharingResponseResult:(0,s.slot)(),serverSidePairingStatusChanged:(0,s.slot)(),getUki:(0,s.slot)(),getAccountInfo:(0,s.slot)(),getDevicesList:(0,s.slot)(),getLocalAccountsList:(0,s.slot)(),getTemporaryToken:(0,s.slot)(),deactivateDevice:(0,s.slot)(),changeDeviceName:(0,s.slot)(),getInvoices:(0,s.slot)(),getPersonalSettings:(0,s.slot)(),openSession:(0,s.slot)({noBuffer:!0}),openSessionWithToken:(0,s.slot)({noBuffer:!0}),openSessionWithDashlaneAuthenticator:(0,s.slot)({noBuffer:!0}),cancelDashlaneAuthenticatorRegistration:(0,s.slot)(),openSessionWithOTP:(0,s.slot)({noBuffer:!0}),openSessionWithOTPForNewDevice:(0,s.slot)({noBuffer:!0}),openSessionWithMasterPassword:(0,s.slot)({noBuffer:!0}),openExtraDeviceSession:(0,s.slot)({noBuffer:!0}),openSessionWithExtraDeviceToken:(0,s.slot)({noBuffer:!0}),openSessionResendToken:(0,s.slot)({noBuffer:!0}),sessionForceSync:(0,s.slot)(),closeSession:(0,s.slot)(),lockSession:(0,s.slot)({noBuffer:!0}),cancelPremiumSubscription:(0,s.slot)(),createUserGroup:(0,s.slot)(),deleteUserGroup:(0,s.slot)(),renameUserGroup:(0,s.slot)(),inviteUserGroupMembers:(0,s.slot)(),revokeUserGroupMembers:(0,s.slot)(),updateUserGroupMembers:(0,s.slot)(),teamUpdated:(0,s.slot)(),createAccountStep1:(0,s.slot)(),createAccountStep2:(0,s.slot)(),checkLogin:(0,s.slot)(),savePersonalDataItem:(0,s.slot)(),removePersonalDataItem:(0,s.slot)(),savePaymentCard:(0,s.slot)(),getMasterPasswordResetDemandList:(0,s.slot)(),acceptMasterPasswordResetDemand:(0,s.slot)(),checkIfMasterPasswordIsValid:(0,s.slot)(),declineMasterPasswordResetDemand:(0,s.slot)(),getMembers:(0,s.slot)(),addTeamAdmin:(0,s.slot)(),removeTeamAdmin:(0,s.slot)(),setTeamSettings:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)(),checkDirectorySyncKeyResponse:(0,s.slot)(),queryStaticDataCollections:(0,s.slot)(),sendSharingResponse:(0,s.slot)(),revokeSharing:(0,s.slot)(),updateSharingPermission:(0,s.slot)(),setPendingElementsAsSeen:(0,s.slot)(),resumeSession:(0,s.slot)(),exceptionLog:(0,s.slot)()}},30187:(e,t,r)=>{var s;r.d(t,{w:()=>s}),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(s||(s={}))},94883:(e,t,r)=>{r.d(t,{Rj:()=>n,Xz:()=>o,_m:()=>a});var s=r(30504),i=r(55432);const a={addLoginNotification:(0,s.slot)(),clearAllStoredLoginNotification:(0,s.slot)()},o={getLoginNotifications:(0,s.slot)()},n={liveLoginNotifications:(0,i.H)()}},22955:(e,t,r)=>{r.d(t,{_1:()=>n,vq:()=>a,xP:()=>o});var s=r(30504),i=r(55432);const a={updateLoginStepInfo:(0,s.slot)(),resetLoginStepInfo:(0,s.slot)()},o={getLoginStepInfo:(0,s.slot)()},n={liveLoginStepInfo:(0,i.H)()}},35096:(e,t,r)=>{r.d(t,{I:()=>i});var s=r(30504);const i={savePersonalDataItem:(0,s.slot)(),filledDataItem:(0,s.slot)(),updateWebOnboardingMode:(0,s.slot)()}},8755:(e,t,r)=>{r.d(t,{Ie:()=>o,U$:()=>a,iX:()=>n});var s=r(30504),i=r(55432);const a={markNotificationAsInteracted:(0,s.slot)(),markNotificationAsSeen:(0,s.slot)(),markNotificationAsUnseen:(0,s.slot)()},o={getNotificationStatus:(0,s.slot)()},n={liveNotificationStatus:(0,i.H)()}},52215:(e,t,r)=>{r.d(t,{of:()=>u,K1:()=>d,A2:()=>l});var s=r(30504),i=r(55432);const a={getLoginDeviceLimitFlow:(0,s.slot)()},o={liveLoginDeviceLimitFlow:(0,i.H)()},n={getTwoFactorAuthenticationInfo:(0,s.slot)()},c={liveTwoFactorAuthenticationInfo:(0,i.H)()},l={getLoginStatus:(0,s.slot)(),getLocalAccounts:(0,s.slot)(),getIsSSOUser:(0,s.slot)(),getSSOMigrationInfo:(0,s.slot)(),getSessionInfo:(0,s.slot)(),getMasterPasswordAndServerKey:(0,s.slot)(),getUserCryptoSettings:(0,s.slot)(),getSyncInfo:(0,s.slot)(),getIsSyncInProgress:(0,s.slot)(),getPremiumStatus:(0,s.slot)(),getNodePremiumStatus:(0,s.slot)(),getSubscriptionInformation:(0,s.slot)(),getActiveSpaces:(0,s.slot)(),getSSOProviderInfo:(0,s.slot)(),getUserLogin:(0,s.slot)(),getPublicUserId:(0,s.slot)(),getAnalyticsInstallationId:(0,s.slot)(),getUserLoginStatus:(0,s.slot)(),getWebOnboardingMode:(0,s.slot)(),getIsPaymentFailureChurningDismissed:(0,s.slot)(),getCredentialSearchOrder:(0,s.slot)(),getDidOpen:(0,s.slot)(),getPlatformName:(0,s.slot)(),getAccountAuthenticationType:(0,s.slot)(),...a,...n},d={liveLoginStatus:(0,i.H)(),liveDidOpen:(0,i.H)(),liveIsSSOUser:(0,i.H)(),liveSSOMigrationInfo:(0,i.H)(),liveSessionInfo:(0,i.H)(),liveSyncInfo:(0,i.H)(),liveIsSyncInProgress:(0,i.H)(),livePremiumStatus:(0,i.H)(),liveServiceProviderUrl:(0,i.H)(),liveWebOnboardingMode:(0,i.H)(),liveSubscriptionInformation:(0,i.H)(),...o,...c},u={validateToken:(0,s.slot)(),validateMasterPassword:(0,s.slot)(),resetProtectedItemAutofillTimer:(0,s.slot)(),forceSync:(0,s.slot)(),updatePremiumChurningDismissDate:(0,s.slot)(),setCredentialSearchOrder:(0,s.slot)(),refreshSubscriptionInformation:(0,s.slot)(),updateAccountRecoveryKeyPersonalSettings:(0,s.slot)()}},43956:(e,t,r)=>{var s;r.d(t,{fE:()=>n,vX:()=>c}),function(e){e[e.NO_PREMIUM=0]="NO_PREMIUM",e[e.PREMIUM=1]="PREMIUM",e[e.PREMIUM_CANCELLED=2]="PREMIUM_CANCELLED",e[e.OLD_ACCOUNT=3]="OLD_ACCOUNT",e[e.NEW_USER=4]="NEW_USER",e[e.GRACE_PERIOD=5]="GRACE_PERIOD"}(s||(s={}));Object.freeze({freeTrialGranted:"free_trial_granted",premiumGranted:"premium_granted",renewed:"renewed",subscribed:"subscribed",crosssellPurchased:"crosssell_purchased",setAsLegacy:"set_as_legacy",familyCreated:"family_created",familyRenewed:"family_renewed"}),Object.freeze({Amazon:"amazon",FreeTrial:"free_trial",Invoice:"invoice",IOS:"ios",IOSRenewable:"ios_renewable",Legacy:"legacy",Mac:"mac",MacRenewable:"mac_renewable",Offer:"offer",Partner:"partner",Paypal:"paypal",PaypalRenewable:"paypal_renewable",Playstore:"playstore",PlaystoreRenewable:"playstore_renewable",Stripe:"stripe"});var i,a,o;!function(e){e[e.UNPAIRED=0]="UNPAIRED",e[e.PAIRED=1]="PAIRED"}(i||(i={})),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(a||(a={})),function(e){e.not_in_team="not_in_team",e.proposed="proposed",e.in_team="in_team"}(o||(o={}));Object.freeze({Premium:"premium",Essentials:"essentials",Premiumplus:"premiumplus",BackupForAll:"backup-for-all"}),Object.freeze({Team:"team",Business:"business",Legacy:"legacy",Entreprise:"entreprise",Free:"free",Starter:"starter",EntryLevel:"entry_level"});var n,c,l;!function(e){e.Accepted="accepted",e.Pending="pending",e.Proposed="proposed",e.Refused="refused",e.Removed="removed",e.Revoked="revoked",e.Unproposed="unproposed"}(n||(n={})),function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(c||(c={})),function(e){e.NAME="name",e.DATE="date"}(l||(l={}))},38578:(e,t,r)=>{r.d(t,{H:()=>a,r:()=>i});var s=r(30504);const i={generatePassword:(0,s.slot)(),generateAndSavePassword:(0,s.slot)(),savePasswordGenerationSettings:(0,s.slot)()},a={getPasswordGenerationSettings:(0,s.slot)()}},73298:(e,t,r)=>{r.d(t,{P:()=>a,_:()=>i});var s=r(30504);const i={cancelAutoRenew:(0,s.slot)(),downloadCustomerInvoice:(0,s.slot)(),fetchInvoiceList:(0,s.slot)(),requestRefund:(0,s.slot)()},a={getInvoicesCount:(0,s.slot)(),getInvoiceList:(0,s.slot)(),getInvoiceListYears:(0,s.slot)()}},52860:(e,t,r)=>{r.d(t,{UW:()=>o,gQ:()=>a,qN:()=>n});var s=r(30504),i=r(55432);const a={disableCredentialProtection:(0,s.slot)(),unlockProtectedItems:(0,s.slot)()},o={vaultLockDate:(0,s.slot)()},n={liveVaultLockDate:(0,i.H)()}},77507:(e,t,r)=>{r.d(t,{$k:()=>a,EX:()=>n,q9:()=>o});var s=r(30504),i=r(55432);const a={activateAccountRecovery:(0,s.slot)(),setupMasterPasswordForRecovery:(0,s.slot)(),deactivateAccountRecovery:(0,s.slot)(),registerDeviceForRecovery:(0,s.slot)(),startAccountRecovery:(0,s.slot)(),sendRecoveryRequest:(0,s.slot)(),cancelRecoveryRequest:(0,s.slot)(),checkRecoveryRequestStatus:(0,s.slot)(),recoverUserData:(0,s.slot)(),checkDoesLocalRecoveryKeyExist:(0,s.slot)(),isRecoveryRequestPending:(0,s.slot)()},o={getRecoveryOptInSetting:(0,s.slot)(),getShouldShowFeatureActivationModal:(0,s.slot)(),getAccountRecoveryRequestCount:(0,s.slot)()},n={liveAccountRecoveryRequestCount:(0,i.H)()}},27794:(e,t,r)=>{r.d(t,{Ll:()=>o,i1:()=>a,uG:()=>n});var s=r(30504),i=r(55432);const a={getAllSharedItemIds:(0,s.slot)(),getMyAcceptedUserGroups:(0,s.slot)(),getSharingCapacity:(0,s.slot)(),getUserGroups:(0,s.slot)(),getUserGroup:(0,s.slot)(),getUserGroupMembers:(0,s.slot)(),getSharingUsers:(0,s.slot)(),getSharingUserPermissionLevel:(0,s.slot)()},o={liveAllSharedItemIds:(0,i.H)(),liveMyAcceptedUserGroups:(0,i.H)(),liveSharingCapacity:(0,i.H)(),liveUserGroups:(0,i.H)(),liveSharingUsers:(0,i.H)(),liveSharingUserPermissionLevel:(0,i.H)()},n={convertItemToDashlaneXml:(0,s.slot)(),shareItem:(0,s.slot)()}},73762:(e,t,r)=>{r.d(t,{N:()=>i,b:()=>a});var s=r(30504);const i={getIsRecoveryEnabled:(0,s.slot)()},a={getTeamInfo:(0,s.slot)(),computePlanPricing:(0,s.slot)()}},77253:(e,t,r)=>{r.d(t,{XJ:()=>a,dN:()=>o,hO:()=>n});var s=r(30504),i=r(55432);const a={getAdministrableUserGroup:(0,s.slot)(),getAdministrableUserGroups:(0,s.slot)(),isGroupNameAvailable:(0,s.slot)(),getAdminProvisioningKey:(0,s.slot)()},o={liveAdministrableUserGroup:(0,i.H)(),liveAdministrableUserGroups:(0,i.H)(),liveAdminProvisioningKey:(0,i.H)()},n={registerTeamDomain:(0,s.slot)(),completeTeamDomainRegistration:(0,s.slot)(),deactivateTeamDomain:(0,s.slot)(),getTeamDomains:(0,s.slot)(),getTeamDevice:(0,s.slot)(),listTeamDevices:(0,s.slot)(),deactivateTeamDevice:(0,s.slot)(),registerTeamDevice:(0,s.slot)(),registerTeamDeviceAccount:(0,s.slot)(),getEncryptionServiceConfig:(0,s.slot)(),generateAndSaveEncryptionServiceConfig:(0,s.slot)(),clearSelfHostedESSettings:(0,s.slot)(),getTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamDeviceEncryptedConfig:(0,s.slot)(),updateTeamSettings:(0,s.slot)(),parseMetadataFields:(0,s.slot)(),persistAdminProvisioningKey:(0,s.slot)(),removeAdminProvisioningKey:(0,s.slot)(),createSSOConnectorConfig:(0,s.slot)(),generateSSOConnectorKey:(0,s.slot)(),startAuditLogsQuery:(0,s.slot)(),getAuditLogQueryResults:(0,s.slot)(),getRecoveryCodesAsTeamCaptain:(0,s.slot)(),createInviteLink:(0,s.slot)(),changeInviteLinkTeamKey:(0,s.slot)(),toggleInviteLink:(0,s.slot)(),getInviteLink:(0,s.slot)(),requestInviteLinkToken:(0,s.slot)(),getInviteLinkForAdmin:(0,s.slot)(),getLastADSyncDate:(0,s.slot)(),getSpecialUserGroupInviteValuesForMemberInTeam:(0,s.slot)(),getSpecialUserGroupRevision:(0,s.slot)()}},89210:(e,t,r)=>{r.d(t,{Kr:()=>n,Vz:()=>a,kh:()=>o});var s=r(30504),i=r(55432);const a={getVisibleUserMessages:(0,s.slot)(),getUserMessages:(0,s.slot)()},o={liveUserMessages:(0,i.H)(),liveVisibleUserMessages:(0,i.H)()},n={dismissUserMessages:(0,s.slot)(),addUserMessage:(0,s.slot)()}},71316:(e,t,r)=>{r.d(t,{T4:()=>a,fD:()=>o,lp:()=>n});var s=r(30504),i=r(55432);const a={getVpnAccount:(0,s.slot)(),getVpnCapabilitySetting:(0,s.slot)()},o={liveVpnAccount:(0,i.H)()},n={activateVpnAccount:(0,s.slot)(),clearVpnAccountErrors:(0,s.slot)(),completeVpnAccountActivation:(0,s.slot)()}},6936:(e,t,r)=>{r.d(t,{W:()=>E});var s=r(86952),i=r(74354),a=r(25029),o=r(66302),n=r(99059);class c extends((0,i.A)({scope:a.F.Device})){}class l extends((0,i.A)({scope:a.F.Device})){}class d extends((0,i.g)({scope:a.F.Device})){}var u;const p={...(u=o.z,Object.keys(u).reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Command`]:(0,i.A)({scope:a.F.Device})})),{})),CarbonCommand:c,CarbonLegacyLeelooCommand:l,MitigationDeleteGrapheneUserDataCommand:d};var h=r(23326),m=r(38344),g=r(33820);class v extends((0,n.k)({scope:a.F.Device})){}class y extends((0,n.k)({scope:a.F.Device})){}var _,f;const S={...(_=m.r,f=g.z,[...Object.keys(_),...Object.keys(f)].reduce(((e,t)=>({...e,[`${t[0].toUpperCase().concat(t.substring(1))}Query`]:(0,n.k)({scope:a.F.Device})})),{})),CarbonStateQuery:v,CarbonStateListQuery:y},E=(0,s.Q)({name:"carbon-legacy",commands:p,queries:S,events:h.U3})},86252:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(67837),i=r(6936);class a extends((0,s.E)(i.W)){}(0,s.K)(i.W,a)},23326:(e,t,r)=>{r.d(t,{Dj:()=>o,E1:()=>n,U3:()=>c});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.Device})){}class o extends((0,s.d)({scope:i.F.Device})){}class n extends((0,s.d)({scope:i.F.Device})){}const c={CarbonCommandResultEvent:a,CarbonLegacyEvent:o,CarbonLegacyDeviceRemotelyDeleted:n}},44632:(e,t,r)=>{r.d(t,{fv:()=>$,QX:()=>Y,pz:()=>q});var s=r(30504),i=r(55432);const a={getBreach:(0,s.slot)(),getBreaches:(0,s.slot)(),getBreachesPage:(0,s.slot)(),getBreachesPaginationToken:(0,s.slot)(),getBreachesUpdateStatus:(0,s.slot)()},o={liveBreach:(0,i.H)(),liveBreaches:(0,i.H)(),liveBreachesBatch:(0,i.H)(),liveBreachesUpdaterStatus:(0,i.H)()},n={updateBreachStatus:(0,s.slot)()},c={addCollection:(0,s.slot)(),deleteCollection:(0,s.slot)(),removeItemsFromCollections:(0,s.slot)(),updateCollection:(0,s.slot)()},l={addCredential:(0,s.slot)(),updateCredential:(0,s.slot)(),updateLinkedWebsites:(0,s.slot)()},d={getCredential:(0,s.slot)(),getCredentialCategories:(0,s.slot)(),getCredentials:(0,s.slot)(),getCredentialsByDomain:(0,s.slot)(),getCredentialsCount:(0,s.slot)(),getCredentialsPage:(0,s.slot)(),getCredentialsPaginationToken:(0,s.slot)(),getDashlaneDefinedLinkedWebsites:(0,s.slot)(),getShouldShowRequireMasterPassword:(0,s.slot)()},u={liveCredential:(0,i.H)(),liveCredentials:(0,i.H)(),liveCredentialsByDomain:(0,i.H)(),liveCredentialsBatch:(0,i.H)(),liveCredentialsCount:(0,i.H)()},p={getIsForcedDomainsEnabled:(0,s.slot)()},h={getPersonalDataExport:(0,s.slot)()},m={getGeneratedPassword:(0,s.slot)(),getGeneratedPasswordsCount:(0,s.slot)(),getGeneratedPasswords:(0,s.slot)(),getGeneratedPasswordsPage:(0,s.slot)(),getGeneratedPasswordsPaginationToken:(0,s.slot)()},g={liveGeneratedPasswordsCount:(0,i.H)(),liveGeneratedPasswords:(0,i.H)()},v={saveGeneratedPassword:(0,s.slot)()},y={addDriverLicense:(0,s.slot)(),editDriverLicense:(0,s.slot)()},_={addFiscalId:(0,s.slot)(),editFiscalId:(0,s.slot)()},f={addIdCard:(0,s.slot)(),editIdCard:(0,s.slot)()},S={addPassport:(0,s.slot)(),editPassport:(0,s.slot)()},E={addSocialSecurityId:(0,s.slot)(),editSocialSecurityId:(0,s.slot)()},b=(0,s.combineEvents)(y,_,f,S,E),w={getImportPersonalDataStatus:(0,s.slot)()},A={liveImportPersonalDataStatus:(0,i.H)()},C={importPersonalData:(0,s.slot)(),previewPersonalData:(0,s.slot)(),dismissPersonalDataImportNotifications:(0,s.slot)()},I={getPasskey:(0,s.slot)(),getPasskeys:(0,s.slot)(),getPasskeysForDomain:(0,s.slot)()},T={livePasskey:(0,i.H)(),livePasskeys:(0,i.H)()},P={addPasskey:(0,s.slot)(),updatePasskey:(0,s.slot)(),deletePasskey:(0,s.slot)()},O={getHasPasswordHistory:(0,s.slot)(),getPasswordHistoryPage:(0,s.slot)(),getPasswordHistoryPaginationToken:(0,s.slot)()},R={livePasswordHistory:(0,i.H)(),livePasswordHistoryBatch:(0,i.H)()},D={getPaymentCard:(0,s.slot)(),getPaymentCards:(0,s.slot)()},N={livePaymentCard:(0,i.H)(),livePaymentCards:(0,i.H)()},U={addPaymentCard:(0,s.slot)(),updatePaymentCard:(0,s.slot)(),deletePaymentCard:(0,s.slot)()},F={getSecureFilesQuota:(0,s.slot)(),getSecureFilesInfoList:(0,s.slot)(),getFileDownloadProgress:(0,s.slot)(),getFileUploadProgress:(0,s.slot)()},M={liveSecureFilesQuota:(0,i.H)(),liveFileDownloadProgress:(0,i.H)(),liveFileUploadProgress:(0,i.H)()},L={downloadSecureFile:(0,s.slot)(),chunkTransferDone:(0,s.slot)(),deleteSecureFile:(0,s.slot)(),addSecureFile:(0,s.slot)(),validateSecureFile:(0,s.slot)(),commitSecureFile:(0,s.slot)(),initSecureFilesStorageInfo:(0,s.slot)(),clearSecureFileState:(0,s.slot)()},x={setupDefaultNoteCategories:(0,s.slot)()},k={getNote:(0,s.slot)(),getNoteCategories:(0,s.slot)(),getNotes:(0,s.slot)(),getNotesCount:(0,s.slot)(),getNotesPage:(0,s.slot)(),getNotesPaginationToken:(0,s.slot)()},G={liveNote:(0,i.H)(),liveNotes:(0,i.H)(),liveNotesBatch:(0,i.H)(),liveNotesCount:(0,i.H)()},V={getAnonymousUserId:(0,s.slot)(),getIsUrlBanished:(0,s.slot)(),arePasswordsProtected:(0,s.slot)(),areRichIconsEnabled:(0,s.slot)()},K={liveArePasswordsProtected:(0,i.H)(),liveAreRichIconsEnabled:(0,i.H)()},j={toggleDashlane:(0,s.slot)(),updateProtectPasswordsSetting:(0,s.slot)(),updateAutofillSettings:(0,s.slot)(),updateRichIconsSetting:(0,s.slot)()},B={getSpace:(0,s.slot)(),getSpaces:(0,s.slot)()},W={disableVaultItemProtection:(0,s.slot)()},z={getSecretsCount:(0,s.slot)()},H={liveSecrets:(0,i.H)(),liveSecretsCount:(0,i.H)()},Q={duplicateVaultItem:(0,s.slot)()},q=(0,s.combineEvents)(a,d,p,m,w,k,I,O,D,z,F,V,B,{}),Y=(0,s.combineEvents)(o,u,g,A,G,T,R,N,H,M,K),$=(0,s.combineEvents)(n,c,l,h,v,b,C,P,U,L,x,j,W,Q)},61476:(e,t,r)=>{r.d(t,{J:()=>n});var s=r(86952),i=r(46047),a=r(70219),o=r(26331);const n=(0,s.Q)({name:"permissions",commands:{addGroupManager:i.B,removeGroupManager:a.d},events:{},queries:{userPermissions:o.l}})},46047:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},70219:(e,t,r)=>{r.d(t,{d:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},26331:(e,t,r)=>{r.d(t,{l:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},23597:(e,t,r)=>{r.d(t,{B:()=>K});var s,i=r(88802),a=r(99634),o=r(61476),n=r(34710),c=r(93850),l=r(63663),d=r(46047),u=r(60399),p=r(57924),h=r(87113),m=r(86252),g=r(87279),v=r(48844);!function(e){e[e.GroupManager=0]="GroupManager"}(s||(s={}));let y=class{constructor(e,t){this.serverApiClient=e,this.carbonLegacyClient=t}async addRole({role:e,params:t}){if(e===s.GroupManager)return await this.addGroupManager(t)}async removeRole({role:e,params:t}){if(e===s.GroupManager)return await this.removeGroupManager(t)}async getSpecialUserGroupRevision(e){const{commands:{carbon:t}}=this.carbonLegacyClient,r=await t({name:"getSpecialUserGroupRevision",args:[{teamId:e}]});let s;if(!(0,g.d6)(r))throw r.error.error;{const{carbonResult:e}=r.data,{specialUserGroupRevision:t}=e;s=t}return s}async removeGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t);return await(0,u.z)(this.serverApiClient.v1.teams.removeGroupManager({memberLogin:e,userGroupRevision:r}).pipe((0,v.DZ)((e=>{throw new Error(e.message)})),(0,v.lk)((e=>{if(e.data)return(0,g.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to remove group manager")}))))}async addGroupManager({memberLogin:e,teamId:t}){const r=await this.getSpecialUserGroupRevision(t),{commands:{carbon:s}}=this.carbonLegacyClient,i=await s({name:"getSpecialUserGroupInviteValuesForMemberInTeam",args:[{memberLogin:e,teamId:t}]});let a="",o="";if(!(0,g.d6)(i))throw i.error.error;{const{carbonResult:e}=i.data,{groupKey:t,proposeSignature:r}=e;a=t,o=r}return await(0,u.z)(this.serverApiClient.v1.teams.addGroupManager({memberLogin:e,groupKey:a,proposeSignature:o,userGroupRevision:r}).pipe((0,v.DZ)((e=>{throw new Error(e.message)})),(0,v.lk)((e=>{if(e.data)return(0,g.Vp)(void 0);throw new Error("Unknown server error occurred while attempting to add group manager")}))))}};y=(0,i.__decorate)([(0,p.GS)(),(0,i.__metadata)("design:paramtypes",[h.l,m._])],y);let _=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.addRole({role:s.GroupManager,params:e})}};_=(0,i.__decorate)([(0,l.W)(d.B),(0,i.__metadata)("design:paramtypes",[y])],_);var f=r(70219);let S=class{constructor(e){this.roleService=e}async execute({body:e}){return await this.roleService.removeRole({role:s.GroupManager,params:e})}};S=(0,i.__decorate)([(0,l.W)(f.d),(0,i.__metadata)("design:paramtypes",[y])],S);var E=r(26331),b=r(20754),w=r(43978),A=r(69885),C=r(87065),I=r(7165);const T=I.z.enum(["ALL","BILLING_EDIT","BILLING_READ","GROUP_CREATE","GROUP_DELETE","GROUP_EDIT","GROUP_READ"]),P=T,O=I.z.array(T);var R=r(95681),D=r(23347),N=r(10722),U=r(25029);const F=e=>O.safeParse(e).success;class M extends((0,R.Q)({storage:{schemaVersion:1,initialValue:[],typeGuard:F},persist:!0,scope:U.F.User,storeName:"permissions-store",capacity:D.Y._010KB,codec:N.E})){}let L=class{constructor(e,t,r){this.carbon=e,this.serverApiClient=t,this.permissionsStore=r}async refreshState(){const{getActiveSpaces:e}=this.carbon.queries;return await(0,u.z)(e().pipe((0,w.w)((e=>{if(!(0,g.d6)(e))throw new Error("Cannot retrieve user spaces from carbon");return e.data.length?this.serverApiClient.v1.teams.getUserPermissions().pipe((0,C.U)((e=>{if((0,g.hx)(e))throw new Error(`getUserPermissions failed with error: ${e}`);this.permissionsStore.set(this.serverToDomainPermissionsMapper(e.data.data.permissions))}))):(0,A.of)(void 0)}))))}getActiveUserPermissions(){return this.permissionsStore.state$.pipe((0,C.U)(g.Vp))}serverToDomainPermissionsMapper(e){return e.filter((e=>P.safeParse(e).success))}};L=(0,i.__decorate)([(0,p.GS)(),(0,i.__metadata)("design:paramtypes",[m._,h.l,M])],L);let x=class{constructor(e){this.permissionsService=e}execute(){return this.permissionsService.getActiveUserPermissions()}};x=(0,i.__decorate)([(0,b.e)(E.l),(0,i.__metadata)("design:paramtypes",[L])],x);var k=r(5237),G=r(68307);let V=class{constructor(e){this.permissionsService=e}async handle(){await this.permissionsService.refreshState()}};V=(0,i.__decorate)([(0,G.b)(k.M),(0,i.__metadata)("design:paramtypes",[L])],V);let K=class{};K=(0,i.__decorate)([(0,a.Y)({api:o.J,imports:[c.n],providers:[L,y],stores:[M],handlers:{commands:{addGroupManager:_,removeGroupManager:S},events:{...(0,a.g)(n.Q,{sessionOpened:V})},queries:{userPermissions:x}}})],K)},18183:(e,t,r)=>{r.d(t,{j:()=>E});var s=r(86952),i=r(13060),a=r(22481),o=r(74593),n=r(23823),c=r(78519),l=r(6790),d=r(78548),u=r(60017),p=r(24662),h=r(77539),m=r(22632),g=r(14074),v=r(5370),y=r(40956),_=r(22618),f=r(36261),S=r(80448);const E=(0,s.Q)({name:"accountRecoveryKey",commands:{goToActivationNextStep:i.Z,goToActivationPrevStep:a.H,requestActivation:o.e,cancelActivation:n.w,cancelGeneration:c.r,confirmActivation:l.W,confirmNewPassword:d.v,deactivate:u.E,submitRecoveryKey:p.Y,tryAgainRecovery:h.d,cancelRecoveryFlow:m.b,startRecoveryFlow:g.Q,clearWrongRecoveryKeyError:v.u},queries:{activationFlowStatus:y.S,accountRecoveryKeyStatus:_.D,recoveryFlowStatus:f.y,recoveryMethodsInfo:S.V},events:{}})},23823:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},78519:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},22632:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},5370:(e,t,r)=>{r.d(t,{u:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},6790:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},78548:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},60017:(e,t,r)=>{r.d(t,{E:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},13060:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},22481:(e,t,r)=>{r.d(t,{H:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},74593:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},14074:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},24662:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},77539:(e,t,r)=>{r.d(t,{d:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},22618:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},40956:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},36261:(e,t,r)=>{r.d(t,{y:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},80448:(e,t,r)=>{r.d(t,{V:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},77547:(e,t,r)=>{r.d(t,{D:()=>At});var s=r(88802),i=r(18183),a=r(11433),o=r(99634),n=r(38679),c=r(9671),l=r(93850),d=r(37935),u=r(80310),p=r(87279),h=r(63663),m=r(13060),g=r(78065),v=r(24966),y=r(57924),_=r(53446),f=r(37294),S=r(65865),E=r(18275),b=r(60399),w=r(30523),A=r(87065),C=r(86252),I=r(87113),T=r(48844),P=r(18533),O=r(20195),R=r(25029),D=r(95681),N=r(23347);const U=e=>!(!e||"object"!=typeof e)&&"isEnabled"in e;class F extends((0,D.Q)({initialValue:{isEnabled:void 0,login:void 0},persist:!1,scope:R.F.Device,storeName:"account-recovery-key",storeTypeGuard:U,capacity:N.Y._001KB})){}const M=["email_token","totp","duo_push","dashlane_authenticator"],L=e=>"object"==typeof e&&"type"in e;var x,k=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.NETWORK_ERROR="NETWORK_ERROR",e.INITIALIZE_MACHINE_ERROR="INITIALIZE_MACHINE_ERROR",e.WRONG_RECOVERY_KEY_ERROR="WRONG_RECOVERY_KEY_ERROR",e.CHANGE_MASTER_PASSWORD_ERROR="CHANGE_MASTER_PASSWORD_ERROR"}(x||(x={}));class G extends((0,k.Hu)(x.NETWORK_ERROR,"There is an issue with your connection")){}let V=class{constructor(e,t,r){this.store=e,this.serverApiClient=t,this.carbon=r}getAuthTicketInfo(){const{carbonState:e}=this.carbon.queries;return(0,b.z)(e({path:"userSession.authTicketInfo"}).pipe((0,T.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting auth ticket info")}})))}retrieveLocalAccounts(){const{carbonState:e}=this.carbon.queries;return(0,b.z)(e({path:"authentication.localAccounts"}).pipe((0,w.h)(p.d6),(0,w.h)((e=>e.data.accountsListInitialized)),(0,A.U)((e=>e.data.accountsList))))}async getCurrentPersonalSettings(){const{carbonStateList:e}=this.carbon.queries;return await(0,b.z)(e({paths:["userSession.personalSettings.AccountRecoveryKey","userSession.personalSettings.AccountRecoveryKeyId"]}).pipe((0,T.nb)({success:([e,t])=>({AccountRecoveryKey:e,AccountRecoveryKeyId:t}),failure:()=>{throw new Error("Failure getting state list")}})))}getLastAuthenticatedUserRecoveryData(){return this.store.state$.pipe((0,A.U)((e=>({isEnabled:e.isEnabled,login:e.login}))))}async updateLastAuthenticatedUserRecoveryStatus(e){if(!e)throw new Error("No user login provided");const t=await(0,b.z)(this.serverApiClient.v1.accountrecovery.getStatus({login:e}));if((0,p.hx)(t))throw new Error("Server call failed");await this.store.set({isEnabled:t.data.data.enabled,login:e})}async generateRecoveryKey(){const{carbon:e}=this.carbon.commands,t={length:28,digits:!0,letters:!0,avoidAmbiguous:!0,symbols:!1};return await e({name:"generatePassword",args:[{settings:t}]})}async setPersonalSettings(e){const{carbon:t}=this.carbon.commands;return await t({name:"updateAccountRecoveryKeyPersonalSettings",args:[e]})}async getAccountInfo(e){return await(0,b.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:M}).pipe((0,T.DZ)((e=>(0,P.EQ)(e,{BusinessError:()=>{throw new Error(x.GENERIC_ERROR)},FetchFailedError:()=>new G,InternalServerError:O.j,InvalidRequest:O.j,RateLimited:O.j,ServiceUnavailable:O.j,UnspecifiedBadStatus:O.j}))),(0,T.lk)((e=>{const t=e.data.verifications.find(L);if(t)return(0,p.Vp)({verificationMethod:t,accountType:e.data.accountType});throw new Error("Unsupported authentication method")}))))}async requestActivation(e){return await(0,b.z)(this.serverApiClient.v1.accountrecovery.requestActivation({encryptedVaultKey:e}).pipe((0,T.DZ)((e=>(0,P.EQ)(e,{BusinessError:()=>{throw new Error(x.GENERIC_ERROR)},FetchFailedError:()=>new G,UnspecifiedBadStatus:O.j,InternalServerError:O.j,InvalidRequest:O.j,RateLimited:O.j,ServiceUnavailable:O.j}))),(0,T.lk)((e=>{if(e.data.recoveryId)return(0,p.Vp)(e.data.recoveryId);throw new Error(x.GENERIC_ERROR)}))))}async confirmActivation(e){return await(0,b.z)(this.serverApiClient.v1.accountrecovery.confirmActivation({recoveryId:e}).pipe((0,T.DZ)((e=>(0,P.EQ)(e,{BusinessError:()=>{throw new Error(x.GENERIC_ERROR)},FetchFailedError:()=>new G,UnspecifiedBadStatus:O.j,InternalServerError:O.j,InvalidRequest:O.j,RateLimited:O.j,ServiceUnavailable:O.j}))),(0,T.lk)((()=>(0,p.Vp)(void 0)))))}async deactivate(e){return await(0,b.z)(this.serverApiClient.v1.accountrecovery.deactivate({reason:e}).pipe((0,T.DZ)((e=>(0,P.EQ)(e,{BusinessError:()=>{throw new Error(x.GENERIC_ERROR)},FetchFailedError:()=>new G,UnspecifiedBadStatus:O.j,InternalServerError:O.j,InvalidRequest:O.j,RateLimited:O.j,ServiceUnavailable:O.j}))),(0,T.lk)((()=>(0,p.Vp)(void 0)))))}async getEncryptedVaultKey(e,t){return await(0,b.z)(this.serverApiClient.v1.accountrecovery.getEncryptedVaultKey({login:e,authTicket:t}).pipe((0,T.DZ)((e=>(0,P.EQ)(e,{BusinessError:()=>{throw new Error(x.GENERIC_ERROR)},FetchFailedError:()=>new G,UnspecifiedBadStatus:O.j,InternalServerError:O.j,InvalidRequest:O.j,RateLimited:O.j,ServiceUnavailable:O.j}))),(0,T.lk)((e=>{const{encryptedVaultKey:t,recoveryId:r}=e.data;if(t&&r)return(0,p.Vp)({encryptedVaultKey:t,recoveryId:r});throw new Error(x.GENERIC_ERROR)}))))}};V=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[F,I.l,C._])],V);let K=class{constructor(e){this.recoveryKeyService=e}async execute(){try{const e=await(0,b.z)(this.recoveryKeyService.getLastAuthenticatedUserRecoveryData());return Promise.resolve({isFeatureEnabled:e.isEnabled,recoveryKey:"",recoveryId:"",encryptedVaultKey:""})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};K=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[V])],K);var j=r(54066),B=r(10370),W=r(89685),z=r(56268),H=r(66122),Q=r(94805),q=r(16698);let Y=class{constructor(e,t){this.carbon=e,this.flexibleEncryptor=t}makeDerivationConfig(e){const[,,t]=e.split("$");return"pbkdf2"===t?Q.E1:Q.mr}async getUserCryptoConfig(){const{carbonStateList:e}=this.carbon.queries;return await(0,b.z)(e({paths:["userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,T.nb)({success:([e,t])=>{if("string"!=typeof e)throw new Error("Fixed salt is not a string");if("string"!=typeof t)throw new Error("Marker is not a string");return{fixedSalt:e,derivationConfig:this.makeDerivationConfig(t)}},failure:()=>{throw new Error("Failure getting state list")}})))}async getUserMasterPassword(){const{carbonState:e}=this.carbon.queries;return await(0,b.z)(e({path:"userSession.session.masterPassword"}).pipe((0,A.U)((e=>{if(!(0,p.d6)(e))throw new Error("Error when fetching master password from session");const t=e.data;if("string"!=typeof t)throw new Error("Result data is not a string");return(0,j.u)(t)}))))}async encrypt(e){const t=await this.getUserMasterPassword(),{derivationConfig:r,fixedSalt:s}=await this.getUserCryptoConfig();return await this.flexibleEncryptor.encrypt(e,t,r,q.Nw,{salt:(0,H.R)(s)})}};Y=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[C._,z._])],Y);let $=class{constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyEncryptor=t}async executeWithParams(e){if(e.recoveryKey)return(0,p.Vp)({recoveryKey:e.recoveryKey,encryptedVaultKey:e.encryptedVaultKey,recoveryId:e.recoveryId});const t=await this.accountRecoveryKeyService.generateRecoveryKey();if((0,p.hx)(t))return(0,p.Rn)({tag:x.GENERIC_ERROR});const r=(0,j.u)(t.data.carbonResult.password.toUpperCase()),s=await this.recoveryKeyEncryptor.encrypt(r),i=(0,B.s)(s),a=await this.accountRecoveryKeyService.requestActivation(i);return(0,p.hx)(a)?(0,p.Rn)({tag:a.error.tag}):(0,p.Vp)({recoveryKey:(0,W.v)(r),encryptedVaultKey:i,recoveryId:a.data})}};$=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[V,Y])],$);var X=r(26897),Z=r(76183),J=r(89358);let ee=class{constructor(e,t,r){this.accountRecoveryKeyService=e,this.syncService=t,this.session=r}async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.getCurrentPersonalSettings(),s={AccountRecoveryKey:e,AccountRecoveryKeyId:t};if(await this.accountRecoveryKeyService.setPersonalSettings(s),(0,p.hx)(await this.syncService.waitForSync(X.Trigger.SettingsChange)))return await this.accountRecoveryKeyService.setPersonalSettings(r),(0,p.Rn)({tag:x.GENERIC_ERROR});const i=await this.accountRecoveryKeyService.confirmActivation(t);if((0,p.hx)(i))return await this.accountRecoveryKeyService.setPersonalSettings(r),(0,p.hx)(await this.syncService.waitForSync(X.Trigger.SettingsChange))?(0,p.Rn)({tag:x.GENERIC_ERROR}):(0,p.Rn)({tag:i.error.tag});const a=await(0,b.z)(this.session.queries.selectedOpenedSession());if(!(0,p.d6)(a)||!a.data)throw new Error("No users logged in");return await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(a.data),Promise.resolve((0,p.Vp)(void 0))}};ee=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[V,Z._,J.x])],ee);var te=r(48038);let re=class{constructor(e,t,r){this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r,this.initializeMachineService=e,this.requestActivationService=t,this.confirmActivationService=r}desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"ActivationFlowMachine",context:{isFeatureEnabled:!1,recoveryKey:"",recoveryId:"",encryptedVaultKey:""},states:{Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"InitAccountRecoveryKeyActivation",cond:"isActivationFlow"},{actions:["assignInitialContext"],target:"GenerateNewAccountRecoveryKey"}]}},InitAccountRecoveryKeyActivation:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"}}},RequestingActivation:{invoke:{src:"requestActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{actions:["assignKeys"],target:"DisplayAccountRecoveryKey"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},DisplayAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"ConfirmAccountRecoveryKey"}}},ConfirmAccountRecoveryKey:{on:{GO_TO_NEXT_STEP:{target:"FinalisingAccountRecoveryKeyActivation"},GO_TO_PREV_STEP:{target:"DisplayAccountRecoveryKey"}}},FinalisingAccountRecoveryKeyActivation:{invoke:{src:"confirmActivation",onDone:[{cond:"isFunctionalError",actions:["assignFunctionalError"],target:"AccountRecoveryKeyActivationError"},{target:"AccountRecoveryKeyActivationDone"}],onError:{actions:["assignGenericError"],target:"AccountRecoveryKeyActivationError"}}},AccountRecoveryKeyActivationDone:{},GenerateNewAccountRecoveryKey:{on:{REQUEST_ACTIVATION:{target:"RequestingActivation"},CANCEL_GENERATION:{target:"CancelNewAccountRecoveryKey"}}},CancelNewAccountRecoveryKey:{on:{GO_TO_PREV_STEP:{target:"GenerateNewAccountRecoveryKey"}}},AccountRecoveryKeyActivationError:{}},on:{RESET_FLOW:{actions:["clearContext"],target:"Starting"}}},options:{actions:{assignInitialContext:(0,S.f0)({encryptedVaultKey:(e,t)=>t.data.encryptedVaultKey,recoveryKey:(e,t)=>t.data.recoveryKey,recoveryId:(e,t)=>t.data.recoveryId,isFeatureEnabled:(e,t)=>t.data.isFeatureEnabled}),assignKeys:(0,S.f0)({recoveryKey:(e,t)=>t.data.data.recoveryKey,encryptedVaultKey:(e,t)=>t.data.data.encryptedVaultKey,recoveryId:(e,t)=>t.data.data.recoveryId}),assignFunctionalError:(0,S.f0)({error:(e,t)=>t.data.error.tag}),assignGenericError:(0,S.f0)({error:()=>x.GENERIC_ERROR}),clearContext:(0,S.f0)({encryptedVaultKey:()=>"",recoveryKey:()=>"",recoveryId:()=>"",error:()=>{}})},services:{initializeMachine:()=>this.initializeMachineService.execute(),requestActivation:e=>this.requestActivationService.executeWithParams(e),confirmActivation:e=>this.confirmActivationService.executeWithParams(e.recoveryKey,e.recoveryId)},guards:{isActivationFlow:(e,t)=>function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.Starting")}(t)&&!t.data.isFeatureEnabled,isFunctionalError:(e,t)=>(function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.RequestingActivation")}(t)||function(e){return e.type.startsWith("done.invoke.ActivationFlowMachine.FinalisingAccountRecoveryKeyActivation")}(t))&&(0,p.hx)(t.data)}}};return e&&(0,te.G)(t.config),t}create(e=!1){const{config:t,options:r}=this.desc(e);return(0,E.C)(t,r)}};re=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[K,$,ee])],re);var se=r(8362);const ie=e=>!0;class ae extends((0,D.Q)({initialValue:void 0,persist:!1,scope:R.F.Device,storeName:"activation-flow-machine",storeTypeGuard:ie})){}let oe=class{constructor(e,t,r,s){this.activationMachineStore=r,this.allowedToFail=s,this.activationMachineStore=r;const i=e.create(t);this.interpreter=g.kJ(i).onTransition((0,_.V)(this.allowedToFail)).onEvent((0,f.V)(this.allowedToFail)).onTransition((async()=>{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.activationMachineStore,e)}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?se.ZM.create(JSON.parse(t)):void 0})(this.activationMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Activation] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Activation] Unable to start machine",e)}}ready(){return new v.X(!0)}continue(e){if(!this.interpreter)throw new Error("Activation flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};oe=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[re,Boolean,ae,c.J])],oe);let ne=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,p.Vp)(void 0))}};ne=(0,s.__decorate)([(0,h.W)(m.Z),(0,s.__metadata)("design:paramtypes",[oe])],ne);var ce=r(22481);let le=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"GO_TO_PREV_STEP"}),Promise.resolve((0,p.Vp)(void 0))}};le=(0,s.__decorate)([(0,h.W)(ce.H),(0,s.__metadata)("design:paramtypes",[oe])],le);var de=r(74593);let ue=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"REQUEST_ACTIVATION"}),Promise.resolve((0,p.Vp)(void 0))}};ue=(0,s.__decorate)([(0,h.W)(de.e),(0,s.__metadata)("design:paramtypes",[oe])],ue);var pe=r(23823);let he=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"RESET_FLOW"}),Promise.resolve((0,p.Vp)(void 0))}};he=(0,s.__decorate)([(0,h.W)(pe.w),(0,s.__metadata)("design:paramtypes",[oe])],he);var me=r(78519);let ge=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"CANCEL_GENERATION"}),Promise.resolve((0,p.Vp)(void 0))}};ge=(0,s.__decorate)([(0,h.W)(me.r),(0,s.__metadata)("design:paramtypes",[oe])],ge);var ve=r(6790);let ye=class{constructor(e){this.activationFlow=e}execute(){return this.activationFlow.continue({type:"GO_TO_NEXT_STEP"}),Promise.resolve((0,p.Vp)(void 0))}};ye=(0,s.__decorate)([(0,h.W)(ve.W),(0,s.__metadata)("design:paramtypes",[oe])],ye);var _e=r(78548);let fe=class{constructor(e){this.recoveryKeyService=e}async executeWithParams(e){try{const{authTicket:t}=await this.recoveryKeyService.getAuthTicketInfo(),r=await this.recoveryKeyService.getAccountInfo(e);if((0,p.hx)(r))throw new Error("Unable to retrieve verifications methods for login");return Promise.resolve({authTiket:t??"",accountType:r.data.accountType,verificationMethod:r.data.verificationMethod})}catch(e){return Promise.reject(new Error("Unable to retrieve initialization data"))}}};fe=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[V])],fe);var Se=r(25594);let Ee=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e,t){return await this.flexibleDecryptor.decrypt(e,t)}};Ee=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[Se.a])],Ee);let be=class{constructor(e,t){this.accountRecoveryKeyService=e,this.recoveryKeyDecryptor=t}async executeWithParams({login:e,authTicket:t,recoveryKey:r}){try{const s=await this.accountRecoveryKeyService.getEncryptedVaultKey(e,t);if((0,p.hx)(s))return Promise.reject(x.GENERIC_ERROR);const i=(0,j.u)(r),a=(0,H.R)(s.data.encryptedVaultKey),o=await this.recoveryKeyDecryptor.decrypt(i,a),n=(0,B.s)(o),c=atob(n);return Promise.resolve({oldPassword:c})}catch(e){return(s=e)instanceof Error&&s.message.includes("Signature cannot be verified")?Promise.reject(x.WRONG_RECOVERY_KEY_ERROR):Promise.reject(x.GENERIC_ERROR)}var s}};var we,Ae,Ce;be=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[V,Ee])],be),function(e){e.USER_CHANGING_MP="USER_CHANGING_MP",e.MP_TO_SSO="MP_TO_SSO",e.SSO_TO_MP="SSO_TO_MP",e.TO_EMAIL_TOKEN="EMAIL_TOKEN",e.ADMIN_ASSISTED_RECOVERY="ADMIN_ASSISTED_RECOVERY",e.ACCOUNT_RECOVERY_KEY="ACCOUNT_RECOVERY_KEY"}(we||(we={})),function(e){e.FEATURE_BLOCKED="feature_blocked",e.INNACTIVE_SESSION="inactive_session",e.INVALID_TOKEN="invalid_token",e.OTP_PROBLEM="otp_problem",e.MP_ERROR="mp_error",e.MP_STRENGTH_ERROR="mp_strength_error",e.SUCCESS="success",e.SYNC_PROGRESS="sync_in_progress",e.UNKNOWN_ERROR="unknown_error",e.WRONG_PASSWORD="wrong_password",e.UNEXPECTED_STATE="unexpected_state"}(Ae||(Ae={})),function(e){e.DOWNLOAD="download",e.DECRYPTING="decrypting",e.ENCRYPTING="encrypting",e.UPLOADING="uploading",e.DONE="done",e.ERROR="error"}(Ce||(Ce={}));var Ie=r(25565);let Te=class{constructor(e,t){this.carbon=e,this.deviceRegistration=t}async executeWithParams(e){const{commands:t}=this.carbon;try{const{cleanRemotelyRemovedProfiles:r,registerDevice:s}=this.deviceRegistration.commands,{localAccounts:i}=this.deviceRegistration.queries;await r();const a=await(0,b.z)(i());if((0,p.hx)(a))return Promise.reject(new Error(`[ARK] - Error while fetching local accounts: ${a.error}`));a.data.localAccounts.some((t=>t.login===e.login))||await s({with:"authTicket",login:e.login,authTicket:e.authTicket});const o=await t.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0,loginType:"ARK"}]});if((0,p.hx)(o))return Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${o.error}`));const n=await t.changeMasterPassword({newPassword:e.newPassword,currentPassword:e.oldPassword,flow:we.ACCOUNT_RECOVERY_KEY});return(0,p.hx)(n)||!n.data.success?Promise.reject(new Error(`[ARK] - Error while changing user Master Password (${"failure"===n.tag?n.error:""})`)):Promise.resolve(void 0)}catch(e){return Promise.reject(new Error(`[ARK] - Unable to change user Master Password: ${e}`))}}};Te=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[C._,Ie.z])],Te);var Pe=r(81822);let Oe=class{constructor(e){this.identityVerification=e,this.identityVerification=e}executeWithParams(e,t){try{return this.identityVerification.commands.startIdentityVerification({login:e,verificationMethod:t.type}),Promise.resolve(void 0)}catch(e){return Promise.reject(new Error("Something went wrong..."))}}};Oe=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[Pe.l])],Oe);var Re=r(26457);let De=class{constructor(e,t,r,s,i){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=r,this.logger=s,this.allowedToFail=i}async executeWithParams(e,t){const r=await this.accountRecoveryKeyService.deactivate(t);return(0,p.hx)(r)?(this.logger.trace("Deactivate ARK: "+r.error.message),(0,p.Rn)({tag:r.error.tag})):(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((async()=>await this.syncService.waitForSync(X.Trigger.SettingsChange)),"waitForSync"),(0,p.Vp)(void 0))}};De=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[V,oe,Z._,Re.V,c.J])],De);let Ne=class{constructor(e,t,r){this.carbon=e,this.deactivateArk=t,this.deviceRegistration=r}async executeWithParams(e){const{commands:t,queries:r}=this.carbon;try{const{cleanRemotelyRemovedProfiles:r,registerDevice:s}=this.deviceRegistration.commands,{localAccounts:i}=this.deviceRegistration.queries;await r();const a=await(0,b.z)(i());if((0,p.hx)(a))return Promise.reject(new Error(`[ARK] - Error while fetching local accounts: ${a.error}`));a.data.localAccounts.some((t=>t.login===e.login))||await s({with:"authTicket",login:e.login,authTicket:e.authTicket});const o=await t.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e.login,password:e.oldPassword,rememberPassword:!1,requiredPermissions:void 0,loginType:"ARK"}]});if((0,p.hx)(o))return Promise.reject(new Error(`[ARK] - Error while trying to open session with deciphered recovery key: ${o.error}`));const n=await this.deactivateArk.executeWithParams(e.login,"KEY_USED");return(0,p.hx)(n)?Promise.reject(x.GENERIC_ERROR):Promise.resolve(void 0)}catch(e){const s=await(0,b.z)(r.carbonState({path:"userSession.account.isAuthenticated"}));return(0,p.d6)(s)&&s.data&&await t.carbonLegacyLeeloo({name:"closeSession",arg:[{}]}),Promise.reject(x.GENERIC_ERROR)}}};Ne=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[C._,De,Ie.z])],Ne);let Ue=class{constructor(e,t,r,s,i){this.initializeMachineService=e,this.checkAccountRecoveryKeyService=t,this.changeMasterPasswordService=r,this.triggerIdentityVerificationService=s,this.openSessionPasswordLessService=i}desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Idle",id:"RecoveryFlowMachine",context:{login:"",authTicket:"",newPassword:"",recoveryKey:"",oldPassword:"",encryptedVaultKey:""},states:{Idle:{entry:["clearContext"],on:{START_RECOVERY_FLOW:{target:"Starting",actions:["assignAccountEmail"]}}},Starting:{invoke:{src:"initializeMachine",onDone:[{actions:["assignInitialContext"],target:"IdentityVerification",cond:"isAuthTicketNeeded"},{actions:["assignInitialContext"],target:"EnterRecoveryKey"}]}},IdentityVerification:{entry:["triggerIdentityVerification"]},EnterRecoveryKey:{on:{SUBMIT_RECOVERY_KEY:{actions:["assignRecoveryKey"],target:"CheckAccountRecoveryKey"}}},CheckAccountRecoveryKey:{invoke:{src:"checkAccountRecoveryKey",onDone:[{target:"OpenPasswordlessSession",actions:["assignOldPassword"],cond:"isPasswordlessUser"},{actions:["assignOldPassword"],target:"ChangeMasterPassword"}],onError:[{actions:["assignError"],cond:"isWrongRecoveryKeyError",target:"EnterRecoveryKey"},{actions:["assignError"],target:"CheckAccountRecoveryKeyError"}]}},CheckAccountRecoveryKeyError:{on:{TRY_AGAIN:{actions:["clearError"],target:"EnterRecoveryKey"}}},OpenPasswordlessSession:{invoke:{src:"openSession",onDone:{target:"RecoverySuccess"},onError:{actions:["assignError"],target:"EnterRecoveryKey"}}},ChangeMasterPassword:{on:{CONFIRM_NEW_PASSWORD:{actions:["assignNewPassword"],target:"FinalisingRecovery"}}},FinalisingRecovery:{invoke:{src:"changeMasterPassword",onDone:{target:"RecoverySuccess"},onError:{actions:["assignError"],target:"ChangeMasterPasswordError"}}},ChangeMasterPasswordError:{on:{TRY_AGAIN:{target:"ChangeMasterPassword"}}},RecoverySuccess:{type:"final"}},on:{CLEAR_ERROR:{actions:["clearError"]},IDENTITY_VERIFICATION_COMPLETE:{actions:["assignAuthTicket"],target:"EnterRecoveryKey"},CANCEL_RECOVERY_FLOW:{actions:["clearError"],target:"Idle"}}},options:{actions:{assignAccountEmail:(0,S.f0)({login:(e,t)=>t.login}),assignInitialContext:(0,S.f0)({authTicket:(e,t)=>t.data.authTiket,accountType:(e,t)=>t.data.accountType,verificationMethod:(e,t)=>t.data.verificationMethod}),assignAuthTicket:(0,S.f0)({authTicket:(e,t)=>t.authTicket}),assignNewPassword:(0,S.f0)({newPassword:(e,t)=>t.password}),assignRecoveryKey:(0,S.f0)({recoveryKey:(e,t)=>t.recoveryKey}),assignOldPassword:(0,S.f0)({oldPassword:(e,t)=>t.data.oldPassword}),assignError:(0,S.f0)({error:(e,t)=>t.data}),clearError:(0,S.f0)({error:()=>{}}),triggerIdentityVerification:e=>{if(!e.verificationMethod)throw new Error("No verification method found, initialization went wrong");return this.triggerIdentityVerificationService.executeWithParams(e.login,e.verificationMethod)},clearContext:(0,S.f0)({login:()=>"",newPassword:()=>"",localAccounts:()=>[],recoveryKey:()=>"",oldPassword:()=>"",encryptedVaultKey:()=>"",authTicket:()=>""})},services:{initializeMachine:e=>this.initializeMachineService.executeWithParams(e.login),checkAccountRecoveryKey:e=>this.checkAccountRecoveryKeyService.executeWithParams(e),changeMasterPassword:e=>this.changeMasterPasswordService.executeWithParams(e),openSession:e=>this.openSessionPasswordLessService.executeWithParams(e)},guards:{isAuthTicketNeeded:(e,t)=>!t.data.authTiket,isPasswordlessUser:e=>"invisibleMasterPassword"===e.accountType,isWrongRecoveryKeyError:(e,t)=>t.data===x.WRONG_RECOVERY_KEY_ERROR}}};return e&&(0,te.G)(t.config),t}create(e=!1){const{config:t,options:r}=this.desc(e);return(0,E.C)(t,r)}};Ue=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[fe,be,Te,Oe,Ne])],Ue);const Fe=e=>!0;class Me extends((0,D.Q)({initialValue:void 0,persist:!1,scope:R.F.Device,storeName:"recovery-flow-machine",storeTypeGuard:Fe})){}let Le=class{constructor(e,t,r,s){this.recoveryMachineStore=r,this.allowedToFail=s,this.recoveryMachineStore=r;const i=e.create(t);this.interpreter=g.kJ(i).onTransition((0,_.V)(this.allowedToFail)).onEvent((0,f.V)(this.allowedToFail)).onTransition((async()=>{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.recoveryMachineStore,e)}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?se.ZM.create(JSON.parse(t)):void 0})(this.recoveryMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[ARK Recovery] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[ARK Recovery] Unable to start machine",e)}}ready(){return new v.X(!0)}continue(e){if(!this.interpreter)throw new Error("Recovery flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};Le=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[Ue,Boolean,Me,c.J])],Le);let xe=class{constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}execute(e){return this.recoveryFlow.continue({type:"CONFIRM_NEW_PASSWORD",password:e.body.password}),Promise.resolve((0,p.Vp)(void 0))}};xe=(0,s.__decorate)([(0,h.W)(_e.v),(0,s.__metadata)("design:paramtypes",[Le])],xe);var ke=r(60017);let Ge=class{constructor(e,t,r,s,i,a){this.accountRecoveryKeyService=e,this.activationFlow=t,this.syncService=r,this.logger=s,this.allowedToFail=i,this.session=a}async execute(e){const{reason:t}=e.body,r=await this.accountRecoveryKeyService.deactivate(t);if((0,p.hx)(r))return this.logger.trace("Deactivate ARK: "+r.error.message),(0,p.Rn)({tag:r.error.tag});const s=await(0,b.z)(this.session.queries.selectedOpenedSession());return(0,p.hx)(s)||!s.data?(this.logger.trace("Deactivate ARK: No user login provided"),(0,p.Rn)({tag:x.GENERIC_ERROR})):(await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(s.data),this.activationFlow.continue({type:"RESET_FLOW"}),await this.accountRecoveryKeyService.setPersonalSettings({AccountRecoveryKey:void 0,AccountRecoveryKeyId:void 0}),await this.allowedToFail.doOne((async()=>await this.syncService.waitForSync(X.Trigger.SettingsChange)),"waitForSync"),(0,p.Vp)(void 0))}};Ge=(0,s.__decorate)([(0,h.W)(ke.E),(0,s.__metadata)("design:paramtypes",[V,oe,Z._,Re.V,c.J,J.x])],Ge);var Ve=r(24662);let Ke=class{constructor(e){this.recoveryFlow=e}execute(e){return this.recoveryFlow.continue({type:"SUBMIT_RECOVERY_KEY",recoveryKey:e.body.recoveryKey}),Promise.resolve((0,p.Vp)(void 0))}};Ke=(0,s.__decorate)([(0,h.W)(Ve.Y),(0,s.__metadata)("design:paramtypes",[Le])],Ke);var je=r(77539);let Be=class{constructor(e){this.recoveryFlow=e}execute(){return this.recoveryFlow.continue({type:"TRY_AGAIN"}),Promise.resolve((0,p.Vp)(void 0))}};Be=(0,s.__decorate)([(0,h.W)(je.d),(0,s.__metadata)("design:paramtypes",[Le])],Be);var We=r(22632),ze=r(94189);let He=class{constructor(e,t){this.recoveryFlow=e,this.cqrsClient=t,this.recoveryFlow=e}execute(){return this.recoveryFlow.continue({type:"CANCEL_RECOVERY_FLOW"}),this.cqrsClient.getClient(a.i).commands.cancelIdentityVerification(),Promise.resolve((0,p.Vp)(void 0))}};He=(0,s.__decorate)([(0,h.W)(We.b),(0,s.__metadata)("design:paramtypes",[Le,ze.w])],He);var Qe=r(14074);let qe=class{constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}execute(e){const{login:t}=e.body;return this.recoveryFlow.continue({type:"START_RECOVERY_FLOW",login:t}),Promise.resolve((0,p.Vp)(void 0))}};qe=(0,s.__decorate)([(0,h.W)(Qe.Q),(0,s.__metadata)("design:paramtypes",[Le])],qe);var Ye=r(5370);let $e=class{constructor(e){this.recoveryFlow=e}execute(){return this.recoveryFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,p.Vp)(void 0))}};$e=(0,s.__decorate)([(0,h.W)(Ye.u),(0,s.__metadata)("design:paramtypes",[Le])],$e);var Xe,Ze,Je=r(85390),et=r(6136),tt=r(20754),rt=r(40956),st=r(69885),it=r(6220);!function(e){e[e.InitActivation=0]="InitActivation",e[e.RequestActivation=1]="RequestActivation",e[e.DisplayKey=2]="DisplayKey",e[e.ConfirmKey=3]="ConfirmKey",e[e.FinaliseActivation=4]="FinaliseActivation",e[e.ActivationDone=5]="ActivationDone",e[e.ShowError=6]="ShowError",e[e.GenerateNewKey=7]="GenerateNewKey",e[e.CancelGenerateNewKey=8]="CancelGenerateNewKey"}(Xe||(Xe={})),function(e){e[e.InitRecovery=0]="InitRecovery",e[e.IdentityVerification=1]="IdentityVerification",e[e.EnterRecoveryKey=2]="EnterRecoveryKey",e[e.ChangeMasterPassword=3]="ChangeMasterPassword",e[e.Finalising=4]="Finalising",e[e.Success=5]="Success",e[e.Failure=6]="Failure"}(Ze||(Ze={}));const at=e=>(0,st.of)((0,p.Vp)(function(e){if(!e.matches("Starting"))return e.matches("InitAccountRecoveryKeyActivation")?{step:Xe.InitActivation,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("RequestingActivation")?{step:Xe.RequestActivation,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("DisplayAccountRecoveryKey")?{step:Xe.DisplayKey,recoveryKey:e.context.recoveryKey,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("ConfirmAccountRecoveryKey")?{step:Xe.ConfirmKey,recoveryKey:e.context.recoveryKey,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("FinalisingAccountRecoveryKeyActivation")?{step:Xe.FinaliseActivation,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("AccountRecoveryKeyActivationDone")?{step:Xe.ActivationDone,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("AccountRecoveryKeyActivationError")?{step:Xe.ShowError,error:e.context.error,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("GenerateNewAccountRecoveryKey")?{step:Xe.GenerateNewKey,isFeatureEnabled:e.context.isFeatureEnabled}:e.matches("CancelNewAccountRecoveryKey")?{step:Xe.CancelGenerateNewKey,isFeatureEnabled:e.context.isFeatureEnabled}:void console.warn("[ARK Activation] - No view associated to state ",e.value)}(e))),ot=e=>e.pipe((0,it.z)(at));var nt=r(52800);const ct=(e,t)=>{const r=t.matches(e.value),s=(0,nt.Z)(e.context,t.context);return r&&s};let lt=class{constructor(e,t){this.activationFlow=e,this.activationFlowMachineStore=t}execute(){return(0,Je.a)([(e=this.activationFlowMachineStore,e.state$.pipe((0,A.U)((e=>e?se.ZM.create(JSON.parse(e)):void 0)))),this.activationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,w.h)(Boolean),(0,et.x)(((e,t)=>ct(e,t))),ot);var e}};lt=(0,s.__decorate)([(0,tt.e)(rt.S),(0,s.__metadata)("design:paramtypes",[oe,ae])],lt);var dt=r(43978),ut=r(22618);let pt=class{constructor(e){this.accountRecoveryKeyService=e}execute({body:e}){const{login:t}=e;return""===t?(0,st.of)((0,p.Vp)({isEnabled:!1})):this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,dt.w)((async e=>(void 0!==e.isEnabled&&t===e.login||await this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(t),e))),(0,A.U)((e=>(0,p.Vp)({isEnabled:e.isEnabled}))))}};pt=(0,s.__decorate)([(0,tt.e)(ut.D),(0,s.__metadata)("design:paramtypes",[V])],pt);var ht=r(80448);let mt=class{constructor(e,t,r){this.accountRecoveryKeyService=e,this.carbonLegacyClient=t,this.session=r}execute(){const e=this.session.queries.selectedOpenedSession().pipe((0,dt.w)((e=>{if(!(0,p.d6)(e)||!e.data)throw new Error("no user provided ");return this.accountRecoveryKeyService.updateLastAuthenticatedUserRecoveryStatus(e.data)})),(0,dt.w)((()=>this.carbonLegacyClient.queries.carbonState({path:"userSession.personalSettings.RecoveryOptIn"}))),(0,w.h)(p.d6),(0,A.U)((e=>"boolean"==typeof e.data&&e.data))),t=this.accountRecoveryKeyService.getLastAuthenticatedUserRecoveryData().pipe((0,A.U)((e=>void 0!==e.isEnabled&&e.isEnabled)));return(0,Je.a)([e,t]).pipe((0,A.U)((([e,t])=>(0,p.Vp)({adminAssistedRecovery:e,accountRecoveryKey:t}))))}};mt=(0,s.__decorate)([(0,tt.e)(ht.V),(0,s.__metadata)("design:paramtypes",[V,C._,J.x])],mt);var gt=r(36261);const vt=e=>(0,st.of)((0,p.Vp)(function(e){return e.matches("Starting")?{step:Ze.InitRecovery,error:e.context.error}:e.matches("IdentityVerification")?{step:Ze.IdentityVerification,login:e.context.login}:e.matches("EnterRecoveryKey")||e.matches("CheckAccountRecoveryKey")?{step:Ze.EnterRecoveryKey,error:e.context.error,accountType:e.context.accountType}:e.matches("ChangeMasterPassword")?{step:Ze.ChangeMasterPassword,error:e.context.error}:e.matches("FinalisingRecovery")||e.matches("OpenPasswordlessSession")?{step:Ze.Finalising}:e.matches("RecoverySuccess")?{step:Ze.Success}:e.matches("CheckAccountRecoveryKeyError")||e.matches("ChangeMasterPasswordError")?{step:Ze.Failure}:void console.warn("[ARK Recovery] - No view associated to state ",e.value)}(e))),yt=e=>e.pipe((0,it.z)(vt));let _t=class{constructor(e,t){this.recoveryFlow=e,this.recoveryFlowMachineStore=t}execute(){return(0,Je.a)([(e=this.recoveryFlowMachineStore,e.state$.pipe((0,A.U)((e=>e?se.ZM.create(JSON.parse(e)):void 0)))),this.recoveryFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,w.h)(Boolean),(0,et.x)(((e,t)=>ct(e,t))),yt);var e}};_t=(0,s.__decorate)([(0,tt.e)(gt.y),(0,s.__metadata)("design:paramtypes",[Le,Me])],_t);var ft=r(68307),St=r(13089);let Et=class{constructor(e){this.recoveryFlow=e,this.recoveryFlow=e}handle(e){const{authTicket:t}=e.body;return this.recoveryFlow.continue({type:"IDENTITY_VERIFICATION_COMPLETE",authTicket:t}),Promise.resolve()}};Et=(0,s.__decorate)([(0,ft.b)(St.w),(0,s.__metadata)("design:paramtypes",[Le])],Et);var bt=r(55300),wt=r(59894);let At=class{};At=(0,s.__decorate)([(0,o.Y)({api:i.j,stores:[ae,Me,F],imports:[l.n,d.D,u.R],handlers:{commands:{goToActivationNextStep:ne,goToActivationPrevStep:le,requestActivation:ue,cancelActivation:he,cancelGeneration:ge,confirmActivation:ye,confirmNewPassword:xe,deactivate:Ge,submitRecoveryKey:Ke,tryAgainRecovery:Be,cancelRecoveryFlow:He,startRecoveryFlow:qe,clearWrongRecoveryKeyError:$e},events:{...(0,o.g)(a.i,{identityVerificationCompleted:Et})},queries:{activationFlowStatus:lt,accountRecoveryKeyStatus:pt,recoveryMethodsInfo:mt,recoveryFlowStatus:_t}},providers:[...(0,n.H)(oe,{inject:[re,ae,bt.c,c.J],asyncFactory:async(e,t,r,s)=>{let i=!1;const a=await(0,b.z)(r.queries.platformInfo());!(0,p.d6)(a)||a.data.buildType!==wt.P.DEV&&a.data.buildType!==wt.P.NIGHTLY||(i=!0);const o=new oe(e,i,t,s);return await o.prepare(),o}}),...(0,n.H)(Le,{inject:[Ue,Me,bt.c,c.J],asyncFactory:async(e,t,r,s)=>{let i=!1;const a=await(0,b.z)(r.queries.platformInfo());!(0,p.d6)(a)||a.data.buildType!==wt.P.DEV&&a.data.buildType!==wt.P.NIGHTLY||(i=!0);const o=new Le(e,i,t,s);return await o.prepare(),o}}),re,Ue,K,fe,be,Oe,V,$,ee,Ee,Y,Te,Ne,De]})],At)},54200:(e,t,r)=>{r.d(t,{X:()=>n});var s=r(86952),i=r(30690),a=r(28254),o=r(6347);const n=(0,s.Q)({name:"accountCreation",commands:{createPasswordlessAccount:i.c,markMassDeployFirstInitDone:a.$},events:{},queries:{accountCreationMassDeployPolicies:o.d}})},30690:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},28254:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},6347:(e,t,r)=>{r.d(t,{d:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},24452:(e,t,r)=>{r.d(t,{l:()=>n});var s=r(86952),i=r(39129),a=r(14320),o=r(55398);const n=(0,s.Q)({name:"accountReferral",commands:{inviteByEmail:o.P},events:{},queries:{getSharingLink:i.h,getInvitationsHistory:a.g}})},55398:(e,t,r)=>{r.d(t,{P:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},14320:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},39129:(e,t,r)=>{r.d(t,{h:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},10901:(e,t,r)=>{r.d(t,{d:()=>c});var s=r(86952),i=r(3993),a=r(85715),o=r(75456),n=r(95843);const c=(0,s.Q)({name:"deleteOrResetAccount",commands:{completeFlow:o.I,initiateFlow:n.O},events:{},queries:{userAuthenticationMethod:i.c,isFlowCompleted:a.h}})},75456:(e,t,r)=>{r.d(t,{I:()=>n,O:()=>s});var s,i=r(74354),a=r(25029),o=r(7165);!function(e){e.INVALID_OTP_ALREADY_USED="INVALID_OTP_ALREADY_USED",e.INVALID_OTP_BLOCKED="INVALID_OTP_BLOCKED",e.VERIFICATION_FAILED="VERIFICATION_FAILED",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="ACCOUNT_BLOCKED_CONTACT_SUPPORT",e.VERIFICATION_REQUIRES_REQUEST="VERIFICATION_REQUIRES_REQUEST",e.VERIFICATION_TIMEOUT="VERIFICATION_TIMEOUT"}(s||(s={}));o.z.object({tag:o.z.nativeEnum(s)});class n extends((0,i.g)({scope:a.F.Device})){}},95843:(e,t,r)=>{r.d(t,{O:()=>n,U:()=>s});var s,i=r(74354),a=r(25029),o=r(7165);!function(e){e.UNKNOWN_USER="user_not_found",e.SSO_BLOCKED="SSO_BLOCKED"}(s||(s={}));o.z.object({tag:o.z.nativeEnum(s)});class n extends((0,i.g)({scope:a.F.Device})){}},85715:(e,t,r)=>{r.d(t,{h:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},3993:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},57295:(e,t,r)=>{r.d(t,{Z:()=>ie});var s=r(88802),i=r(63663),a=r(30690),o=r(57924),n=r(55300),c=r(87113),l=r(19603),d=r(56268),u=r(40173),p=r(87279),h=r(60399),m=r(78776);const g="ZZ";function v(e){return!e||e.length<2||e.length>5?g:e}const y="und";function _(e){return!e||e.length<2||e.length>5?y:e}const f="Device";function S(e){return e||f}function E(e){return e?e.replace(/https?:\/\//g," "):e}function b(){return`{${(0,m.Z)().toUpperCase()}}`}var w=r(10370),A=r(21131),C=r(86286),I=r(9034),T=r(94805),P=r(16698),O=r(25565);let R=class{constructor(e,t,r,s,i,a){this.serverApiClient=e,this.platformInfoClient=t,this.random=r,this.flexibleEncryptor=s,this.rsaKeyGenerator=i,this.deviceRegistration=a}async createAccount({login:e,accountType:t,password:r,consents:s,deviceName:i}){const a=await(0,h.z)(this.platformInfoClient.queries.platformInfo());if(!(0,p.d6)(a))throw new Error("failed to get platform info");const o=a.data,n=Math.round(Date.now()/1e3),c=this.random.get(16),l=function({AnonymousUserId:e,CryptoFixedSalt:t,CryptoUserPayload:r,UsagelogToken:s,accountCreationDatetime:i}){return`<?xml version="1.0" encoding="UTF-8"?>\n<root>\n    <KWSettingsManagerApp> \n        <KWDataItem key="AnonymousUserId"><![CDATA[${e}]]></KWDataItem>\n        <KWDataItem key="CryptoFixedSalt"><![CDATA[${t}]]></KWDataItem>\n        <KWDataItem key="CryptoUserPayload"><![CDATA[${r}]]></KWDataItem>  \n        <KWDataItem key="SyncBackup"><![CDATA[YES]]></KWDataItem>\n        <KWDataItem key="UsagelogToken"><![CDATA[${s}]]></KWDataItem>\n        <KWDataItem key="accountCreationDatetime"><![CDATA[${i}]]></KWDataItem>\n    </KWSettingsManagerApp>\n</root>`}({accountCreationDatetime:n,AnonymousUserId:b(),CryptoFixedSalt:(0,w.s)(c),CryptoUserPayload:"$1$argon2d$16$3$32768$2$aes256$cbchmac$16$",Login:e,UsagelogToken:b()}),d=(0,A.n)((new TextEncoder).encode(l)),u=async e=>await this.flexibleEncryptor.encrypt((new TextEncoder).encode(r),e,T.mr,P.Nw,{salt:c}),m=await u(d),{privateKey:g,publicKey:y}=await this.rsaKeyGenerator.generate(),f=(0,C.R)(g),O=(0,I.y)(y),R=await u((new TextEncoder).encode(f));if("server_carbon_unknown"===o.platformName)throw new Error("Invalid platform info");const D=await(0,h.z)(this.serverApiClient.v1.account.createUser({appVersion:o.appVersion,consents:[{consentType:"emailsOffersAndTips",status:s.offers},{consentType:"privacyPolicyAndToS",status:s.tosAndPrivacy}],country:v(o.country),deviceName:S(E(i)),language:_(o.lang),login:e,osCountry:v(o.country),osLanguage:_(o.lang),platform:o.platformName,settings:{time:n,content:(0,w.s)(m)},sharingKeys:{publicKey:O,privateKey:(0,w.s)(R)},temporaryDevice:!1,accountType:t,contactEmail:e}));if(!(0,p.d6)(D))throw new Error("failed to create account on server! ");const{deviceAccessKey:N,deviceSecretKey:U,userAnalyticsId:F}=D.data.data,M=await this.deviceRegistration.commands.registerDevice({with:"deviceKeys",deviceAccessKey:N,deviceSecretKey:U,login:e,settings:(0,w.s)(m),userAnalyticsId:F,deviceName:i,ignoreAlreadyRegisteredError:!0});if(!(0,p.d6)(M))throw new Error("failed to register device in carbon")}};R=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[c.l,n.c,l.Y,d._,u.e,O.z])],R);var D=r(86252),N=r(85465),U=r(30523),F=r(89358),M=r(42303);const L={avoidAmbiguous:!1,length:40,letters:!0,digits:!0,symbols:!0};let x=class{constructor(e,t,r,s){this.creator=e,this.carbon=t,this.session=r,this.pinCode=s}async execute({body:{consents:e,email:t,pinCode:r,deviceName:s}}){const i=(0,N.generate)(L);await this.creator.createAccount({accountType:"invisibleMasterPassword",login:t,consents:e,password:i,deviceName:s});const a=await this.carbon.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:t,password:i,rememberPassword:!0,requiredPermissions:void 0,loginType:"CreatedPasswordlessAccount"}]});if(!(0,p.d6)(a))throw new Error("failed to login in carbon");return await(0,h.z)(this.session.queries.selectedOpenedSession().pipe((0,U.h)((e=>(0,p.d6)(e)&&e.data===t)))),await this.pinCode.commands.activate({pinCode:r}),(0,p.Vp)(void 0)}};x=(0,s.__decorate)([(0,i.W)(a.c),(0,s.__metadata)("design:paramtypes",[R,D._,F.x,M.u])],x);var k=r(28254),G=r(25029),V=r(95681),K=r(23347),j=r(10722);const B=e=>!(!e||"object"!=typeof e)&&("firstMassDeployOpening"in e&&"teamKey"in e);class W extends((0,V.Q)({codec:j.E,persist:!0,scope:G.F.Device,storeName:"account-creation-browser-policies-store",capacity:K.Y._001KB,storage:{schemaVersion:1,initialValue:{firstMassDeployOpening:!0,teamKey:""},typeGuard:B}})){}let z=class{constructor(e){this.acBrowserPoliciesStore=e}async execute(){const e=await this.acBrowserPoliciesStore.getState();return this.acBrowserPoliciesStore.set({...e,firstMassDeployOpening:!1}),(0,p.Vp)(void 0)}};z=(0,s.__decorate)([(0,i.W)(k.$),(0,s.__metadata)("design:paramtypes",[W])],z);var H=r(20754),Q=r(6347),q=r(87065);let Y=class{constructor(e){this.acBrowserPoliciesStore=e}execute(){return this.acBrowserPoliciesStore.state$.pipe((0,q.U)((e=>(0,p.Vp)(e))))}};Y=(0,s.__decorate)([(0,H.e)(Q.d),(0,s.__metadata)("design:paramtypes",[W])],Y);var $=r(99634),X=r(54200),Z=r(15043);class J{}let ee=class extends J{async retrieveAccountCreationBrowserPolicies(){try{const e=await(0,Z.U)();return void 0===e?(0,p.Vp)({teamKey:"",isExtensionMassDeployed:!1}):(0,p.Vp)({teamKey:e.team_key||"",isExtensionMassDeployed:e.is_extension_mass_deployed||!1})}catch{return(0,p.Vp)({teamKey:"",isExtensionMassDeployed:!1})}}};ee=(0,s.__decorate)([(0,o.GS)()],ee);let te=class{constructor(e,t){this.acBrowserPoliciesStore=e,this.massDeployBrowserPoliciesService=t}async onFrameworkInit(){const{firstMassDeployOpening:e}=await this.acBrowserPoliciesStore.getState(),t=await this.massDeployBrowserPoliciesService.retrieveAccountCreationBrowserPolicies();(0,p.ty)(t,(({teamKey:t,isExtensionMassDeployed:r})=>{this.acBrowserPoliciesStore.set({teamKey:t,firstMassDeployOpening:e&&r})}))}};te=(0,s.__decorate)([(0,o.ar)(),(0,s.__metadata)("design:paramtypes",[W,J])],te);var re=r(93850),se=r(37935);let ie=class{};ie=(0,s.__decorate)([(0,$.Y)({api:X.X,providers:[{provide:J,useClass:ee},R],exports:[J],onFrameworkInit:[te],stores:[W],handlers:{commands:{createPasswordlessAccount:x,markMassDeployFirstInitDone:z},events:{},queries:{accountCreationMassDeployPolicies:Y}},imports:[re.n,se.D]})],ie)},93368:(e,t,r)=>{r.d(t,{o:()=>A});var s=r(88802),i=r(99634),a=r(24452),o=r(93850),n=r(34987),c=r(20754),l=r(39129),d=r(87113),u=r(48844),p=r(86252);let h=class{constructor(e,t){this.serverApiClient=e,this.carbon=t}execute(){return this.carbon.queries.getSubscriptionCode().pipe((0,n.b)((e=>this.serverApiClient.v1.invitation.getSharingLink({userKey:"success"===e.tag?e.data:""}).pipe((0,u.Qn)((e=>e.data)),(0,u.DZ)((e=>{throw new Error(e.message)}))))))}};h=(0,s.__decorate)([(0,c.e)(l.h),(0,s.__metadata)("design:paramtypes",[d.l,p._])],h);var m=r(14320),g=r(87279);let v=class{constructor(e){this.serverApiClient=e}execute(){return this.serverApiClient.v1.invitation.getInvitationsHistory().pipe((0,u.Qn)((e=>e.data)),(0,u.DZ)((e=>(0,g.Rn)({tag:`GetInvitationsHistoryQueryHandler failure: ${e.message}`}))))}};v=(0,s.__decorate)([(0,c.e)(m.g),(0,s.__metadata)("design:paramtypes",[d.l])],v);var y=r(60399),_=r(63663),f=r(55398),S=r(87065),E=r(57924);let b=class{constructor(e){this.serverApiClient=e}async getIsExistingLogin(e){const t=this.serverApiClient.v1.authentication.get2FaStatusUnauthenticated({login:e});return await(0,y.z)(t.pipe((0,S.U)((e=>(0,g.d6)(e)))))}};b=(0,s.__decorate)([(0,E.GS)(),(0,s.__metadata)("design:paramtypes",[d.l])],b);let w=class{constructor(e,t,r){this.serverApiClient=e,this.carbon=t,this.accountExistsService=r}async execute({body:{email:e}}){try{const t=await(0,y.z)(this.carbon.queries.getSubscriptionCode());if(await this.accountExistsService.getIsExistingLogin(e)){const e="InviteByEmailCommand";return(0,g.Rn)({tag:e})}const r=await(0,y.z)(this.serverApiClient.v1.invitation.invite({userKey:(0,g.d6)(t)?t.data:"",identifiers:[e],type:"manual"}));if((0,g.hx)(r))throw new Error("InviteByEmailCommand failure: something went wrong in call to /invitation/invite");return(0,g.Vp)(void 0)}catch(e){throw new Error("InviteByEmailCommand failure: something went wrong in execute method")}}};w=(0,s.__decorate)([(0,_.W)(f.P),(0,s.__metadata)("design:paramtypes",[d.l,p._,b])],w);let A=class{};A=(0,s.__decorate)([(0,i.Y)({api:a.l,imports:[o.n],handlers:{commands:{inviteByEmail:w},events:{},queries:{getSharingLink:h,getInvitationsHistory:v}},providers:[b]})],A)},77993:(e,t,r)=>{r.d(t,{T:()=>D});var s=r(88802),i=r(99634),a=r(93850),o=r(10901),n=r(60399),c=r(87065),l=r(95843),d=r(75456),u=r(57924),p=r(87113),h=r(48844),m=r(18533),g=r(20195),v=r(87279);let y=class{constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case l.U.UNKNOWN_USER:return{tag:l.U.UNKNOWN_USER};case l.U.SSO_BLOCKED:return{tag:l.U.SSO_BLOCKED};default:throw new Error(`GetAuthenticationMethodsForReset: error ${e}`)}}}getAuthenticationMethodsForReset(e){return this.serverApiClient.v1.authentication.getAuthenticationMethodsForReset({login:e,methods:["email_token","totp"]}).pipe((0,h.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:()=>{throw new Error("Fetch Failed error")},BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,h.Qn)((e=>{if(e.data.verifications.length>=1)return e.data.verifications[0].type;throw new Error("GetAuthenticationMethodsForReset: couldn't retrieve any method")})))}requestEmailTokenVerificationSending(e){return(0,n.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,c.U)((e=>(0,v.d6)(e)))))}getVerifyTokenFunctionalError(e){switch(e){case"invalid_otp_already_used":return{tag:d.O.INVALID_OTP_ALREADY_USED};case"invalid_otp_blocked":return{tag:d.O.INVALID_OTP_BLOCKED};case"verification_failed":return{tag:d.O.VERIFICATION_FAILED};case"account_blocked_contact_support":return{tag:d.O.ACCOUNT_BLOCKED_CONTACT_SUPPORT};case"verification_requires_request":return{tag:d.O.VERIFICATION_REQUIRES_REQUEST};case"verification_timeout":return{tag:d.O.VERIFICATION_TIMEOUT};default:throw new Error("performTokenVerification: Business error not handled")}}verifyTOTPToken(e,t){return(0,n.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t,intent:"account_delete_or_reset"}).pipe((0,h.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getVerifyTokenFunctionalError(e.code),FetchFailedError:g.j,BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,h.Qn)((e=>e.data.authTicket))))}verifyEmailToken(e,t){return(0,n.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t,intent:"account_delete_or_reset"}).pipe((0,h.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getVerifyTokenFunctionalError(e.code),FetchFailedError:g.j,BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,h.Qn)((e=>e.data.authTicket))))}deleteOrResetAccount(e,t,r=!0){return(0,n.z)(this.serverApiClient.v1.account.deleteOrResetAccount({authTicket:t,isDelete:r,login:e}).pipe((0,h.DZ)((e=>(0,m.EQ)(e,{BusinessError:g.j,FetchFailedError:g.j,BadStatus:g.j,InternalServerError:g.j,InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,h.Qn)((()=>!0))))}};y=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[p.l])],y);var _=r(20754),f=r(3993),S=r(25029),E=r(95681),b=r(23347);class w extends((0,E.Q)({persist:!1,scope:S.F.Device,storeName:"account-deletion",initialValue:{login:"",userAuthenticationMethod:null,isFlowCompleted:!1},capacity:b.Y._001KB})){}let A=class{constructor(e){this.deleteOrResetAccountStore=e}execute(){return this.deleteOrResetAccountStore.state$.pipe((0,c.U)((e=>(0,v.Vp)(e.userAuthenticationMethod))))}};A=(0,s.__decorate)([(0,_.e)(f.c),(0,s.__metadata)("design:paramtypes",[w])],A);var C=r(85715);let I=class{constructor(e){this.deleteOrResetAccountStore=e}execute(){return this.deleteOrResetAccountStore.state$.pipe((0,c.U)((e=>(0,v.Vp)(e.isFlowCompleted))))}};var T;I=(0,s.__decorate)([(0,_.e)(C.h),(0,s.__metadata)("design:paramtypes",[w])],I),function(e){e.EMAIL="EMAIL",e.TOTP="TOTP"}(T||(T={}));var P=r(63663);let O=class{constructor(e,t){this.deleteOrResetAccountStore=e,this.deleteOrResetAccountService=t}async execute({body:e}){const{token:t,isDelete:r}=e,s=await this.deleteOrResetAccountStore.getState(),{userAuthenticationMethod:i,login:a}=s,o=i===T.EMAIL?await this.deleteOrResetAccountService.verifyEmailToken(a,t):await this.deleteOrResetAccountService.verifyTOTPToken(a,t);if((0,v.hx)(o))return Promise.resolve(o);const n=await this.deleteOrResetAccountService.deleteOrResetAccount(a,o.data,r);if((0,v.hx)(n))throw new Error("CompleteFlowCommand : error while deleting the account");return this.deleteOrResetAccountStore.set({...s,isFlowCompleted:!0}),Promise.resolve((0,v.Vp)(void 0))}};O=(0,s.__decorate)([(0,P.W)(d.I),(0,s.__metadata)("design:paramtypes",[w,y])],O);let R=class{constructor(e,t){this.deleteOrResetAccountStore=e,this.deleteOrResetAccountService=t}async execute({body:e}){const{login:t}=e,r=await(0,n.z)(this.deleteOrResetAccountService.getAuthenticationMethodsForReset(t).pipe((0,h.Qn)((e=>"email_token"===e?T.EMAIL:T.TOTP))));if((0,v.hx)(r))return Promise.resolve(r);r.data===T.EMAIL&&this.deleteOrResetAccountService.requestEmailTokenVerificationSending(t);const s=await this.deleteOrResetAccountStore.getState();return await this.deleteOrResetAccountStore.set({...s,login:t,userAuthenticationMethod:r.data}),Promise.resolve((0,v.Vp)(void 0))}};R=(0,s.__decorate)([(0,P.W)(l.O),(0,s.__metadata)("design:paramtypes",[w,y])],R);let D=class{};D=(0,s.__decorate)([(0,i.Y)({api:o.d,handlers:{commands:{completeFlow:O,initiateFlow:R},events:{},queries:{userAuthenticationMethod:A,isFlowCompleted:I}},stores:[w],imports:[a.n],providers:[y]})],D)},1534:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(86952),i=r(65446);const a=(0,s.Q)({name:"overrides",commands:{},events:{},queries:{OverridesQuery:i.N}})},65446:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},5540:(e,t,r)=>{r.d(t,{x:()=>P});var s=r(88802),i=r(99634);var a=r(1534),o=r(57924),n=r(26457),c=r(43702),l=r(25859),d=r(6220),u=r(30523),p=r(87065),h=r(39995);class m{constructor(e,t,r,s){this.settings=e,this.store=t,this.appLogger=r,this.rfuDispatcher=s;const{fileName:i}=e;this.jsonSerializerCodec=new c.b,this.newlyUpdatedFiles$=(0,l.P)((async()=>{const e=await this.store.getState();return{[i]:e.revision}})).pipe((0,d.z)((e=>this.rfuDispatcher.fileSubscription(e))))}initFileObservation(){this.newlyUpdatedFiles$.subscribe(this._handleRFUDownload.bind(this))}streamFileUpdate(){return this.store.state$.pipe((0,u.h)((e=>0!==e.revision)),(0,p.U)((e=>e.data)),(0,u.h)((e=>this.settings.typeguard(e))))}async _handleRFUDownload(e){const{fileName:t}=this.settings;if(!(t in e))return;const r=e[t],s=this.jsonSerializerCodec.decode(r.buffer);this.settings.typeguard(s)&&(await this.store.set({filename:r.fileName,data:s,revision:r.revision,lastDownloadTimestamp:r.lastDownloadTimestamp}),this.rfuDispatcher.fileSubscription({[t]:r.revision}))}}var g=r(73881),v=r(95681),y=r(23347),_=r(10722),f=r(25029);const S=e=>!("object"!=typeof e||null===e)&&("filename"in e&&null!==e.filename&&void 0!==e.filename&&"string"==typeof e.filename&&"revision"in e&&null!==e.revision&&void 0!==e.revision&&"number"==typeof e.revision),E=e=>({filename:e,revision:0,data:{},lastDownloadTimestamp:Date.now()});let b=class{constructor(e){this.rfuClient=e}onFrameworkInit(){this.rfuClient.initFileObservation()}};b=(0,s.__decorate)([(0,o.ar)(),(0,s.__metadata)("design:paramtypes",[m])],b);var w=r(20754),A=r(65446),C=r(87279);let I=class{constructor(e){this.rfuClient=e}execute(){return this.rfuClient.streamFileUpdate().pipe((0,p.U)((e=>(0,C.Vp)({overrides:e}))))}};I=(0,s.__decorate)([(0,w.e)(A.N),(0,s.__metadata)("design:paramtypes",[m])],I);const T=((e,t)=>{const r=(e=>class extends((0,v.Q)({storeName:"RFUStore",persist:!0,storage:{schemaVersion:1,initialValue:E(e),typeGuard:S},codec:_.E,storeTypeGuard:S,capacity:y.Y._010KB,scope:f.F.Device,isCache:!0})){})(e);var s;return{providers:[{token:m,asyncFactory:(e,t,r)=>Promise.resolve(new m(s,e,t,r)),inject:[(s={fileName:e,storeClass:r,typeguard:t}).storeClass,n.V,h.Q]}],onFrameworkInit:[b],imports:[g.Q],stores:[r]}})("overrides.json",(e=>null!=e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)&&e.every((e=>(e=>{if(!e||"object"!=typeof e)return!1;const t="type"in e&&void 0!==e.type&&("startsWith"===e.type||"regexp"===e.type),r="value"in e&&void 0!==e.value&&(Array.isArray(e.value)&&e.value.every((e=>"string"==typeof e))||"string"==typeof e.value),s="conditions"in e&&void 0!==e.conditions&&Array.isArray(e.conditions)&&e.conditions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("css"===e.type||"xpath"===e.type),r="selector"in e&&void 0!==e.selector&&"string"==typeof e.selector;return t&&r})(e))),i="actions"in e&&void 0!==e.actions&&Array.isArray(e.actions)&&e.actions.every((e=>(e=>{const t="type"in e&&void 0!==e.type&&("set"===e.type||"ignore"===e.type),r="cssSelector"in e&&void 0!==e.cssSelector&&"string"==typeof e.cssSelector;return t&&r})(e)));return t&&r&&s&&i})(e)))))));let P=class{};P=(0,s.__decorate)([(0,i.Y)({api:a.D,composes:[T],handlers:{commands:{},events:{},queries:{overrides:I}}})],P)},36636:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(67837),i=r(29986);class a extends((0,s.E)(i.V)){}(0,s.K)(i.V,a)},29986:(e,t,r)=>{r.d(t,{V:()=>o});var s=r(86952),i=r(28096),a=r(75203);const o=(0,s.Q)({name:"authenticationFlow",commands:{changeLogin:a.hW,changeTwoFactorAuthenticationOtpType:a.eG,clearError:a.jq,cancelDeviceTransferRequest:a.Yc,resendEmailToken:a.Gc,resendPushNotification:a.rF,sendAccountEmail:a.A,sendMasterPassword:a.rT,submitPinCode:a.CO,submitBackupCode:a.sH,submitEmailToken:a.XH,submitTotp:a.ad,switchToDevicetoDeviceAuthentication:a.sU,switchToDashlaneAuthenticator:a.K1,switchToMasterPasswordCommand:a.On,switchToEmailToken:a.v5,switchToPinCode:a.WF,retryWebAuthnAuthentication:a.M6,webAuthnAuthenticationFail:a.O3,logout:a.N5,lockSession:a.Y$,loginViaSSO:a.yv,initiateLoginWithSSO:a.Hr,initiateAutologinWithSSOCommand:a.x2},queries:{authenticationFlowStatus:i.DW,getSsoUserSettings:i.Dc,getProviderInfo:i.L2},events:{}})},75203:(e,t,r)=>{r.d(t,{A:()=>a,CO:()=>n,Gc:()=>v,Hr:()=>I,K1:()=>d,M6:()=>E,N5:()=>w,O3:()=>b,On:()=>c,WF:()=>u,XH:()=>p,Y$:()=>A,Yc:()=>P,ad:()=>h,eG:()=>g,hW:()=>o,jq:()=>S,rF:()=>_,rT:()=>y,sH:()=>m,sU:()=>l,v5:()=>f,x2:()=>T,yv:()=>C});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}class o extends((0,s.g)({scope:i.F.Device})){}class n extends((0,s.g)({scope:i.F.Device})){}class c extends((0,s.g)({scope:i.F.Device})){}class l extends((0,s.g)({scope:i.F.Device})){}class d extends((0,s.g)({scope:i.F.Device})){}class u extends((0,s.g)({scope:i.F.Device})){}class p extends((0,s.g)({scope:i.F.Device})){}class h extends((0,s.g)({scope:i.F.Device})){}class m extends((0,s.g)({scope:i.F.Device})){}class g extends((0,s.g)({scope:i.F.Device})){}class v extends((0,s.g)({scope:i.F.Device})){}class y extends((0,s.g)({scope:i.F.Device})){}class _ extends((0,s.g)({scope:i.F.Device})){}class f extends((0,s.g)({scope:i.F.Device})){}class S extends((0,s.g)({scope:i.F.Device})){}class E extends((0,s.g)({scope:i.F.Device})){}class b extends((0,s.g)({scope:i.F.Device})){}class w extends((0,s.g)({scope:i.F.Device})){}class A extends((0,s.g)({scope:i.F.Device})){}class C extends((0,s.g)({scope:i.F.Device})){}class I extends((0,s.g)({scope:i.F.Device})){}class T extends((0,s.g)({scope:i.F.Device})){}class P extends((0,s.g)({scope:i.F.Device})){}},28096:(e,t,r)=>{r.d(t,{DW:()=>a,Dc:()=>o,L2:()=>n});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}class o extends((0,s.k)({scope:i.F.Device})){}class n extends((0,s.k)({scope:i.F.Device})){}},64496:(e,t,r)=>{var s,i,a;r.d(t,{E6:()=>i,UY:()=>a,ao:()=>o,hr:()=>s,vX:()=>n}),function(e){e.SSO="sso",e.MP="master_password"}(s||(s={})),function(e){e.WaitingForTransferRequest="WaitingForTransferRequest",e.DisplayInstructions="DisplayInstructions",e.LoadingPassphrase="LoadingPassphrase",e.DisplayPassphrase="DisplayPassphrase",e.LoadingAccount="LoadingAccount",e.Error="Error",e.DeviceRegistered="DeviceRegistered"}(i||(i={})),function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TIMEOUT="TIMEOUT",e.REQUEST_REJECTED="REQUEST_REJECTED",e.ACCOUNT_ERROR="ACCOUNT_ERROR",e.RATE_LIMIT="RATE_LIMIT"}(a||(a={}));const o=e=>Object.values(a).includes(e);var n;!function(e){e[e.MP_TO_SSO=0]="MP_TO_SSO",e[e.MP_TO_SSO_WITH_INFO=1]="MP_TO_SSO_WITH_INFO",e[e.SSO_TO_MP=2]="SSO_TO_MP"}(n||(n={}))},66974:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(86952),i=r(85373);const a=(0,s.Q)({name:"authentication",commands:{},events:{},queries:{canLockApp:i._}})},85373:(e,t,r)=>{r.d(t,{I:()=>a,_:()=>o});var s=r(99059),i=r(25029);const a="USER_NOT_LOGGED_IN";class o extends((0,s.k)({scope:i.F.User,noUserError:{tag:a}})){}},42853:(e,t,r)=>{r.d(t,{G:()=>n});var s=r(86952),i=r(319),a=r(96782),o=r(59463);const n=(0,s.Q)({name:"deviceRegistration",commands:{cleanRemotelyRemovedProfiles:i.L,registerDevice:a.J},events:{},queries:{localAccounts:o.a}})},25565:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(67837),i=r(42853);class a extends((0,s.E)(i.G)){}(0,s.K)(i.G,a)},319:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},96782:(e,t,r)=>{r.d(t,{J:()=>n,Y:()=>o});var s=r(74354),i=r(25029),a=r(7165);const o=a.z.discriminatedUnion("with",[a.z.object({with:a.z.literal("token"),login:a.z.string(),token:a.z.string(),deviceName:a.z.optional(a.z.string()),ignoreAlreadyRegisteredError:a.z.optional(a.z.boolean())}),a.z.object({with:a.z.literal("authTicket"),login:a.z.string(),authTicket:a.z.string(),deviceName:a.z.optional(a.z.string()),ignoreAlreadyRegisteredError:a.z.optional(a.z.boolean())}),a.z.object({with:a.z.literal("deviceKeys"),login:a.z.string(),deviceName:a.z.optional(a.z.string()),ignoreAlreadyRegisteredError:a.z.optional(a.z.boolean()),deviceAccessKey:a.z.string(),deviceSecretKey:a.z.string(),settings:a.z.string(),userAnalyticsId:a.z.string(),serverKey:a.z.optional(a.z.string())})]);class n extends((0,s.g)({scope:i.F.Device})){}},59463:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},6218:(e,t,r)=>{r.d(t,{F:()=>u});var s=r(86952),i=r(53835),a=r(33969),o=r(97891),n=r(87041),c=r(55870),l=r(48214),d=r(81540);const u=(0,s.Q)({name:"deviceTransfer",commands:{refreshRequest:a.V,cancelRequest:o.b,approveRequest:n.G,rejectRequest:c.a,submitPassphraseChallenge:l.I,returnToDeviceSetupCommand:d.n},events:{},queries:{trustedDeviceFlowStatus:i.N}})},87041:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},97891:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},33969:(e,t,r)=>{r.d(t,{V:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},55870:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},81540:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},48214:(e,t,r)=>{r.d(t,{I:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},53835:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},70486:(e,t,r)=>{var s,i;r.d(t,{S:()=>s,T:()=>i}),function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.INVALID_PASSPHRASE="INVALID_PASSPHRASE",e.TIMEOUT="TIMEOUT",e.PASSPHRASE_ATTEMPTS_LIMIT="PASSPHRASE_ATTEMPTS_LIMIT"}(s||(s={})),function(e){e[e.WaitingForNewDeviceRequest=0]="WaitingForNewDeviceRequest",e[e.NewDeviceRequestAvailable=1]="NewDeviceRequestAvailable",e[e.DisplayPassphraseChallenge=2]="DisplayPassphraseChallenge",e[e.DeviceTransferComplete=3]="DeviceTransferComplete",e[e.LoadingChallenge=4]="LoadingChallenge",e[e.DeviceTransferRejected=5]="DeviceTransferRejected",e[e.Error=6]="Error"}(i||(i={}))},28760:(e,t,r)=>{var s;r.d(t,{T:()=>s}),function(e){e.AuthenticationWebPinUnlockProd="authentication_web_pincode_prod"}(s||(s={}))},11433:(e,t,r)=>{r.d(t,{i:()=>n});var s=r(86952),i=r(41025),a=r(13744),o=r(13089);const n=(0,s.Q)({name:"identityVerificationFlow",commands:{changeTwoFactorAuthenticationOtpType:a.eG,clearError:a.$5,resendEmailToken:a.Gc,resendPushNotification:a.rF,submitBackupCode:a.sH,submitEmailToken:a.XH,submitTotp:a.ad,switchToDashlaneAuthenticator:a.K1,switchToEmailToken:a.v5,startIdentityVerification:a.qw,cancelIdentityVerification:a.Vs},queries:{identityVerificationFlowStatus:i.O},events:{identityVerificationCompleted:o.w}})},13744:(e,t,r)=>{r.d(t,{$5:()=>o,Gc:()=>n,K1:()=>p,Vs:()=>g,XH:()=>l,ad:()=>u,eG:()=>a,qw:()=>m,rF:()=>c,sH:()=>d,v5:()=>h});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}class o extends((0,s.g)({scope:i.F.Device})){}class n extends((0,s.g)({scope:i.F.Device})){}class c extends((0,s.g)({scope:i.F.Device})){}class l extends((0,s.g)({scope:i.F.Device})){}class d extends((0,s.g)({scope:i.F.Device})){}class u extends((0,s.g)({scope:i.F.Device})){}class p extends((0,s.g)({scope:i.F.Device})){}class h extends((0,s.g)({scope:i.F.Device})){}class m extends((0,s.g)({scope:i.F.Device})){}class g extends((0,s.g)({scope:i.F.Device})){}},13089:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.Device})){}},41025:(e,t,r)=>{r.d(t,{O:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},81822:(e,t,r)=>{r.d(t,{l:()=>a});var s=r(67837),i=r(11433);class a extends((0,s.E)(i.i)){}(0,s.K)(i.i,a)},60467:(e,t,r)=>{r.r(t),r.d(t,{ActivateCommand:()=>F.r,AuthenticationClient:()=>z,AuthenticationFeatureFlips:()=>K.T,AuthenticationFlowContracts:()=>s,CanLockAppQuery:()=>B._,CleanRemotelyRemovedProfilesCommand:()=>O.L,DeactivateCommand:()=>M.E,DeviceRegistrationClient:()=>N.z,DeviceTransferContracts:()=>a,GetCurrentUserStatusQuery:()=>k.o,GetStatusQuery:()=>x.D,IdentityVerificationFlowContracts:()=>i,LocalAccountsQuery:()=>D.a,LoginWithPinCodeCommand:()=>L.cM,NO_ACTIVE_PIN_CODE:()=>L.DN,PinCodeClient:()=>G.u,PinCodeServerApiConfig:()=>V,RegisterDeviceCommand:()=>R.J,Request2FaCodesByPhoneCommand:()=>I.x,Request2FaCodesByPhoneErrorCodes:()=>T.A,USER_NOT_LOGGED_IN:()=>B.I,ValidateWebauthnAssertionCommand:()=>I.L,WRONG_PIN_CODE:()=>L.Vh,authenticationApi:()=>j.n,createNoActivePinCodeError:()=>L.Zs,createWrongPinCodeError:()=>L.g5,deviceRegistrationApi:()=>P.G,pinCodeApi:()=>U.n,registrationSchema:()=>R.Y,userVerificationApi:()=>C.M});var s={};r.r(s),r.d(s,{AuthenticationFlowClient:()=>d.e,AuthenticationFlowStatusQuery:()=>c.DW,CancelDeviceTransferRequestCommand:()=>n.Yc,ChangeAccountEmailCommand:()=>n.hW,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>n.eG,ClearErrorCommand:()=>n.jq,DeviceToDeviceAuthenticationErrors:()=>l.UY,DeviceToDeviceAuthenticationFlowStep:()=>l.E6,GetSsoProviderInfoQuery:()=>c.L2,GetSsoUserSettingsQuery:()=>c.Dc,InitiateAutologinWithSSOCommand:()=>n.x2,InitiateLoginWithSSOCommand:()=>n.Hr,LockCommand:()=>n.Y$,LoginViaSSOCommand:()=>n.yv,LogoutCommand:()=>n.N5,ResendEmailTokenCommand:()=>n.Gc,ResendPushNotificationCommand:()=>n.rF,RetryWebAuthnAuthenticationCommand:()=>n.M6,SSOMigrationType:()=>l.vX,SendAccountEmailCommand:()=>n.A,SendMasterPasswordCommand:()=>n.rT,SsoMigrationServerMethod:()=>l.hr,SubmitBackupCodeCommand:()=>n.sH,SubmitEmailTokenCommand:()=>n.XH,SubmitPinCodeCommand:()=>n.CO,SubmitTotpCommand:()=>n.ad,SwitchToDashlaneAuthenticatorCommand:()=>n.K1,SwitchToDevicetoDeviceAuthenticationCommand:()=>n.sU,SwitchToEmailTokenCommand:()=>n.v5,SwitchToMasterPasswordCommand:()=>n.On,SwitchToPinCodeCommand:()=>n.WF,WebAuthnAuthenticationFailCommand:()=>n.O3,authenticationFlowApi:()=>o.V,isDeviceToDeviceAuthenticationError:()=>l.ao});var i={};r.r(i),r.d(i,{CancelIdentityVerificationCommand:()=>p.Vs,ChangeTwoFactorAuthenticationOtpTypeCommand:()=>p.eG,ClearIdentityVerificationErrorCommand:()=>p.$5,IdentityVerificationClient:()=>m.l,IdentityVerificationCompletedEvent:()=>g.w,IdentityVerificationFlowStatusQuery:()=>h.O,ResendEmailTokenCommand:()=>p.Gc,ResendPushNotificationCommand:()=>p.rF,StartIdentityVerificationCommand:()=>p.qw,SubmitBackupCodeCommand:()=>p.sH,SubmitEmailTokenCommand:()=>p.XH,SubmitTotpCommand:()=>p.ad,SwitchToDashlaneAuthenticatorCommand:()=>p.K1,SwitchToEmailTokenCommand:()=>p.v5,identityVerificationFlowApi:()=>u.i});var a={};r.r(a),r.d(a,{ApproveDeviceTransferRequestCommand:()=>_.G,CancelRequestCommand:()=>E.b,RefreshRequestCommand:()=>y.V,RejectDeviceTransferRequestCommand:()=>f.a,ReturnToDeviceSetupCommand:()=>b.n,SubmitPassphraseChallengeCommand:()=>S.I,TrustedDeviceFlowErrors:()=>A.S,TrustedDeviceFlowStatusQuery:()=>w.N,TrustedDeviceFlowStep:()=>A.T,deviceTransferApi:()=>v.F});var o=r(29986),n=r(75203),c=r(28096),l=r(64496),d=r(36636),u=r(11433),p=r(13744),h=r(41025),m=r(81822),g=r(13089),v=r(6218),y=r(33969),_=r(87041),f=r(55870),S=r(48214),E=r(97891),b=r(81540),w=r(53835),A=r(70486),C=r(69401),I=r(11088),T=r(83853),P=r(42853),O=r(319),R=r(96782),D=r(59463),N=r(25565),U=r(89033),F=r(85035),M=r(44878),L=r(73675),x=r(35941),k=r(67160),G=r(42303);class V{constructor(e){this.env=e}}var K=r(28760),j=r(66974),B=r(85373),W=r(67837);class z extends((0,W.E)(j.n)){}(0,W.K)(j.n,z)},89033:(e,t,r)=>{r.d(t,{n:()=>l});var s=r(86952),i=r(85035),a=r(44878),o=r(73675),n=r(35941),c=r(67160);const l=(0,s.Q)({name:"pinCode",commands:{activate:i.r,deactivate:a.E,loginWithPinCode:o.cM},events:{},queries:{getStatus:n.D,getCurrentUserStatus:c.o}})},42303:(e,t,r)=>{r.d(t,{u:()=>a});var s=r(67837),i=r(89033);class a extends((0,s.E)(i.n)){}(0,s.K)(i.n,a)},85035:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},44878:(e,t,r)=>{r.d(t,{E:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},73675:(e,t,r)=>{r.d(t,{DN:()=>c,Vh:()=>o,Zs:()=>l,cM:()=>d,g5:()=>n});var s=r(74354),i=r(25029),a=r(96168);const o="WRONG_PIN_CODE",n=(0,a.Vj)(o,"Entered pin-code is not correct"),c="NO_ACTIVE_PIN_CODE",l=(0,a.Vj)(c,"User has no active pin-code");class d extends((0,s.g)({scope:i.F.Device})){}},67160:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},35941:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},83853:(e,t,r)=>{var s;r.d(t,{A:()=>s}),function(e){e.AccountNotEligible="AccountNotEligible",e.NetworkError="NetworkError"}(s||(s={}))},69401:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(86952),i=r(11088);const a=(0,s.Q)({name:"userVerification",commands:{validateWebauthnAssertion:i.L,request2FaCodesByPhone:i.x},queries:{},events:{}})},11088:(e,t,r)=>{r.d(t,{L:()=>a,x:()=>o});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}class o extends((0,s.g)({scope:i.F.Device})){}},76561:(e,t,r)=>{r.d(t,{c:()=>jt});var s=r(88802),i=r(60399),a=r(29986),o=r(6936),n=r(86252),c=r(99634),l=r(38679),d=r(9671),u=r(55300),p=r(59894),h=r(87279),m=r(93850),g=r(43673),v=r(8362),y=r(25029),_=r(95681),f=r(87065);const S=e=>!0;class E extends((0,_.Q)({initialValue:void 0,persist:!1,scope:y.F.Device,storeName:"authentication-flow-machine",storeTypeGuard:S})){}var b=r(23347),w=r(10722);const A=e=>!(!e||"object"!=typeof e)&&"rememberMeForSSOPreference"in e;class C extends((0,_.Q)({codec:w.E,persist:!0,storage:{initialValue:{rememberMeForSSOPreference:!0},schemaVersion:1,typeGuard:A},scope:y.F.Device,storeName:"sso-info",storeTypeGuard:A,capacity:b.Y._001KB})){}const I=e=>!0;class T extends((0,_.Q)({persist:!1,initialValue:{},scope:y.F.Device,storeName:"sso-provider-info",storeTypeGuard:I,capacity:b.Y._001KB})){}var P=r(63663),O=r(75203),R=r(78065),D=r(20916),N=r(57924),U=r(53446),F=r(37294);class M{constructor(e,t){this.interpreter=e,this.carbon=t}execute(){try{const{carbonState:e}=this.carbon.queries;e({path:"userSession.loginDeviceLimitFlow.flow"}).pipe((0,f.U)((e=>{if("success"===e.tag)return e.data}))).subscribe((e=>{Boolean(this.lastDeviceLimitFlowValue)&&!e&&this.interpreter.send({type:"DEVICE_LIMIT_ABORTED"}),this.lastDeviceLimitFlowValue=e}))}catch(e){return Promise.reject(new Error("Unable to subscribe to loginDeviceLimitFlow state"))}}}var L=r(65865),x=r(18275),k=r(48038),G=r(15187);class V extends G.x{}var K=r(89358);let j=class{constructor(e,t){this.carbon=e,this.session=t}async executeWithParams({login:e,masterPassword:t,isRememberMeEnabled:r,serverKey:s}){const a=await(0,i.z)(this.session.queries.createdSessionsState());if((0,h.hx)(a))throw new Error("coudltn get sessions");if(e in a.data)try{return await this.session.commands.openUserSession({email:e,rememberPassword:r,sessionKey:{type:"mp",masterPassword:t,secondaryKey:s}})}catch(e){return Promise.reject(new Error("UNKNOWN_ERROR"))}try{return await this.carbon.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e,password:t,rememberPassword:r,requiredPermissions:void 0,loginType:"MasterPassword"}]}),Promise.resolve()}catch(e){}}};j=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._,K.x])],j);let B=class{constructor(e){this.carbonLegacy=e}async execute(){try{const e=await this.carbonLegacy.commands.carbon({name:"checkDoesLocalRecoveryKeyExist",args:[]});if(!(0,h.d6)(e))throw new Error("Carbon command failed");return{isAccountRecoveryAvailable:e.data.carbonResult.doesExist}}catch(e){return{isAccountRecoveryAvailable:!1}}}};B=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],B);var W=r(48844),z=r(87113),H=r(64496);const Q=e=>"object"==typeof e&&"type"in e,q=e=>{if(e)switch(e){case"sso_member_to_admin":case"sso_member_to_mp_user":return H.vX.SSO_TO_MP;case"mp_user_to_sso_member":return H.vX.MP_TO_SSO;default:return}};let Y=class{constructor(e,t){this.ssoProviderInfoStore=e,this.serverApiClient=t,this.ssoProviderInfoStore=e,this.serverApiClient=t}async getSsoMigration(e){const t=await(0,i.z)(this.serverApiClient.v1.authentication.getAuthenticationMethodsForDevice({login:e,methods:["email_token","totp","duo_push","dashlane_authenticator","u2f"]}).pipe((0,W.DZ)((e=>{throw new Error(e.message)})),(0,W.lk)((e=>{const t=e.data.verifications.find(Q);if(t)return(0,h.Vp)(t);throw new Error("Unsupported authentication method")}))));if((0,h.hx)(t))throw new Error("Retrieve of verificationMethods failed ");if("sso"===t.data.type)return{serviceProviderUrl:t.data.ssoInfo.serviceProviderUrl,isNitroProvider:t.data.ssoInfo.isNitroProvider,migration:t.data.ssoInfo.migration}}async executeWithParams({login:e}){const t=await this.getSsoMigration(e);if(t)return await this.ssoProviderInfoStore.set({isNitroProvider:t.isNitroProvider??!1,serviceProviderUrl:t.serviceProviderUrl,migrationType:q(t.migration)}),{serviceProviderRedirectUrl:t.serviceProviderUrl,isNitroProvider:t.isNitroProvider}}};Y=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[T,z.l])],Y);let $=class{constructor(e){this.session=e}async executeWithParams(e){const t=await(0,i.z)(this.session.queries.checkSessionKey({email:e.login,sessionKey:{type:"mp",masterPassword:e.masterPassword,secondaryKey:e.serverKey}}));if(!(0,h.d6)(t))throw new Error("Error verifying SK");if(t.data)return!0;throw new V}};$=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[K.x])],$);let X=class{constructor(e,t,r,s){this.accountRecoveryStatusService=e,this.masterPasswordService=t,this.checkIsMigrationNeededService=r,this.mpVerificationService=s}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"CheckingAccountRecoveryStatus",id:"MasterPasswordFlowMachine",context:{isRememberMeEnabled:!1,isAccountRecoveryAvailable:!1},states:{CheckingAccountRecoveryStatus:{invoke:{src:"checkAccountRecoveryStatus",onDone:{target:"WaitingForMasterPassword",actions:["assignAccountRecoveryStatus"]}}},WaitingForMasterPassword:{on:{INPUT_MASTER_PASSWORD:{target:"ValidatingMasterPassword",actions:["assignMasterPassword"]},SWITCH_TO_PIN_CODE:{target:"#AuthenticationFlowMachine.PinCode",cond:"hasPinCodeEnabled"}}},ValidatingMasterPassword:{invoke:{src:"validateMasterPassword",onDone:{target:"OpeningSessionWithMasterpassword"},onError:{actions:["assignMpError"],target:"WaitingForMasterPassword"}}},OpeningSessionWithMasterpassword:{invoke:{src:"authenticateWithMasterPassword",onError:{actions:["assignGenericServiceError"]},onDone:{target:"CheckingMigrationNeeded"}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]},DEVICE_LIMIT_ABORTED:{target:"DeviceLimitAborted"}}},CheckingMigrationNeeded:{invoke:{src:"checkIsMigrationNeeded",onDone:{target:"MasterPasswordDone",actions:["assignSSOMigrationStatus"]},onError:{target:"WaitingForMasterPassword",actions:["assignGenericServiceError"]}},on:{CARBON_LEGACY_ERROR:{target:"WaitingForMasterPassword",actions:["assignError"]}}},DeviceLimitAborted:{type:"final",data:{shouldResetAuthenticationFlow:!0}},MasterPasswordDone:{type:"final",data:{shouldResetAuthenticationFlow:!1}}}},options:{actions:{assignMasterPassword:(0,L.f0)({masterPassword:(e,t)=>t.masterPassword,isRememberMeEnabled:(e,t)=>t.rememberMe}),assignAccountRecoveryStatus:(0,L.f0)({isAccountRecoveryAvailable:(e,t)=>t.data.isAccountRecoveryAvailable}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignGenericServiceError:(0,L.f0)({error:()=>({code:"unknown_error",data:{message:"UNKNOWN_ERROR"}})}),assignMpError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.data instanceof V?"WRONG_PASSWORD":"UNKNOWN_ERROR"}})}),assignSSOMigrationStatus:(0,L.f0)({serviceProviderRedirectUrl:(e,t)=>t.data?.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.data?.isNitroProvider})},services:{authenticateWithMasterPassword:e=>{const{login:t,masterPassword:r,isRememberMeEnabled:s,serverKey:i}=e;return this.masterPasswordService.executeWithParams({login:t??"",masterPassword:r??"",isRememberMeEnabled:s,serverKey:i})},checkAccountRecoveryStatus:()=>this.accountRecoveryStatusService.execute(),checkIsMigrationNeeded:e=>this.checkIsMigrationNeededService.executeWithParams({login:e.login??""}),validateMasterPassword:({login:e,masterPassword:t,serverKey:r})=>this.mpVerificationService.executeWithParams({login:e??"",masterPassword:t??"",serverKey:r})},guards:{hasPinCodeEnabled:e=>e.shouldAskPinCode}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};X=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[B,j,Y,$])],X);let Z=class{constructor(e){this.carbonLegacy=e}async execute(e){try{return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionResendToken",arg:[{login:e.login??""}]}),Promise.resolve()}catch(e){}}};Z=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],Z);let J=class{constructor(e){this.carbonLegacy=e}async requestCodeAgainstServer(){}async execute({login:e}){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithDashlaneAuthenticator",arg:[{login:e,password:null,persistData:!0,deviceName:""}]}),Promise.resolve()}async cancel(){return await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"cancelDashlaneAuthenticatorRegistration",arg:[]}),Promise.resolve()}};J=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],J);let ee=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator"},on:{CARBON_LEGACY_ERROR:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]},RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["cancelDashlaneAuthenticator","clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,L.f0)({error:()=>{}}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),switchToEmailToken:(0,L.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,L.f0)({isDashlaneAuthenticatorAvailable:!0}),cancelDashlaneAuthenticator:()=>{this.dashlaneAuthenticatorService.cancel()},sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};ee=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[J,Z])],ee);let te=class{constructor(e){this.carbonLegacy=e}async execute(e){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithToken",arg:[{login:e.login??"",password:null,token:e.emailToken??"",persistData:!0,deviceName:e.deviceName}]})}catch(e){}}};te=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],te);let re=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"WaitingForEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{entry:["authenticateWithEmailToken"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{clearError:(0,L.f0)({error:()=>{}}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignEmailToken:(0,L.f0)({emailToken:(e,t)=>t.emailToken}),authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:s}=e;return this.authenticateWithEmailToken.execute({deviceName:t,emailToken:r,login:s})}},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};re=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[te,Z])],re);const se=e=>({initial:e.initial,states:e.states,on:e.on??{}});let ie=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...se(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...se(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,L.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};ie=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ee,re])],ie);let ae=class{desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{},initial:"InitWebAuthnAuthentication",states:{InitWebAuthnAuthentication:{on:{WEBAUTHN_AUTHENTICATION_FAIL:{target:"WebAuthnAuthenticationFailed",actions:["assignWebAuthnError"]}}},WebAuthnAuthenticationFailed:{on:{RETRY_WEBAUTHN_AUTHENTICATION:{target:"InitWebAuthnAuthentication",actions:["clearError"]}}},WebAuthnAuthenticationDone:{type:"final",data:{switchToMasterPassword:!1,switchToPinCode:!1}},MasterPasswordRequested:{type:"final",data:{switchToMasterPassword:!0,switchToPinCode:!1}},PinCodeRequested:{type:"final",data:{switchToMasterPassword:!1,switchToPinCode:!0}}},on:{USE_MASTER_PASSWORD:{actions:["clearError"],target:".MasterPasswordRequested",internal:!0},SWITCH_TO_PIN_CODE:{actions:["clearError"],target:".PinCodeRequested",internal:!0}}},options:{actions:{clearError:(0,L.f0)({error:()=>{}}),assignWebAuthnError:(0,L.f0)({error:(e,t)=>t.error})},services:{},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};ae=(0,s.__decorate)([(0,N.GS)()],ae);let oe=class{constructor(e){this.carbonLegacy=e}executeWithParams({login:e,masterPassword:t,otp:r,twoFactorAuthenticationOtpType:s,otpVerificationMode:i,deviceName:a}){const o={login:e,password:t??null,otp:r,withBackupCode:"backupCode"===s,persistData:!0};try{"otp2"===i?this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTP",arg:[{...o,deviceName:a}]}):"otp1"===i&&this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSessionWithOTPForNewDevice",arg:[o]})}catch(e){}return Promise.resolve()}};oe=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],oe);let ne=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"WebAuthnMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{entry:["authenticateWithTwoFactorAuthentication"],on:{CARBON_LEGACY_ERROR:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),clearError:(0,L.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,L.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,L.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType}),authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};this.twoFactorAuthenticationService.executeWithParams(t)}},services:{},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};ne=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[oe])],ne);var ce=r(10430),le=r(10551),de=r(16053);let ue=class{constructor(e){this.d2dAuthenticationService=e}async execute({login:e}){const t=le.getDefaultDeviceName();if(!e||!t)throw new ce.z("No user login/device name",H.UY.GENERIC_ERROR);const r=await this.d2dAuthenticationService.requestTransfer(e,t);if((0,h.hx)(r))throw new ce.z("Request transfer error",H.UY.GENERIC_ERROR);const{transferId:s,expireDateUnix:i}=r.data;return Promise.resolve({transferId:s,expireDateUnix:i})}};ue=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[de.C])],ue);var pe=r(15652);let he=class{constructor(e,t){this.d2dCryptoService=e,this.d2dAuthenticationService=t}async execute({transferId:e}){if(!e)throw new ce.z("No transferId in context",H.UY.GENERIC_ERROR);const{privateKey:t,publicKey:r}=this.d2dCryptoService.generateKeyPair(),s=this.d2dCryptoService.hash(r),i=await this.d2dAuthenticationService.startReceiverKeyExchange(e,s);if((0,h.hx)(i))return Promise.reject(i.error);const{senderPublicKey:a}=i.data;return Promise.resolve({receiverPrivateKey:t,receiverPublicKey:r,senderPublicKey:a})}};he=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[pe.q,de.C])],he);let me=class{constructor(e){this.d2dAuthenticationService=e}async execute(e){if(!e.transferId||!e.login)throw new ce.z("No transferId or user login in the machine context",H.UY.GENERIC_ERROR);const t=await this.d2dAuthenticationService.startTransfer(e.transferId);return(0,h.hx)(t)?Promise.reject(t.error):Promise.resolve(t.data)}};me=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[de.C])],me);let ge=class{constructor(e,t){this.d2dCryptoService=e,this.d2dAuthenticationService=t}async execute(e){if(!e.transferId||!e.login)throw new ce.z("No transferId or user login in the machine context",H.UY.GENERIC_ERROR);if(!e.receiverPrivateKey||!e.receiverPublicKey||!e.senderPublicKey)throw new ce.z("Missing keys/data in context",H.UY.GENERIC_ERROR);if(!e.sharedSecret)throw new ce.z("Missing sharedSecret in context",H.UY.GENERIC_ERROR);if(!e.encryptedData||!e.nonce)throw new ce.z("Missing transfer data in context",H.UY.GENERIC_ERROR);const t=this.d2dCryptoService.generateSymmetricKey(e.login,e.transferId,e.sharedSecret),r=this.d2dCryptoService.decryptInvisibleMasterPassword(e.encryptedData,e.nonce,t);await this.d2dAuthenticationService.openSession(r.login,r.token,r.key.value,e.deviceName)}};ge=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[pe.q,de.C])],ge);var ve=r(69605);let ye=class{constructor(e,t,r){this.d2dCryptoService=e,this.d2dAuthenticationService=t,this.passphraseService=r}async execute(e){if(!e.receiverPrivateKey||!e.receiverPublicKey||!e.senderPublicKey)throw new ce.z("Keys not found in the state machine context",H.UY.GENERIC_ERROR);if(!e.transferId)throw new ce.z("TransferId not found in the state machine context/store",H.UY.GENERIC_ERROR);if(!e.login)throw new ce.z("User login not found in state machine context/store",H.UY.GENERIC_ERROR);const t=await this.d2dAuthenticationService.completeKeyExchange(e.transferId,e.receiverPublicKey);if((0,h.hx)(t))throw new ce.z("Error with completeKeyExchange",H.UY.GENERIC_ERROR);const r=this.d2dCryptoService.generateReceiverSharedSecret(e.receiverPublicKey,e.receiverPrivateKey,e.senderPublicKey),s=this.d2dCryptoService.generateVisualCheckSeed(e.login,e.transferId,r),{passphrase:i}=await this.passphraseService.generatePassphraseChallenge(s);return Promise.resolve({sharedSecret:r,passphrase:i})}};ye=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[pe.q,de.C,ve.Kp])],ye);let _e=class{constructor(e,t,r,s,i){this.requestDeviceTransfer=e,this.startReceiverKeyExchange=t,this.completeKeyExchangeAndGeneratePassphrase=r,this.startTransfer=s,this.openSession=i}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"DeviceToDeviceAuthenticationFlow",initial:"WaitingForTransferRequest",context:{transferId:void 0},states:{WaitingForTransferRequest:{invoke:{src:"requestDeviceTransfer",onDone:{target:"DisplayInstructions",actions:["assignTransferId"]},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},DisplayInstructions:{invoke:{src:"startReceiverKeyExchange",onDone:{actions:["assignKeys"],target:"GeneratePassphrase"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},GeneratePassphrase:{invoke:{src:"completeKeyExchangeAndGeneratePassphrase",onDone:{actions:["assignPassphrase"],target:"StartTransfer"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},StartTransfer:{invoke:{src:"startTransfer",onDone:{actions:["assignTransferData"],target:"OpenSession"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},OpenSession:{invoke:{src:"openSession",onDone:{target:"DeviceRegistered"},onError:{actions:["assignDeviceToDeviceError"],target:"DeviceTransferError"}}},DeviceTransferError:{},DeviceRegistered:{type:"final"}}},options:{actions:{assignTransferId:(0,L.f0)({transferId:(e,t)=>t.data.transferId}),assignKeys:(0,L.f0)({receiverPublicKey:(e,t)=>t.data.receiverPublicKey,receiverPrivateKey:(e,t)=>t.data.receiverPrivateKey,senderPublicKey:(e,t)=>t.data.senderPublicKey}),assignPassphrase:(0,L.f0)({passphrase:(e,t)=>t.data.passphrase,sharedSecret:(e,t)=>t.data.sharedSecret}),assignTransferData:(0,L.f0)({encryptedData:(e,t)=>t.data.encryptedData,nonce:(e,t)=>t.data.nonce}),clearContext:(0,L.f0)({deviceName:()=>{},transferId:()=>{},receiverPublicKey:()=>{},receiverPrivateKey:()=>{},senderPublicKey:()=>{},sharedSecret:()=>{},passphrase:()=>{}}),assignDeviceToDeviceError:(0,L.f0)({error:(e,t)=>t.data instanceof ce.z?t.data.code:H.UY.GENERIC_ERROR})},services:{requestDeviceTransfer:e=>this.requestDeviceTransfer.execute(e),startReceiverKeyExchange:e=>this.startReceiverKeyExchange.execute(e),completeKeyExchangeAndGeneratePassphrase:e=>this.completeKeyExchangeAndGeneratePassphrase.execute(e),startTransfer:e=>this.startTransfer.execute(e),openSession:e=>this.openSession.execute(e)}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};_e=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ue,he,ye,me,ge])],_e);var fe=r(18533),Se=r(42303);class Ee extends G.x{constructor(){super("Entered PIN code is wrong")}}let be=class{constructor(e){this.pinCodeClient=e}async executeWithParams({loginEmail:e,pinCode:t}){if(!e)throw new Error("No login email");const r=await this.pinCodeClient.commands.loginWithPinCode({email:e,pinCode:t});return(0,h.hx)(r)?Promise.reject((0,fe.EQ)(r.error,{NO_ACTIVE_PIN_CODE:()=>new Error("No active pin code"),WRONG_PIN_CODE:()=>new Ee})):Promise.resolve()}};be=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Se.u])],be);let we=class{constructor(e){this.pinCodeVerificationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"PinCodeMachine",context:{pinCode:""},initial:"WaitingForPinCode",states:{WaitingForPinCode:{on:{INPUT_PIN_CODE:{target:"ValidatingPinCode",actions:["assignPinCode"]},USE_MASTER_PASSWORD:{target:"#AuthenticationFlowMachine.MasterPassword"},USE_DEVICE_TO_DEVICE_AUTHENTICATION:{target:"#AuthenticationFlowMachine.DeviceToDeviceAuthentication"}}},ValidatingPinCode:{invoke:{src:"validatePinCode",onDone:{target:"PinCodeDone"},onError:{actions:["assignPinCodeError"],target:"WaitingForPinCode"}}},PinCodeDone:{type:"final"}}},options:{actions:{assignPinCode:(0,L.f0)({pinCode:(e,t)=>t.pinCode}),assignPinCodeError:(0,L.f0)({error:(e,t)=>({code:t.data instanceof Ee?"wrong_pin_code":"unknown_error"})}),clearError:(0,L.f0)({error:()=>{}}),clearContext:(0,L.f0)({pinCode:()=>"",error:()=>{}})},services:{validatePinCode:e=>this.pinCodeVerificationService.executeWithParams({loginEmail:e.login,pinCode:e.pinCode})},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,x.C)(e,t)}};we=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[be])],we);var Ae=r(30523);let Ce=class{constructor(e,t){this.carbonLegacyClient=e,this.pinCodeClient=t}retrieveLocalAccounts(){return(0,i.z)(this.carbonLegacyClient.queries.carbonState({path:"authentication.localAccounts"}).pipe((0,Ae.h)(h.d6),(0,Ae.h)((e=>e.data.accountsListInitialized)),(0,f.U)((e=>e.data.accountsList))))}async getPinCodeStatus(e){if(!e)return!1;const t=await(0,i.z)(this.pinCodeClient.queries.getStatus({loginEmail:e}));return!(0,h.hx)(t)&&t.data.isPinCodeEnabled}async execute(){const e=await this.retrieveLocalAccounts(),t=e?.find((e=>e.isLastSuccessfulLogin)),r=await this.getPinCodeStatus(t?.login);return{localAccounts:e??[],lastUsedLogin:t?.login??"",shouldAskMasterPassword:t?.shouldAskMasterPassword??!1,shouldAskPinCode:r,shouldAskOTP:t?.hasLoginOtp??!1,rememberMeType:t?.rememberMeType??"disabled"}}};Ce=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._,Se.u])],Ce);let Ie=class{constructor(e){this.carbonLegacy=e}async execute(e){await this.carbonLegacy.commands.carbon({name:"loginViaSSO",args:[e]})}};Ie=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],Ie);let Te=class{constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}async execute({isNitroProvider:e,serviceProviderRedirectUrl:t}){await this.ssoProviderInfoStore.set({isNitroProvider:e,serviceProviderUrl:t})}};Te=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[T])],Te);let Pe=class{constructor(e){this.carbonLegacy=e}async execute({login:e}){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"openSession",arg:[{login:e??""}]})}};Pe=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],Pe);let Oe=class{constructor(e){this.pinCodeClient=e}async execute({login:e}){if(e){const t=await(0,i.z)(this.pinCodeClient.queries.getStatus({loginEmail:e}));if((0,h.d6)(t)&&t.data.isPinCodeEnabled)return Promise.resolve(!0)}return Promise.resolve(!1)}};Oe=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Se.u])],Oe);let Re=class{constructor(e,t,r,s,i,a,o,n,c,l,d){this.deviceRegistrationMachine=e,this.masterPasswordFlowMachine=t,this.twoFactorAuthenticationMachine=r,this.webAuthnMachine=s,this.deviceToDeviceAuthenticationMachine=i,this.pinCodeMachine=a,this.initializeMachineService=o,this.legacySSOLoginService=n,this.checkAccountType=c,this.storeSSOInfoService=l,this.checkPinCodeStatusService=d}desc(e=!1){const t={config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"AuthenticationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.masterPasswordFlowMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,...this.webAuthnMachine.desc().config.context,...this.deviceToDeviceAuthenticationMachine.desc().config.context,...this.pinCodeMachine.desc().config.context,ready:!1,shouldAskMasterPassword:!1,shouldAskOTP:!1,shouldAskPinCode:!1},states:{Starting:{invoke:{src:"initializeMachine",onDone:{actions:["assignInitializationResults"],target:"RememberMeRedirection"}}},RememberMeRedirection:{always:[{target:"MasterPassword",cond:"shouldAskMasterPassword"},{target:"CheckSessionForOtp2",cond:"shouldAskOTP"},{target:"WebAuthn",cond:"rememberMeIsWebAuthn"},{target:"WaitingForEmail"}]},CheckSessionForOtp2:{entry:["checkAccountType"]},WaitingForEmail:{on:{INPUT_ACCOUNT_EMAIL:{target:"ValidatingEmail",actions:["assignAccountEmail","clearError"]}}},ValidatingEmail:{entry:["checkAccountType"],on:{CARBON_LEGACY_ERROR:{target:"WaitingForEmail",actions:["assignError"]}}},PinCode:{...se(this.pinCodeMachine.desc().config)},DeviceRegistration:{...se(this.deviceRegistrationMachine.desc().config)},WebAuthn:{...se(this.webAuthnMachine.desc().config),onDone:[{target:"MasterPassword",cond:"shouldSwitchToMasterPassword"},{target:"PinCode",cond:"shouldSwitchToPinCode"},{target:"MasterPasswordBasedAuthenticationDone"}]},TwoFactorAuthentication:{...se(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"MasterPasswordBasedAuthenticationDone"}},SSOAuthentication:{entry:["legacySSOLogin"]},SSORedirectionToIdp:{entry:["assignServiceProviderInfo","storeSSOInfo"]},CheckPinCodeAvailableForMasterPassword:{invoke:{src:"checkPinCodeStatus",onDone:[{actions:["assignShouldAskPinCode"],cond:"isPinCodeLogin",target:"PinCode"},{actions:["assignShouldAskPinCode"],target:"MasterPassword"}]}},MasterPassword:{...se(this.masterPasswordFlowMachine.desc().config),onDone:[{target:"WaitingForEmail",cond:"shouldResetAuthenticationFlow"},{target:"MasterPasswordBasedAuthenticationDone"}]},MasterPasswordBasedAuthenticationDone:{on:{CARBON_LEGACY_LOGGED_OUT:{target:"Starting"}}},CheckPinCodeAvailableForPasswordless:{invoke:{src:"checkPinCodeStatus",onDone:[{actions:["assignShouldAskPinCode"],cond:"isPinCodeLogin",target:"PinCode"},{actions:["assignShouldAskPinCode"],target:"DeviceToDeviceAuthentication"}]}},DeviceToDeviceAuthentication:{...se(this.deviceToDeviceAuthenticationMachine.desc().config),onDone:{target:"DeviceToDeviceAuthenticationDone"}},DeviceToDeviceAuthenticationDone:{type:"final"}},on:{CHANGE_ACCOUNT_EMAIL:[{target:"ValidatingEmail",actions:["clearError","assignAccountEmail"],cond:"isAccountLoginAvailable"},{target:"WaitingForEmail",actions:["clearError","clearEmail"]}],CARBON_LEGACY_ASK_MASTER_PASSWORD:{target:"CheckPinCodeAvailableForMasterPassword",actions:["assignServerKey","clearError"]},CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT:[{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail","clearError"],cond:"isGrapheneDeviceRegistrationFlow"},{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail","clearError"]}],CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["clearError"]},CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED:{target:"SSORedirectionToIdp",actions:["clearError"]},CARBON_LEGACY_SSO_LOGIN_BYPASS:{target:"SSOAuthentication",actions:["assignSsoData"]},CARBON_LEGACY_OPEN_SESSION_OTP_SENT:{target:"TwoFactorAuthentication",actions:["assignOtpVerificationMode","clearError"]},CARBON_LEGACY_OPEN_SESSION_DEVICE_TO_DEVICE:{target:"CheckPinCodeAvailableForPasswordless",actions:["assignServerKey","clearError"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.masterPasswordFlowMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,...this.webAuthnMachine.desc().options.actions,...this.deviceToDeviceAuthenticationMachine.desc().options.actions,...this.pinCodeMachine.desc().options.actions,assignInitializationResults:(0,L.f0)({login:(e,t)=>t.data.lastUsedLogin,localAccounts:(e,t)=>t.data.localAccounts,shouldAskMasterPassword:(e,t)=>t.data.shouldAskMasterPassword,shouldAskOTP:(e,t)=>t.data.shouldAskOTP,shouldAskPinCode:(e,t)=>t.data.shouldAskPinCode,rememberMeType:(e,t)=>t.data.rememberMeType,ready:()=>!0}),assignAccountEmail:(0,L.f0)({login:(e,t)=>t.login}),assignError:(0,L.f0)({error:(e,t)=>({code:"unknown_error",data:{message:t.error}})}),assignOtpVerificationMode:(0,L.f0)({otpVerificationMode:(e,t)=>t.otpVerificationMode}),assignSsoData:(0,L.f0)({ssoData:(e,t)=>t}),assignServiceProviderInfo:(0,L.f0)({serviceProviderRedirectUrl:(e,t)=>t.serviceProviderRedirectUrl,isNitroProvider:(e,t)=>t.isNitroProvider,rememberMeForSSOPreference:(e,t)=>t.rememberMeForSSOPreference}),assignServerKey:(0,L.f0)({serverKey:(e,t)=>t.serverKey}),assignShouldAskPinCode:(0,L.f0)({shouldAskPinCode:(e,t)=>t.data}),clearEmail:(0,L.f0)({login:void 0}),clearError:(0,L.f0)({error:()=>{}}),clearContext:(0,L.f0)({login:()=>"",shouldAskOTP:()=>!1,shouldAskMasterPassword:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1,isRememberMeEnabled:()=>!1,isAccountRecoveryAvailable:()=>!1}),legacySSOLogin:(e,t)=>this.legacySSOLoginService.execute(t),checkAccountType:e=>this.checkAccountType.execute(e),storeSSOInfo:(e,t)=>this.storeSSOInfoService.execute(t)},services:{...this.deviceRegistrationMachine.desc().options.services,...this.masterPasswordFlowMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services,...this.webAuthnMachine.desc().options.services,...this.deviceToDeviceAuthenticationMachine.desc().options.services,...this.pinCodeMachine.desc().options.services,initializeMachine:()=>this.initializeMachineService.execute(),checkAccountType:e=>this.checkAccountType.execute(e),checkPinCodeStatus:e=>this.checkPinCodeStatusService.execute(e)},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,...this.webAuthnMachine.desc().options.guards,...this.masterPasswordFlowMachine.desc().options.guards,isAccountLoginAvailable:(e,t)=>Boolean(t.login),shouldAskMasterPassword:e=>e.shouldAskMasterPassword&&!e.shouldAskPinCode,shouldAskOTP:e=>!!e.shouldAskOTP&&e.shouldAskOTP,shouldAskPinCode:e=>e.shouldAskPinCode,shouldSwitchToMasterPassword:(e,t)=>t.data.switchToMasterPassword,shouldSwitchToPinCode:(e,t)=>t.data.switchToPinCode,shouldResetAuthenticationFlow:(e,t)=>t.data.shouldResetAuthenticationFlow,rememberMeIsWebAuthn:e=>void 0!==e.rememberMeType&&"webauthn"===e.rememberMeType,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice"),isPinCodeLogin:(e,t)=>t.data}}};return e&&(0,k.G)(t.config),t}create(e=!1){const{config:t,options:r}=this.desc(e);return(0,x.C)(t,r)}};Re=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[ie,X,ne,ae,_e,we,Ce,Ie,Pe,Te,Oe])],Re);let De=class{constructor(e,t,r,s,i){this.carbon=s,this.allowedToFail=i,this.loginMachineStore=t;const a=e.create(r);this.interpreter=R.kJ(a).onTransition((0,U.V)(this.allowedToFail)).onEvent((0,F.V)(this.allowedToFail)).onTransition((async()=>{const e=this.interpreter.getSnapshot();await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.loginMachineStore,e)})),this.abortDeviceLimitEventHandler=new M(this.interpreter,this.carbon)}async prepare(){await this.abortDeviceLimitEventHandler.execute();const e=await(async e=>{const t=await e.getState();return t?v.ZM.create(JSON.parse(t)):void 0})(this.loginMachineStore);if(!e){const e=this.interpreter.start();return void await(0,D.x)(e,(e=>e.context.ready),{timeout:3e4})}let t;await this.allowedToFail.doOne((()=>{if(e.done)throw new Error("Restarting a machine which is already in its final state. Starting from scratch instead.");t=this.interpreter.start(e)}),"Resuming state machine"),t||(t=this.interpreter.start()),await(0,D.x)(t,(e=>e.context.ready))}continue(e){this.interpreter.send(e)}};De=(0,s.__decorate)([(0,N.GS)(),(0,s.__metadata)("design:paramtypes",[Re,E,Boolean,n._,d.J])],De);let Ne=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"CHANGE_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,h.Vp)(void 0))}};Ne=(0,s.__decorate)([(0,P.W)(O.hW),(0,s.__metadata)("design:paramtypes",[De])],Ne);let Ue=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.authenticationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,h.Vp)(void 0))}};Ue=(0,s.__decorate)([(0,P.W)(O.eG),(0,s.__metadata)("design:paramtypes",[De])],Ue);let Fe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,h.Vp)(void 0))}};Fe=(0,s.__decorate)([(0,P.W)(O.jq),(0,s.__metadata)("design:paramtypes",[De])],Fe);let Me=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"CANCEL_DEVICE_TRANSFER_REQUEST"}),Promise.resolve((0,h.Vp)(void 0))}};Me=(0,s.__decorate)([(0,P.W)(O.Yc),(0,s.__metadata)("design:paramtypes",[De])],Me);let Le=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,h.Vp)(void 0))}};Le=(0,s.__decorate)([(0,P.W)(O.Gc),(0,s.__metadata)("design:paramtypes",[De])],Le);let xe=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,h.Vp)(void 0))}};xe=(0,s.__decorate)([(0,P.W)(O.rF),(0,s.__metadata)("design:paramtypes",[De])],xe);let ke=class{constructor(e){this.authenticationFlow=e}execute(e){const{login:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_ACCOUNT_EMAIL",login:t}),Promise.resolve((0,h.Vp)(void 0))}};ke=(0,s.__decorate)([(0,P.W)(O.A),(0,s.__metadata)("design:paramtypes",[De])],ke);let Ge=class{constructor(e){this.authenticationFlow=e}execute(e){const{masterPassword:t,rememberMe:r}=e.body;return this.authenticationFlow.continue({type:"INPUT_MASTER_PASSWORD",masterPassword:t,rememberMe:r}),Promise.resolve((0,h.Vp)(void 0))}};Ge=(0,s.__decorate)([(0,P.W)(O.rT),(0,s.__metadata)("design:paramtypes",[De])],Ge);let Ve=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,h.Vp)(void 0))}};Ve=(0,s.__decorate)([(0,P.W)(O.sH),(0,s.__metadata)("design:paramtypes",[De])],Ve);let Ke=class{constructor(e){this.authenticationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.authenticationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,h.Vp)(void 0))}};Ke=(0,s.__decorate)([(0,P.W)(O.XH),(0,s.__metadata)("design:paramtypes",[De])],Ke);let je=class{constructor(e){this.authenticationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,h.Vp)(void 0))}};je=(0,s.__decorate)([(0,P.W)(O.ad),(0,s.__metadata)("design:paramtypes",[De])],je);let Be=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,h.Vp)(void 0))}};Be=(0,s.__decorate)([(0,P.W)(O.K1),(0,s.__metadata)("design:paramtypes",[De])],Be);let We=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,h.Vp)(void 0))}};We=(0,s.__decorate)([(0,P.W)(O.v5),(0,s.__metadata)("design:paramtypes",[De])],We);let ze=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"USE_DEVICE_TO_DEVICE_AUTHENTICATION"}),Promise.resolve((0,h.Vp)(void 0))}};ze=(0,s.__decorate)([(0,P.W)(O.sU),(0,s.__metadata)("design:paramtypes",[De])],ze);let He=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"RETRY_WEBAUTHN_AUTHENTICATION"}),Promise.resolve((0,h.Vp)(void 0))}};He=(0,s.__decorate)([(0,P.W)(O.M6),(0,s.__metadata)("design:paramtypes",[De])],He);let Qe=class{constructor(e){this.authenticationFlow=e}execute(e){const{webAuthnError:t}=e.body;return this.authenticationFlow.continue({type:"WEBAUTHN_AUTHENTICATION_FAIL",error:t}),Promise.resolve((0,h.Vp)(void 0))}};Qe=(0,s.__decorate)([(0,P.W)(O.O3),(0,s.__metadata)("design:paramtypes",[De])],Qe);var qe=r(26457);let Ye=class{constructor(e,t){this.carbonLegacy=e,this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}catch(e){this.logger.trace("Logout Command error :"+e)}return Promise.resolve((0,h.Vp)(void 0))}};Ye=(0,s.__decorate)([(0,P.W)(O.N5),(0,s.__metadata)("design:paramtypes",[n._,qe.V])],Ye);let $e=class{constructor(e,t){this.carbonLegacy=e,this.logger=t}async execute(){try{await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"lockSession",arg:[{}]})}catch(e){this.logger.trace("LockSession command handler: "+e)}return Promise.resolve((0,h.Vp)(void 0))}};$e=(0,s.__decorate)([(0,P.W)(O.Y$),(0,s.__metadata)("design:paramtypes",[n._,qe.V])],$e);let Xe=class{constructor(e){this.authenticationFlow=e}execute(e){return this.authenticationFlow.continue({type:"CARBON_LEGACY_SSO_LOGIN_BYPASS",...e.body}),Promise.resolve((0,h.Vp)(void 0))}};Xe=(0,s.__decorate)([(0,P.W)(O.yv),(0,s.__metadata)("design:paramtypes",[De])],Xe);var Ze=r(28489),Je=r(94189),et=r(95082);class tt{}let rt=class{constructor(e,t,r,s){this.carbonLegacyClient=e,this.ssoUserSettingsStore=r,this.client=t,this.authenticationFlowInfraContext=s}async retrieveSSOInfo(){const e=await(0,i.z)(this.carbonLegacyClient.queries.carbonState({path:"userSession.ssoSettings"}).pipe((0,f.U)((e=>{if(!((0,h.d6)(e)&&(t=e.data,t&&"object"==typeof t&&(0,Ze.l$)(t,"ssoUser")&&(0,Ze.l$)(t,"serviceProviderUrl"))))throw new Error("SsoSettings is not of the expected type");var t;return e.data}))));return{isNitroProvider:e.isNitroProvider??!1,serviceProviderUrl:e.serviceProviderUrl}}async execute(e){const{loginUserWithEnclaveSSO:t}=this.client.getClient(et.y).commands,r=await this.retrieveSSOInfo(),{login:s,rememberMeForSSOPreference:i}=e.body;return await this.ssoUserSettingsStore.set({rememberMeForSSOPreference:i}),r.isNitroProvider?await t({userEmailAddress:s}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:r.serviceProviderUrl,tabFocus:!0}),Promise.resolve((0,h.Vp)(void 0))}};rt=(0,s.__decorate)([(0,P.W)(O.Hr),(0,s.__metadata)("design:paramtypes",[n._,Je.w,C,tt])],rt);var st=r(46420);const it=e=>!!e&&"object"==typeof e&&(0,Ze.l$)(e,"type")&&"sso"===e.type;let at=class{constructor(e,t,r,s,i){this.allowToFail=i,this.client=t,this.carbonLegacyClient=e,this.authenticationFlowInfraContext=r,this.serverApiClient=s}getDeviceAccessKeys(e){return this.carbonLegacyClient.queries.carbonState({path:"authentication.localUsers"}).pipe((0,Ae.h)(h.d6),(0,f.U)((t=>t.data[e])))}async checkSSOInfo(e){const t=(await(0,i.z)(this.getDeviceAccessKeys(e).pipe((0,f.U)((t=>this.serverApiClient.v1.authentication.getAuthenticationMethodsForLogin({login:e,deviceAccessKey:t.deviceAccessKey,methods:["email_token","totp","duo_push","dashlane_authenticator"]}))),(0,st.J)(),(0,Ae.h)(h.d6),(0,f.U)((e=>e.data.data))))).verifications.find(it);if(t){const e=t.ssoInfo;return{isNitroProvider:e.isNitroProvider,serviceProviderUrl:e.serviceProviderUrl}}throw new Error("No SSO authentication available for the user")}async execute(e){const{login:t}=e.body,{loginUserWithEnclaveSSO:r}=this.client.getClient(et.y).commands;return await this.allowToFail.doOne((async()=>{const e=await this.checkSSOInfo(t);e.isNitroProvider?await r({userEmailAddress:t}):this.authenticationFlowInfraContext.redirectUserToExternalUrl({externalUrl:e.serviceProviderUrl,tabFocus:!1})}),"InitiateAutologinWithSSOCommandHandler.execute"),Promise.resolve((0,h.Vp)(void 0))}};at=(0,s.__decorate)([(0,P.W)(O.x2),(0,s.__metadata)("design:paramtypes",[n._,Je.w,tt,z.l,d.J])],at);var ot=r(68307),nt=r(23326);let ct=class{constructor(e,t,r){this.authenticationFlow=e,this.ssoUserSettingsStore=t,this.carbon=r}getLoginFlowMigrationKillswitch(){return(0,i.z)(this.carbon.queries.carbonState({path:"device.killswitch.disableLoginFlowMigration"}).pipe((0,Ae.h)(h.d6),(0,f.U)((e=>e))))}async handle(e){const t=await this.getLoginFlowMigrationKillswitch();let r=!1;if("undefined"!=typeof self&&self.localStorage){const e=self.localStorage.getItem("extng.loginFlow.forceLegacyFallback");r=Boolean(e)&&"true"===e}if("success"===t.tag&&t.data||r)return console.warn("[Authentication-flow] Ignoring carbon event due to legacy login fallback",{isKillSwitchEnabled:t,isForceLoginFlowFallbackOptionEnabled:r}),Promise.resolve();switch(e.body.eventName){case"openSessionMasterPasswordLess":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DEVICE_TO_DEVICE"});break;case"openSessionTokenSent":if(!e.body.eventData||"object"!=typeof e.body.eventData||!("login"in e.body.eventData)||"string"!=typeof e.body.eventData.login)throw new Error("login not in eventData");this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_TOKEN_SENT",login:e.body.eventData.login});break;case"openSessionAskMasterPassword":{const e=await(0,i.z)(this.carbon.queries.getMasterPasswordAndServerKey());if((0,h.hx)(e))throw new Error("Failed to get  server key from carbon");const{serverKey:t}=e.data;this.authenticationFlow.continue({type:"CARBON_LEGACY_ASK_MASTER_PASSWORD",serverKey:t})}break;case"openSessionDashlaneAuthenticator":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_DASHLANE_AUTHENTICATOR"});break;case"openSessionOTPSent":case"openSessionOTPForNewDeviceRequired":this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_OTP_SENT",otpVerificationMode:"openSessionOTPSent"===e.body.eventName?"otp2":"otp1"});break;case"openSessionSsoRedirectionToIdpRequired":{const t=e.body.eventData,{rememberMeForSSOPreference:r}=await this.ssoUserSettingsStore.getState();this.authenticationFlow.continue({type:"CARBON_LEGACY_OPEN_SESSION_SSO_REDIRECTION_TO_IDP_REQUIRED",serviceProviderRedirectUrl:t.serviceProviderRedirectUrl,isNitroProvider:t.isNitroProvider,rememberMeForSSOPreference:r})}break;case"openSessionFailed":{const t=e.body.eventData;this.authenticationFlow.continue({type:"CARBON_LEGACY_ERROR",error:t.errorCode})}break;case"loginStatusChanged":e.body.eventData.loggedIn||this.authenticationFlow.continue({type:"CARBON_LEGACY_LOGGED_OUT"})}return Promise.resolve()}};ct=(0,s.__decorate)([(0,ot.b)(nt.Dj),(0,s.__metadata)("design:paramtypes",[De,C,n._])],ct);var lt=r(6136),dt=r(20754),ut=r(28096),pt=r(69885),ht=r(6220);const mt=e=>({step:"EmailStep",loginEmail:e.context.login,localAccounts:e.context.localAccounts??[],isLoading:e.matches("ValidatingEmail")&&!e.context.error,error:e.context.error?.data?.message}),gt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.WaitingForTransferRequest,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),vt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.DisplayInstructions,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),yt=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.LoadingPassphrase,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),_t=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.DisplayPassphrase,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,passphrase:e.context.passphrase?.split(ve.iy)||[],error:e.context.error}),ft=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.LoadingAccount,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),St=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.Error,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error??H.UY.GENERIC_ERROR}),Et=e=>({step:"DeviceToDeviceAuthenticationStep",deviceToDeviceStep:H.E6.DeviceRegistered,localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,error:e.context.error}),bt=e=>({step:"EmailTokenStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error?.data?.message,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),wt=e=>({step:"DashlaneAuthenticatorStep",localAccounts:e.context.localAccounts??[],isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error?.data?.message}),At=e=>({step:"TwoFactorAuthenticationOtpStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error?.data?.message,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType}),Ct=e=>({step:"WebAuthnStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login??"",isLoading:e.matches({WebAuthn:"InitWebAuthnAuthentication"})&&!e.context.error,error:e.context.error?.data?.message}),It=e=>({step:"SSORedirectionToIdpStep",loginEmail:e.context.login,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl??"",isNitroProvider:e.context.isNitroProvider??!1,rememberMeForSSOPreference:e.context.rememberMeForSSOPreference,isLoading:e.matches({SSORedirectionToIdp:"InitSSOAuthentication"})&&!e.context.error,error:e.context.error?.data?.message,localAccounts:e.context.localAccounts??[]}),Tt=(e,t)=>({step:"MasterPasswordStep",loginEmail:e.context.login??"",localAccounts:e.context.localAccounts??[],isLoading:(e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"CheckingMigrationNeeded"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})||e.matches("MasterPasswordBasedAuthenticationDone"))&&!e.context.error,isAccountRecoveryAvailable:e.context.isAccountRecoveryAvailable,error:e.context.error?.data?.message,serviceProviderRedirectUrl:e.context.serviceProviderRedirectUrl,isNitroProvider:e.context.isNitroProvider??!1,isAuthenticationDone:t}),Pt=e=>{if(!e.context.login)throw new Error("No email login");return{step:"PinCodeStep",localAccounts:e.context.localAccounts??[],loginEmail:e.context.login,isLoading:e.matches({PinCode:"ValidatingPinCode"})&&!e.context.error,error:e.context.error?.code}},Ot=e=>({step:"StartingStep",localAccounts:e.context.localAccounts??[]});const Rt=e=>(0,pt.of)((0,h.Vp)(function(e){return e.matches("Starting")?Ot(e):e.matches("WaitingForEmail")||e.matches("ValidatingEmail")||e.matches("CheckPinCodeAvailableForMasterPassword")||e.matches("CheckPinCodeAvailableForPasswordless")?mt(e):e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?bt(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?wt(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?At(e):e.matches({WebAuthn:"InitWebAuthnAuthentication"})||e.matches({WebAuthn:"WebAuthnAuthenticationFailed"})||e.matches({WebAuthn:"WebAuthnAuthenticationValidated"})?Ct(e):e.matches("SSORedirectionToIdp")?It(e):e.matches({DeviceToDeviceAuthentication:"WaitingForTransferRequest"})?gt(e):e.matches({DeviceToDeviceAuthentication:"DisplayInstructions"})?vt(e):e.matches({DeviceToDeviceAuthentication:"GeneratePassphrase"})?yt(e):e.matches({DeviceToDeviceAuthentication:"StartTransfer"})?_t(e):e.matches({DeviceToDeviceAuthentication:"OpenSession"})?ft(e):e.matches({DeviceToDeviceAuthentication:"DeviceTransferError"})?St(e):e.matches({DeviceToDeviceAuthentication:"DeviceRegistered"})||e.matches("DeviceToDeviceAuthenticationDone")?Et(e):e.matches({PinCode:"WaitingForPinCode"})||e.matches({PinCode:"ValidatingPinCode"})||e.matches({PinCode:"PinCodeError"})?Pt(e):e.matches({MasterPassword:"CheckingAccountRecoveryStatus"})||e.matches({MasterPassword:"WaitingForMasterPassword"})||e.matches({MasterPassword:"ValidatingMasterPassword"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})||e.matches({MasterPassword:"CheckingMigrationNeeded"})||e.matches({MasterPassword:"OpeningSessionWithMasterpassword"})?Tt(e):e.matches("MasterPasswordBasedAuthenticationDone")?Tt(e,!0):void console.warn("[Auth] - No view associated to state ",JSON.stringify(e.value))}(e))),Dt=e=>e.pipe((0,ht.z)(Rt));var Nt=r(30045);let Ut=class{constructor(e,t){this.authenticationFlow=e,this.loginMachineStore=t}execute(){return(e=this.loginMachineStore,e.state$.pipe((0,f.U)((e=>e?v.ZM.create(JSON.parse(e)):void 0)))).pipe((0,Ae.h)(Boolean),(0,lt.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,Nt.Z)(e.context,t.context);return r&&s})(e,t))),Dt);var e}};Ut=(0,s.__decorate)([(0,dt.e)(ut.DW),(0,s.__metadata)("design:paramtypes",[De,E])],Ut);let Ft=class{constructor(e){this.ssoUserSettingsStore=e,this.ssoUserSettingsStore=e}execute(){return this.ssoUserSettingsStore.state$.pipe((0,f.U)((e=>(0,h.Vp)({rememberMeForSSOPreference:e.rememberMeForSSOPreference}))))}};Ft=(0,s.__decorate)([(0,dt.e)(ut.Dc),(0,s.__metadata)("design:paramtypes",[C])],Ft);let Mt=class{constructor(e){this.ssoProviderInfoStore=e,this.ssoProviderInfoStore=e}execute(){return this.ssoProviderInfoStore.state$.pipe((0,f.U)((e=>(0,h.Vp)({serviceProviderUrl:e.serviceProviderUrl,isNitroProvider:e.isNitroProvider,migrationType:e.migrationType}))))}};Mt=(0,s.__decorate)([(0,dt.e)(ut.L2),(0,s.__metadata)("design:paramtypes",[T])],Mt);const Lt=e=>!0;class xt extends((0,_.Q)({initialValue:void 0,persist:!1,scope:y.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:Lt})){}var kt=r(3786);let Gt=class{constructor(e){this.authenticationFlow=e}execute(e){const{pinCode:t}=e.body;return this.authenticationFlow.continue({type:"INPUT_PIN_CODE",pinCode:t}),Promise.resolve((0,h.Vp)(void 0))}};Gt=(0,s.__decorate)([(0,P.W)(O.CO),(0,s.__metadata)("design:paramtypes",[De])],Gt);let Vt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"USE_MASTER_PASSWORD"}),Promise.resolve((0,h.Vp)(void 0))}};Vt=(0,s.__decorate)([(0,P.W)(O.On),(0,s.__metadata)("design:paramtypes",[De])],Vt);let Kt=class{constructor(e){this.authenticationFlow=e}execute(){return this.authenticationFlow.continue({type:"SWITCH_TO_PIN_CODE"}),Promise.resolve((0,h.Vp)(void 0))}};Kt=(0,s.__decorate)([(0,P.W)(O.WF),(0,s.__metadata)("design:paramtypes",[De])],Kt);let jt=class{};jt=(0,s.__decorate)([(0,c.Y)({api:a.V,handlers:{commands:{changeLogin:Ne,changeTwoFactorAuthenticationOtpType:Ue,clearError:Fe,cancelDeviceTransferRequest:Me,resendEmailToken:Le,resendPushNotification:xe,sendAccountEmail:ke,sendMasterPassword:Ge,submitBackupCode:Ve,submitEmailToken:Ke,submitTotp:je,submitPinCode:Gt,switchToMasterPassword:Vt,switchToDashlaneAuthenticator:Be,switchToEmailToken:We,switchToDevicetoDeviceAuthentication:ze,switchToPinCode:Kt,retryWebAuthnAuthentication:He,webAuthnAuthenticationFail:Qe,logout:Ye,lockSession:$e,loginViaSSO:Xe,initiateLoginWithSSO:rt,initiateAutologinWithSSO:at},events:{...(0,c.g)(o.W,{carbonLegacy:ct})},queries:{authenticationFlowStatus:Ut,getSsoUserSettings:Ft,getProviderInfo:Mt}},configurations:{authenticationFlowContextInfrastructure:{token:tt}},providers:[ee,ie,re,ae,X,ne,_e,...(0,l.H)(De,{inject:[Re,E,n._,u.c,d.J],asyncFactory:async(e,t,r,s,a)=>{let o=!1;const n=await(0,i.z)(s.queries.platformInfo());!(0,h.d6)(n)||n.data.buildType!==p.P.DEV&&n.data.buildType!==p.P.NIGHTLY||(o=!0);const c=new De(e,t,o,r,a);return await c.prepare(),c}}),Re,we,be,Ce,Ie,B,Y,J,te,j,oe,Pe,Z,Te,Oe,ue,$,he,ye,me,ge,pe.q,de.C,ve.Kp,ve.Ny],stores:[E,xt,C,T],imports:[m.n,g.i,kt.I]})],jt)},10430:(e,t,r)=>{r.d(t,{z:()=>s});class s extends Error{constructor(e,t){super(e),this.code=t}}},59550:(e,t,r)=>{r.d(t,{Q:()=>v});var s=r(88802),i=r(60399),a=r(87065),o=r(86252),n=r(28489),c=r(87279),l=r(57924);function d(e){const t=e.split("-");if(t.length>0){const[r]=t;return{accessKey:r,secretKey:e}}throw new Error("Invalid UKI format")}function u(e){return!!(e&&"object"==typeof e&&(0,n.l$)(e,"accessKey")&&(0,n.l$)(e,"secretKey"))&&("string"==typeof e.accessKey&&"string"==typeof e.secretKey)}function p(e){return"string"==typeof e}const h="authentication.currentUser.deviceKeys",m="userSession.localSettings.uki",g="userSession.account.login";let v=class{constructor(e){this.carbonLegacyClient=e}getDeviceCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.carbonLegacyClient;return(0,i.z)(t({paths:[h,m,g]}).pipe((0,a.U)((e=>{if((0,c.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,c.db)(e)})),(0,a.U)(this.carbonStateToRequestUserDeviceCredentials(e))))}getSessionCredentialsForUser(e){const{queries:{carbonStateList:t}}=this.carbonLegacyClient;return(0,i.z)(t({paths:[h,m,g,"userSession.session.sessionKeys"]}).pipe((0,a.U)((e=>{if((0,c.hx)(e))throw new Error("Failed to get credentials from carbon");return(0,c.db)(e)})),(0,a.U)(this.carbonStateToRequestUserSessionCredentials(e))))}carbonStateToRequestUserDeviceCredentials(e){return([t,r,s])=>{if(!t&&!r||s!==e)throw new Error("No user device credentials available for active user");let i;if(r){if(!p(r))throw new Error("Unexpected UKI state shape received from carbon");i=d(r)}else{if(!u(t))throw new Error("Unexpected user device state shape received from carbon");i=t}return{login:e,deviceAccessKey:i.accessKey,deviceSecretKey:i.secretKey}}}carbonStateToRequestUserSessionCredentials(e){return([t,r,s,i])=>{if(!t&&!r||s!==e)throw new Error("No user device credentials available for active user");if(!i)throw new Error("No session credentials available for active user");let a;if(r){if(!p(r))throw new Error("Unexpected UKI state shape received from carbon");a=d(r)}else{if(!u(t))throw new Error("Unexpected user device state shape received from carbon");a=t}if(!((o=i)&&"object"==typeof o&&"accessKey"in o&&"secretKey"in o&&"expirationTimeSeconds"in o&&"string"==typeof o.accessKey&&"string"==typeof o.secretKey&&"number"==typeof o.expirationTimeSeconds))throw new Error("Unexpected session keys state shape received from carbon");var o;return{login:e,deviceAccessKey:a.accessKey,sessionAccessKey:i.accessKey,sessionSecretKey:i.secretKey}}}};v=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],v)},13460:(e,t,r)=>{r.d(t,{R:()=>g});var s=r(88802),i=r(99634),a=r(59550),o=r(66974),n=r(85373),c=r(42303),l=r(86252),d=r(20754),u=r(87279),p=r(85390),h=r(87065);let m=class{constructor(e,t){this.carbon=e,this.pinCode=t}execute(){const e=this.carbon.queries.liveWebAuthnAuthenticationOptedIn(void 0),t=this.pinCode.queries.getCurrentUserStatus();return(0,p.a)({webAuthnQuery:e,pinCodeQuery:t}).pipe((0,h.U)((({pinCodeQuery:e,webAuthnQuery:t})=>{if((0,u.hx)(e)||(0,u.hx)(t))throw new Error("failed to query");return(0,u.Vp)(e.data.isPinCodeEnabled||t.data)})))}};m=(0,s.__decorate)([(0,d.e)(n._),(0,s.__metadata)("design:paramtypes",[l._,c.u])],m);let g=class{};g=(0,s.__decorate)([(0,i.Y)({api:o.n,handlers:{commands:{},events:{},queries:{canLockApp:m}},providers:[a.Q],exports:[a.Q]})],g)},38487:(e,t,r)=>{r.d(t,{_:()=>M});var s=r(88802),i=r(99634),a=r(42853),o=r(162),n=r(87065),c=r(20754),l=r(87279),d=r(59463),u=r(86252);let p=class{constructor(e){this.carbon=e}isLocalAccounts(e){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"object"==typeof t&&"login"in t}isCarbonLocalAccountResult(e){return!(!e||"object"!=typeof e||!("localAccounts"in e))&&this.isLocalAccounts(e.localAccounts)}execute(){return(0,o.D)(this.carbon.commands.carbonLegacyLeeloo({name:"getLocalAccountsList",arg:[]})).pipe((0,n.U)((e=>{if((0,l.hx)(e))throw new Error("Unable to retrieve local accounts list");const t=(0,l.db)(e).carbonResult;if(!this.isCarbonLocalAccountResult(t))throw new Error("Carbon result is not of type local accounts");return(0,l.Vp)({localAccounts:t.localAccounts})})))}};p=(0,s.__decorate)([(0,c.e)(d.a),(0,s.__metadata)("design:paramtypes",[u._])],p);var h=r(63663),m=r(319);let g=class{constructor(e){this.carbon=e}async execute(){const e=await this.carbon.commands.cleanRemotelyRemovedProfiles();if((0,l.hx)(e))throw new Error("clean remotely removed profiles failed");return(0,l.Vp)(void 0)}};g=(0,s.__decorate)([(0,h.W)(m.L),(0,s.__metadata)("design:paramtypes",[u._])],g);var v=r(96782),y=r(18533),_=r(95087),f=r(60399),S=r(22450),E=r(57924),b=r(87113),w=r(63281),A=r(96168);const C="ZZ";const I="und";function T(e){return e?e.replace(/https?:\/\//g," "):e}var P=r(10551);class O extends((0,A.Hu)("InvalidToken","")){}let R=class{constructor(e,t,r){this.serverApiClient=e,this.carbon=t,this.contextless=r}async hasRegisteredDevice(e){const t=await(0,f.z)(this.carbon.queries.getLocalAccounts());if((0,l.hx)(t))throw new Error("Failed to query carbon");return t.data.some((t=>t.login===e))}async registerDeviceWithToken(e,t,r){const s=await(0,f.z)(this.serverApiClient.v1.authentication.performExtraDeviceVerification({login:e,token:t}));if(!(0,l.d6)(s))return(0,l.Rn)(new O);const{authTicket:i}=s.data.data;return this.registerDeviceWithTicket(e,i,r)}async registerDeviceWithTicket(e,t,r){const s=await(0,f.z)(this.carbon.queries.getPlatformInfo());if(!(0,l.d6)(s))throw new Error("Failed to get status from carbon");const i=s.data;if("server_carbon_unknown"===i.platformName)throw new Error("unexpected server_carbon_unknown");const a={deviceName:T(r??P.getDefaultDeviceName()),appVersion:i.appVersion,platform:i.platformName,osCountry:(n=i.country,!n||n.length<2||n.length>5?C:n),osLanguage:(o=i.lang,!o||o.length<2||o.length>5?I:o),temporary:!1};var o,n;const c=await(0,f.z)(this.serverApiClient.v1.authentication.completeDeviceRegistrationWithAuthTicket({authTicket:t,login:e,device:a}));if(!(0,l.d6)(c))throw new Error("Failed to register on server");const{deviceAccessKey:d,deviceSecretKey:u,settings:p,serverKey:h}=c.data.data;return await this.registerDeviceWithKeys({deviceAccessKey:d,deviceSecretKey:u,login:e,settingsContent:p.content,serverKey:h})}async registerDeviceWithKeys({deviceAccessKey:e,deviceSecretKey:t,settingsContent:r,serverKey:s,login:i}){const a=await(0,f.z)(this.contextless.v1.account.accountInfo({deviceAccessKey:e,deviceSecretKey:t,login:i}));if(!(0,l.d6)(a))throw new Error("");const{creationDateUnix:o,publicUserId:n,deviceAnalyticsId:c,userAnalyticsId:d}=a.data.data,u=await this.carbon.commands.registerDevice({deviceAccessKey:e,deviceAnalyticsId:c??"",deviceSecretKey:t,settings:{action:"BACKUP_EDIT",backupDate:o,content:r,identifier:"SETTINGS_userId",time:o,type:"SETTINGS"},serverKey:s,publicUserId:n,userAnalyticsId:d??"",isDataPersisted:S.jP.PERSIST_DATA_YES,login:i});if((0,l.hx)(u))throw new Error("Failed to register in carbon");return(0,l.Vp)(void 0)}};R=(0,s.__decorate)([(0,E.GS)(),(0,s.__metadata)("design:paramtypes",[b.l,u._,w.B])],R);const D={tag:"DeviceAlreadyRegistered"},N={tag:"InvalidTokenError"};let U=class{constructor(e){this.service=e}async execute({body:e}){const{login:t,ignoreAlreadyRegisteredError:r,deviceName:s}=e;if(!r){if(await this.service.hasRegisteredDevice(t))return(0,l.Rn)(D)}switch(e.with){case"authTicket":return this.service.registerDeviceWithTicket(t,e.authTicket,s);case"token":return(0,y.EQ)(await this.service.registerDeviceWithToken(t,e.token,s),{success:()=>(0,l.Vp)(void 0),failure:e=>(0,y.EQ)(e.error,{InvalidToken:()=>(0,l.Rn)(N)})});case"deviceKeys":return await this.service.registerDeviceWithKeys({deviceAccessKey:e.deviceAccessKey,deviceSecretKey:e.deviceSecretKey,login:t,settingsContent:e.settings,serverKey:e.serverKey});default:return(0,_.U)(e)}}};U=(0,s.__decorate)([(0,h.W)(v.J),(0,s.__metadata)("design:paramtypes",[R])],U);var F=r(93850);let M=class{};M=(0,s.__decorate)([(0,i.Y)({api:a.G,imports:[F.n],handlers:{commands:{cleanRemotelyRemovedProfiles:g,registerDevice:U},events:{},queries:{localAccounts:p}},providers:[R]})],M)},65871:(e,t,r)=>{r.d(t,{E:()=>n,V:()=>c});var s=r(88802),i=r(56695),a=r.n(i),o=r(57924);let n=class{constructor(e){this.sodium=e}generateNonce(){return this.sodium.randombytes_buf(this.sodium.crypto_box_NONCEBYTES)}generateKeyPair(){return this.sodium.crypto_kx_keypair()}hash(e,t){return this.sodium.crypto_generichash(this.sodium.crypto_secretbox_KEYBYTES,e,t)}compare(e,t){return this.sodium.memcmp(e,t)}generateClientSharedSecret(e,t,r){return this.sodium.crypto_kx_client_session_keys(e,t,r)}generateServerSharedSecret(e,t,r){return this.sodium.crypto_kx_server_session_keys(e,t,r)}encrypt(e,t,r){return this.sodium.crypto_secretbox_easy(e,t,r)}decrypt(e,t,r){return this.sodium.crypto_secretbox_open_easy(e,t,r)}};function c(){return{token:n,asyncFactory:async()=>{await a().ready;const e=a();return new n(e)}}}n=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[Object])],n)},46484:(e,t,r)=>{r.d(t,{KF:()=>i,dJ:()=>a});var s=r(15187);const i=3;class a extends s.x{constructor(e,t){super(e),this.code=t}}},3786:(e,t,r)=>{r.d(t,{I:()=>oe});var s=r(88802),i=r(6218),a=r(99634),o=r(38679),n=r(93850),c=r(65871),l=r(8362),d=r(87065),u=r(25029),p=r(95681);const h=e=>!0;class m extends((0,p.Q)({initialValue:void 0,persist:!1,scope:u.F.Device,storeName:"trusted-device-flow-machine",storeTypeGuard:h})){}const g=e=>e.state$.pipe((0,d.U)((e=>e?l.ZM.create(JSON.parse(e)):void 0)));var v=r(78065),y=r(24966),_=r(57924),f=r(18275),S=r(65865),E=r(70486),b=r(46484),w=r(87279),A=r(16053);let C=class{constructor(e){this.d2dAuthenticationService=e}async execute(){const e=await this.d2dAuthenticationService.getKeyExchangeTransferInfo();if((0,w.hx)(e))throw new Error("Error with getKeyExchangeTransferInfo");const{transferId:t,receiver:r}=e.data.transfer;return Promise.resolve({transferId:t,requestTimestamp:r.requestedAtDateUnix,untrustedDeviceName:r.deviceName,untrustedDeviceLocation:`${r.city}, ${r.countryCode}`,untrustedDeviceHashedPublicKey:r.hashedPublicKey})}};C=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[A.C])],C);var I=r(15652),T=r(69605);let P=class{constructor(e,t,r){this.d2dCryptoService=e,this.d2dAuthenticationService=t,this.passphraseService=r}async execute(e){const{privateKey:t,publicKey:r}=this.d2dCryptoService.generateKeyPair();if(!e.transferId)throw new Error("No transferId in context");const s=await this.d2dAuthenticationService.startSenderKeyExchange(e.transferId,r);if((0,w.hx)(s))return Promise.reject(s.error);const{receiverPublicKey:i}=s.data,a=e.untrustedDeviceHashedPublicKey;if(!this.d2dCryptoService.verifyUntrustedDevicePublicKey(a,i))throw new Error("Receiver public key doesn't match");const o=this.d2dCryptoService.generateSenderSharedSecret(r,t,i),n=await this.d2dAuthenticationService.getCurrentUserLogin();if((0,w.hx)(n)||!n.data)throw new Error("No user login in context");const c=this.d2dCryptoService.generateVisualCheckSeed(n.data,e.transferId,o),{passphrase:l,missingWordIndex:d}=await this.passphraseService.generatePassphraseChallenge(c);return{sharedSecret:o,passphrase:l,passhraseMissingWordIndex:d}}};P=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[I.q,A.C,T.Kp])],P);let O=class{constructor(e,t,r){this.passphraseService=e,this.d2dCryptoService=t,this.d2dAuthenticationService=r}async execute(e){if(!this.passphraseService.verifyChallenge(e.passphrase,e.passphraseGuess))throw new b.dJ("Passphrase incorrect",e.passphraseAttemptsLeft>1?E.S.INVALID_PASSPHRASE:E.S.PASSPHRASE_ATTEMPTS_LIMIT);const t=await this.d2dAuthenticationService.getCurrentUserLogin();if((0,w.hx)(t)||!t.data||!e.transferId)throw new Error("No user login or no transferId");const r=await this.d2dAuthenticationService.getUserInvisibleMasterPassword(),s=await this.d2dAuthenticationService.requestAuthTicket();if((0,w.hx)(s))throw new Error("Couldn't get authTicket");const{encryptedData:i,nonce:a}=this.d2dCryptoService.encryptInvisibleMasterPassword(t.data,s.data,r,e.transferId,e.sharedSecret),o=await this.d2dAuthenticationService.completeTransfer(i,a,e.transferId);return(0,w.hx)(o)?Promise.reject(o.error):Promise.resolve()}};O=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[T.Kp,I.q,A.C])],O);let R=class{constructor(e,t,r){this.getPendingDeviceTransferRequestService=e,this.approveDeviceTransferRequestService=t,this.verifyPassphraseChallengeService=r}create(){return(0,f.C)({predictableActionArguments:!0,schema:{events:{},context:{}},initial:"WaitingForNewDeviceTransferRequest",id:"TrustedDeviceFlowMachine",context:{transferId:void 0,untrustedDeviceName:"",untrustedDeviceHashedPublicKey:"",untrustedDeviceLocation:"",sharedSecret:"",passphrase:"",passphraseGuess:"",passphraseMissingWordIndex:-1,passphraseAttemptsLeft:b.KF},states:{Idle:{on:{REFRESH_REQUEST:{target:"WaitingForNewDeviceTransferRequest"}}},WaitingForNewDeviceTransferRequest:{invoke:{src:"getPendingDeviceTransferRequest",onDone:[{actions:["assignUntrustedDeviceData"],cond:"isDeviceTransferRequestAvailable",target:"NewDeviceTransferRequest"},{target:"Idle"}],onError:{actions:["assignTrustedDeviceFlowError"],target:"Idle"}}},NewDeviceTransferRequest:{on:{APPROVE_REQUEST:{target:"HandlingDeviceTransferRequest"},REJECT_REQUEST:{actions:["clearContext"],target:"DeviceTransferRejected"},RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}},HandlingDeviceTransferRequest:{invoke:{src:"approveDeviceTransferRequest",onDone:{actions:["assignPassphraseChallengeData"],target:"DisplayPassphraseChallenge"},onError:{actions:["assignTrustedDeviceFlowError"],target:"DeviceTransferFailed"}}},DisplayPassphraseChallenge:{on:{SUBMIT_PASSPHRASE_CHALLENGE:{actions:["assignPassphraseGuess","clearError"],target:"VerifyingPassphraseChallenge"},CANCEL_REQUEST:{actions:["clearContext"],target:"Idle"}}},VerifyingPassphraseChallenge:{invoke:{src:"verifyPassphraseChallenge",onDone:{target:"DeviceTransferComplete"},onError:[{actions:["assignTrustedDeviceFlowError","updatePassphraseAttempts"],target:"DisplayPassphraseChallenge",cond:"isInvalidPassphraseError"},{actions:["assignTrustedDeviceFlowError","updatePassphraseAttempts"],target:"DeviceTransferFailed"}]}},DeviceTransferComplete:{on:{RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}},DeviceTransferRejected:{on:{RETURN_TO_DEVICE_SETUP:{target:"Idle"}}},DeviceTransferFailed:{on:{RETURN_TO_DEVICE_SETUP:{actions:["clearContext"],target:"Idle"}}}}},{actions:{assignUntrustedDeviceData:(0,S.f0)({transferId:(e,t)=>t.data.transferId,untrustedDeviceName:(e,t)=>t.data.untrustedDeviceName,untrustedDeviceHashedPublicKey:(e,t)=>t.data.untrustedDeviceHashedPublicKey,untrustedDeviceLocation:(e,t)=>t.data.untrustedDeviceLocation,requestTimestamp:(e,t)=>t.data.requestTimestamp}),clearContext:(0,S.f0)({transferId:()=>{},untrustedDeviceName:()=>"",untrustedDeviceHashedPublicKey:()=>"",untrustedDeviceLocation:()=>"",sharedSecret:()=>"",passphrase:()=>"",passphraseGuess:()=>"",passphraseMissingWordIndex:()=>-1,passphraseAttemptsLeft:()=>b.KF,error:()=>{}}),clearError:(0,S.f0)({error:()=>{}}),assignTrustedDeviceFlowError:(0,S.f0)({error:(e,t)=>t.data instanceof b.dJ?t.data.code:E.S.GENERIC_ERROR}),assignPassphraseChallengeData:(0,S.f0)({sharedSecret:(e,t)=>t.data.sharedSecret,passphrase:(e,t)=>t.data.passphrase,passphraseMissingWordIndex:(e,t)=>t.data.passhraseMissingWordIndex}),assignPassphraseGuess:(0,S.f0)({passphraseGuess:(e,t)=>t.passphraseChallenge}),updatePassphraseAttempts:(0,S.f0)({passphraseAttemptsLeft:(e,t)=>t.data instanceof b.dJ&&t.data.code===E.S.INVALID_PASSPHRASE?e.passphraseAttemptsLeft-1:e.passphraseAttemptsLeft})},services:{getPendingDeviceTransferRequest:()=>this.getPendingDeviceTransferRequestService.execute(),approveDeviceTransferRequest:e=>this.approveDeviceTransferRequestService.execute(e),verifyPassphraseChallenge:e=>this.verifyPassphraseChallengeService.execute(e)},guards:{isDeviceTransferRequestAvailable:(e,t)=>!!t.data.transferId,isInvalidPassphraseError:(e,t)=>t.data instanceof b.dJ&&"INVALID_PASSPHRASE"===t.data.code}})}};R=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[C,P,O])],R);let D=class{constructor(e,t){this.trustedDeviceMachineStore=t;const r=e.create();this.interpreter=v.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[D2D Trusted Device Flow] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.trustedDeviceMachineStore,e)}catch(e){console.warn("[D2D Trusted Device Flow] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?l.ZM.create(JSON.parse(t)):void 0})(this.trustedDeviceMachineStore);try{this.interpreter.start(e)}catch(e){console.error("[D2D Trusted Device Flow] Unable to reuse the stored state: ",e),this.interpreter.start()}}catch(e){console.error("[D2D Trusted Device Flow] Unable to start machine",e)}}ready(){return new y.X(!0)}continue(e){if(!this.interpreter)throw new Error("TrustedDevice flow not started");this.interpreter.send(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};D=(0,s.__decorate)([(0,_.GS)(),(0,s.__metadata)("design:paramtypes",[R,m])],D);var N=r(43978),U=r(90171),F=r(83695),M=r(85390),L=r(30523),x=r(6136),k=r(30045),G=r(20754),V=r(53835),K=r(69885),j=r(6220),B=r(69126);const W=e=>(0,K.of)((0,w.Vp)(function(e){if(e.matches("Idle")||e.matches("WaitingForNewDeviceTransferRequest"))return{step:E.T.WaitingForNewDeviceRequest};if(e.matches("NewDeviceTransferRequest"))return(0,B.Xn)(e.context.requestTimestamp)<=0?{step:E.T.Error,errorCode:E.S.TIMEOUT}:{step:E.T.NewDeviceRequestAvailable,untrustedDeviceName:e.context.untrustedDeviceName,untrustedDeviceLocation:e.context.untrustedDeviceLocation,requestTimestamp:e.context.requestTimestamp};if(e.matches("HandlingDeviceTransferRequest"))return{step:E.T.LoadingChallenge};if(e.matches("DisplayPassphraseChallenge")||e.matches("VerifyingPassphraseChallenge")){const{passphrase:t,passphraseMissingWordIndex:r,untrustedDeviceName:s,error:i}=e.context,a=t.split(T.iy).map(((e,t)=>t===r?"":e));return{step:E.T.DisplayPassphraseChallenge,untrustedDeviceName:s,passphrase:a,error:i}}if(e.matches("DeviceTransferComplete"))return{step:E.T.DeviceTransferComplete,untrustedDeviceName:e.context.untrustedDeviceName};if(e.matches("DeviceTransferRejected"))return{step:E.T.DeviceTransferRejected,untrustedDeviceName:e.context.untrustedDeviceName};if(e.matches("DeviceTransferFailed"))return{step:E.T.Error,errorCode:e.context.error};throw new Error("[D2D Trusted Device] - No view associated to state")}(e))),z=e=>e.pipe((0,j.z)(W));let H=class{constructor(e,t){this.trustedDeviceFlow=e,this.trustedDeviceFlowMachineStore=t}execute(){const e=g(this.trustedDeviceFlowMachineStore).pipe((0,L.h)(Boolean),(0,d.U)((e=>e.context.requestTimestamp?(0,B.Xn)(e.context.requestTimestamp):0))).pipe((0,N.w)((e=>(0,U.H)(e))),(0,F.O)(0));return(0,M.a)([g(this.trustedDeviceFlowMachineStore),this.trustedDeviceFlow.ready(),e],((e,t,r)=>{if(e&&t)return e})).pipe((0,L.h)(Boolean),z,(0,x.x)(((e,t)=>(0,k.Z)(e,t))))}};H=(0,s.__decorate)([(0,G.e)(V.N),(0,s.__metadata)("design:paramtypes",[D,m])],H);var Q=r(63663),q=r(87041);let Y=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"APPROVE_REQUEST"}),Promise.resolve((0,w.Vp)(void 0))}};Y=(0,s.__decorate)([(0,Q.W)(q.G),(0,s.__metadata)("design:paramtypes",[D])],Y);var $=r(33969);let X=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"REFRESH_REQUEST"}),Promise.resolve((0,w.Vp)(void 0))}};X=(0,s.__decorate)([(0,Q.W)($.V),(0,s.__metadata)("design:paramtypes",[D])],X);var Z=r(55870);let J=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"REJECT_REQUEST"}),Promise.resolve((0,w.Vp)(void 0))}};J=(0,s.__decorate)([(0,Q.W)(Z.a),(0,s.__metadata)("design:paramtypes",[D])],J);var ee=r(97891);let te=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"CANCEL_REQUEST"}),Promise.resolve((0,w.Vp)(void 0))}};te=(0,s.__decorate)([(0,Q.W)(ee.b),(0,s.__metadata)("design:paramtypes",[D])],te);var re=r(48214);let se=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(e){const{passphraseChallenge:t}=e.body;return this.trustedDeviceFlow.continue({type:"SUBMIT_PASSPHRASE_CHALLENGE",passphraseChallenge:t}),Promise.resolve((0,w.Vp)(void 0))}};se=(0,s.__decorate)([(0,Q.W)(re.I),(0,s.__metadata)("design:paramtypes",[D])],se);var ie=r(81540);let ae=class{constructor(e){this.trustedDeviceFlow=e,this.trustedDeviceFlow=e}execute(){return this.trustedDeviceFlow.continue({type:"RETURN_TO_DEVICE_SETUP"}),Promise.resolve((0,w.Vp)(void 0))}};ae=(0,s.__decorate)([(0,Q.W)(ie.n),(0,s.__metadata)("design:paramtypes",[D])],ae);let oe=class{};oe=(0,s.__decorate)([(0,a.Y)({api:i.F,stores:[m],imports:[n.n],exports:[I.q,c.E],providers:[(0,c.V)(),...(0,o.H)(D,{inject:[R,m],asyncFactory:async(e,t)=>{const r=new D(e,t);return await r.prepare(),r}}),c.E,T.Kp,I.q,A.C,C,P,O,R,T.Ny],handlers:{commands:{approveRequest:Y,refreshRequest:X,rejectRequest:J,cancelRequest:te,submitPassphraseChallenge:se,returnToDeviceSetup:ae},events:{},queries:{trustedDeviceFlowStatus:H}}})],oe)},16053:(e,t,r)=>{r.d(t,{C:()=>E});var s=r(88802),i=r(60399),a=r(10551),o=r(22450),n=r(86252),c=r(87113),l=r(25994),d=r(57924),u=r(48844),p=r(87279),h=r(18533),m=r(20195),g=r(89358),v=r(64496),y=r(70486),_=r(69126),f=r(10430),S=r(46484);let E=class{constructor(e,t,r){this.serverApiClient=e,this.sessionClient=t,this.carbon=r}async getCurrentUserLogin(){return await(0,i.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,u.DZ)((()=>(0,p.Rn)(new Error("No user login found")))),(0,u.lk)((e=>(0,p.Vp)(e)))))}getUserInvisibleMasterPassword(){const{carbonState:e}=this.carbon.queries;return(0,i.z)(e({path:"userSession.session.masterPassword"}).pipe((0,u.nb)({success:e=>e,failure:()=>{throw new Error("Failure getting user invisible master password info")}})))}async requestAuthTicket(){return await(0,i.z)(this.serverApiClient.v1.authentication.requestExtraDeviceRegistration({tokenType:"googleAccountNewDevice"}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data.token)))))}async getKeyExchangeTransferInfo(){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.getKeyExchangeTransferInfo({}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startReceiverKeyExchange(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.startReceiverKeyExchange({transferId:e,receiverHashedPublicKey:t},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:m.j,FetchFailedError:()=>{throw new f.z("User offline or request timeout",v.UY.TIMEOUT)},UnspecifiedBadStatus:({response:t})=>{if(t.status===l.W.GatewayTimeout)return new f.z("Request has timed out",v.UY.TIMEOUT);(0,m.j)(e)},InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async completeKeyExchange(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.completeKeyExchange({receiverPublicKey:t,transferId:e}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>(0,p.Rn)(e),FetchFailedError:()=>(0,p.Rn)(e),UnspecifiedBadStatus:()=>(0,p.Rn)(e),InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startTransfer(e){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.startTransfer({transferId:e,transferType:"universal"},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:m.j,FetchFailedError:m.j,UnspecifiedBadStatus:({response:t})=>t.status===l.W.GatewayTimeout?new f.z("Request has timed out",v.UY.TIMEOUT):(0,m.j)(e),InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async requestTransfer(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.requestTransfer({transfer:{login:e,receiverDeviceName:t,transferType:"universal"}}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:()=>{throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async startSenderKeyExchange(e,t){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.startSenderKeyExchange({transferId:e,senderPublicKey:t},{timeout:6e4}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>{if("TRANSFER_DOES_NOT_EXISTS"===e.code)throw new S.dJ("Transfer request has expired",y.S.TIMEOUT);throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:({response:e})=>{if(e.status===l.W.GatewayTimeout)return new S.dJ("Request has timed out",y.S.TIMEOUT);throw new Error("[D2D]: Bad status error")},InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async completeTransfer(e,t,r){return await(0,i.z)(this.serverApiClient.v1.secretTransfer.completeTransfer({transfer:{encryptedData:e,nonce:t,transferId:r,transferType:"universal"}}).pipe((0,u.DZ)((e=>(0,h.EQ)(e,{BusinessError:e=>{if("TRANSFER_DOES_NOT_EXISTS"===e.error.code)return new S.dJ("Request timed out",y.S.TIMEOUT);throw new Error("[D2D]: Business Error")},FetchFailedError:()=>{throw new Error("[D2D]: Network error")},UnspecifiedBadStatus:m.j,InternalServerError:m.j,InvalidRequest:m.j,RateLimited:m.j,ServiceUnavailable:m.j}))),(0,u.lk)((e=>(0,p.Vp)(e.data)))))}async openSession(e,t,r,s){const n=await(0,i.z)(this.serverApiClient.v1.authentication.performExtraDeviceVerification({login:e,token:t}));if(!(0,p.d6)(n))throw new f.z("Perform extra device verification failed",v.UY.ACCOUNT_ERROR);const{authTicket:c}=n.data.data,l=await(0,i.z)(this.carbon.queries.getPlatformInfo());if(!(0,p.d6)(l))throw new f.z("No platform info available",v.UY.ACCOUNT_ERROR);const d=l.data,u={deviceName:(0,_.$f)(s||a.getDefaultDeviceName()),appVersion:d.appVersion,platform:d.platformName,osCountry:(0,_.Yb)(d.country),osLanguage:(0,_._$)(d.lang),temporary:!1},h=await(0,i.z)(this.serverApiClient.v1.authentication.completeDeviceRegistrationWithAuthTicket({authTicket:c,login:e,device:u}));if(!(0,p.d6)(h))throw new f.z("Device registration with authTicket failed",v.UY.ACCOUNT_ERROR);const{deviceAccessKey:m,deviceAnalyticsId:g,deviceSecretKey:y,settings:S,serverKey:E,publicUserId:b,userAnalyticsId:w}=h.data.data;await this.carbon.commands.registerDevice({deviceAccessKey:m,deviceAnalyticsId:g,deviceSecretKey:y,settings:S,serverKey:E,publicUserId:b,userAnalyticsId:w,isDataPersisted:o.jP.PERSIST_DATA_YES,login:e});const A=await this.carbon.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e,password:r,rememberPassword:!0,requiredPermissions:void 0,serverKey:"",loginType:"DeviceToDevice"}]});if(!(0,p.d6)(A))throw new f.z("Open session with deciphered password failed",v.UY.ACCOUNT_ERROR)}};E=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[c.l,g.x,n._])],E)},15652:(e,t,r)=>{r.d(t,{q:()=>c});var s=r(88802),i=r(10370),a=r(57924),o=r(65871),n=r(69126);let c=class{constructor(e){this.cryptoToolboxService=e}verifyUntrustedDevicePublicKey(e,t){return this.cryptoToolboxService.compare((0,n.tp)(e),(0,n.tp)(this.hash(t)))}generateReceiverSharedSecret(e,t,r){return(0,i.s)(this.cryptoToolboxService.generateClientSharedSecret((0,n.tp)(e),(0,n.tp)(t),(0,n.tp)(r)).sharedRx)}generateSenderSharedSecret(e,t,r){return(0,i.s)(this.cryptoToolboxService.generateServerSharedSecret((0,n.tp)(e),(0,n.tp)(t),(0,n.tp)(r)).sharedTx)}generateSymmetricKey(e,t,r){return(0,i.s)(this.cryptoToolboxService.hash((new TextEncoder).encode(`DASHLANE_D2D_SYMMETRIC_KEY${e.length}${e}${t}`),(0,n.tp)(r)))}hash(e){return(0,i.s)(this.cryptoToolboxService.hash((0,n.tp)(e)))}generateKeyPair(){const e=this.cryptoToolboxService.generateKeyPair();return{publicKey:(0,i.s)(e.publicKey),privateKey:(0,i.s)(e.privateKey)}}generateVisualCheckSeed(e,t,r){return(0,i.s)(this.cryptoToolboxService.hash((new TextEncoder).encode(`DASHLANE_D2D_SAS_SEED${e.length}${e}${t}`),(0,n.tp)(r)))}encryptInvisibleMasterPassword(e,t,r,s,a){const o=(e=>(new TextEncoder).encode(JSON.stringify(e)))({login:e,key:{type:"invisible_master_password",value:r},token:t,version:1}),c=this.generateSymmetricKey(e,s,a),l=this.cryptoToolboxService.generateNonce(),d=this.cryptoToolboxService.encrypt(o,l,(0,n.tp)(c));return{encryptedData:(0,i.s)(d),nonce:(0,i.s)(l)}}decryptInvisibleMasterPassword(e,t,r){const s=this.cryptoToolboxService.decrypt((0,n.tp)(e),(0,n.tp)(t),(0,n.tp)(r)),i=new TextDecoder("utf-8").decode(s);return JSON.parse(i)}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o.E])],c)},69605:(e,t,r)=>{r.d(t,{Kp:()=>u,Ny:()=>d,iy:()=>c});var s=r(88802),i=r(67978),a=r(57924),o=r(75994),n=r(69126);const c=" ",l=Math.pow(2,32)-1;let d=class extends i.K{constructor(e){super("assets/eff_large_wordlist.json",e)}loadResource(e){if(!e||!Array.isArray(e))throw new Error("Failed to load word list");return e}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o.X])],d);let u=class{constructor(e){this.fetcher=e}getWordList(){return this.fetcher.get()}async generatePassphraseChallenge(e){const t=await this.getWordList(),r=[],s=Math.floor(l/t.length)*t.length;for(let i=0;i<e.length;i+=4){const{buffer:a,byteOffset:o}=new Uint8Array((0,n.tp)(e).slice(i,i+4)),c=new DataView(a).getUint32(o,!0);if(c<s){const e=t[c%t.length];r.push(e)}if(5===r.length)break}return{passphrase:r.join(c),missingWordIndex:Math.floor(5*Math.random())}}verifyChallenge(e,t){if(!e)throw new Error("[DEVICE-TRANSFER]: Passphrase challenge not generated yet");if(!t)throw new Error("[DEVICE-TRANSFER]: Passphrase guess not saved to machine context");return e===t}};u=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[d])],u)},69126:(e,t,r)=>{r.d(t,{$f:()=>d,Xn:()=>i,Yb:()=>n,_$:()=>l,tp:()=>a});var s=r(66122);const i=e=>1e3*e+6e4-Date.now(),a=e=>new Uint8Array((0,s.R)(e)),o="ZZ";function n(e){return!e||e.length<2||e.length>5?o:e}const c="und";function l(e){return!e||e.length<2||e.length>5?c:e}function d(e){return e?e.replace(/https?:\/\//g," "):e}},99600:(e,t,r)=>{r.d(t,{f:()=>Re});var s,i,a,o,n,c=r(88802),l=r(99634),d=r(38679),u=r(93850),p=r(11433),h=r(57924),m=r(65865),g=r(18275),v=r(87279),y=r(60399),_=r(87113),f=r(48844),S=r(18533),E=r(95087),b=r(20195),w=r(96168);!function(e){e.VERIFICATION_FAILED="verification_failed",e.VERIFICATION_TIMEOUT="verification_timeout",e.VERIFICATION_REQUIRES_REQUEST="verification_requires_request",e.ACCOUNT_BLOCKED_CONTACT_SUPPORT="account_blocked_contact_support",e.INVALID_OTP_ALREADY_USED="invalid_otp_already_used",e.INVALID_OTP_BLOCKED="invalid_otp_blocked"}(s||(s={}));class A extends((0,w.Hu)(s.VERIFICATION_FAILED,"")){}class C extends((0,w.Hu)(s.VERIFICATION_TIMEOUT,"")){}class I extends((0,w.Hu)(s.VERIFICATION_REQUIRES_REQUEST,"")){}class T extends((0,w.Hu)(s.ACCOUNT_BLOCKED_CONTACT_SUPPORT,"")){}class P extends((0,w.Hu)(s.INVALID_OTP_ALREADY_USED,"")){}class O extends((0,w.Hu)(s.INVALID_OTP_BLOCKED,"")){}class R extends((0,w.Hu)("network_error","")){}!function(e){e.TOKEN_NOT_VALID="TOKEN_NOT_VALID",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.TOKEN_TOO_MANY_ATTEMPTS="TOKEN_TOO_MANY_ATTEMPTS",e.TOKEN_ACCOUNT_LOCKED="TOKEN_ACCOUNT_LOCKED"}(i||(i={})),function(e){e.OTP_NOT_VALID="OTP_NOT_VALID",e.OTP_TOO_MANY_ATTEMPTS="OTP_TOO_MANY_ATTEMPTS",e.OTP_ALREADY_USED="OTP_ALREADY_USED",e.BACKUP_CODE_NOT_VALID="BACKUP_CODE_NOT_VALID"}(a||(a={})),function(e){e.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED="DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED",e.TOKEN_EXPIRED="TOKEN_EXPIRED"}(o||(o={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.UNKNOWN_ERROR="UNKNOWN_ERROR"}(n||(n={}));let D=class{constructor(e){this.serverApiClient=e}async performEmailTokenVerification(e,t){return await(0,y.z)(this.serverApiClient.v1.authentication.performEmailTokenVerification({login:e,token:t}).pipe((0,f.DZ)((e=>(0,S.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new A;case s.VERIFICATION_TIMEOUT:return new C;case s.VERIFICATION_REQUIRES_REQUEST:return new I;case s.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return new T;default:(0,E.U)(e.code)}},FetchFailedError:()=>new R,UnspecifiedBadStatus:b.j,InternalServerError:b.j,InvalidRequest:b.j,RateLimited:b.j,ServiceUnavailable:b.j}))),(0,f.lk)((e=>(0,v.Vp)(e.data.authTicket)))))}async performTotpVerification(e,t){return await(0,y.z)(this.serverApiClient.v1.authentication.performTotpVerification({login:e,otp:t}).pipe((0,f.DZ)((e=>(0,S.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new A;case s.INVALID_OTP_ALREADY_USED:return new P;case s.INVALID_OTP_BLOCKED:return new O;default:(0,E.U)(e.code)}},FetchFailedError:()=>new R,UnspecifiedBadStatus:b.j,InternalServerError:b.j,InvalidRequest:b.j,RateLimited:b.j,ServiceUnavailable:b.j}))),(0,f.lk)((e=>(0,v.Vp)(e.data.authTicket)))))}async performDashlaneAuthenticatorValidation(e,t){return await(0,y.z)(this.serverApiClient.v1.authentication.performDashlaneAuthenticatorVerification({login:e,deviceName:t}).pipe((0,f.DZ)((e=>(0,S.EQ)(e,{BusinessError:e=>{switch(e.code){case s.VERIFICATION_FAILED:return new A;case s.VERIFICATION_TIMEOUT:return new C;default:(0,E.U)(e.code)}},FetchFailedError:()=>new R,UnspecifiedBadStatus:b.j,InternalServerError:b.j,InvalidRequest:b.j,RateLimited:b.j,ServiceUnavailable:b.j}))),(0,f.lk)((e=>(0,v.Vp)(e.data.authTicket)))))}async askServerToSendToken(e){return await(0,y.z)(this.serverApiClient.v1.authentication.requestEmailTokenVerification({login:e}).pipe((0,f.DZ)((e=>{throw e})),(0,f.lk)((()=>(0,v.Vp)(void 0)))))}};D=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[_.l])],D);let N=class{constructor(e){this.identityVerificationService=e,this.identityVerificationService=e}async execute({login:e}){if(e){const t=await this.identityVerificationService.askServerToSendToken(e);if((0,v.hx)(t))return Promise.reject(t.error)}Promise.resolve(void 0)}};N=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D])],N);var U=r(81459);let F=class extends U.f{};F=(0,c.__decorate)([(0,h.GS)()],F);let M=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return o.DASHLANE_AUTHENTICATOR_PUSH_NOTIFICATION_DENIED;case s.VERIFICATION_TIMEOUT:return o.TOKEN_EXPIRED;default:return n.UNKNOWN_ERROR}}async execute({login:e}){if(!e)throw new Error("Something went wrong");const t=await this.identityVerificationService.performDashlaneAuthenticatorValidation(e,"");if((0,v.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}};M=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D,F])],M);let L=class{constructor(e,t){this.dashlaneAuthenticatorService=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"AuthenticatorMachine",context:{isDashlaneAuthenticatorAvailable:!1},initial:"RequestingServerPush",states:{RequestingServerPush:{entry:["updateDashlaneAuthenticatorAvailability"],invoke:{src:"authenticateWithDashlaneAuthenticator",onDone:{target:"AuthenticatorPushValidated"},onError:{actions:["assignError","updateDashlaneAuthenticatorAvailability"]}},on:{RESEND_PUSH_NOTIFICATION:{target:"RequestingServerPush",actions:["clearError"]},SWITCH_TO_EMAIL_TOKEN:{actions:["clearError"],target:"EmailTokenRequested"}}},AuthenticatorPushValidated:{type:"final",data:{switchToEmailToken:!1}},EmailTokenRequested:{entry:["sendEmailToken"],type:"final",data:{switchToEmailToken:!0}}}},options:{actions:{clearError:(0,m.f0)({error:()=>{}}),assignError:(0,m.f0)({error:(e,t)=>t.data}),switchToEmailToken:(0,m.f0)({switchToEmailToken:()=>!0}),updateDashlaneAuthenticatorAvailability:(0,m.f0)({isDashlaneAuthenticatorAvailable:!0}),sendEmailToken:e=>{const{login:t}=e;this.sendEmailToken.execute({login:t})}},services:{authenticateWithDashlaneAuthenticator:e=>{const{login:t}=e;return this.dashlaneAuthenticatorService.execute({login:t})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};L=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[M,N])],L);const x=/^\d{6}$/;let k=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return i.TOKEN_NOT_VALID;case s.VERIFICATION_TIMEOUT:return i.TOKEN_EXPIRED;case s.VERIFICATION_REQUIRES_REQUEST:return i.TOKEN_TOO_MANY_ATTEMPTS;case s.ACCOUNT_BLOCKED_CONTACT_SUPPORT:return i.TOKEN_ACCOUNT_LOCKED;default:return n.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.emailToken||0===e.emailToken.length||!x.test(e.emailToken))return Promise.reject(n.UNKNOWN_ERROR);const t=await this.identityVerificationService.performEmailTokenVerification(e.login,e.emailToken);if((0,v.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}const r=t.data;return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:r}),Promise.resolve()}};k=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D,F])],k);let G=class{constructor(e,t){this.authenticateWithEmailToken=e,this.sendEmailToken=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"EmailTokenMachine",context:{login:"",emailToken:"",deviceName:""},initial:"SendEmailToken",states:{SendEmailToken:{invoke:{src:"sendEmailToken",onError:{target:"WaitingForEmailToken"},onDone:{target:"WaitingForEmailToken"}}},WaitingForEmailToken:{on:{INPUT_EMAIL_TOKEN:{target:"ValidatingEmailToken",actions:["assignEmailToken"]},RESEND_EMAIL_TOKEN:{target:"SendEmailToken",actions:["clearError"]}}},ValidatingEmailToken:{invoke:{src:"authenticateWithEmailToken",onDone:{target:"FinishingEmailToken"},onError:{target:"WaitingForEmailToken",actions:["assignError"]}}},FinishingEmailToken:{type:"final",data:{switchToDashlaneAuthenticator:!1}},DashlaneAuthenticatorRequested:{type:"final",data:{switchToDashlaneAuthenticator:!0}}},on:{SWITCH_TO_DASHLANE_AUTHENTICATOR:{target:".DashlaneAuthenticatorRequested",internal:!0,actions:["clearError"]}}},options:{actions:{assignError:(0,m.f0)({error:(e,t)=>t.data}),clearError:(0,m.f0)({error:()=>{}}),assignEmailToken:(0,m.f0)({emailToken:(e,t)=>t.emailToken})},services:{sendEmailToken:e=>{const{login:t}=e;return this.sendEmailToken.execute({login:t})},authenticateWithEmailToken:e=>{const{deviceName:t,emailToken:r,login:s}=e;return this.authenticateWithEmailToken.executeWithParams({deviceName:t,emailToken:r,login:s})}},guards:{}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};G=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[k,N])],G);const V=e=>({initial:e.initial,states:e.states,on:e.on??{}});let K=class{constructor(e,t){this.authenticatorMachine=e,this.emailTokenMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{},guards:{}},id:"DeviceRegistrationMachine",context:{...this.authenticatorMachine.desc().config.context,...this.emailTokenMachine.desc().config.context,registrationMethod:void 0},initial:"StartDeviceRegistration",states:{StartDeviceRegistration:{always:[{target:"EmailToken",cond:"isRegistrationMethodEmailToken"},{target:"DashlaneAuthenticator",cond:"isRegistrationMethodAuthenticator"},{target:"TwoFactorAuthentication",cond:"isRegistrationMethodOTP"}]},DashlaneAuthenticator:{...V(this.authenticatorMachine.desc().config),onDone:[{target:"EmailToken",cond:"shouldSwitchToEmailToken"},{target:"DeviceRegistrationDone"}]},EmailToken:{...V(this.emailTokenMachine.desc().config),onDone:[{target:"DashlaneAuthenticator",cond:"shouldSwitchToAuthenticator"},{target:"DeviceRegistrationDone"}]},TwoFactorAuthentication:{onDone:{target:"DeviceRegistrationDone"}},DeviceRegistrationDone:{type:"final"}}},options:{actions:{...this.authenticatorMachine.desc().options.actions,...this.emailTokenMachine.desc().options.actions,assignUnknownDeviceRegistrationError:(0,m.f0)({error:()=>({code:"unknown_error",data:{message:"Unknown device registration error"}})})},services:{...this.authenticatorMachine.desc().options.services,...this.emailTokenMachine.desc().options.services},guards:{...this.authenticatorMachine.desc().options.guards,...this.emailTokenMachine.desc().options.guards,isRegistrationMethodEmailToken:e=>"email_token"===e.registrationMethod,isRegistrationMethodOTP:e=>"otp"===e.registrationMethod,isRegistrationMethodAuthenticator:e=>"dashlane_authenticator"===e.registrationMethod,shouldSwitchToEmailToken:(e,t)=>t.data.switchToEmailToken,shouldSwitchToAuthenticator:(e,t)=>t.data.switchToDashlaneAuthenticator}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};K=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[L,G])],K);var j=r(25029),B=r(95681);const W=e=>!0;class z extends((0,B.Q)({initialValue:void 0,persist:!1,scope:j.F.Device,storeName:"device-registration-flow-store",storeTypeGuard:W})){}let H=class{constructor(e,t){this.identityVerificationService=e,this.eventEmitter=t}mapFunctionalErrorToErrorCode(e){switch(e.tag){case s.VERIFICATION_FAILED:return a.OTP_NOT_VALID;case s.INVALID_OTP_ALREADY_USED:return a.OTP_ALREADY_USED;case s.INVALID_OTP_BLOCKED:return a.OTP_TOO_MANY_ATTEMPTS;default:return n.UNKNOWN_ERROR}}async executeWithParams(e){if(!e.login||!e.otp||0===e.otp.length||"totp"===e.twoFactorAuthenticationOtpType&&!x.test(e.otp))return Promise.reject(n.UNKNOWN_ERROR);const t=await this.identityVerificationService.performTotpVerification(e.login,e.otp);if((0,v.hx)(t)){const e=this.mapFunctionalErrorToErrorCode(t.error);return Promise.reject(e)}return this.eventEmitter.sendEvent("identityVerificationCompleted",{authTicket:t.data}),Promise.resolve()}};H=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[D,F])],H);let Q=class{constructor(e){this.twoFactorAuthenticationService=e}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},id:"TwoFactorAuthenticationMachine",context:{twoFactorAuthenticationOtpType:"totp"},initial:"WaitingForTotp",states:{WaitingForTotp:{on:{INPUT_TOTP:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForBackupCode",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},WaitingForBackupCode:{on:{INPUT_BACKUP_CODE:{target:"ValidatingTwoFactorAuthenticationOtp",actions:["assignTwoFactorAuthenticationOtpValue"]},SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE:{target:"WaitingForTotp",actions:["assignTwoFactorAuthenticationOtpType","clearError"]}}},ValidatingTwoFactorAuthenticationOtp:{invoke:{src:"authenticateWithTwoFactorAuthentication",onDone:{target:"TwoFactorAuthenticationDone"},onError:[{target:"WaitingForBackupCode",cond:"isBackupCode",actions:["assignError"]},{target:"WaitingForTotp",actions:["assignError"]}]}},TwoFactorAuthenticationDone:{type:"final"}}},options:{actions:{assignError:(0,m.f0)({error:(e,t)=>t.data}),clearError:(0,m.f0)({error:()=>{}}),assignTwoFactorAuthenticationOtpValue:(0,m.f0)({twoFactorAuthenticationOtpValue:(e,t)=>t.twoFactorAuthenticationOtpValue}),assignTwoFactorAuthenticationOtpType:(0,m.f0)({twoFactorAuthenticationOtpType:(e,t)=>t.twoFactorAuthenticationOtpType})},services:{authenticateWithTwoFactorAuthentication:e=>{const t={login:e.login??"",masterPassword:e.masterPassword??null,otp:e.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.twoFactorAuthenticationOtpType,persistData:!0,otpVerificationMode:e.otpVerificationMode,deviceName:e.deviceName};return this.twoFactorAuthenticationService.executeWithParams(t)}},guards:{isBackupCode:e=>"backupCode"===e.twoFactorAuthenticationOtpType}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};Q=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[H])],Q);let q=class{constructor(e,t){this.deviceRegistrationMachine=e,this.twoFactorAuthenticationMachine=t}desc(){return{config:{predictableActionArguments:!0,schema:{events:{},context:{}},initial:"Starting",id:"IdentityVerificationFlowMachine",context:{...this.deviceRegistrationMachine.desc().config.context,...this.twoFactorAuthenticationMachine.desc().config.context,ready:!1,shouldAskOTP:!1},states:{Starting:{entry:["assignInitializationResults"]},DeviceRegistration:{...V(this.deviceRegistrationMachine.desc().config)},TwoFactorAuthentication:{...V(this.twoFactorAuthenticationMachine.desc().config),onDone:{target:"AuthenticationDone"}},AuthenticationDone:{type:"final"}},on:{VERIFY_IDENTITY_WITH_TOKEN:{target:"DeviceRegistration.EmailToken",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR:{target:"DeviceRegistration.DashlaneAuthenticator",actions:["assignAccountEmail"]},VERIFY_IDENTITY_WITH_TOTP:{target:"TwoFactorAuthentication",actions:["assignAccountEmail"]},CANCEL_IDENTITY_VERIFICATION:{target:"Starting",actions:["clearContext"]},CLEAR_ERROR:{actions:["clearError"]}}},options:{actions:{...this.deviceRegistrationMachine.desc().options.actions,...this.twoFactorAuthenticationMachine.desc().options.actions,assignInitializationResults:(0,m.f0)({ready:()=>!0}),assignAccountEmail:(0,m.f0)({login:(e,t)=>t.login}),clearContext:(0,m.f0)({login:()=>"",shouldAskOTP:()=>!1,twoFactorAuthenticationOtpType:()=>"totp",registrationMethod:()=>{},emailToken:()=>"",deviceName:()=>"",isDashlaneAuthenticatorAvailable:()=>!1}),clearError:(0,m.f0)({error:()=>{}})},services:{...this.deviceRegistrationMachine.desc().options.services,...this.twoFactorAuthenticationMachine.desc().options.services},guards:{...this.deviceRegistrationMachine.desc().options.guards,...this.twoFactorAuthenticationMachine.desc().options.guards,isGrapheneDeviceRegistrationFlow:e=>!!e.login&&e.login.includes("kw_test_newdevice")}}}}create(){const{config:e,options:t}=this.desc();return(0,g.C)(e,t)}};q=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[K,Q])],q);var Y=r(85390),$=r(30523),X=r(6136),Z=r(20754),J=r(41025),ee=r(69885),te=r(6220);const re=e=>({step:"EmailTokenStep",isLoading:e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})&&!e.context.error,error:e.context.error,emailToken:e.context.emailToken,isDashlaneAuthenticatorAvailable:e.context.isDashlaneAuthenticatorAvailable}),se=e=>({step:"DashlaneAuthenticatorStep",isLoading:e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})&&!e.context.error,error:e.context.error}),ie=e=>({step:"TwoFactorAuthenticationOtpStep",isLoading:e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})&&!e.context.error,error:e.context.error,twoFactorAuthenticationOtpValue:e.context.twoFactorAuthenticationOtpValue,twoFactorAuthenticationOtpType:e.context.twoFactorAuthenticationOtpType});const ae=e=>(0,ee.of)((0,v.Vp)(function(e){return e.matches("Starting")?{step:"StartingStep"}:e.matches({DeviceRegistration:{EmailToken:"SendEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"WaitingForEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"ValidatingEmailToken"}})||e.matches({DeviceRegistration:{EmailToken:"FinishingEmailToken"}})?re(e):e.matches({DeviceRegistration:{DashlaneAuthenticator:"RequestingServerPush"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushFailed"}})||e.matches({DeviceRegistration:{DashlaneAuthenticator:"AuthenticatorPushValidated"}})?se(e):e.matches({TwoFactorAuthentication:"WaitingForTotp"})||e.matches({TwoFactorAuthentication:"WaitingForBackupCode"})||e.matches({TwoFactorAuthentication:"ValidatingTwoFactorAuthenticationOtp"})||e.matches({TwoFactorAuthentication:"FinishingTwoFactorAuthenticationOtp"})?ie(e):void console.warn("[Auth Ticket] - No view associated to state ",JSON.stringify(e.value))}(e))),oe=e=>e.pipe((0,te.z)(ae));var ne=r(8362),ce=r(87065);const le=e=>!0;class de extends((0,B.Q)({initialValue:void 0,persist:!1,scope:j.F.Device,storeName:"identity-verification-flow-machine",storeTypeGuard:le})){}var ue=r(30045);var pe=r(24966),he=r(78065),me=r(20916);let ge=class{constructor(e,t){this.identityVerificationMachineStore=t,this.initFlag=new pe.X(!1);const r=e.create();this.delayedEvents=[],this.interpreter=he.kJ(r).onTransition((async e=>{e.changed||"xstate.init"===e.event.type||console.warn(`[Auth Ticket] State is unchanged. Unexpected transition on ${JSON.stringify(e.value)} with event ${e.event.type} `);try{const e=this.interpreter?.getSnapshot();e&&await(async(e,t)=>{await e.set(JSON.stringify(t))})(this.identityVerificationMachineStore,e)}catch(e){console.warn("[Auth Ticket] Unable to get snapshot",e)}}))}async prepare(){if(this.interpreter)try{const e=await(async e=>{const t=await e.getState();return t?ne.ZM.create(JSON.parse(t)):void 0})(this.identityVerificationMachineStore);let t;try{t=this.interpreter.start(e)}catch(e){console.error("[Auth Ticket] Unable to reuse the stored state: ",e),t=this.interpreter.start()}await(0,me.x)(t,(e=>e.context.ready)),this.interpreter.send(this.delayedEvents),this.delayedEvents=[],this.initFlag.next(!0)}catch(e){console.error("[Auth Ticket] Unable to start machine",e)}}ready(){return this.initFlag}continue(e){if(!this.interpreter)throw new Error("Authentication flow not started");this.interpreter.getSnapshot().context.ready?this.interpreter.send(e):this.delayedEvents.push(e)}stop(){this.isStarted()&&(this.interpreter=void 0)}isStarted(){return Boolean(this.interpreter)}};ge=(0,c.__decorate)([(0,h.GS)(),(0,c.__metadata)("design:paramtypes",[q,de])],ge);let ve=class{constructor(e,t){this.identityVerificationFlow=e,this.identityVerificationMachineStore=t}execute(){return(0,Y.a)([(e=this.identityVerificationMachineStore,e.state$.pipe((0,ce.U)((e=>e?ne.ZM.create(JSON.parse(e)):void 0)))),this.identityVerificationFlow.ready()],((e,t)=>{if(e&&t)return e})).pipe((0,$.h)(Boolean),(0,X.x)(((e,t)=>((e,t)=>{const r=t.matches(e.value),s=(0,ue.Z)(e.context,t.context);return r&&s})(e,t))),oe);var e}};ve=(0,c.__decorate)([(0,Z.e)(J.O),(0,c.__metadata)("design:paramtypes",[ge,de])],ve);var ye=r(63663),_e=r(13744);let fe=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpType:t}=e.body;return this.identityVerificationFlow.continue({type:"SWITCH_TWO_FACTOR_AUTHENTICATION_TYPE",twoFactorAuthenticationOtpType:t}),Promise.resolve((0,v.Vp)(void 0))}};fe=(0,c.__decorate)([(0,ye.W)(_e.eG),(0,c.__metadata)("design:paramtypes",[ge])],fe);let Se=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"CLEAR_ERROR"}),Promise.resolve((0,v.Vp)(void 0))}};Se=(0,c.__decorate)([(0,ye.W)(_e.$5),(0,c.__metadata)("design:paramtypes",[ge])],Se);let Ee=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"RESEND_EMAIL_TOKEN"}),Promise.resolve((0,v.Vp)(void 0))}};Ee=(0,c.__decorate)([(0,ye.W)(_e.Gc),(0,c.__metadata)("design:paramtypes",[ge])],Ee);let be=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"RESEND_PUSH_NOTIFICATION"}),Promise.resolve((0,v.Vp)(void 0))}};be=(0,c.__decorate)([(0,ye.W)(_e.rF),(0,c.__metadata)("design:paramtypes",[ge])],be);let we=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_BACKUP_CODE",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,v.Vp)(void 0))}};we=(0,c.__decorate)([(0,ye.W)(_e.sH),(0,c.__metadata)("design:paramtypes",[ge])],we);let Ae=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{emailToken:t,deviceName:r}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_EMAIL_TOKEN",emailToken:t,deviceName:r}),Promise.resolve((0,v.Vp)(void 0))}};Ae=(0,c.__decorate)([(0,ye.W)(_e.XH),(0,c.__metadata)("design:paramtypes",[ge])],Ae);let Ce=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{twoFactorAuthenticationOtpValue:t}=e.body;return this.identityVerificationFlow.continue({type:"INPUT_TOTP",twoFactorAuthenticationOtpValue:t}),Promise.resolve((0,v.Vp)(void 0))}};Ce=(0,c.__decorate)([(0,ye.W)(_e.ad),(0,c.__metadata)("design:paramtypes",[ge])],Ce);let Ie=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_DASHLANE_AUTHENTICATOR"}),Promise.resolve((0,v.Vp)(void 0))}};Ie=(0,c.__decorate)([(0,ye.W)(_e.K1),(0,c.__metadata)("design:paramtypes",[ge])],Ie);let Te=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"SWITCH_TO_EMAIL_TOKEN"}),Promise.resolve((0,v.Vp)(void 0))}};Te=(0,c.__decorate)([(0,ye.W)(_e.v5),(0,c.__metadata)("design:paramtypes",[ge])],Te);let Pe=class{constructor(e){this.identityVerificationFlow=e}execute(e){const{login:t,verificationMethod:r}=e.body;switch(r){case"email_token":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOKEN",login:t});break;case"totp":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_TOTP",login:t});break;case"dashlane_authenticator":this.identityVerificationFlow.continue({type:"VERIFY_IDENTITY_WITH_DASHLANE_AUTHENTICATOR",login:t})}return Promise.resolve((0,v.Vp)(void 0))}};Pe=(0,c.__decorate)([(0,ye.W)(_e.qw),(0,c.__metadata)("design:paramtypes",[ge])],Pe);let Oe=class{constructor(e){this.identityVerificationFlow=e}execute(){return this.identityVerificationFlow.continue({type:"CANCEL_IDENTITY_VERIFICATION"}),Promise.resolve((0,v.Vp)(void 0))}};Oe=(0,c.__decorate)([(0,ye.W)(_e.Vs),(0,c.__metadata)("design:paramtypes",[ge])],Oe);let Re=class{};Re=(0,c.__decorate)([(0,l.Y)({api:p.i,handlers:{commands:{changeTwoFactorAuthenticationOtpType:fe,clearError:Se,resendEmailToken:Ee,resendPushNotification:be,submitBackupCode:we,submitEmailToken:Ae,submitTotp:Ce,switchToDashlaneAuthenticator:Ie,switchToEmailToken:Te,startIdentityVerification:Pe,cancelIdentityVerification:Oe},events:{},queries:{identityVerificationFlowStatus:ve}},providers:[K,L,M,G,Q,...(0,d.H)(ge,{inject:[q,de],asyncFactory:async(e,t)=>{const r=new ge(e,t);return await r.prepare(),r}}),q,k,H,N,D,F],imports:[u.n],exports:[ge],stores:[de,z]})],Re)},62175:(e,t,r)=>{r.d(t,{N:()=>oe});var s=r(88802),i=r(99634),a=r(89033),o=r(28760),n=r(37935),c=r(93850),l=r(85035),d=r(63663),u=r(87279),p=r(73675),h=r(86252),m=r(57924),g=r(9671),v=r(92258),y=r(31222),_=r(87113),f=r(10370),S=r(66122);function E(e){const t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,s=t.padEnd(t.length+r,"=");return(0,S.R)(s)}var b=r(18533),w=r(20195),A=r(95087),C=r(89358),I=r(87065),T=r(89618),P=r(25313),O=r(30523),R=r(85390),D=r(60399);let N=null;async function U(){if(!N){const{client:e}=await async function(){const{client:e,ready:t}=await Promise.all([r.e(642),r.e(633),r.e(877),r.e(495),r.e(373),r.e(139)]).then(r.bind(r,6504));return await t,{client:e}}();N=e}return N}var F=r(25029),M=r(95681),L=r(23347),x=r(7165),k=r(10722);const G=x.z.object({localAccounts:x.z.record(x.z.string(),x.z.object({salt:x.z.string(),encryptedSessionKey:x.z.string(),serverSessionKey:x.z.string(),attemptsLeft:x.z.number()}))}),V=e=>G.safeParse(e).success;class K extends((0,M.Q)({persist:!0,storage:{initialValue:{localAccounts:{}},schemaVersion:1,typeGuard:V,migrateStorageSchema:()=>({localAccounts:{}})},codec:k.E,scope:F.F.Device,storeName:"pincode",capacity:L.Y._001KB})){}var j=r(56268),B=r(25594),W=r(94805),z=r(16698);let H=class{constructor(e,t){this.flexibleEncryptor=e,this.flexibleDecryptor=t}async encryptSessionKeyWithPinKey(e,t){return await this.flexibleEncryptor.encrypt(t,e,W.oo,z.gO)}async decryptSessionKeyWithPinKey(e,t){return await this.flexibleDecryptor.decrypt(t,e)}};H=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[j._,B.a])],H);var Q=r(67978),q=r(75994);let Y=class extends Q.K{constructor(e,t){super(`/assets/pin-code.${"https://api.dashlane.com"===t.baseUrl?"prod":"staging"}.config.json`,e)}loadResource(e){if(!((t=e)&&"object"==typeof t&&"serverIdentifier"in t&&"serverPublicKey"in t))throw new Error("File corrupted");var t;return e}};Y=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[q.X,_.l])],Y);let $=class{constructor(e,t,r,s,i,a,o,n,c){this.pinCodeStore=e,this.session=t,this.keyGenerator=r,this.hmacSigner=s,this.sessionKeyCrypto=i,this.serverApi=a,this.allowToFail=o,this.carbonClient=n,this.pinCodeServerConfigResourceLoader=c}getPinCodeStatus(e){return this.pinCodeStore.state$.pipe((0,I.U)((t=>{const r=e in t.localAccounts;return(0,u.Vp)(r?{isPinCodeEnabled:!0,attemptsLeft:t.localAccounts[e].attemptsLeft}:{isPinCodeEnabled:!1})})))}getCurrentUserPinCodeStatus(){const e=this.session.queries.selectedOpenedSession().pipe((0,T.V)({first:5e3,with:()=>(0,P._)((()=>new Error("No current active user")))}),(0,I.U)((e=>(0,u.d6)(e)&&e.data?e.data:"")),(0,O.h)((e=>!!e)));return(0,R.a)([e,this.pinCodeStore.state$]).pipe((0,I.U)((([e,t])=>{const r=e in t.localAccounts;return(0,u.Vp)(r?{isPinCodeEnabled:!0,attemptsLeft:t.localAccounts[e].attemptsLeft}:{isPinCodeEnabled:!1})})))}async activatePinCode(e){const t=await this.getCurrentUserEmail(),r=await(0,D.z)(this.carbonClient.queries.carbonState({path:"state.authentication.currentUser.rememberMeType"}));(0,u.d6)(r)&&"autologin"===r.data&&await this.carbonClient.commands.disableAutologin();const s=await this.pinCodeStore.getState(),i=await this.getExportedSessionKey(),a=(0,f.s)(await this.keyGenerator.generate()),o=await U(),n=(0,f.s)(await this.hmacSigner.sign((0,S.R)(a),(new TextEncoder).encode(e))),{clientRegistrationState:c,registrationRequest:l}=o.startRegistration({password:n}),d=await(0,D.z)(this.serverApi.v1.authentication.pincodeRequestActivation({activationRequest:l})),p=(0,b.EQ)(d,{success:e=>e.data.data.activationResponse,failure:e=>(0,b.EQ)(e.error,{BusinessError:e=>{if("FAILED_TO_PROCESS_ACTIVATION_REQUEST"===e.code)return(0,w.j)(e.code);(0,A.U)(e.code)},FetchFailedError:w.j,InternalServerError:w.j,InvalidRequest:w.j,RateLimited:w.j,ServiceUnavailable:w.j,UnspecifiedBadStatus:w.j})}),h=await this.pinCodeServerConfigResourceLoader.get(),{registrationRecord:m,exportKey:g,serverStaticPublicKey:v}=o.finishRegistration({clientRegistrationState:c,registrationResponse:p,password:n,identifiers:{client:t,server:h.serverIdentifier}});if(v!==h.serverPublicKey)throw new Error("OPAQUE´s serverStaticPublicKey does not match api configs.");const y=await(0,D.z)(this.serverApi.v1.authentication.pincodeCompleteActivation({pinCodeRecord:m})),_=(0,b.EQ)(y,{success:e=>e.data.data.sessionKey,failure:e=>(0,b.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"ACTIVATION_REQUEST_NOT_FOUND":case"EMPTY_PIN_CODE_RECORD":return(0,w.j)(e.code);default:(0,A.U)(e)}},FetchFailedError:w.j,InternalServerError:w.j,InvalidRequest:w.j,RateLimited:w.j,ServiceUnavailable:w.j,UnspecifiedBadStatus:w.j})}),C=E(g),I=await this.sessionKeyCrypto.encryptSessionKeyWithPinKey(i,C);await this.pinCodeStore.set({...s,localAccounts:{...s.localAccounts,[t]:{...s.localAccounts[t],serverSessionKey:_,salt:a,encryptedSessionKey:(0,f.s)(I),attemptsLeft:3}}})}async removePinCodeFromStore(e){const t=await this.pinCodeStore.getState();delete t.localAccounts[e],await this.pinCodeStore.set(t)}async deactivatePinCode(){const e=await this.getCurrentUserEmail();await this.removePinCodeFromStore(e),await this.allowToFail.doOne((async()=>await(0,D.z)(this.serverApi.v1.authentication.pincodeDisable({}))),"Deactivate pin code")}async computePinKey(e,t){const r=await this.pinCodeStore.getState();if(!(t in r.localAccounts))return(0,u.Rn)((0,p.Zs)());const{serverSessionKey:s,salt:i}=r.localAccounts[t],a=(0,f.s)(await this.hmacSigner.sign((0,S.R)(i),(new TextEncoder).encode(e))),o=await U(),{clientLoginState:n,startLoginRequest:c}=o.startLogin({password:a}),l=await(0,D.z)(this.serverApi.v1.authentication.pincodeRequestLogin({loginRequest:c,sessionKey:s})),d=(0,b.EQ)(l,{success:e=>(0,u.Vp)(e.data.data),failure:e=>(0,b.EQ)(e.error,{BusinessError:e=>{switch(e.code){case"INVALID_SESSION_KEY":case"NO_PIN_CODE_ACTIVATED":case"FAILED_TO_PROCESS_LOGIN_REQUEST":case"MAX_ATTEMPTS_REACHED":return(0,u.Rn)((0,p.Zs)());default:(0,A.U)(e)}},FetchFailedError:w.j,InternalServerError:w.j,InvalidRequest:w.j,RateLimited:w.j,ServiceUnavailable:w.j,UnspecifiedBadStatus:w.j})});if(!(0,u.d6)(d))return await this.removePinCodeFromStore(t),d;const{loginResponse:h,attemptsLeft:m}=d.data,g=await this.pinCodeStore.getState();await this.pinCodeStore.set({...g,localAccounts:{...g.localAccounts,[t]:{...g.localAccounts[t],attemptsLeft:m}}});const v=await this.pinCodeServerConfigResourceLoader.get(),y=o.finishLogin({clientLoginState:n,loginResponse:h,password:a,identifiers:{client:t,server:v.serverIdentifier}});if(!y)return 0===m&&await this.removePinCodeFromStore(t),(0,u.Rn)((0,p.g5)());if(y.serverStaticPublicKey!==v.serverPublicKey)throw new Error("OPAQUE´s serverStaticPublicKey does not match api configs.");const{exportKey:_,finishLoginRequest:C}=y;return await this.allowToFail.doOne((async()=>await(0,D.z)(this.serverApi.v1.authentication.pincodeCompleteLogin({sessionKey:s,completeLoginRequest:C}))),"Complete login with pin code"),(0,u.Vp)(E(_))}async loginWithPinCode(e,t){const r=await this.pinCodeStore.getState();if(!(e in r.localAccounts))return(0,u.Rn)((0,p.Zs)());const{encryptedSessionKey:s}=r.localAccounts[e],i=await this.computePinKey(t,e);if(!(0,u.d6)(i))return i;const a=i.data,o=await this.sessionKeyCrypto.decryptSessionKeyWithPinKey((0,S.R)(s),a),n=await this.session.commands.openUserSession({email:e,rememberPassword:!1,sessionKey:{type:"exported",content:(0,f.s)(o)}});if(!(0,u.d6)(n))throw new Error("Failed to open the session");return(0,u.Vp)(void 0)}async getCurrentUserEmail(){const e=await(0,D.z)(this.session.queries.selectedOpenedSession());if(!(0,u.d6)(e)||!e.data)throw new Error("No current session was found");return e.data}async getExportedSessionKey(){const e=await(0,D.z)(this.session.queries.exportSessionKey());if(!(0,u.d6)(e))throw new Error("Failed to export session key");return(0,S.R)(e.data.content)}};$=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[K,C.x,v.c,y.q,H,_.l,g.J,h._,Y])],$);let X=class{constructor(e){this.pinCodeService=e}async execute({body:e}){return await this.pinCodeService.activatePinCode(e.pinCode),(0,u.Vp)(void 0)}};X=(0,s.__decorate)([(0,d.W)(l.r),(0,s.__metadata)("design:paramtypes",[$])],X);var Z=r(44878);let J=class{constructor(e){this.pinCodeService=e}async execute(){return await this.pinCodeService.deactivatePinCode(),(0,u.Vp)(void 0)}};J=(0,s.__decorate)([(0,d.W)(Z.E),(0,s.__metadata)("design:paramtypes",[$])],J);let ee=class{constructor(e){this.pinCodeService=e}async execute({body:e}){return await this.pinCodeService.loginWithPinCode(e.email,e.pinCode)}};ee=(0,s.__decorate)([(0,d.W)(p.cM),(0,s.__metadata)("design:paramtypes",[$])],ee);var te=r(35941),re=r(20754);let se=class{constructor(e){this.pinCodeService=e}execute(e){return this.pinCodeService.getPinCodeStatus(e.body.loginEmail)}};se=(0,s.__decorate)([(0,re.e)(te.D),(0,s.__metadata)("design:paramtypes",[$])],se);var ie=r(67160);let ae=class{constructor(e){this.pinCodeService=e}execute(){return this.pinCodeService.getCurrentUserPinCodeStatus()}};ae=(0,s.__decorate)([(0,re.e)(ie.o),(0,s.__metadata)("design:paramtypes",[$])],ae);let oe=class{};oe=(0,s.__decorate)([(0,i.Y)({api:a.n,stores:[K],imports:[n.D,c.n],handlers:{commands:{activate:X,deactivate:J,loginWithPinCode:ee},events:{},queries:{getStatus:se,getCurrentUserStatus:ae}},providers:[$,H,Y],requiredFeatureFlips:Object.values(o.T)})],oe)},13520:(e,t,r)=>{r.d(t,{Z:()=>A});var s=r(88802),i=r(69401),a=r(99634),o=r(93850),n=r(13460),c=r(11088),l=r(63663),d=r(63281),u=r(87279),p=r(89358),h=r(60399),m=r(59550);let g=class{constructor(e,t,r){this.contextLessServerApiClient=e,this.authWSRepository=t,this.sessionClient=r}async execute(e){const t=await(0,h.z)(this.sessionClient.queries.selectedOpenedSession()),r=(0,u.d6)(t)?(0,u.db)(t):e.body.login;if(void 0===r)throw new Error("Logged out and no login specified");const{id:s,type:i,rawId:a,response:o}=e.body.assertion,n=await(0,h.z)(this.contextLessServerApiClient.v1.authentication.completeRememberMeOpenSession(await this.authWSRepository.getSessionCredentialsForUser(r),{authenticator:{authenticationType:"webauthn.get",credential:{type:i,id:s,rawId:a,response:o}}}));if((0,u.hx)(n))throw new Error(`Assertion could not be validated: ${n.error.name}`);return(0,u.Vp)(void 0)}};g=(0,s.__decorate)([(0,l.W)(c.L),(0,s.__metadata)("design:paramtypes",[d.B,m.Q,p.x])],g);var v=r(20195);const y={FetchFailedError:_=()=>(0,v.j)("Error calling server API"),InternalServerError:_,InvalidRequest:_,RateLimited:_,ServiceUnavailable:_,UnspecifiedBadStatus:_};var _,f=r(87113),S=r(18533);var E=r(83853);function b(e){return()=>(0,u.Rn)({tag:e})}let w=class{constructor(e){this.server=e}async execute({body:{email:e}}){const t=await(0,h.z)(this.server.v1.authentication.requestOtpRecoveryCodesByPhone({login:e}));return(0,S.EQ)(t,{success:()=>(0,u.Vp)(void 0),failure:e=>(0,S.EQ)(e.error,{...y,FetchFailedError:b(E.A.NetworkError),BusinessError:e=>{return t=e.code,{INVALID_RECOVERY_PHONE:b(E.A.AccountNotEligible),SMS_ERROR:()=>(0,v.j)("Dashlane servers failed to send SMS"),SMS_OPT_OUT:b(E.A.AccountNotEligible),USER_NOT_FOUND:b(E.A.AccountNotEligible),WRONG_OTP_STATUS:b(E.A.AccountNotEligible)}[t]();var t}})})}};w=(0,s.__decorate)([(0,l.W)(c.x),(0,s.__metadata)("design:paramtypes",[f.l])],w);let A=class{};A=(0,s.__decorate)([(0,a.Y)({api:i.M,handlers:{commands:{validateWebauthnAssertion:g,request2FaCodesByPhone:w},events:{},queries:{}},imports:[o.n,n.R]})],A)},17556:(e,t,r)=>{r.d(t,{e:()=>s});class s{redirectUserToExternalUrl(e){!async function(){try{await chrome.tabs.create({url:e.externalUrl,active:e.tabFocus})}catch(t){console.warn("[Auto-SSO] No window available. Delaying tab creation");const r=()=>{chrome.tabs.create({url:e.externalUrl,active:e.tabFocus}),chrome.windows.onCreated.removeListener(r)};chrome.windows.onCreated.addListener(r)}}()}}},15403:(e,t,r)=>{r.d(t,{c:()=>n});var s=r(86952),i=r(21494),a=r(57655),o=r(24221);const n=(0,s.Q)({name:"autofillData",commands:{},events:{},queries:{getSingleAutofillData:i.a,getMultipleAutofillData:a.N,searchAutofillData:o.w}})},57655:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},21494:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},24221:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},92018:(e,t,r)=>{r.d(t,{Y:()=>o});var s=r(86952),i=r(11564),a=r(73581);const o=(0,s.Q)({name:"autofillTracking",commands:{temporaryEmitPasswordAutofillPerformedEvent:a.q},events:{passwordAutofillPerformedEvent:i.p},queries:{}})},73581:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},11564:(e,t,r)=>{r.d(t,{p:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},46154:(e,t,r)=>{r.d(t,{Pw:()=>o,q_:()=>i,rF:()=>n,up:()=>s});const s=["KWAddress","KWBankStatement","KWCompany","KWDriverLicence","KWEmail","KWFiscalStatement","KWIDCard","KWIdentity","KWMerchand","KWPassport","KWPaymentMean_creditCard","KWPaymentMean_paypal","KWPersonalWebsite","KWPhone","KWSecureNote","KWSecureNoteCategory","KWSocialSecurityStatement"],i=["KWAuthentifiant","KWGeneratedPassword","KWPasskey"],a=[...s,...i],o=e=>!!e&&"string"==typeof e&&a.includes(e),n=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every(o)},3124:(e,t,r)=>{r.d(t,{P:()=>s,w:()=>i});const s=e=>e instanceof Array&&!e.find((e=>{return!("object"==typeof(t=e)&&null!==t&&"id"in t&&"fieldIdentifier"in t&&"domain"in t);var t})),i=e=>"none"===e.correctedDataSource},52434:(e,t,r)=>{var s;r.d(t,{M:()=>s}),function(e){e[e.CannotDisable=0]="CannotDisable",e[e.DisableSpecificVaultItem=1]="DisableSpecificVaultItem",e[e.DisableGeneralSetting=2]="DisableGeneralSetting"}(s||(s={}))},78364:(e,t,r)=>{var s;r.d(t,{k:()=>s}),function(e){e.Address="Address",e.BankAccount="BankAccount",e.Company="Company",e.Credential="Credential",e.DriverLicense="DriverLicense",e.Email="Email",e.FiscalId="FiscalId",e.GeneratedPassword="GeneratedPassword",e.IdCard="IdCard",e.Identity="Identity",e.NoteCategory="NoteCategory",e.Note="Note",e.Passport="Passport",e.Passkey="Passkey",e.PaymentCard="PaymentCard",e.PersonalWebsite="PersonalWebsite",e.Phone="Phone",e.Secret="Secret",e.SocialSecurityId="SocialSecurityId"}(s||(s={}))},62864:(e,t,r)=>{r.r(t),r.d(t,{AddDisabledSourceTypesCommand:()=>U.g,AddLinkedWebsiteCommand:()=>Z.vp,AddLinkedWebsiteErrors:()=>Z.hy,AnalysisStatus:()=>O._,AutofillSettingsApiClient:()=>P.W,CREDENTIAL_DATA_MODELS:()=>g.q_,CountriesForAutofill:()=>d,DisableAnalysisCommand:()=>F.u,DisableAutofillOnFormsCommand:()=>L.t,DisableAutofillOnLoginsCommand:()=>x.f,DisableAutologinCommand:()=>M.T,DisableFollowUpNotificationCommand:()=>k.y,DisablePhishingPreventionForUrlCommand:()=>I.z,EnableAnalysisCommand:()=>G.c,EnableAutofillOnFormsCommand:()=>K.a,EnableAutofillOnLoginsCommand:()=>j.I,EnableAutologinCommand:()=>V.i,EnableFollowUpNotificationCommand:()=>B.B,FORM_DATA_MODELS:()=>g.up,GetAnalysisStatusOnUrlQuery:()=>O.h,GetAutofillDisabledOnLoginsAndFormsNotificationStatusQuery:()=>S.z,GetAutofillProtectionContextQuery:()=>b.u,GetAutofillSettingsQuery:()=>R.T,GetDashlaneDefinedLinkedWebsitesQuery:()=>$.J,GetMultipleAutofillDataQuery:()=>a.N,GetPreferencesForCredentialsQuery:()=>N.g,GetSingleAutofillDataQuery:()=>i.a,GetUserAutofillCorrectionsQuery:()=>D.w,LinkedWebsitesClient:()=>Y.X,OtherSourceType:()=>u,PasswordAutofillPerformedEvent:()=>c.p,PhishingPreventionDisabledForUrlQuery:()=>A.v,PhishingPreventionEnabledQuery:()=>w.i,RemoveDisabledSourceTypesCommand:()=>W.v,RemoveLinkedWebsiteCommand:()=>J.M7,RemoveLinkedWebsiteErrors:()=>J.E6,ResetProtectedItemAutofillTimerCommand:()=>C.y,SearchAutofillDataQuery:()=>o.w,SetAutofillDisabledOnLoginsAndFormsNotificationStatusCommand:()=>f.a,SetUserAutofillCorrectionsCommand:()=>H.S,TemporaryEmitPasswordAutofillPerformedEventCommand:()=>l.q,ToggleDashlaneCommand:()=>z.r,UpdateCredentialPreferencesCommand:()=>Q.J,UpdateLinkedWebsitesCommand:()=>X.A,VaultItemDisableProtectionMode:()=>y.M,VaultSourceType:()=>p.k,autofillDataApi:()=>s.c,autofillNotificationsApi:()=>_._,autofillSecurityApi:()=>E.V,autofillSettingsApi:()=>T.I,autofillTrackingApi:()=>n.Y,createAddLinkedWebsiteCredentialNotFound:()=>Z.i6,createAddLinkedWebsiteErrorOnUpdatingVault:()=>Z.R6,createAddLinkedWebsiteWebsiteAlreadyLinked:()=>Z.lD,createRemoveLinkedWebsiteCredentialNotFound:()=>J.W4,createRemoveLinkedWebsiteErrorOnUpdatingVault:()=>J.cQ,isArrayOfAutofillableDataModel:()=>g.rF,isArrayOfUserAutofillCorrections:()=>v.P,isAutofillableDataModel:()=>g.Pw,isDashlaneDisabledPermanently:()=>v.w,isOtherSourceType:()=>h,isVaultSourceType:()=>m,linkedWebsitesApi:()=>q.G});var s=r(15403),i=r(21494),a=r(57655),o=r(24221),n=r(92018),c=r(11564),l=r(73581);const d=Object.freeze({NO_TYPE:"NO_TYPE",UNIVERSAL:"UNIVERSAL",AD:"AD",AE:"AE",AF:"AF",AG:"AG",AI:"AI",AL:"AL",AM:"AM",AO:"AO",AR:"AR",AS:"AS",AT:"AT",AU:"AU",AW:"AW",AZ:"AZ",BA:"BA",BB:"BB",BD:"BD",BE:"BE",BF:"BF",BG:"BG",BH:"BH",BI:"BI",BJ:"BJ",BL:"BL",BM:"BM",BN:"BN",BO:"BO",BR:"BR",BS:"BS",BT:"BT",BW:"BW",BY:"BY",BZ:"BZ",CA:"CA",CD:"CD",CF:"CF",CG:"CG",CH:"CH",CI:"CI",CK:"CK",CL:"CL",CM:"CM",CN:"CN",CO:"CO",CR:"CR",CU:"CU",CV:"CV",CY:"CY",CZ:"CZ",DE:"DE",DJ:"DJ",DK:"DK",DM:"DM",DO:"DO",DZ:"DZ",EC:"EC",EE:"EE",EG:"EG",ER:"ER",ES:"ES",ET:"ET",FI:"FI",FJ:"FJ",FK:"FK",FM:"FM",FO:"FO",FR:"FR",GA:"GA",GB:"GB",GD:"GD",GE:"GE",GF:"GF",GG:"GG",GH:"GH",GI:"GI",GL:"GL",GM:"GM",GN:"GN",GP:"GP",GQ:"GQ",GR:"GR",GT:"GT",GU:"GU",GW:"GW",GY:"GY",HK:"HK",HN:"HN",HR:"HR",HT:"HT",HU:"HU",ID:"ID",IE:"IE",IL:"IL",IM:"IM",IN:"IN",IO:"IO",IQ:"IQ",IR:"IR",IS:"IS",IT:"IT",JE:"JE",JM:"JM",JO:"JO",JP:"JP",KE:"KE",KG:"KG",KH:"KH",KI:"KI",KM:"KM",KN:"KN",KP:"KP",KR:"KR",KW:"KW",KY:"KY",KZ:"KZ",LA:"LA",LB:"LB",LC:"LC",LI:"LI",LK:"LK",LR:"LR",LS:"LS",LT:"LT",LU:"LU",LV:"LV",LY:"LY",MA:"MA",MC:"MC",MD:"MD",ME:"ME",MF:"MF",MG:"MG",MH:"MH",MK:"MK",ML:"ML",MM:"MM",MN:"MN",MO:"MO",MP:"MP",MQ:"MQ",MR:"MR",MS:"MS",MT:"MT",MU:"MU",MV:"MV",MW:"MW",MX:"MX",MY:"MY",MZ:"MZ",NA:"NA",NC:"NC",NE:"NE",NF:"NF",NG:"NG",NI:"NI",NL:"NL",NO:"NO",NP:"NP",NR:"NR",NU:"NU",NZ:"NZ",OM:"OM",PA:"PA",PE:"PE",PF:"PF",PG:"PG",PH:"PH",PK:"PK",PL:"PL",PM:"PM",PR:"PR",PS:"PS",PT:"PT",PW:"PW",PY:"PY",QA:"QA",RE:"RE",RO:"RO",RS:"RS",RU:"RU",RW:"RW",SA:"SA",SB:"SB",SC:"SC",SD:"SD",SE:"SE",SG:"SG",SH:"SH",SI:"SI",SK:"SK",SL:"SL",SM:"SM",SN:"SN",SO:"SO",SR:"SR",ST:"ST",SV:"SV",SY:"SY",SZ:"SZ",TC:"TC",TD:"TD",TF:"TF",TG:"TG",TH:"TH",TJ:"TJ",TK:"TK",TL:"TL",TM:"TM",TN:"TN",TO:"TO",TR:"TR",TT:"TT",TV:"TV",TW:"TW",TZ:"TZ",UA:"UA",UG:"UG",US:"US",UY:"UY",UZ:"UZ",VA:"VA",VC:"VC",VE:"VE",VG:"VG",VI:"VI",VN:"VN",VU:"VU",WF:"WF",WS:"WS",XK:"XK",YE:"YE",YT:"YT",ZA:"ZA",ZM:"ZM",ZW:"ZW",AQ:"AQ",AX:"AX",BV:"BV",CC:"CC",CX:"CX",EH:"EH",GS:"GS",HM:"HM",PN:"PN",SJ:"SJ",UM:"UM"});var u,p=r(78364);!function(e){e.NewPassword="newPassword",e.SubmitButton="submitButton",e.WebauthnConditionalUI="WebauthnConditionalUI"}(u||(u={}));const h=e=>Object.values(u).includes(e),m=e=>e in p.k;var g=r(46154),v=r(3124),y=r(52434),_=r(45714),f=r(61933),S=r(63208),E=r(38554),b=r(51730),w=r(5282),A=r(63212),C=r(93555),I=r(94370),T=r(69029),P=r(72250),O=r(68573),R=r(63267),D=r(3414),N=r(95371),U=r(99682),F=r(3909),M=r(34962),L=r(65791),x=r(56e3),k=r(11232),G=r(54405),V=r(4924),K=r(38018),j=r(69643),B=r(82796),W=r(46918),z=r(50163),H=r(29641),Q=r(15269),q=r(46097),Y=r(25146),$=r(66608),X=r(9446),Z=r(3535),J=r(88026)},46097:(e,t,r)=>{r.d(t,{G:()=>c});var s=r(86952),i=r(66608),a=r(3535),o=r(88026),n=r(9446);const c=(0,s.Q)({name:"linkedWebsites",commands:{addLinkedWebsite:a.vp,removeLinkedWebsite:o.M7,updateLinkedWebsites:n.A},events:{},queries:{getDashlaneDefinedLinkedWebsites:i.J}})},25146:(e,t,r)=>{r.d(t,{X:()=>a});var s=r(67837),i=r(46097);class a extends((0,s.E)(i.G)){}(0,s.K)(i.G,a)},3535:(e,t,r)=>{r.d(t,{R6:()=>l,hy:()=>s,i6:()=>n,lD:()=>c,vp:()=>d});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.CREDENTIAL_NOT_FOUND="credential_not_found",e.WEBSITE_ALREADY_LINKED="website_already_linked",e.ERROR_ON_UPDATING_VAULT="error_on_updating_vault"}(s||(s={}));const n=(0,o.Vj)(s.CREDENTIAL_NOT_FOUND,"Couldn't retrieve the credential"),c=(0,o.Vj)(s.WEBSITE_ALREADY_LINKED,"Website alredy linked to this credential"),l=(0,o.Vj)(s.ERROR_ON_UPDATING_VAULT,"Error while updating the credential");class d extends((0,i.g)({scope:a.F.User})){}},88026:(e,t,r)=>{r.d(t,{E6:()=>s,M7:()=>l,W4:()=>n,cQ:()=>c});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.CREDENTIAL_NOT_FOUND="credential_not_found",e.ERROR_ON_UPDATING_VAULT="error_on_updating_vault"}(s||(s={}));const n=(0,o.Vj)(s.CREDENTIAL_NOT_FOUND,"Couldn't retrieve the credential"),c=(0,o.Vj)(s.ERROR_ON_UPDATING_VAULT,"Error while updating the credential");class l extends((0,i.g)({scope:a.F.User})){}},9446:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},66608:(e,t,r)=>{r.d(t,{J:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},45714:(e,t,r)=>{r.d(t,{_:()=>o});var s=r(86952),i=r(61933),a=r(63208);const o=(0,s.Q)({name:"autofillNotifications",commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:i.a},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:a.z}})},61933:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},63208:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},38554:(e,t,r)=>{r.d(t,{V:()=>l});var s=r(86952),i=r(51730),a=r(5282),o=r(63212),n=r(94370),c=r(93555);const l=(0,s.Q)({name:"autofillSecurity",commands:{disablePhishingPreventionForUrl:n.z,resetProtectedItemAutofillTimer:c.y},events:{},queries:{getAutofillProtectionContext:i.u,isPhishingPreventionCapabilityEnabled:a.i,isPhishingPreventionDisabledForUrl:o.v}})},94370:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},93555:(e,t,r)=>{r.d(t,{y:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},51730:(e,t,r)=>{r.d(t,{u:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},5282:(e,t,r)=>{r.d(t,{i:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},63212:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},69029:(e,t,r)=>{r.d(t,{I:()=>w});var s=r(86952),i=r(46918),a=r(99682),o=r(50163),n=r(68573),c=r(63267),l=r(3414),d=r(95371),u=r(54405),p=r(4924),h=r(38018),m=r(69643),g=r(82796),v=r(3909),y=r(34962),_=r(65791),f=r(56e3),S=r(11232),E=r(29641),b=r(15269);const w=(0,s.Q)({name:"autofillSettings",commands:{toggleDashlane:o.r,enableAnalysis:u.c,enableAutologin:p.i,enableAutofillOnForms:h.a,enableAutofillOnLogins:m.I,enableFollowUpNotification:g.B,disableAnalysis:v.u,disableAutologin:y.T,disableAutofillOnForms:_.t,disableAutofillOnLogins:f.f,disableFollowUpNotification:S.y,addDisabledSourceTypes:a.g,removeDisabledSourceTypes:i.v,setUserAutofillCorrections:E.S,updateCredentialPreferences:b.J},events:{},queries:{getAnalysisStatusOnUrl:n.h,getAutofillSettings:c.T,getUserAutofillCorrections:l.w,getPreferencesForCredentials:d.g}})},72250:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(67837),i=r(69029);class a extends((0,s.E)(i.I)){}(0,s.K)(i.I,a)},99682:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},3909:(e,t,r)=>{r.d(t,{u:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},65791:(e,t,r)=>{r.d(t,{t:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},56e3:(e,t,r)=>{r.d(t,{f:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},34962:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},11232:(e,t,r)=>{r.d(t,{y:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},54405:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},38018:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},69643:(e,t,r)=>{r.d(t,{I:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},4924:(e,t,r)=>{r.d(t,{i:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},82796:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},46918:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},29641:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},50163:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},15269:(e,t,r)=>{r.d(t,{J:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},68573:(e,t,r)=>{r.d(t,{_:()=>s,h:()=>o});var s,i=r(99059),a=r(25029);!function(e){e.ANALYSIS_ENABLED="ANALYSIS_ENABLED",e.ANALYSIS_DISABLED_BY_USER="ANALYSIS_DISABLED_BY_USER",e.ANALYSIS_DISABLED_BY_B2B_ADMIN="ANALYSIS_DISABLED_BY_B2B_ADMIN",e.ANALYSIS_DISABLED_BY_KILLSWITCH="ANALYSIS_DISABLED_BY_KILLSWITCH",e.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT="ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT"}(s||(s={}));class o extends((0,i.k)({scope:a.F.Device})){}},63267:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},95371:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},3414:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},18890:(e,t,r)=>{r.d(t,{U:()=>j});var s=r(88802),i=r(99634),a=r(15403),o=r(87065),n=r(78364),c=r(57924),l=r(87279),d=r(48844),u=r(82706),p=r(64035),h=r(61199),m=r(72965);const g={[n.k.Address]:u.U.Address,[n.k.BankAccount]:u.U.BankAccount,[n.k.Company]:u.U.Company,[n.k.Credential]:u.U.Credential,[n.k.DriverLicense]:u.U.DriversLicense,[n.k.Email]:u.U.Email,[n.k.FiscalId]:u.U.FiscalId,[n.k.GeneratedPassword]:null,[n.k.IdCard]:u.U.IdCard,[n.k.Identity]:u.U.Identity,[n.k.Note]:u.U.SecureNote,[n.k.Passkey]:u.U.Passkey,[n.k.Passport]:u.U.Passport,[n.k.PaymentCard]:u.U.PaymentCard,[n.k.PersonalWebsite]:u.U.Website,[n.k.Phone]:u.U.Phone,[n.k.SocialSecurityId]:u.U.SocialSecurityId,[n.k.Secret]:u.U.Secret,[n.k.NoteCategory]:null};let v=class{constructor(e,t){this.vaultClient=e,this.searchClient=t}getAutofillData(e,t,r,s){const i=g[e];if(!i)throw new Error("autofill-data.repository: bad vault item type in `getAutofillData`");return this.getVaultItem(i,t?[t]:void 0,r,s).pipe((0,o.U)((e=>{if((0,l.hx)(e))throw new Error("autofill-data.repository: the following error occured while requesting the vault API "+e.tag);if(t&&e.data[p.N[i]].matchCount<1)throw new Error("autofill-data.repository: no vault item corresponding to the provided id");return e})))}searchAutofillData(e,t,r){let s;return t?.length&&(s=t.map((e=>g[e])).filter((e=>!!e))),this.searchVaultItem(e,s,r).pipe((0,d.DZ)((e=>{throw new Error("autofill-data.repository: the following error occured while requesting the search vault API "+e)})))}getVaultItem(e,t,r,s){const{query:i}=this.vaultClient.queries;return i({vaultItemTypes:[e],ids:t,propertySorting:r,propertyFilters:s})}searchVaultItem(e,t,r){const{search:s}=this.searchClient.queries;return s({searchQuery:e,vaultItemTypes:t,propertySorting:r})}};v=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[h.L,m.T])],v);var y,_=r(72250),f=r(25146),S=r(60399),E=r(82466),b=r(47905),w=r(26897),A=r(64718);!function(e){e.MainWebsite="MainWebsite",e.DashlaneDefinedLinkedWebsite="DashlaneDefinedLinkedWebsite",e.UserDefinedLinkedWebsite="UserDefinedLinkedWebsite",e.None="None"}(y||(y={}));const C=(e,t,r)=>{const s=((e,t,r)=>{if(!e)return y.None;const s=new A.Y(e).getRootDomain();return s===new A.Y(t.URL).getRootDomain()?y.MainWebsite:r.map((e=>new A.Y(e).getRootDomain())).includes(s)?y.DashlaneDefinedLinkedWebsite:t.linkedURLs.map((e=>new A.Y(e).getRootDomain())).includes(s)?y.UserDefinedLinkedWebsite:y.None})(e,t,r);switch(s){case y.DashlaneDefinedLinkedWebsite:return w.MatchType.AssociatedWebsite;case y.UserDefinedLinkedWebsite:return w.MatchType.UserAssociatedWebsite;case y.None:case y.MainWebsite:default:return w.MatchType.Regular}},I=e=>new Date(1e3*e),T=e=>{if(!e)return null;const t=(e=>{if(!e)return 0;const[t,r,s]=e.split(/[-/]/).map((e=>Number.parseInt(e,10))),i=new Date;i.setUTCHours(0,0,0,0);const a=i.setUTCFullYear(t,r-1,s);return Math.floor(a/1e3)})(e);return Number.isNaN(t)?null:t},P=e=>{const t=new Date(0).getUTCFullYear(),r=I(T(e.birthDate)??0),s=new Date(Date.now()-r.getTime());return Math.abs(s.getUTCFullYear()-t)},O=e=>e??"",R=e=>e??0;let D=class{constructor(e,t,r){this.autofillSettings=e,this.linkedWebsitesClient=t,this.sharingItemsClient=r,this.mapVaultItemToAutofillView={[n.k.Address]:this.addressAutofillView.bind(this),[n.k.BankAccount]:this.bankAccountAutofillView.bind(this),[n.k.Company]:this.companyAutofillView.bind(this),[n.k.Credential]:this.credentialAutofillView.bind(this),[n.k.DriverLicense]:this.driverLicenseAutofillView.bind(this),[n.k.Email]:this.emailAutofillView.bind(this),[n.k.FiscalId]:this.fiscalIdAutofillView.bind(this),[n.k.GeneratedPassword]:()=>{},[n.k.IdCard]:this.idCardAutofillView.bind(this),[n.k.Identity]:this.identityAutofillView.bind(this),[n.k.Passkey]:this.passkeyAutofillView.bind(this),[n.k.Passport]:this.passportAutofillView.bind(this),[n.k.PaymentCard]:this.paymentCardAutofillView.bind(this),[n.k.Phone]:this.phoneAutofillView.bind(this),[n.k.Secret]:this.secretAutofillView.bind(this),[n.k.Note]:this.noteAutofillView.bind(this),[n.k.SocialSecurityId]:this.socialSecurityIdAutofillView.bind(this),[n.k.PersonalWebsite]:this.personalWebsiteAutofillView.bind(this),[n.k.NoteCategory]:()=>{}}}getAutofillViewForItems(e,{data:t},r){return this.mapVaultItemToAutofillView[e](t,r)}filterItemsByDomain(e,t){let r=e;return this.isCredentialsList(e)?r=e.filter((e=>{const r=new A.Y(e.url).getRootDomain();return t===r||e.matchType===w.MatchType.AssociatedWebsite||e.matchType===w.MatchType.UserAssociatedWebsite})):this.isPasskeysList(e)&&(r=e.filter((e=>{const r=new A.Y(e.rpId).getHostname(),s=new A.Y(t).getHostname();return s===r||s.endsWith(`.${r}`)}))),r}isCredentialsList(e){return e.length>0&&e[0].vaultType===n.k.Credential}isPasskeysList(e){return e.length>0&&e[0].vaultType===n.k.Passkey}baseItemAutofillView(e){return{id:e.id,lastUse:e.lastUse,localeFormat:e.localeFormat,spaceId:O(e.spaceId)}}addressAutofillView(e){return Promise.all(e.addressesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Address,addressFull:`${e.streetNumber} ${e.streetName}`,stateCode:O(e.stateNumber),addressName:O(e.itemName),streetTitle:O(e.streetName),building:O(e.building),city:O(e.city),country:O(e.country),zipCode:O(e.zipCode),streetName:O(e.streetName),streetNumber:O(e.streetNumber),state:O(e.state),stairs:O(e.stairs),digitCode:O(e.digitCode),stateLevel2:"",door:O(e.door),floor:O(e.floor)}))))}bankAccountAutofillView(e){return Promise.all(e.bankAccountsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.BankAccount,name:O(e.accountName),owner:O(e.ownerName),IBAN:O(e.IBAN),BIC:O(e.BIC),bank:"",bankCode:O(e.bankCode),country:O(e.country)}))))}companyAutofillView(e){return Promise.all(e.companiesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Company,name:O(e.companyName),jobTitle:O(e.jobTitle)}))))}async credentialAutofillView(e,t){const{getDashlaneDefinedLinkedWebsites:r}=this.linkedWebsitesClient.queries,{getPreferencesForCredentials:s}=this.autofillSettings.queries,i=e.credentialsResult.items.map((({id:e})=>e)),a=await(0,S.z)(s({credentialIds:i}));if((0,l.hx)(a))throw new Error("Failed to retrieve preferences result: "+a.tag);const o=a.data;return Promise.all(e.credentialsResult.items.map((async e=>{const s=o.find((({id:t})=>t===e.id)),i=await(0,S.z)(r({url:e.URL}));if(!s||(0,l.hx)(i))throw new Error("Failed to map Credential to autofill view");const a=await this.getSharingInfoForItem(e.id),{data:c}=i,{useAutoLogin:d,requireMasterPassword:u,onlyAutofillExactDomain:p}=s;return{...this.baseItemAutofillView(e),vaultType:n.k.Credential,title:O(e.itemName),url:O(e.URL),secondaryLogin:O(e.alternativeUsername),email:O(e.email),password:O(e.password),otpSecret:O(e.otpSecret),matchType:C(t??"",e,c),login:O(e.username),hasOtp:!!e.otpURL,otpUrl:O(e.otpURL),autoLogin:d,autoProtected:u,subdomainOnly:p,userAddedLinkedWebsites:e.linkedURLs,sharingStatus:a}})))}async getSharingInfoForItem(e){const{getPermissionForItem:t}=this.sharingItemsClient.queries,r=await(0,S.z)(t({itemId:e}));if((0,l.hx)(r))throw new Error("Failed to get sharing info for item in `autofill-data.service`");const{permission:s}=r.data;return s?{isShared:!0,hasAdminPermission:s===E.y3.Admin}:{isShared:!1}}driverLicenseAutofillView(e){return Promise.all(e.driversLicensesResult.items.map((e=>{const t=I(R(T(e.expirationDate))),r=I(R(T(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:n.k.DriverLicense,expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:O(e.idNumber),issueDay:r.getDate(),issueMonth:r.getMonth()+1,issueYear:r.getFullYear(),issueDateFull:`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`,country:O(e.country),creationDate:R(e.creationDatetime),name:O(e.idName),state:O(e.state)}})))}emailAutofillView(e){return Promise.all(e.emailsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Email,email:O(e.emailAddress),name:O(e.itemName),type:e.type??"NO_TYPE"}))))}fiscalIdAutofillView(e){return Promise.all(e.fiscalIdsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.FiscalId,creationDate:R(e.creationDatetime),country:O(e.country),idNumber:O(e.fiscalNumber),teledeclarantNumber:O(e.teledeclarantNumber)}))))}identityAutofillView(e){return Promise.all(e.identitiesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Identity,age:P(e),birthDate:O(e.birthDate),birthPlace:O(e.birthPlace),firstName:O(e.firstName),lastName2:O(e.lastName2),lastName:O(e.lastName),middleName:O(e.middleName),middleNameInitial:O(e.middleName),pseudo:O(e.pseudo),title:O(e.title)}))))}idCardAutofillView(e){return Promise.all(e.idCardsResult.items.map((e=>{const t=I(R(T(e.expirationDate))),r=I(R(T(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:n.k.IdCard,country:O(e.country),creationDate:R(e.creationDatetime),expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:O(e.idNumber),issueDay:r.getDate(),issueMonth:r.getMonth()+1,issueYear:r.getFullYear(),issueDateFull:`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`,name:O(e.idName)}})))}noteAutofillView(e){return Promise.all(e.secureNotesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Note}))))}secretAutofillView(e){return Promise.all(e.secretsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Secret}))))}passportAutofillView(e){return Promise.all(e.passportsResult.items.map((e=>{const t=I(R(T(e.expirationDate))),r=I(R(T(e.issueDate)));return{...this.baseItemAutofillView(e),vaultType:n.k.Passport,country:e.country,creationDate:R(e.creationDatetime),deliveryPlace:e.issuePlace,expirationDay:t.getDate(),expirationMonth:t.getMonth()+1,expirationYear:t.getFullYear(),expirationDateFull:`${t.getFullYear()}-${t.getMonth()+1}-${t.getDate()}`,idNumber:O(e.idNumber),issueDay:r.getDate(),issueMonth:r.getMonth()+1,issueYear:r.getFullYear(),issueDateFull:`${r.getFullYear()}-${r.getMonth()+1}-${r.getDate()}`,name:O(e.idName)}})))}paymentCardAutofillView(e){return Promise.all(e.paymentCardsResult.items.map((e=>{let t="";return e.cardNumber&&e.cardNumber.trim().length>0&&(t=e.cardNumber.trim().slice(-4)),{...this.baseItemAutofillView(e),vaultType:n.k.PaymentCard,bank:"",cardNumber:O(e.cardNumber),cardNumberLastDigits:t,color:e.color||"BLUE_1",expireMonth:O(e.expireMonth),expireYear:O(e.expireYear),name:O(e.itemName),ownerName:O(e.ownerName),securityCode:O(e.securityCode),type:"PAYMENT_TYPE_MASTERCARD"}})))}personalWebsiteAutofillView(e){return Promise.all(e.websitesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.PersonalWebsite,name:O(e.itemName),website:O(e.URL)}))))}phoneAutofillView(e){return Promise.all(e.phonesResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Phone,name:O(e.itemName),numberInternational:O(e.numberInternational),number:O(e.phoneNumber),type:e.type}))))}socialSecurityIdAutofillView(e){return Promise.all(e.socialSecurityIdsResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.SocialSecurityId,name:O(e.idName),idNumber:O(e.idNumber),country:O(e.country),creationDate:R(e.creationDatetime)}))))}passkeyAutofillView(e){return Promise.all(e.passkeysResult.items.map((e=>({...this.baseItemAutofillView(e),vaultType:n.k.Passkey,credentialId:e.credentialId,rpId:e.rpId,rpName:e.rpName,userDisplayName:e.userDisplayName,userHandle:e.userHandle,counter:e.counter,keyAlgorithm:e.keyAlgorithm}))))}};D=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[_.W,f.X,b.s])],D);var N=r(30523),U=r(43978),F=r(21494),M=r(20754);let L=class{constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}execute({body:{itemId:e,itemType:t,rootDomain:r}}){return this.autofillDataRepository.getAutofillData(t,e).pipe((0,N.h)((e=>(0,l.d6)(e))),(0,U.w)((e=>this.autofillDataService.getAutofillViewForItems(t,e,r))),(0,o.U)((e=>e[0])),(0,o.U)(l.Vp))}};L=(0,s.__decorate)([(0,M.e)(F.a),(0,s.__metadata)("design:paramtypes",[v,D])],L);var x=r(37182),k=r(57655);let G=class{constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}execute({body:{itemType:e,domain:t,sorting:r,filters:s}}){const i=!!t&&(e===n.k.Credential||e===n.k.Passkey);return this.autofillDataRepository.getAutofillData(e,void 0,r,s).pipe((0,N.h)((e=>(0,l.d6)(e))),(0,U.w)((r=>this.autofillDataService.getAutofillViewForItems(e,r,t))),(0,x.K)((e=>{throw new Error("get-multiple-autofill-data: error occured while mapping to autofill views: "+e)})),(0,o.U)((e=>i?this.autofillDataService.filterItemsByDomain(e,t):e)),(0,o.U)(l.Vp))}};G=(0,s.__decorate)([(0,M.e)(k.N),(0,s.__metadata)("design:paramtypes",[v,D])],G);var V=r(24221);let K=class{constructor(e,t){this.autofillDataRepository=e,this.autofillDataService=t}execute({body:{searchQuery:e,itemTypes:t,domain:r,sorting:s}}){const i=t??[...Object.values(n.k).filter((e=>e!==n.k.GeneratedPassword&&e!==n.k.NoteCategory))];return this.autofillDataRepository.searchAutofillData(e,t,s).pipe((0,N.h)((e=>(0,l.d6)(e))),(0,U.w)((e=>Promise.all(i.map((t=>this.autofillDataService.getAutofillViewForItems(t,e,r)))))),(0,x.K)((e=>{throw new Error("search-autofill-data: error occured while mapping to autofill views: "+e)})),(0,o.U)((e=>e.flatMap((e=>e)))),(0,o.U)(l.Vp))}};K=(0,s.__decorate)([(0,M.e)(V.w),(0,s.__metadata)("design:paramtypes",[v,D])],K);let j=class{};j=(0,s.__decorate)([(0,i.Y)({api:a.c,handlers:{commands:{},events:{},queries:{getSingleAutofillData:L,getMultipleAutofillData:G,searchAutofillData:K}},providers:[v,D]})],j)},59123:(e,t,r)=>{r.d(t,{V:()=>h});var s=r(88802),i=r(99634),a=r(92018),o=r(81459),n=r(57924);let c=class extends o.f{};c=(0,s.__decorate)([(0,n.GS)()],c);var l=r(63663),d=r(87279),u=r(73581);let p=class{constructor(e){this.autofillTrackingEventsEmitter=e}execute({body:e}){const{credentialId:t}=e;return t&&this.autofillTrackingEventsEmitter.sendEvent("passwordAutofillPerformed",{credentialId:t}),Promise.resolve((0,d.Vp)(void 0))}};p=(0,s.__decorate)([(0,l.W)(u.q),(0,s.__metadata)("design:paramtypes",[c])],p);let h=class{};h=(0,s.__decorate)([(0,i.Y)({api:a.Y,handlers:{commands:{temporaryEmitPasswordAutofillPerformedEvent:p},events:{},queries:{}},providers:[c]})],h)},33084:(e,t,r)=>{var s;r.d(t,{G:()=>s}),function(e){e.AutofillWebOneClickFormFill="autofill_web_oneClickFormFill",e.AutofillWebAskBeforeAutologin="autofill_web_askBeforeAutologin",e.AutofillWebNewSubdomainManagement="autofill_web_newSubdomainManagement",e.AutofillWebInjectScriptOnStartDev="autofill_web_injectScriptOnStart_dev",e.ReplaceInputListeners="autofill_web_replaceInputListeners",e.ReplaceInputListenersDev="autofill_web_replaceInputListeners_dev",e.PasskeySupport="autofill_web_passkey_support",e.PhishingPreventionOnPasteDev="autofill_web_phishing_prevention_on_paste_dev",e.PhishingPreventionOnPaste="autofill_web_phishing_prevention_on_paste_2",e.ImproveImpalaVisibility="autofill_web_improveImpalaVisibility",e.ImproveImpalaVisibilityDev="autofill_web_improveImpalaVisibility_dev",e.DisableAutologin="autofill_web_disableAutologin",e.AdminTabDev="ace_admin_tab_dev",e.AdminTab="ace_admin_tab",e.BiometricPasskeyDev="ace_web_biometric_passkey_dev",e.BiometricPasskey="ace_web_biometric_passkey",e.DisableEmailPasswordWarningDev="ace_disable_email_password_warning_dev",e.DisableEmailPasswordWarning="ace_disable_email_password_warning",e.RestrictPasswordFreePlanPhase1="b2c_web_restrict_password_free_plan_phase1",e.RestrictPasswordFreePlanPhase2="b2c_web_restrict_password_free_plan_phase2",e.EnableAdditionalInputEventInTimeout="ace_web_enableAdditionalInputEventInTimeout",e.AdminInterview="ace_admin_tab_interview",e.AdminInterviewDev="ace_admin_tab_interview_dev",e.LinkedWebsitesInContextDev="ace_web_linkedWebsitesInContext_dev",e.GrapheneMigrationV2="ace_web_graphene_migration_v2",e.GrapheneMigrationV2Dev="ace_web_graphene_migration_v2_dev",e.GrapheneMigrationV3="ace_web_graphene_migration_v3",e.GrapheneMigrationV3Dev="ace_web_graphene_migration_v3_dev",e.SecretsAttachment="ace_secrets_vault_attachment",e.InAppPasswordHealthBadges="ace_inapp_passwordhealth_indicators"}(s||(s={}))},90458:(e,t,r)=>{r.d(t,{J:()=>U});var s,i=r(88802),a=r(99634),o=r(46097),n=r(60399),c=r(87065),l=r(69885);!function(e){e.Manual="manual",e.Remember="remember"}(s||(s={}));var d=r(86252),u=r(64718),p=r(57924),h=r(87279),m=r(93843),g=r(48501),v=r(21543);const y=e=>Object.keys(e).map((t=>[t].concat(e[t]))),_=e=>[...e].sort();var f=r(53998),S=r(82706),E=r(61199);let b=class{constructor(e,t){this.carbonLegacyClient=e,this.vaultItemsCrudClient=t,this.updateLinkedWebsites=async(e,t)=>{const r=await this.getCredentialById(t),s=this.getUserAddedLinkedWebsiteDomains(r),i=[...new Set(e)].filter(Boolean);var a,o;if(o=i,(a=s).length===o.length&&_(a).join("")===_(o).join(""))return;const n=0===i.length?[]:this.mergeLinkedWebsites(r,s,i),c={...r.LinkedServices,associated_domains:n},l=await this.carbonLegacyClient.commands.carbon({name:"updateCredential",args:[{id:t,update:{linkedServices:c}}]});if((0,h.hx)(l))throw new Error("Error when updating linked websites using updateCredential query from Carbon")},this.getCredentialByIdGraphene=e=>(0,n.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[S.U.Credential],ids:[e]}).pipe((0,c.U)((e=>(0,h.d6)(e)&&1===e.data.credentialsResult.matchCount?e.data.credentialsResult.items[0]:null)))),this.populateDashlaneDefinedLinkedWebsitesIndex=e=>{const t={};return e.forEach((e=>{e.forEach((r=>{t[r]=e}))})),t},this.mergeLinkedDomainsIntoList=(e,t)=>{const r=[],s=[];e.forEach((e=>{return i=t,e.some((e=>i.includes(e)))?r.push(e):s.push(e);var i}));const i=r.concat([t]).flat();return s.concat([i])},this.reduceLinkedDomainsLists=(e,t,r)=>e.concat(t,r).reduce(this.mergeLinkedDomainsIntoList,[]),this._getDashlaneDefinedLinkedWebsites=e=>{const t=new u.Y(e).getRootDomain();return t?this.allDashlaneDefinedLinkedWebsitesIndex[t]||[t]:[]},this.getCredentialById=e=>{const{carbonState:t}=this.carbonLegacyClient.queries;return(0,n.z)(t({path:"userSession.personalData.credentials"}).pipe((0,c.U)((t=>{if(!(0,h.d6)(t)||!(0,f.A)(t.data))throw new Error("Bad credential format");const r=t.data.find((t=>t.Id===e));if(r)return r;throw new Error("Cannot find credential")}))))},this.getUserAddedLinkedWebsiteDomains=e=>e.LinkedServices?.associated_domains?.flatMap((({domain:e})=>Boolean(e)?e:[]))??[],this.getNewLinkedWebsitesToAdd$=(e,t)=>t.filter((t=>!e.includes(t))).map(this.linkedWebsiteFormatter),this.linkedWebsiteFormatter=e=>({domain:e,source:s.Manual}),this.mergeLinkedWebsites=(e,t,r)=>[...(e.LinkedServices?.associated_domains??[]).filter((e=>r.includes(e.domain))),...this.getNewLinkedWebsitesToAdd$(t,r)],this.allDashlaneDefinedLinkedWebsitesIndex=this.populateDashlaneDefinedLinkedWebsitesIndex(this.reduceLinkedDomainsLists(m,y(v),y(g)).map((e=>[...new Set(e)])))}getDashlaneDefinedLinkedWebsites$(e){return(0,l.of)(this._getDashlaneDefinedLinkedWebsites(e)).pipe((0,c.U)(h.Vp))}};b=(0,i.__decorate)([(0,p.GS)(),(0,i.__metadata)("design:paramtypes",[d._,E.L])],b);var w=r(20754),A=r(66608);let C=class{constructor(e){this.linkedWebsites=e}execute({body:{url:e=""}}){return this.linkedWebsites.getDashlaneDefinedLinkedWebsites$(e)}};C=(0,i.__decorate)([(0,w.e)(A.J),(0,i.__metadata)("design:paramtypes",[b])],C);var I=r(63663),T=r(3535);let P=class{constructor(e,t){this.repository=e,this.vaultItemsCrudClient=t}async execute({body:{credentialId:e,linkedWebsite:t}}){const r=await this.repository.getCredentialByIdGraphene(e);if(!r)return(0,h.Rn)((0,T.i6)());if(r.linkedURLs.find((e=>e===t)))return(0,h.Rn)((0,T.lD)());const s=await this.vaultItemsCrudClient.commands.updateVaultItem({vaultItemType:S.U.Credential,id:e,content:{linkedURLs:[...r.linkedURLs,t]}});return(0,h.hx)(s)?(0,h.Rn)((0,T.R6)()):(0,h.Vp)(void 0)}};P=(0,i.__decorate)([(0,I.W)(T.vp),(0,i.__metadata)("design:paramtypes",[b,E.L])],P);var O=r(88026);let R=class{constructor(e,t){this.repository=e,this.vaultItemsCrudClient=t}async execute({body:{credentialId:e,linkedWebsite:t}}){const r=await this.repository.getCredentialByIdGraphene(e);if(!r)return(0,h.Rn)((0,O.W4)());const s=await this.vaultItemsCrudClient.commands.updateVaultItem({vaultItemType:S.U.Credential,id:e,content:{linkedURLs:[...r.linkedURLs.filter((e=>e!==t))]}});return(0,h.hx)(s)?(0,h.Rn)((0,O.cQ)()):(0,h.Vp)(void 0)}};R=(0,i.__decorate)([(0,I.W)(O.M7),(0,i.__metadata)("design:paramtypes",[b,E.L])],R);var D=r(9446);let N=class{constructor(e){this.linkedWebsites=e}async execute({body:{credentialId:e,updatedLinkedWebsitesList:t}}){try{return await this.linkedWebsites.updateLinkedWebsites(t,e),(0,h.Vp)(void 0)}catch(e){return(0,h.Rn)({tag:"",error:e instanceof Error?e:new Error("Update linked websites command failed")})}}};N=(0,i.__decorate)([(0,I.W)(D.A),(0,i.__metadata)("design:paramtypes",[b])],N);let U=class{};U=(0,i.__decorate)([(0,a.Y)({api:o.G,handlers:{commands:{addLinkedWebsite:P,removeLinkedWebsite:R,updateLinkedWebsites:N},events:{},queries:{getDashlaneDefinedLinkedWebsites:C}},providers:[b]})],U)},80034:(e,t,r)=>{r.d(t,{r:()=>w});var s=r(88802),i=r(99634),a=r(45714),o=r(33084),n=r(95681),c=r(23347),l=r(25029),d=r(10722);const u=e=>void 0!==e&&"boolean"==typeof e;class p extends((0,n.Q)({persist:!0,storage:{initialValue:!1,typeGuard:u,schemaVersion:1},scope:l.F.User,storeName:"autofill-disabled-notification",capacity:c.Y._001KB,codec:d.E})){}var h=r(57924);let m=class{constructor(e){this.store=e}get autofillDisabledOnLoginsAndFormsNotificationStatus(){return{get$:this._getAutofillDisabledOnLoginsAndFormsNotificationStatus$,set:this._setAutofillDisabledOnLoginsAndFormsNotificationStatus.bind(this)}}get _getAutofillDisabledOnLoginsAndFormsNotificationStatus$(){return this.store.state$}async _setAutofillDisabledOnLoginsAndFormsNotificationStatus(e){try{await this.store.set(e)}catch{throw new Error("SetAutofillDisabledOnLoginsAndFormsNotificationStatus command from autofill-core failed")}}};m=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[p])],m);var g=r(63663),v=r(87279),y=r(61933);let _=class{constructor(e){this.autofillDisabledNotificationRepository=e}async execute({body:e}){const{status:t}=e;return await this.autofillDisabledNotificationRepository.autofillDisabledOnLoginsAndFormsNotificationStatus.set(t),(0,v.Vp)(void 0)}};_=(0,s.__decorate)([(0,g.W)(y.a),(0,s.__metadata)("design:paramtypes",[m])],_);var f=r(87065),S=r(20754),E=r(63208);let b=class{constructor(e){this.repository=e}execute(){return this.repository.autofillDisabledOnLoginsAndFormsNotificationStatus.get$.pipe((0,f.U)(v.Vp))}};b=(0,s.__decorate)([(0,S.e)(E.z),(0,s.__metadata)("design:paramtypes",[m])],b);let w=class{};w=(0,s.__decorate)([(0,i.Y)({api:a._,handlers:{commands:{setAutofillDisabledOnLoginsAndFormsNotificationStatus:_},events:{},queries:{getAutofillDisabledOnLoginsAndFormsNotificationStatus:b}},stores:[p],providers:[m],requiredFeatureFlips:Object.values(o.G)})],w)},74215:(e,t,r)=>{r.d(t,{k:()=>k});var s=r(88802),i=r(99634),a=r(38554),o=r(63663),n=r(93555),c=r(87279),l=r(86252);let d=class{constructor(e){this.carbonLegacyClient=e}async execute(){const{carbon:e}=this.carbonLegacyClient.commands,t=await e({name:"resetProtectedItemAutofillTimer",args:[]});return(0,c.hx)(t)?(0,c.Rn)({tag:"ResetProtectedItemAutofillTimer command from autofill/security failed"}):(0,c.Vp)(void 0)}};d=(0,s.__decorate)([(0,o.W)(n.y),(0,s.__metadata)("design:paramtypes",[l._])],d);var u=r(87065),p=r(85390),h=r(69885),m=r(57924),g=r(78364),v=r(52434),y=r(53998);let _=class{constructor(e){this.carbonLegacyClient=e,this.isUserSSO=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve premium status");return e.spaces})),(0,u.U)((e=>e?.[0].isSSOUser??!1)))},this.areProtectedItemsUnlocked=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return(0,p.a)([e({path:"userSession.session.lastMasterPasswordCheck"}),e({path:"userSession.account.login"})]).pipe((0,u.U)((([e,t])=>{if(!(0,c.d6)(e)||"number"!=typeof e.data)throw new Error("Cannot retrieve last master password check");if(!(0,c.d6)(t)||"string"!=typeof t.data)throw new Error("No active login");const r=e.data,s=t.data;return Date.now()-r<(/^kw_test_auto_fmpc_.*/.test(s)?5e3:3e5)})))},this.isItemUnlocked=()=>(0,p.a)([this.areProtectedItemsUnlocked(),this.isUserSSO()]).pipe((0,u.U)((([e,t])=>e||t))),this.isGlobalCredentialProtectionSettingOn=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.ProtectPasswords"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e)||"boolean"!=typeof e.data)throw new Error("No global setting found");return e.data})))},this.getCredentialProtectionStatus=e=>{const{carbonState:t}=this.carbonLegacyClient.queries;return t({path:"userSession.personalData.credentials"}).pipe((0,u.U)((t=>{if(!(0,c.d6)(t)||!(0,y.A)(t.data))throw new Error("Bad credential format");const r=t.data;return r.find((t=>t.Id===e))?.AutoProtected??!1})))},this.getIsMPRequiredForCreditCardOrSocialSecurityId=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.SecuredDataAutofillCreditcard"}).pipe((0,u.U)((e=>!(0,c.d6)(e)||"boolean"!=typeof e.data||e.data)))},this._isVaultItemProtected=(e,t)=>e===g.k.PaymentCard||e===g.k.SocialSecurityId?(0,p.a)([this.isItemUnlocked(),this.getIsMPRequiredForCreditCardOrSocialSecurityId()]).pipe((0,u.U)((([e,t])=>({disableMode:v.M.CannotDisable,isProtected:t&&!e})))):e===g.k.Credential?(0,p.a)([this.isItemUnlocked(),this.isGlobalCredentialProtectionSettingOn(),this.getCredentialProtectionStatus(t)]).pipe((0,u.U)((([e,t,r])=>t?{disableMode:v.M.DisableGeneralSetting,isProtected:!e}:{disableMode:v.M.DisableSpecificVaultItem,isProtected:r&&!e}))):(0,h.of)({disableMode:v.M.CannotDisable,isProtected:!1}),this._isPhishingPreventionEnabled=()=>{const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.nodePremiumStatus"}).pipe((0,u.U)((e=>{if(!(0,c.d6)(e))throw new Error("Cannot retrieve premium status");const t=e.data;return t.capabilities?.autofillWithPhishingPrevention.enabled??!1})))}}getIsVaultItemProtected$(e,t){return this._isVaultItemProtected(e,t).pipe((0,u.U)(c.Vp))}getIsPhishingPreventionEnabled$(){return this._isPhishingPreventionEnabled().pipe((0,u.U)(c.Vp))}};_=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[l._])],_);var f=r(20754),S=r(51730);let E=class{constructor(e){this.autofillSecurity=e}execute({body:e}){const{vaultItemId:t,vaultType:r}=e;return this.autofillSecurity.getIsVaultItemProtected$(r,t)}};E=(0,s.__decorate)([(0,f.e)(S.u),(0,s.__metadata)("design:paramtypes",[_])],E);var b=r(5282);let w=class{constructor(e){this.autofillSecurity=e}execute(){return this.autofillSecurity.getIsPhishingPreventionEnabled$()}};w=(0,s.__decorate)([(0,f.e)(b.i),(0,s.__metadata)("design:paramtypes",[_])],w);var A=r(94370),C=r(60399),I=r(95681),T=r(23347),P=r(25029),O=r(10722),R=r(64718);const D=e=>!!e&&"object"==typeof e&&Object.values(e).every((e=>Array.isArray(e)))&&Object.keys(e).every((e=>new R.Y(e).isUrlValid()));class N extends((0,I.Q)({persist:!0,storage:{initialValue:{},typeGuard:D,schemaVersion:1},scope:P.F.User,storeName:"phishing-prevention-optouts",capacity:T.Y._010KB,codec:O.E})){}let U=class{constructor(e){this.store=e}get phishingPreventionOptOuts(){return{get$:this._getPhishingPreventionOptOuts$,set$:this._setPhishingPreventionOptOut.bind(this)}}async disablePhishingPreventionForUrl(e,t){const r=await(0,C.z)(this._getPhishingPreventionOptOuts$),s={...r,[e]:Array.from(new Set(r[e]??[]).add(t))};await this._setPhishingPreventionOptOut(s)}get _getPhishingPreventionOptOuts$(){return this.store.state$}async _setPhishingPreventionOptOut(e){try{await this.store.set(e)}catch{throw new Error("SetPhishingPreventionOptOut command from autofill-core has failed")}}};U=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[N])],U);let F=class{constructor(e){this.phishingPreventionRepository=e}async execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return await this.phishingPreventionRepository.disablePhishingPreventionForUrl(e,t),(0,c.Vp)(void 0)}};F=(0,s.__decorate)([(0,o.W)(A.z),(0,s.__metadata)("design:paramtypes",[U])],F);var M=r(63212);let L=class{constructor(e){this.phishingPreventionRepository=e}execute({body:{credentialUrl:e,pasteDestinationUrl:t}}){return this.phishingPreventionRepository.phishingPreventionOptOuts.get$.pipe((0,u.U)((r=>e in r&&(r[e]??[]).includes(t))),(0,u.U)(c.Vp))}};L=(0,s.__decorate)([(0,f.e)(M.v),(0,s.__metadata)("design:paramtypes",[U])],L);var x=r(33084);let k=class{};k=(0,s.__decorate)([(0,i.Y)({api:a.V,handlers:{commands:{resetProtectedItemAutofillTimer:d,disablePhishingPreventionForUrl:F},events:{},queries:{getAutofillProtectionContext:E,isPhishingPreventionCapabilityEnabled:w,isPhishingPreventionDisabledForUrl:L}},stores:[N],providers:[_,U],requiredFeatureFlips:Object.values(x.G)})],k)},53998:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(57789);const i=e=>Array.isArray(e)&&e.every((e=>null!==e&&"object"==typeof e&&"kwType"in e&&(0,s.G)(e)))},53673:(e,t,r)=>{r.d(t,{P:()=>Se});var s=r(88802),i=r(99634),a=r(69029),o=r(33084),n=r(63663),c=r(50163),l=r(87279),d=r(86252);let u=class{constructor(e){this.carbonLegacyClient=e}async execute({body:e}){const{isAutofillEnabled:t,url:r}=e,{carbon:s}=this.carbonLegacyClient.commands,i=await s({name:"toggleDashlane",args:[{where:"site",autofill:t,autologin:t,url:r}]});if((0,l.hx)(i))throw new Error("Toggle Dashlane command from core-autofill failed");return(0,l.Vp)(void 0)}};u=(0,s.__decorate)([(0,n.W)(c.r),(0,s.__metadata)("design:paramtypes",[d._])],u);var p=r(87065),h=r(85390),m=r(43978),g=r(20754),v=r(64718),y=r(68573),_=r(28489);var f,S,E;!function(e){e[e.UNKNOWN_ERROR=0]="UNKNOWN_ERROR"}(f||(f={})),function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(S||(S={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(E||(E={}));const b=e=>{if(!(t=e)||"object"!=typeof t||!(0,_.l$)(t,"status")||"number"!=typeof t.status)throw new Error("twoFactorAuthentication is not of the expected type");var t;return e.status===E.READY&&e.shouldEnforceTwoFactorAuthentication},w=e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>"string"==typeof e));var A=r(60399),C=r(97280),I=r(57924),T=r(46154);var P=r(53998),O=r(82706);let R=class{constructor(e){this.carbonLegacyClient=e}get credentialsPreferences(){return{getByIds:this._getPreferencesForCredentials$.bind(this),set:this._setCredentialPreferences.bind(this)}}get isAutofillDisabled(){return{get$:this._getIsAutofillDisabled$,set:this._setIsAutofillDisabled.bind(this)}}get isAutologinDisabled(){return{get$:this._getIsAutologinDisabled$,set:this._setIsAutologinDisabled.bind(this)}}get disabledDomains(){return{get$:this._getDisabledDomains$,set:this._setDisabledDomains.bind(this),add:this._addDisabledDomains.bind(this),remove:this._removeDisabledDomains.bind(this)}}get disabledSourceTypes(){return{get$:this._getDisabledSourceTypes$,set:this._setDisabledSourceTypes.bind(this),add:this._addDisabledSourceTypes.bind(this),remove:this._removeDisabledSourceTypes.bind(this)}}get isFollowUpNotificationEnabled(){return{get$:this._getIsFollowUpNotificationEnabled$,set:this._setIsFollowUpNotificationEnabled.bind(this)}}async _updateSettings(e){const t=e.isAutofillDisabled??await(0,A.z)(this._getIsAutofillDisabled$),r=e.isAutologinDisabled??await(0,A.z)(this._getIsAutologinDisabled$),s=e.disabledDomains??await(0,A.z)(this._getDisabledDomains$),i=e.disabledSourceTypes??await(0,A.z)(this._getDisabledSourceTypes$),a=e.isFollowUpNotificationEnabled??await(0,A.z)(this._getIsFollowUpNotificationEnabled$),o=await this.carbonLegacyClient.commands.carbon({name:"updateAutofillSettings",args:[{AutofillSettings:{disabledDomains:s,disabledSourceTypes:i,isAutofillDisabled:t,isAutologinDisabled:r,isFollowUpNotificationEnabled:a}}]});if((0,l.hx)(o))throw new Error("Error when updating autofill settings using updateAutofillSettings query from Carbon")}get _getAutofillSettings$(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.personalSettings.AutofillSettings"}).pipe((0,p.U)((e=>{if(!(0,l.d6)(e)||!(e=>!!e&&"object"==typeof e&&(0,_.l$)(e,"isAutofillDisabled")&&"boolean"==typeof e.isAutofillDisabled&&(0,_.l$)(e,"isAutologinDisabled")&&"boolean"==typeof e.isAutologinDisabled&&(0,_.l$)(e,"disabledSourceTypes")&&(0,T.rF)(e.disabledSourceTypes)&&(0,_.l$)(e,"disabledDomains")&&Array.isArray(e.disabledDomains)&&e.disabledDomains.every((e=>"string"==typeof e))&&(0,_.l$)(e,"isFollowUpNotificationEnabled")&&"boolean"==typeof e.isFollowUpNotificationEnabled)(e.data))throw new Error("AutofillSettings is not of the expected type");return e.data})),(0,C.d)(1))}async _setCredentialPreferences({credentialId:e,credentialUrl:t,onlyAutofillExactDomain:r,requireMasterPassword:s,useAutoLogin:i,shouldSkipSync:a}){const{carbonLegacyLeeloo:o}=this.carbonLegacyClient.commands,n=await o({name:"savePersonalDataItem",arg:[{kwType:O.U.Credential,origin:"MANUAL",content:{id:e,url:t,onlyForThisSubdomain:r,autoLogin:i,protectWithMasterPassword:s},shouldSkipSync:a}]});if((0,l.hx)(n))throw new Error(`Failed to update credential preferences for: ${e}`)}_getPreferencesForCredentials$(e){const{carbonState:t}=this.carbonLegacyClient.queries;return t({path:"userSession.personalData.credentials"}).pipe((0,p.U)((t=>{if((0,l.hx)(t)||!(0,P.A)(t.data))throw new Error("Bad credentials format when retrieving credential preferences");const r=e.length?t.data.filter((t=>e.includes(t.Id))):t.data;if(e.length&&r.length!==e.length)throw new Error("not able to find one or more credentials corresponding to the provided ids");return(0,l.Vp)(r.map((e=>({id:e.Id,useAutoLogin:Boolean(e.AutoLogin),onlyAutofillExactDomain:Boolean(e.SubdomainOnly),requireMasterPassword:Boolean(e.AutoProtected)}))))})))}get _getIsAutofillDisabled$(){return this._getAutofillSettings$.pipe((0,p.U)((({isAutofillDisabled:e})=>e)))}_setIsAutofillDisabled(e){return this._updateSettings({isAutofillDisabled:e})}get _getIsAutologinDisabled$(){return this._getAutofillSettings$.pipe((0,p.U)((({isAutologinDisabled:e})=>e)))}_setIsAutologinDisabled(e){return this._updateSettings({isAutologinDisabled:e})}_setIsFollowUpNotificationEnabled(e){return this._updateSettings({isFollowUpNotificationEnabled:e})}get _getDisabledDomains$(){return this._getAutofillSettings$.pipe((0,p.U)((({disabledDomains:e})=>e)))}_setDisabledDomains(e){return this._updateSettings({disabledDomains:e})}async _addDisabledDomains(e){const t=await(0,A.z)(this._getDisabledDomains$);return this._setDisabledDomains([...new Set([...t,...e])])}async _removeDisabledDomains(e){const t=await(0,A.z)(this._getDisabledDomains$);return this._setDisabledDomains(t.filter((t=>!e.includes(t))))}get _getDisabledSourceTypes$(){return this._getAutofillSettings$.pipe((0,p.U)((({disabledSourceTypes:e})=>e)))}_setDisabledSourceTypes(e){return this._updateSettings({disabledSourceTypes:e})}async _addDisabledSourceTypes(e){const t=await(0,A.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes([...new Set([...t,...e])])}async _removeDisabledSourceTypes(e){const t=await(0,A.z)(this._getDisabledSourceTypes$);return this._setDisabledSourceTypes(t.filter((t=>!e.includes(t))))}get _getIsFollowUpNotificationEnabled$(){return this._getAutofillSettings$.pipe((0,p.U)((({isFollowUpNotificationEnabled:e})=>e)))}};R=(0,s.__decorate)([(0,I.GS)(),(0,s.__metadata)("design:paramtypes",[d._])],R);let D=class{constructor(e,t){this.carbonLegacyClient=e,this.settings=t}execute({body:{url:e}}){const{carbonState:t}=this.carbonLegacyClient.queries,r=new v.Y(e),s=r.getRootDomain(),i=r.getHost(),a=t({path:"device.killswitch.disableAutofill"}).pipe((0,p.U)((e=>{if(!(0,l.d6)(e)||!(e=>"boolean"==typeof e)(e.data))throw new Error("Error when fetching killswitch.disableAutofill");return e.data}))),o=(0,h.a)({isAutofillDisabled:this.settings.isAutofillDisabled.get$,disabledDomains:this.settings.disabledDomains.get$}).pipe((0,m.w)((async({isAutofillDisabled:e,disabledDomains:t})=>e||t.includes(await s)))),n=t({path:"userSession.spaceData.spaces"}).pipe((0,m.w)((async e=>{if(!(0,l.d6)(e)||!(e=>!!e&&"object"==typeof e&&Array.isArray(e)&&e.every((e=>(0,_.l$)(e,"details")&&(0,_.l$)(e.details,"info"))))(e.data))throw new Error("Error when fetching spaceData.spaces");const t=e.data.reduce(((e,t)=>{const r=t.details.info.autologinDomainDisabledArray;return[...e,...w(r)?r:[]]}),[]),r=await i;return t.some((e=>{const t=new v.Y(e).getHost();return t===r||r.endsWith(`.${t}`)}))}))),c=t({path:"authentication.twoFactorAuthentication"}).pipe((0,p.U)((e=>{if(!(0,l.d6)(e))throw new Error("Error when fetching authentication.twoFactorAuthentication");return b(e.data)})));return(0,h.a)({isAutofillDisabledByB2BAdmin:n,isAutofillDisabledByKillswitch:a,isAutofillDisabledByUser:o,isAutofillDisabledBy2FAEnforcement:c}).pipe((0,p.U)((({isAutofillDisabledBy2FAEnforcement:e,isAutofillDisabledByB2BAdmin:t,isAutofillDisabledByKillswitch:r,isAutofillDisabledByUser:s})=>{let i=y._.ANALYSIS_ENABLED;return r?i=y._.ANALYSIS_DISABLED_BY_KILLSWITCH:t?i=y._.ANALYSIS_DISABLED_BY_B2B_ADMIN:s?i=y._.ANALYSIS_DISABLED_BY_USER:e&&(i=y._.ANALYSIS_DISABLED_BY_2FA_ENFORCEMENT),(0,l.Vp)({analysisStatus:i})})))}};D=(0,s.__decorate)([(0,g.e)(y.h),(0,s.__metadata)("design:paramtypes",[d._,R])],D);var N=r(63267);let U=class{constructor(e){this.settings=e}execute(){return(0,h.a)({disabledDomains:this.settings.disabledDomains.get$,disabledSourceTypes:this.settings.disabledSourceTypes.get$,isAutofillDisabled:this.settings.isAutofillDisabled.get$,isAutologinDisabled:this.settings.isAutologinDisabled.get$,isFollowUpNotificationEnabled:this.settings.isFollowUpNotificationEnabled.get$}).pipe((0,p.U)(l.Vp))}};U=(0,s.__decorate)([(0,g.e)(N.T),(0,s.__metadata)("design:paramtypes",[R])],U);var F=r(99682);let M=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.add(e),(0,l.Vp)(void 0)}};M=(0,s.__decorate)([(0,n.W)(F.g),(0,s.__metadata)("design:paramtypes",[R])],M);var L=r(46918);let x=class{constructor(e){this.settings=e}async execute({body:{sourceTypes:e}}){return await this.settings.disabledSourceTypes.remove(e),(0,l.Vp)(void 0)}};x=(0,s.__decorate)([(0,n.W)(L.v),(0,s.__metadata)("design:paramtypes",[R])],x);var k=r(54405);let G=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!1),(0,l.Vp)(void 0)}};G=(0,s.__decorate)([(0,n.W)(k.c),(0,s.__metadata)("design:paramtypes",[R])],G);var V=r(3909);let K=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutofillDisabled.set(!0),(0,l.Vp)(void 0)}};K=(0,s.__decorate)([(0,n.W)(V.u),(0,s.__metadata)("design:paramtypes",[R])],K);var j=r(4924);let B=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutologinDisabled.set(!1),(0,l.Vp)(void 0)}};B=(0,s.__decorate)([(0,n.W)(j.i),(0,s.__metadata)("design:paramtypes",[R])],B);var W=r(34962);let z=class{constructor(e){this.settings=e}async execute(){return await this.settings.isAutologinDisabled.set(!0),(0,l.Vp)(void 0)}};z=(0,s.__decorate)([(0,n.W)(W.T),(0,s.__metadata)("design:paramtypes",[R])],z);var H=r(38018);let Q=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...T.up]),(0,l.Vp)(void 0)}};Q=(0,s.__decorate)([(0,n.W)(H.a),(0,s.__metadata)("design:paramtypes",[R])],Q);var q=r(69643);let Y=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.remove([...T.q_]),(0,l.Vp)(void 0)}};Y=(0,s.__decorate)([(0,n.W)(q.I),(0,s.__metadata)("design:paramtypes",[R])],Y);var $=r(82796);let X=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!0),(0,l.Vp)(void 0)}};X=(0,s.__decorate)([(0,n.W)($.B),(0,s.__metadata)("design:paramtypes",[R])],X);var Z=r(65791);let J=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...T.up]),(0,l.Vp)(void 0)}};J=(0,s.__decorate)([(0,n.W)(Z.t),(0,s.__metadata)("design:paramtypes",[R])],J);var ee=r(56e3);let te=class{constructor(e){this.settings=e}async execute(){return await this.settings.disabledSourceTypes.add([...T.q_]),(0,l.Vp)(void 0)}};te=(0,s.__decorate)([(0,n.W)(ee.f),(0,s.__metadata)("design:paramtypes",[R])],te);var re=r(11232);let se=class{constructor(e){this.settings=e}async execute(){return await this.settings.isFollowUpNotificationEnabled.set(!1),(0,l.Vp)(void 0)}};se=(0,s.__decorate)([(0,n.W)(re.y),(0,s.__metadata)("design:paramtypes",[R])],se);var ie=r(29641),ae=r(3124),oe=r(95681),ne=r(23347),ce=r(25029),le=r(10722);const de=e=>!!e&&(0,ae.P)(e);class ue extends((0,oe.Q)({persist:!0,storage:{initialValue:[],typeGuard:de,schemaVersion:1},scope:ce.F.Device,storeName:"user-autofill-corrections",capacity:ne.Y._100KB,codec:le.E})){}let pe=class{constructor(e){this.store=e}get userAutofillCorrections(){return{get$:this._getUserAutofillCorrections$,set:this._setUserAutofillCorrections.bind(this)}}get _getUserAutofillCorrections$(){return this.store.state$}async _setUserAutofillCorrections(e){try{await this.store.set(e)}catch{throw new Error("SetUserAutofillCorrections command from core-autofill failed")}}};pe=(0,s.__decorate)([(0,I.GS)(),(0,s.__metadata)("design:paramtypes",[ue])],pe);let he=class{constructor(e){this.correctionsRepository=e}async execute({body:e}){const{corrections:t}=e;return await this.correctionsRepository.userAutofillCorrections.set(t),(0,l.Vp)(void 0)}};he=(0,s.__decorate)([(0,n.W)(ie.S),(0,s.__metadata)("design:paramtypes",[pe])],he);var me=r(15269);let ge=class{constructor(e){this.autofillSettings=e}async execute({body:e}){try{return await this.autofillSettings.credentialsPreferences.set(e),(0,l.Vp)(void 0)}catch(e){const t=e instanceof Error?e.message:"unable to update credential preferences";return(0,l.Rn)({tag:"error",errorMessage:t})}}};ge=(0,s.__decorate)([(0,n.W)(me.J),(0,s.__metadata)("design:paramtypes",[R])],ge);var ve=r(3414);let ye=class{constructor(e){this.settings=e}execute(){return this.settings.userAutofillCorrections.get$.pipe((0,p.U)(l.Vp))}};ye=(0,s.__decorate)([(0,g.e)(ve.w),(0,s.__metadata)("design:paramtypes",[pe])],ye);var _e=r(95371);let fe=class{constructor(e){this.autofillSettingsRepository=e}execute({body:{credentialIds:e=[]}}){return this.autofillSettingsRepository.credentialsPreferences.getByIds(e)}};fe=(0,s.__decorate)([(0,g.e)(_e.g),(0,s.__metadata)("design:paramtypes",[R])],fe);let Se=class{};Se=(0,s.__decorate)([(0,i.Y)({api:a.I,handlers:{commands:{toggleDashlane:u,enableAnalysis:G,enableAutologin:B,enableAutofillOnForms:Q,enableAutofillOnLogins:Y,enableFollowUpNotification:X,disableAnalysis:K,disableAutologin:z,disableAutofillOnForms:J,disableAutofillOnLogins:te,disableFollowUpNotification:se,addDisabledSourceTypes:M,removeDisabledSourceTypes:x,setUserAutofillCorrections:he,updateCredentialPreferences:ge},events:{},queries:{getAnalysisStatusOnUrl:D,getAutofillSettings:U,getUserAutofillCorrections:ye,getPreferencesForCredentials:fe}},stores:[ue],providers:[R,pe],requiredFeatureFlips:Object.values(o.G)})],Se)},92137:(e,t,r)=>{r.r(t),r.d(t,{DismissMasterPasswordNotificationCommand:()=>i.T,IsMasterPasswordLeakedQuery:()=>c.B,IsMasterPasswordNotificationDismissedQuery:()=>l.F,IsMasterPasswordWeakQuery:()=>d.D,TemporaryCheckMasterPasswordCommand:()=>a.T,TemporaryCheckMasterPasswordWeakCommand:()=>n.B,TemporaryResetMasterPasswordLeakedCommand:()=>o.j,masterPasswordSecurityApi:()=>s.J});var s=r(75962),i=r(80673),a=r(88030),o=r(30600),n=r(5105),c=r(22730),l=r(23913),d=r(86695)},75962:(e,t,r)=>{r.d(t,{J:()=>u});var s=r(86952),i=r(80673),a=r(88030),o=r(30600),n=r(5105),c=r(22730),l=r(86695),d=r(23913);const u=(0,s.Q)({name:"masterPasswordSecurity",commands:{dismissMasterPasswordNotification:i.T,temporaryCheckMasterPassword:a.T,temporaryResetMasterPasswordLeaked:o.j,temporaryCheckMasterPasswordWeak:n.B},events:{},queries:{isMasterPasswordLeaked:c.B,isMasterPasswordWeak:l.D,isMasterPasswordNotificationDismissed:d.F}})},80673:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},5105:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},88030:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},30600:(e,t,r)=>{r.d(t,{j:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},22730:(e,t,r)=>{r.d(t,{B:()=>i});var s=r(99059);class i extends((0,s.k)()){}},23913:(e,t,r)=>{r.d(t,{F:()=>i});var s=r(99059);class i extends((0,s.k)()){}},86695:(e,t,r)=>{r.d(t,{D:()=>i});var s=r(99059);class i extends((0,s.k)()){}},97500:(e,t,r)=>{r.d(t,{f:()=>Ne});var s=r(99634),i=r(75962),a=r(37935),o=r(93850),n=r(70305),c=r(20754),l=r(22730),d=r(25029),u=r(95681),p=r(23347),h=r(10722),m=r(7165);const g=m.z.object({isMasterPasswordLeaked:m.z.boolean(),isMasterPasswordNotificationDismissed:m.z.boolean(),isMasterPasswordWeak:m.z.boolean(),lastCheckTimestamp:m.z.number()}),v=e=>g.safeParse(e).success;class y extends((0,u.Q)({persist:!0,storage:{initialValue:{isMasterPasswordWeak:!1,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1,lastCheckTimestamp:0},typeGuard:v,schemaVersion:1},scope:d.F.User,isCache:!0,storeName:"master-password-security",codec:h.E,capacity:p.Y._001KB})){}var _=r(87279),f=r(87065),S=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},E=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let b=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,f.U)((e=>(0,_.Vp)(e.isMasterPasswordLeaked))))}};b=S([(0,c.e)(l.B),E("design:paramtypes",[y])],b);var w=r(86695),A=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},C=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let I=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,f.U)((e=>(0,_.Vp)(e.isMasterPasswordWeak))))}};I=A([(0,c.e)(w.D),C("design:paramtypes",[y])],I);var T=r(23913),P=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},O=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let R=class{constructor(e){this.masterPasswordSecurityStore=e}execute(){return this.masterPasswordSecurityStore.state$.pipe((0,f.U)((e=>(0,_.Vp)(e.isMasterPasswordNotificationDismissed))))}};R=P([(0,c.e)(T.F),O("design:paramtypes",[y])],R);var D=r(63663),N=r(80673),U=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},F=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let M=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!0}),Promise.resolve((0,_.Vp)(void 0))}};M=U([(0,D.W)(N.T),F("design:paramtypes",[y])],M);var L=r(88030),x=r(57924),k=r(87113),G=r(60399),V=r(79256),K=r(96303),j=r(54066),B=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},W=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let z=class{constructor(e){this.argon2dDeriver=e}async hash(e){return(0,K.k)(await this.argon2dDeriver.derive((0,j.u)(e),(0,j.u)("z8CXohryCcGAa7CESNHYnedqbDyp"),{tCost:3,mCost:32768,parallelism:2}))}};z=B([(0,x.GS)(),W("design:paramtypes",[V.y])],z);var H=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Q=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let q=class{constructor(e,t,r){this.serverApiClient=e,this.masterPasswordSecurityStore=t,this.passwordHasher=r}shouldBeChecked(){return(0,G.z)(this.masterPasswordSecurityStore.state$.pipe((0,f.U)((e=>!e.isMasterPasswordLeaked&&e.lastCheckTimestamp+864e5<=Date.now()))))}async check(e){const t=await this.passwordHasher.hash(e),r=await(0,G.z)(this.serverApiClient.v1.pwleak.getHashes({hashPrefix:t.substring(0,6)}));if((0,_.hx)(r))throw new Error("Error while retrieving list of hashes for MP checking");const s=r.data.data.includes(t),i=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...i,isMasterPasswordLeaked:s,lastCheckTimestamp:Date.now()})}};q=H([(0,x.GS)(),Q("design:paramtypes",[k.l,y,z])],q);var Y=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},$=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let X=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordNotificationDismissed:!1})}};X=Y([(0,x.GS)(),$("design:paramtypes",[y])],X);var Z=r(94189),J=r(20587),ee=r(26897),te=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},re=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let se=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(J.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new ee.AnonymousMasterPasswordHealthReportEvent({isLeaked:t.isMasterPasswordLeaked})})}};se=te([(0,x.GS)(),re("design:paramtypes",[y,Z.w])],se);var ie=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let oe=class{constructor(e,t,r){this.checkMasterPasswordService=e,this.resetMasterPasswordNotification=t,this.anonymousMasterPasswordLeakedTrackingEventSender=r}async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordService.shouldBeChecked()?(await this.checkMasterPasswordService.check(e.password),this.anonymousMasterPasswordLeakedTrackingEventSender.send(),Promise.resolve((0,_.Vp)(void 0))):Promise.resolve((0,_.Vp)(void 0))}};oe=ie([(0,D.W)(L.T),ae("design:paramtypes",[q,X,se])],oe);var ne=r(30600),ce=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},le=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let de=class{constructor(e){this.masterPasswordSecurityStore=e}async execute(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,lastCheckTimestamp:0,isMasterPasswordLeaked:!1,isMasterPasswordNotificationDismissed:!1}),Promise.resolve((0,_.Vp)(void 0))}};de=ce([(0,D.W)(ne.j),le("design:paramtypes",[y])],de);var ue=r(5105),pe=r(85465);const he=async e=>{if(e)return await(async e=>(await(0,pe.evaluate)(e)).score)(e)/25};var me=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},ge=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let ve=class{constructor(e){this.masterPasswordSecurityStore=e}async check(e){const t=(await he(e)??5)<3,r=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...r,isMasterPasswordWeak:t})}};ve=me([(0,x.GS)(),ge("design:paramtypes",[y])],ve);var ye=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},_e=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let fe=class{constructor(e,t){this.masterPasswordSecurityStore=e,this.cqrsClient=t}async send(){const{commands:{trackEvent:e}}=this.cqrsClient.getClient(J.Yu),t=await this.masterPasswordSecurityStore.getState();await e({event:new ee.AnonymousMasterPasswordHealthReportEvent({isWeak:t.isMasterPasswordWeak})})}};fe=ye([(0,x.GS)(),_e("design:paramtypes",[y,Z.w])],fe);var Se=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ee=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let be=class{constructor(e,t,r){this.checkMasterPasswordWeakService=e,this.anonymousMasterPasswordWeakTrackingEventSender=t,this.resetMasterPasswordNotification=r}async execute({body:e}){return await this.resetMasterPasswordNotification.reset(),await this.checkMasterPasswordWeakService.check(e.password),this.anonymousMasterPasswordWeakTrackingEventSender.send(),Promise.resolve((0,_.Vp)(void 0))}};be=Se([(0,D.W)(ue.B),Ee("design:paramtypes",[ve,fe,X])],be);var we=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Ae=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Ce=class{constructor(e){this.masterPasswordSecurityStore=e}async reset(){const e=await this.masterPasswordSecurityStore.getState();return await this.masterPasswordSecurityStore.set({...e,isMasterPasswordWeak:!1})}};Ce=we([(0,x.GS)(),Ae("design:paramtypes",[y])],Ce);var Ie=r(68307),Te=r(67490),Pe=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o},Oe=function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};let Re=class{constructor(e){this.resetMasterPasswordWeak=e}handle(){return this.resetMasterPasswordWeak.reset(),Promise.resolve(void 0)}};Re=Pe([(0,Ie.b)(Te.D),Oe("design:paramtypes",[Ce])],Re);var De=function(e,t,r,s){var i,a=arguments.length,o=a<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,r):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,s);else for(var n=e.length-1;n>=0;n--)(i=e[n])&&(o=(a<3?i(o):a>3?i(t,r,o):i(t,r))||o);return a>3&&o&&Object.defineProperty(t,r,o),o};let Ne=class{};Ne=De([(0,s.Y)({api:i.J,handlers:{commands:{dismissMasterPasswordNotification:M,temporaryCheckMasterPassword:oe,temporaryResetMasterPasswordLeaked:de,temporaryCheckMasterPasswordWeak:be},events:{...(0,s.g)(n.v,{masterPasswordChanged:Re})},queries:{isMasterPasswordLeaked:b,isMasterPasswordWeak:I,isMasterPasswordNotificationDismissed:R}},providers:[q,z,X,ve,se,fe,Ce],imports:[a.D,o.n],stores:[y]})],Ne)},43894:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(86952),i=r(11730),a=r(9932);const o=(0,s.Q)({name:"notifications",commands:{},events:{},queries:{GetPlanPricingQuery:i.c,GetUserMessagesQuery:a.m}})},11730:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},9932:(e,t,r)=>{r.d(t,{m:()=>o});var s,i=r(99059),a=r(25029);!function(e){e.DEFAULT="default",e.TRIAL_EXPIRED="trial_expired",e.WEB_STORE="web_store",e.DASHBOARD_UPGRADE="dashboard_upgrade",e.SHARING_CENTER_FAMILY="sharing_center_family",e.SHARING_CENTER_WORK="sharing_center_work"}(s||(s={}));class o extends((0,i.k)({scope:a.F.User})){}},80260:(e,t,r)=>{r.d(t,{F:()=>E});var s=r(88802),i=r(99634),a=r(43894),o=r(30523),n=r(87065),c=r(43978),l=r(20754),d=r(86252),u=r(11730),p=r(57924),h=r(87113),m=r(48844),g=r(87279);let v=class{constructor(e){this.serverApiClient=e,this.getPeriodicity=(e,t)=>"d"===e&&t>=30||"M"===e&&1===t?"monthly":"y"===e&&1===t||"M"===e&&12===t?"yearly":"other"}getPlanPricing({login:e,userKey:t,couponCode:r,language:s,hasEssentials:i}){return this.serverApiClient.v1.payments.getAccessibleWebOffers({login:e,userKey:t,couponCode:r,language:s,forceFamily:!0,hasEssentials:i}).pipe((0,m.DZ)((e=>{throw new Error(`GetPlanPricing failed with error: ${e}`)})),(0,m.lk)((e=>{const{plans:t,currency:r}=e.data,{family:s,premium:i}=t,{offers:a,...o}=s,{offers:n,...c}=i,l={plans:{family:{offers:a.map((({price:e,duration:t,...r})=>({price:.01*(e??0),billingPeriod:{periodicity:this.getPeriodicity(t.unit,t.value),value:t.value},...r}))),...o},premium:{offers:n.map((({price:e,duration:t,...r})=>({price:.01*(e??0),billingPeriod:{periodicity:this.getPeriodicity(t.unit,t.value),value:t.value},...r}))),...c}},currency:r};return(0,g.Vp)(l)})))}};v=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.l])],v);let y=class{constructor(e,t){this.carbonLegacyClient=e,this.webOffersService=t}execute(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.account.login"}).pipe((0,o.h)(g.d6),(0,n.U)((e=>e.data)),(0,c.w)((e=>this.webOffersService.getPlanPricing({login:e}))))}};y=(0,s.__decorate)([(0,l.e)(u.c),(0,s.__metadata)("design:paramtypes",[d._,v])],y);var _=r(9932);let f=class{constructor(e){this.carbonLegacyClient=e}execute(){const{carbonState:e}=this.carbonLegacyClient.queries;return e({path:"userSession.localSettings.userMessages"}).pipe((0,m.Qn)((e=>e)))}};f=(0,s.__decorate)([(0,l.e)(_.m),(0,s.__metadata)("design:paramtypes",[d._])],f);var S=r(93850);let E=class{};E=(0,s.__decorate)([(0,i.Y)({api:a.B,handlers:{commands:{},events:{},queries:{getPlanPricing:y,getUserMessages:f}},imports:[S.n],providers:[v]})],E)},86021:(e,t,r)=>{r.d(t,{U:()=>d});var s=r(86952),i=r(88041),a=r(52442),o=r(62960),n=r(91438),c=r(46855),l=r(74352);const d=(0,s.Q)({name:"getStarted",commands:{dismissGetStarted:i.A,markAdminConsoleOpened:a.T},events:{},queries:{hasCompletedAutofillTutorial:o.G,hasCompletedCredentialTutorial:n.x,hasOpenedAdminConsole:c.s,isGetStartedDismissed:l.A}})},88041:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},52442:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},62960:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},91438:(e,t,r)=>{r.d(t,{x:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},46855:(e,t,r)=>{r.d(t,{s:()=>i});var s=r(99059);class i extends((0,s.k)()){}},74352:(e,t,r)=>{r.d(t,{A:()=>i});var s=r(99059);class i extends((0,s.k)()){}},59382:(e,t,r)=>{r.d(t,{$:()=>F});var s=r(88802),i=r(99634),a=r(86021),o=r(25029),n=r(95681),c=r(23347),l=r(10722),d=r(7165);const u=d.z.object({hasOpenedAdminConsole:d.z.boolean(),isGetStartedDismissed:d.z.boolean()}),p=e=>u.safeParse(e).success;class h extends((0,n.Q)({storage:{schemaVersion:1,initialValue:{hasOpenedAdminConsole:!1,isGetStartedDismissed:!1},typeGuard:p},persist:!0,scope:o.F.User,storeName:"onboarding-get-started-store",capacity:c.Y._010KB,codec:l.E})){}var m=r(63663),g=r(87279),v=r(88041);let y=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState();return await this.store.set({...e,isGetStartedDismissed:!0}),Promise.resolve((0,g.Vp)(void 0))}};y=(0,s.__decorate)([(0,m.W)(v.A),(0,s.__metadata)("design:paramtypes",[h])],y);var _=r(52442);let f=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState();return await this.store.set({...e,hasOpenedAdminConsole:!0}),Promise.resolve((0,g.Vp)(void 0))}};f=(0,s.__decorate)([(0,m.W)(_.T),(0,s.__metadata)("design:paramtypes",[h])],f);var S=r(20754),E=r(62960),b=r(57924),w=r(86252),A=r(87065);let C=class{constructor(e){this.carbonLegacyClient=e}get(){return this.carbonLegacyClient.queries.getWebOnboardingMode().pipe((0,A.U)((e=>{if(!(0,g.d6)(e))throw new Error("Error while retrieving the legacy onboarding state");return e.data.completedSteps})))}getAutofillTaskCompletion(){return this.get().pipe((0,A.U)((e=>(0,g.Vp)(!!e?.tryAutofillOnWeb))))}getCredentialTaskCompletion(){return this.get().pipe((0,A.U)((e=>(0,g.Vp)(!!e?.saveCredentialOnWeb))))}};C=(0,s.__decorate)([(0,b.GS)(),(0,s.__metadata)("design:paramtypes",[w._])],C);let I=class{constructor(e){this.onboardingStateGetterService=e}execute(){return this.onboardingStateGetterService.getAutofillTaskCompletion()}};I=(0,s.__decorate)([(0,S.e)(E.G),(0,s.__metadata)("design:paramtypes",[C])],I);var T=r(91438);let P=class{constructor(e){this.onboardingStateGetterService=e}execute(){return this.onboardingStateGetterService.getCredentialTaskCompletion()}};P=(0,s.__decorate)([(0,S.e)(T.x),(0,s.__metadata)("design:paramtypes",[C])],P);var O=r(46855);let R=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,A.U)((e=>(0,g.Vp)(e.hasOpenedAdminConsole))))}};R=(0,s.__decorate)([(0,S.e)(O.s),(0,s.__metadata)("design:paramtypes",[h])],R);var D=r(74352);let N=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,A.U)((e=>(0,g.Vp)(e.isGetStartedDismissed))))}};var U;N=(0,s.__decorate)([(0,S.e)(D.A),(0,s.__metadata)("design:paramtypes",[h])],N),function(e){e.OnboardingWebAdminVaultGetStartedGuide="onboarding_web_adminVaultGetStartedGuide",e.OnboardingWebConfirmSite="onboarding_web_onboarding",e.OnboardingWebExtensionInstallStaticBanner="onboarding_web_extensionInstallStaticBanner",e.OnboardingWebFirstInviteAndShare="onboarding_web_firstInviteAndShare",e.SaexOnboardingHubAddPasswords="saexOnboardingHubAddPasswords"}(U||(U={}));let F=class{};F=(0,s.__decorate)([(0,i.Y)({api:a.U,stores:[h],handlers:{commands:{dismissGetStarted:y,markAdminConsoleOpened:f},events:{},queries:{hasCompletedAutofillTutorial:I,hasCompletedCredentialTutorial:P,hasOpenedAdminConsole:R,isGetStartedDismissed:N}},providers:[C],requiredFeatureFlips:Object.values(U)})],F)},8122:(e,t,r)=>{r.d(t,{J:()=>o});var s=r(86952),i=r(47010),a=r(76107);const o=(0,s.Q)({name:"antiphishing",commands:{addAutoRedirectedDomain:a.A},events:{},queries:{isAutoRedirectedDomain:i.U}})},76107:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},47010:(e,t,r)=>{r.d(t,{U:()=>i});var s=r(99059);class i extends((0,s.k)()){}},71450:(e,t,r)=>{r.d(t,{H:()=>c});var s=r(86952),i=r(26254),a=r(91619),o=r(30240),n=r(60135);const c=(0,s.Q)({name:"breaches",commands:{dismissBreach:i.n,markBreachAsSeen:a.Q},events:{},queries:{breach:o.i,unreadBreachesCount:n.L}})},49186:(e,t,r)=>{var s,i;r.d(t,{J:()=>s,K:()=>i}),function(e){e.PENDING="PENDING",e.VIEWED="VIEWED",e.ACKNOWLEDGED="ACKNOWLEDGED"}(s||(s={})),function(e){e.Username="username",e.Password="password",e.Email="email",e.CreditCard="creditcard",e.Phone="phone",e.Address="address",e.SSN="ssn",e.IP="ip",e.Location="geolocation",e.PersonalInfo="personalinfo",e.SocialNetwork="social"}(i||(i={}))},26254:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},91619:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},30240:(e,t,r)=>{r.d(t,{i:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},60135:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},96248:(e,t,r)=>{r.d(t,{M:()=>l});var s=r(86952),i=r(9310),a=r(21444),o=r(94814),n=r(9062),c=r(36214);const l=(0,s.Q)({name:"emailMonitoring",commands:{dismissOnboardingNotification:i.n,optinEmail:a.P5,optoutEmail:o.Lc},events:{},queries:{emailList:n.dB,onboardingNotificationState:c.p}})},9310:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},21444:(e,t,r)=>{r.d(t,{Dq:()=>o,Iy:()=>c,P5:()=>p,Qj:()=>d,XX:()=>n,pK:()=>l,tp:()=>u});var s=r(74354),i=r(25029),a=r(96168);const o="OK";var n;!function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.ALREADY_SUBSCRIBED="USER_HAS_ALREADY_AN_ACTIVE_SUBSCRIPTION",e.TOO_MANY_SUBSCRIPTIONS="USER_HAS_TOO_MANY_SUBSCRIPTIONS",e.GENERIC_ERROR="GENERIC_ERROR"}(n||(n={}));const c=(0,a.Vj)(n.INVALID_EMAIL,""),l=(0,a.Vj)(n.ALREADY_SUBSCRIBED,""),d=(0,a.Vj)(n.TOO_MANY_SUBSCRIPTIONS,""),u=(0,a.Vj)(n.GENERIC_ERROR,"");class p extends((0,s.g)({scope:i.F.User})){}},94814:(e,t,r)=>{r.d(t,{KP:()=>n,Lc:()=>u,QS:()=>o,h1:()=>l,uD:()=>c,v4:()=>d});var s=r(74354),i=r(25029),a=r(96168);const o="OK";var n;!function(e){e.INVALID_EMAIL="EMAIL_IS_INVALID",e.NO_SUBSCRIPTION="USER_HAS_NO_SUBSCRIPTION",e.GENERIC_ERROR="GENERIC_ERROR"}(n||(n={}));class c extends((0,a.Hu)(n.INVALID_EMAIL,"")){}class l extends((0,a.Hu)(n.NO_SUBSCRIPTION,"")){}class d extends((0,a.Hu)(n.GENERIC_ERROR,"")){}class u extends((0,s.g)({scope:i.F.User})){}},57255:(e,t,r)=>{var s;function i(e){return"UNKNOWN"===e||"SEEN"===e||"NOT_SEEN"===e}r.d(t,{M:()=>s,U:()=>i}),function(e){e.UNKNOWN="UNKNOWN",e.SEEN="SEEN",e.NOT_SEEN="NOT_SEEN"}(s||(s={}))},9062:(e,t,r)=>{r.d(t,{a2:()=>a,dB:()=>o,wp:()=>s});var s,i=r(99059);function a(e){return"pending"===e||"active"===e||"disabled"===e}!function(e){e.PENDING="pending",e.ACTIVE="active",e.DISABLED="disabled"}(s||(s={}));class o extends((0,i.k)()){}},36214:(e,t,r)=>{r.d(t,{p:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},61184:(e,t,r)=>{r.r(t),r.d(t,{AddAutoRedirectedDomainCommand:()=>U.A,BreachLeakedDataType:()=>g.K,BreachQuery:()=>h.i,BreachState:()=>g.J,CompromisedCredentialsIdsForBreachQuery:()=>w.A,CompromisedCredentialsQuery:()=>E.v,CorruptionDataSeverity:()=>P.bp,CorruptionDataStrength:()=>P.ub,CredentialHealthDataQuery:()=>y.w,DarkWebOnboardingState:()=>l.M,DataLeaksEmailStatus:()=>n.wp,DismissBreachCommand:()=>u.n,DismissOnboardingNotificationCommand:()=>i.n,EmailsListQuery:()=>n.dB,FilterCredentialsIdsQuery:()=>S.M,FilterCredentialsQuery:()=>f.Q,HealthFilter:()=>P._x,IsAutoRedirectedDomainQuery:()=>N.U,MarkBreachAsSeenCommand:()=>p.Q,OnboardingNotificationStateQuery:()=>c.p,OptinDataLeaksResultErrorCode:()=>a.XX,OptinDataLeaksResultOkCode:()=>a.Dq,OptinEmailCommand:()=>a.P5,OptoutDataLeaksResultErrorCode:()=>o.KP,OptoutDataLeaksResultOkCode:()=>o.QS,OptoutEmailCommand:()=>o.Lc,OptoutGenericError:()=>o.v4,OptoutInvalidEmailError:()=>o.uD,OptoutNoSubscriptionError:()=>o.h1,OtpCodeForSecretOrUrlGenerationError:()=>L.k,OtpCodeForSecretOrUrlQuery:()=>L.S,OtpCodeGenerationError:()=>M.c,OtpCodeQuery:()=>M.J,PasswordHealthClient:()=>O.L,PasswordHealthComputationFinishedEvent:()=>T.w,PasswordHealthReportQuery:()=>b.b,RecalculatePasswordHealthCommand:()=>I.t,RiskType:()=>P.gI,ScoreForPasswordQuery:()=>A.c,ScoreQuery:()=>_.e,SetupOtpCodeForCredentialCommand:()=>x.z,UnreadBreachesCountQuery:()=>m.L,UpdateIsCredentialExcludedCommand:()=>C.v,antiphishingApi:()=>D.J,breachesApi:()=>d.H,createOptinAlreadySubscribedError:()=>a.pK,createOptinGenericError:()=>a.tp,createOptinInvalidEmailError:()=>a.Iy,createOptinTooManySubscriptionsError:()=>a.Qj,emailMonitoringApi:()=>s.M,isDarkWebOnboardingState:()=>l.U,isDataLeaksEmailStatus:()=>n.a2,otpApi:()=>F.i,passwordHealthApi:()=>v.d,vaultReportApi:()=>R.f});var s=r(96248),i=r(9310),a=r(21444),o=r(94814),n=r(9062),c=r(36214),l=r(57255),d=r(71450),u=r(26254),p=r(91619),h=r(30240),m=r(60135),g=r(49186),v=r(57668),y=r(99097),_=r(75787),f=r(53489),S=r(33850),E=r(65796),b=r(7466),w=r(32069),A=r(5998),C=r(76687),I=r(45806),T=r(25547),P=r(4253),O=r(95479),R=r(93856),D=r(8122),N=r(47010),U=r(76107),F=r(90056),M=r(25619),L=r(5158),x=r(12071)},90056:(e,t,r)=>{r.d(t,{i:()=>n});var s=r(86952),i=r(25619),a=r(5158),o=r(12071);const n=(0,s.Q)({name:"otp",commands:{setupOtpCodeForCredential:o.z},events:{},queries:{otpCode:i.J,otpCodeForSecretOrUrl:a.S}})},12071:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},25619:(e,t,r)=>{r.d(t,{J:()=>n,c:()=>o});var s=r(99059),i=r(25029),a=r(96168);class o extends((0,a.Hu)("Cannot generate OTP code due to no OtpSecret or OtpUrl found for credential","")){}class n extends((0,s.k)({scope:i.F.User})){}},5158:(e,t,r)=>{r.d(t,{S:()=>n,k:()=>o});var s=r(99059),i=r(25029),a=r(96168);class o extends((0,a.Hu)("Cannot generate OTP code for secret or url","")){}class n extends((0,s.k)({scope:i.F.User})){}},57668:(e,t,r)=>{r.d(t,{d:()=>g});var s=r(86952),i=r(76687),a=r(45806),o=r(25547),n=r(99097),c=r(53489),l=r(33850),d=r(75787),u=r(65796),p=r(32069),h=r(7466),m=r(5998);const g=(0,s.Q)({name:"passwordHealth",commands:{updateIsCredentialExcluded:i.v,recalculatePasswordHealth:a.t},events:{passwordHealthComputationFinished:o.w},queries:{credentialHealthData:n.w,filterCredentials:c.Q,filterCredentialsIds:l.M,score:d.e,compromisedCredentials:u.v,compromisedCredentialsIdsForBreach:p.A,passwordHealthReport:h.b,scoreForPassword:m.c}})},76687:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},45806:(e,t,r)=>{r.d(t,{t:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},25547:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},95479:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(67837),i=r(57668);class a extends((0,s.E)(i.d)){}(0,s.K)(i.d,a)},4253:(e,t,r)=>{var s,i,a,o;r.d(t,{_x:()=>i,bp:()=>o,gI:()=>s,ub:()=>a}),function(e){e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(s||(s={})),function(e){e.All="all",e.Weak="weak",e.Reused="reused",e.Compromised="compromised",e.Excluded="excluded"}(i||(i={})),function(e){e.WEAK="weak",e.EXTREMELY_WEAK="extremely_weak"}(a||(a={})),function(e){e.COMMON="common",e.STRONG="strong"}(o||(o={}))},32069:(e,t,r)=>{r.d(t,{A:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},65796:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},99097:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},33850:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},53489:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},7466:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},5998:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},75787:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},93856:(e,t,r)=>{r.d(t,{f:()=>s});const s=(0,r(86952).Q)({name:"vaultReport",commands:{},events:{},queries:{}})},95889:(e,t,r)=>{r.d(t,{v:()=>b});var s=r(88802),i=r(99634),a=r(8122),o=r(25029),n=r(95681),c=r(23347),l=r(10722),d=r(7165);const u=d.z.object({autoredirection:d.z.record(d.z.boolean())}),p=e=>u.safeParse(e).success;class h extends((0,n.Q)({persist:!0,storage:{initialValue:{autoredirection:{}},typeGuard:p,schemaVersion:1},scope:o.F.Device,storeName:"antiphishing",codec:l.E,capacity:c.Y._001KB})){}var m=r(20754),g=r(47010),v=r(87065),y=r(87279);let _=class{constructor(e){this.antiphishingStore=e}execute({body:e}){return this.antiphishingStore.state$.pipe((0,v.U)((t=>(0,y.Vp)(!!e.domain&&!!t.autoredirection[e.domain]))))}};_=(0,s.__decorate)([(0,m.e)(g.U),(0,s.__metadata)("design:paramtypes",[h])],_);var f=r(63663),S=r(76107);let E=class{constructor(e){this.antiphishingStore=e}async execute({body:e}){const{domain:t}=e;if(t){const e=await this.antiphishingStore.getState();await this.antiphishingStore.set({...e,autoredirection:{...e.autoredirection,[t]:!0}})}return Promise.resolve((0,y.Vp)(void 0))}};E=(0,s.__decorate)([(0,f.W)(S.A),(0,s.__metadata)("design:paramtypes",[h])],E);let b=class{};b=(0,s.__decorate)([(0,i.Y)({api:a.J,handlers:{commands:{addAutoRedirectedDomain:E},events:{},queries:{isAutoRedirectedDomain:_}},stores:[h]})],b)},90364:(e,t,r)=>{r.d(t,{b:()=>a});const s=e=>void 0===e||"string"==typeof e,i=e=>void 0===e||"number"==typeof e,a=e=>{if(!e||!Array.isArray(e))return!1;if(0===e.length)return!0;const t=e[0];return"string"==typeof t.Id&&i(t.LastBackupTime)&&s(t.kwType)&&s(t.BreachId)&&i(t.ContentRevision)}},1237:(e,t,r)=>{r.d(t,{T:()=>c,l:()=>n});var s=r(49186),i=r(9811);const a=({name:e,domains:t})=>{if(e)return e;if(t.length>0){const[e]=t;return e}return""},o=e=>(0,i.Tc)(e)?"private":"public",n=e=>[...e.reduce(((e,t)=>{const r=e.get(t.BreachId);return(!r||r.LastBackupTime&&t.LastBackupTime&&r.LastBackupTime<t.LastBackupTime)&&e.set(t.BreachId,t),e}),new Map).values()],c=(e,t)=>{const r=n(e.filter(i.rY)).find((e=>e.Id===t));if(!r)throw new Error("Breach not found");return(e=>{const t=e.Content,r=(0,i.Tc)(e)?e.Content.impactedEmails:[];return{breachId:e.BreachId,breachType:o(e),domains:t.domains,eventDate:t.eventDate,id:e.Id,impactedEmails:r,kwType:e.kwType??"KWSecurityBreach",leakedData:t.leakedData??[],leakedPasswords:e.LeakedPasswords??[],name:a(t),status:e.Status??s.J.PENDING}})(r)}},9811:(e,t,r)=>{r.d(t,{F7:()=>o,Tc:()=>n,rY:()=>a});const s=e=>"object"==typeof e,i=e=>(e=>s(e)&&"breachModelVersion"in e&&"number"==typeof e.breachModelVersion)(e)&&1===e.breachModelVersion&&"domains"in e&&Array.isArray(e.domains)&&"eventDate"in e&&"string"==typeof e.eventDate&&"id"in e&&"string"==typeof e.id,a=e=>{return s(t=e)&&"kwType"in t&&"string"==typeof t.kwType&&"KWSecurityBreach"===t.kwType&&i(e.Content);var t},o=e=>(e=>{const t=e;return"impactedEmails"in t&&Array.isArray(t.impactedEmails)})(e)&&e.impactedEmails.length>0,n=e=>a(e)&&o(e.Content)},32217:(e,t,r)=>{r.d(t,{t:()=>A});var s=r(88802),i=r(99634),a=r(71450),o=r(63663),n=r(87279),c=r(49186),l=r(26254),d=r(86252);let u=class{constructor(e){this.carbonLegacyClient=e}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateBreachStatus",args:[{id:e.id,status:c.J.ACKNOWLEDGED}]}),Promise.resolve((0,n.Vp)(void 0))}};u=(0,s.__decorate)([(0,o.W)(l.n),(0,s.__metadata)("design:paramtypes",[d._])],u);var p=r(91619);let h=class{constructor(e){this.carbonLegacyClient=e}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateBreachStatus",args:[{id:e.id,status:c.J.VIEWED}]}),Promise.resolve((0,n.Vp)(void 0))}};h=(0,s.__decorate)([(0,o.W)(p.Q),(0,s.__metadata)("design:paramtypes",[d._])],h);var m=r(48844),g=r(20754),v=r(30240),y=r(1237),_=r(90364);let f=class{constructor(e){this.carbonLegacyClient=e}execute({body:e}){const{id:t}=e,{queries:{carbonState:r}}=this.carbonLegacyClient;return r({path:"userSession.personalData.securityBreaches"}).pipe((0,m.Qn)((e=>{if(!(0,_.b)(e))throw new Error("Bad Breaches format");return e})),(0,m.Qn)((e=>(0,y.T)(e,t))))}};f=(0,s.__decorate)([(0,g.e)(v.i),(0,s.__metadata)("design:paramtypes",[d._])],f);var S=r(87065),E=r(60135),b=r(9811);let w=class{constructor(e){this.carbonLegacyClient=e}execute(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,m.Qn)((e=>{if(!(0,_.b)(e))throw new Error("Bad Breaches format");return e})),(0,S.U)((e=>{if((0,n.hx)(e))throw new Error("Error while fetching data");const t=(0,y.l)(e.data.filter(b.rY)).filter((e=>e.Status===c.J.PENDING&&(0,b.Tc)(e)));return(0,n.Vp)({count:t.length})})))}};w=(0,s.__decorate)([(0,g.e)(E.L),(0,s.__metadata)("design:paramtypes",[d._])],w);let A=class{};A=(0,s.__decorate)([(0,i.Y)({api:a.H,handlers:{commands:{dismissBreach:u,markBreachAsSeen:h},events:{},queries:{breach:f,unreadBreachesCount:w}}})],A)},59348:(e,t,r)=>{r.d(t,{S:()=>G});var s=r(88802),i=r(99634),a=r(96248),o=r(87065),n=r(6136),c=r(43978),l=r(90171),d=r(69885),u=r(87279),p=r(20754),h=r(9062),m=r(48844),g=r(87113),v=r(57924),y=r(25029),_=r(95681),f=r(57255),S=r(10722);const E=e=>(e=>!(!e||"object"!=typeof e)&&"onboardingStatus"in e&&"emails"in e)(e)&&(0,f.U)(e.onboardingStatus)&&Array.isArray(e.emails);class b extends((0,_.Q)({persist:!0,storage:{schemaVersion:1,initialValue:{onboardingStatus:f.M.NOT_SEEN,emails:[]},typeGuard:E},scope:y.F.User,storeName:"email-monitoring-state",storeTypeGuard:E,codec:S.E,isCache:!0})){}let w=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.execute=()=>{this.serverApiClient.v1.darkwebmonitoring.listRegistrations({}).pipe((0,m.Qn)((({data:e})=>e.emails.map((e=>({email:e.email,state:(0,h.a2)(e.state)?e.state:h.wp.PENDING}))))),(0,m.Qn)((e=>{this.store.update((t=>({...t,emails:e})))})),(0,m.DZ)((e=>{throw e}))).subscribe()}}};w=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:paramtypes",[g.l,b])],w);let A=class{constructor(e,t){this.syncMonitoredEmails=e,this.store=t}execute(){this.syncMonitoredEmails.execute();return this.store.state$.pipe((0,o.U)((e=>e.emails)),(0,n.x)(((e,t)=>JSON.stringify(e)===JSON.stringify(t))),(0,o.U)((e=>(0,u.Vp)(e)))).pipe((0,c.w)((e=>{const t=()=>(this.syncMonitoredEmails.execute(),e),r=e=>(0,l.H)(0,e).pipe((0,c.w)((()=>(0,d.of)(t()))));return(0,u.hx)(e)||e.data.some((e=>e.state===h.wp.PENDING))?r(3e4):(0,d.of)(e)})))}};A=(0,s.__decorate)([(0,p.e)(h.dB),(0,s.__metadata)("design:paramtypes",[w,b])],A);var C=r(36214);let I=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,o.U)((e=>(0,u.Vp)(e.onboardingStatus))))}};I=(0,s.__decorate)([(0,p.e)(C.p),(0,s.__metadata)("design:paramtypes",[b])],I);var T=r(63663),P=r(9310);function O(e){return{...e,onboardingStatus:f.M.SEEN}}let R=class{constructor(e){this.store=e}async execute(){await this.store.update(O)}};R=(0,s.__decorate)([(0,v.GS)(),(0,s.__metadata)("design:paramtypes",[b])],R);let D=class{constructor(e){this.dismissOnboardingNotificationService=e}async execute(){return await this.dismissOnboardingNotificationService.execute(),Promise.resolve((0,u.Vp)(void 0))}};D=(0,s.__decorate)([(0,T.W)(P.n),(0,s.__metadata)("design:paramtypes",[R])],D);var N=r(21444),U=r(60399),F=r(82567);let M=class{constructor(e,t){this.serverApiClient=e,this.store=t}async execute({body:{email:e}}){return await(0,U.z)(this.serverApiClient.v1.darkwebmonitoring.registerEmail({email:e}).pipe((0,m.DZ)((e=>{throw new Error(e.message)})),(0,m.lk)((e=>e.data.result===N.Dq?(0,u.Vp)(void 0):(0,u.Rn)((e=>{switch(e){case N.XX.INVALID_EMAIL:return(0,N.Iy)();case N.XX.ALREADY_SUBSCRIBED:return(0,N.pK)();case N.XX.TOO_MANY_SUBSCRIPTIONS:return(0,N.Qj)();default:return(0,N.tp)()}})(e.data.result)))),(0,F.b)((async t=>{(0,u.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails,{email:e,state:h.wp.PENDING}]})))}))))}};M=(0,s.__decorate)([(0,T.W)(N.P5),(0,s.__metadata)("design:paramtypes",[g.l,b])],M);var L=r(93850),x=r(94814);let k=class{constructor(e,t){this.serverApiClient=e,this.store=t,this.getFunctionalError=e=>{switch(e){case x.KP.NO_SUBSCRIPTION:return new x.h1;case x.KP.INVALID_EMAIL:return new x.uD;case x.KP.GENERIC_ERROR:default:return new x.v4}}}async execute({body:{email:e}}){return await(0,U.z)(this.serverApiClient.v1.darkwebmonitoring.deregisterEmail({email:e}).pipe((0,m.DZ)((e=>{throw new Error(e.message)})),(0,m.lk)((e=>e.data.result===x.QS?(0,u.Vp)(void 0):(0,u.Rn)(this.getFunctionalError(e.data.result)))),(0,F.b)((async t=>{(0,u.d6)(t)&&await this.store.update((t=>({...t,emails:[...t.emails.filter((t=>t.email!==e))]})))}))))}};k=(0,s.__decorate)([(0,T.W)(x.Lc),(0,s.__metadata)("design:paramtypes",[g.l,b])],k);let G=class{};G=(0,s.__decorate)([(0,i.Y)({api:a.M,stores:[b],handlers:{commands:{dismissOnboardingNotification:D,optinEmail:M,optoutEmail:k},events:{},queries:{emailList:A,onboardingNotificationState:I}},imports:[L.n],providers:[R,w]})],G)},78382:(e,t,r)=>{r.d(t,{f:()=>z});var s=r(88802),i=r(99634),a=r(90056),o=r(87065),n=r(43978),c=r(69885),l=r(25619),d=r(20754),u=r(87279),p=r(57924),h=r(31222);const m="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567".split("").reduce(((e,t,r)=>({...e,[t]:r})),{});function g(e){const t=m[e];if(void 0===t)throw new Error(`Invalid character found: ${e}`);return t}const v=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9],y=async(e,t,r)=>{const s=(e=>{const t=new Uint8Array(e),r=15&t[t.length-1],s=t.slice(r,r+4).reduce(((e,t)=>e.concat(t.toString(16).toString().padStart(2,"0"))),"");return 2147483647&Number.parseInt(s,16)})(await e(function(e){const t=new ArrayBuffer(8);return new DataView(t).setBigUint64(0,BigInt(e)),t}(t)));return(s%(r<=9?v[r]:Math.pow(10,r))).toString().padStart(r,"0")};class _{constructor(e,t){this.signer=e,this.getStep=t}async computeOtpCode({counter:e,digits:t,period:r}){const s=this.getStep(e,r);return await y(this.signer,s,t)}}class f{constructor(e){this.hmacSigner=e}createCodeGenerator({secret:e,algorithm:t}){try{const r=function(e){const t=e.replaceAll("=","").trim().length;let r=0,s=0,i=0;const a=new Uint8Array(5*t/8|0);for(let o=0;o<t;o++)s=s<<5|g(e[o]),r+=5,r>=8&&(a[i++]=s>>>r-8&255,r-=8);return a.buffer}(e);return new _((e=>this.hmacSigner.sign(r,e,t)),this.getStep)}catch(e){return null}}getNextOtpRefreshTimestamp(e,t){if(e)return(e=>{const t=1e3*e,r=Math.floor(Date.now()/t)*t;return new Date(r+t).getTime()})(t);throw new Error("Not supported for non time based OTP type")}}let S=class extends f{constructor(e){super(e)}getStep(e,t){return((e,t)=>Math.floor(e/t))(e||(new Date).getTime(),1e3*t)}};S=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.q])],S);var E=r(86252),b=r(48844);const w=e=>void 0===e||"string"==typeof e;let A=class{constructor(e){this.carbonLegacyClient=e}getById(e){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"state.userSession.personalData.credentials"}).pipe((0,b.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&w(t.OtpSecret)&&w(t.OtpUrl)}))))(e))throw new Error("Bad credential format");return e})),(0,o.U)((t=>{if((0,u.hx)(t))return(0,u.Vp)(null);const r=t.data.reduce(((t,r)=>r.Id===e?{Id:r.Id,OtpSecret:r.OtpSecret,OtpUrl:r.OtpUrl}:t),null);return(0,u.Vp)(r)})))}};var C;A=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[E._])],A),function(e){e.SHA1="SHA-1",e.SHA256="SHA-256",e.SHA384="SHA-384",e.SHA512="SHA-512"}(C||(C={}));const I=["totp","hotp"],T=e=>{const t=new URL(e),r=(e=>{const t=e.hostname?e.hostname:/\/\/([th]otp)\//.exec(e.pathname)?.[1]??"";return I.includes(t)?t:null})(t),s=t.searchParams.get("secret")?.toUpperCase();if(!r||!s)throw new Error("Corrupted OTP url");const i=t.searchParams.get("digits"),a=t.searchParams.get("counter"),o=t.searchParams.get("period"),n=t.searchParams.get("algorithm");return{secret:s,algorithm:n?C[n]:C.SHA1,counter:a?Number.parseInt(a,10):0,digits:i?Number.parseInt(i,10):6,period:o?Number.parseInt(o,10):30}},P=e=>({secret:e.toUpperCase(),algorithm:C.SHA1,counter:0,digits:6,period:30}),O=e=>{try{return T(e)}catch{return P(e)}},R=e=>{const{secret:t,algorithm:r,digits:s,period:i}=e;return`otpauth://totp/?secret=${t.toLowerCase()}&algorithm=${r.toUpperCase().replace("-","")}&digits=${s}&period=${i}&lock=false`};var D=r(90171),N=r(30523);let U=class{constructor(e){this.otpGeneratorService=e}async withGeneratedCodeAndValidity(e,t){try{const r=await t.computeOtpCode(e),s=this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period);return(0,u.Vp)({code:r,validityEndDate:s,validityTime:1e3*e.period,url:R(e)})}catch{return(0,u.Rn)(void 0)}}otpCodes$(e,t){return(0,D.H)(0,1e3).pipe((0,N.h)((t=>{if(0===t)return!0;return((e,t)=>e-Date.now()>=1e3*t-1e3)(this.otpGeneratorService.getNextOtpRefreshTimestamp(!0,e.period),e.period)})),(0,n.w)((()=>this.withGeneratedCodeAndValidity(e,t))))}};U=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[S])],U);let F=class{constructor(e,t,r){this.credentialOTPGetter=e,this.otpGeneratorService=t,this.otpCodeService=r}withCodeGenerator(e){return{codeGenerator:this.otpGeneratorService.createCodeGenerator(e),params:e}}execute({body:e}){const{credentialId:t}=e;return this.credentialOTPGetter.getById(t).pipe((0,o.U)((e=>{if((0,u.hx)(e)||!e.data)throw new Error("Credential not found");return e.data})),(0,o.U)((e=>{if(!e.OtpUrl&&!e.OtpSecret)return{params:null,codeGenerator:null};const t=(e=>{const{OtpSecret:t,OtpUrl:r}=e;if(!t&&!r)throw new Error("Otp config missing for this credential");return r?O(r):P(t??"")})(e);return this.withCodeGenerator(t)})),(0,n.w)((({params:e,codeGenerator:t})=>null===e||null===t?(0,c.of)((0,u.Rn)(new l.c)):this.otpCodeService.otpCodes$(e,t).pipe((0,o.U)((e=>(0,u.hx)(e)?(0,u.Vp)({code:"",validityEndDate:Date.now(),validityTime:Date.now(),url:""}):e))))))}};F=(0,s.__decorate)([(0,d.e)(l.J),(0,s.__metadata)("design:paramtypes",[A,S,U])],F);let M=class extends f{constructor(e){super(e)}getStep(e,t){return e}};M=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.q])],M);var L=r(37935);let x=class{};x=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"otp-generator",providers:[S,M],exports:[S,M],imports:[L.D]})],x);var k=r(5158);let G=class{constructor(e,t){this.otpGeneratorService=e,this.otpCodeService=t}execute({body:e}){const{secretOrUrl:t}=e;if(!t)return(0,c.of)((0,u.Rn)(new k.k));const r=O(t.replaceAll(" ","")),s=this.otpGeneratorService.createCodeGenerator(r);return null===s?(0,c.of)((0,u.Rn)(new k.k)):this.otpCodeService.otpCodes$(r,s).pipe((0,b.DZ)((()=>new k.k)))}};G=(0,s.__decorate)([(0,d.e)(k.S),(0,s.__metadata)("design:paramtypes",[S,U])],G);var V=r(63663),K=r(12071),j=r(82706),B=r(61199);let W=class{constructor(e){this.vaultCrudClient=e}async execute({body:e}){const{updateVaultItem:t}=this.vaultCrudClient.commands,{credentialId:r,otpUrl:s}=e;return await t({vaultItemType:j.U.Credential,content:{otpSecret:"",otpURL:s},id:r}),(0,u.Vp)(void 0)}};W=(0,s.__decorate)([(0,V.W)(K.z),(0,s.__metadata)("design:paramtypes",[B.L])],W);let z=class{};z=(0,s.__decorate)([(0,i.Y)({api:a.i,handlers:{commands:{setupOtpCodeForCredential:W},events:{},queries:{otpCode:F,otpCodeForSecretOrUrl:G}},imports:[x],providers:[A,U]})],z)},59206:(e,t,r)=>{r.d(t,{U:()=>d});var s=r(88802),i=r(86252),a=r(57924),o=r(48844),n=r(90364),c=r(1237),l=r(9811);let d=class{constructor(e){this.carbonLegacyClient=e}getSupportedBreaches(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,o.Qn)((e=>{if(!(0,n.b)(e))throw new Error("Bad Breaches format");return e})),(0,o.Qn)((e=>e.filter(l.rY))))}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.personalData.securityBreaches"}).pipe((0,o.Qn)((e=>{if(!(0,n.b)(e))throw new Error("Bad Breaches format");return e})),(0,o.Qn)((e=>(0,c.l)(e.filter(l.rY)))))}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i._])],d)},58373:(e,t,r)=>{r.d(t,{C:()=>It});var s=r(88802),i=r(57668),a=r(93850),o=r(60733),n=r(99634),c=r(92018),l=r(48430),d=r(25029),u=r(63663),p=r(86252),h=r(87279),m=r(76687),g=r(95681),v=r(23347),y=r(10722),_=r(28489);const f=e=>"object"==typeof e&&null!==e&&(0,_.l$)(e,"credentialsAtRisk")&&(0,_.l$)(e,"index")&&"object"==typeof e.credentialsAtRisk&&"object"==typeof e.index;class S extends((0,g.Q)({persist:!0,storage:{initialValue:{credentialsAtRisk:{},index:{}},typeGuard:f,schemaVersion:1},scope:d.F.User,storeName:"password-health-state",storeTypeGuard:f,codec:y.E,isCache:!0,capacity:v.Y.Unlimited})){}var E=r(4253);const b=e=>{const t={};if(!Object.keys(e).length)return t;for(const r in e){if(!e[r])continue;const s=e[r]?.spaceId??"";void 0===t[s]&&(t[s]={[E.gI.Reused]:[],[E.gI.Weak]:[],[E.gI.Compromised]:[],[E.gI.Excluded]:[],corruptedCount:0,importantCorruptedCount:0}),e[r]?.excluded?t[s][E.gI.Excluded].push(r):(t[s].corruptedCount++,e[r]?.isImportant&&t[s].importantCorruptedCount++,e[r]?.risks.forEach((e=>t[s][e.riskType].push(r))))}return t};let w=class{constructor(e,t){this.store=e,this.carbonLegacyClient=t}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacyClient;return await t({name:"updateCredential",args:[{id:e.credentialId,update:{isExcludedFromHealth:e.excluded}}]}),this.store.update((t=>{const r={...t.credentialsAtRisk[e.credentialId],excluded:e.excluded},s={...t};return s.credentialsAtRisk[e.credentialId]=r,s.index=b(t.credentialsAtRisk),s})),Promise.resolve((0,h.Vp)(void 0))}};w=(0,s.__decorate)([(0,u.W)(m.v),(0,s.__metadata)("design:paramtypes",[S,p._])],w);var A=r(45806),C=r(57924),I=r(7165);const T=I.z.object({isOutdated:I.z.literal(!0),lastUpdateTimestamp:I.z.number(),updatedCredentialIds:I.z.record(I.z.string()),deletedCredentialIds:I.z.record(I.z.string()),hasUpdatedBreaches:I.z.boolean()}),P=I.z.object({isOutdated:I.z.literal(!1),lastUpdateTimestamp:I.z.number()}),O=I.z.discriminatedUnion("isOutdated",[T,P]),R=e=>O.safeParse(e).success;class D extends((0,g.Q)({persist:!0,storage:{initialValue:{isOutdated:!1,lastUpdateTimestamp:0},typeGuard:R,schemaVersion:1},scope:d.F.User,storeName:"health-cache-state",storeTypeGuard:R,codec:y.E,isCache:!0,capacity:v.Y.Unlimited})){}var N=r(64987),U=r(94189),F=r(70493);var M=r(59206),L=r(48844),x=r(64718),k=r(61076),G=r(87065);const V=e=>void 0===e||"string"==typeof e,K=e=>void 0===e||"string"==typeof e||"boolean"==typeof e;let j=class{constructor(e){this.carbonLegacyClient=e}vaultBooleanFormatter(e,t=!1){return void 0===e?t:"string"==typeof e?"true"===e.toLocaleLowerCase():e}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient,t=e({path:"state.userSession.spaceData.spaces"}).pipe((0,L.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.teamId&&"object"==typeof t.details&&"string"==typeof t.details.status}))))(e))throw new Error("Bad space item format");return new Set(e.filter((e=>"accepted"===e.details.status)).map((e=>e.teamId)))}))),r=e({path:"userSession.sharingData.items"}).pipe((0,L.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.content&&"string"==typeof t.itemId&&"number"==typeof t.timestamp}))))(e))throw new Error("Bad shared items format");return e.map((e=>e.itemId))})));return e({path:"state.userSession.personalData.credentials"}).pipe((0,L.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&K(t.AutoLogin)&&K(t.AutoProtected)&&V(t.Email)&&V(t.Login)&&V(t.OtpSecret)&&V(t.OtpUrl)&&V(t.Password)&&V(t.Title)&&V(t.Url)&&V(t.SpaceId)&&K(t.Checked)}))))(e))throw new Error("Bad credential format");return e})),(0,k.V)(r,t),(0,G.U)((([e,t,r])=>{const s={};return(0,h.hx)(e)||(0,h.hx)(r)||e.data.forEach((e=>{const i=new x.Y(e.Url).getRootDomain();var a;e.SpaceId&&""!==e.SpaceId&&!r.data.has(e.SpaceId)||(s[e.Id]={domains:i?[i]:[],autoLogin:this.vaultBooleanFormatter(e.AutoLogin),autoProtected:this.vaultBooleanFormatter(e.AutoProtected),email:e.Email??"",excluded:this.vaultBooleanFormatter(e.Checked),id:e.Id,login:e.Login??"",otpSecret:e.OtpSecret??"",otpUrl:e.OtpUrl??"",password:e.Password??"",spaceId:e.SpaceId??"",shared:(a=e.Id,!(0,h.hx)(t)&&t.data.includes(a)),title:e.Title??""})})),(0,h.Vp)(s)})))}};j=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[p._])],j);var B=r(81459);let W=class extends B.f{};W=(0,s.__decorate)([(0,C.GS)()],W);const z=e=>{const t=e.risks.filter((e=>e.riskType===E.gI.Reused));return 1===t.length?t[0]:void 0},H=(e,t)=>e?.risks.find((e=>e.riskType===t)),Q=(e,t)=>e.risks.filter((e=>e.riskType!==t)),q=(e,t,r)=>[...r,{riskType:E.gI.Reused,credentialIds:[...t.credentialIds].filter((t=>e!==t))}],Y=(e,t)=>{const r=z(t);return{...t,risks:Q(t,E.gI.Reused).concat([{riskType:E.gI.Reused,credentialIds:r?[...r.credentialIds].concat(e.id):[e.id]}])}},$=e=>({id:e.id,title:e.title,email:e.email,excluded:e.excluded,login:e.login,autoLogin:e.autoLogin,autoProtected:e.autoProtected,otpSecret:e.otpSecret,otpUrl:e.otpUrl,spaceId:e.spaceId,shared:e.shared,domains:e.domains}),X=e=>({...$(e),risks:[],isImportant:!1}),Z=(e,t,r)=>{const s=Q(t,E.gI.Reused),i=r&&r.length>0,a=s.length>0;return i||a?{...X(e),risks:i?s.concat([{riskType:E.gI.Reused,credentialIds:r}]):s}:void 0},J=e=>!!H(e,E.gI.Weak),ee=e=>!!z(e),te=e=>!!H(e,E.gI.Compromised),re=e=>e.excluded,se=3,ie=5;function ae(e,t,r=se,s=ie){if(!e||!t)return!1;const i=e.length,a=t.length;if(Math.abs(i-a)>r)return!1;if(i<s||a<s)return e===t;if(e===t)return!0;let o=new Array(a+1),n=new Array(a+1),c=!1;for(let e=0;e<a+1;e++)o[e]=e;for(let s=0;s<i;s++){n[0]=s+1,c=n[0]>r;for(let i=0;i<a;i++){const a=o[i+1]+1,l=n[i]+1;let d=o[i];e[s]!==t[i]&&d++,n[i+1]=Math.min(a,Math.min(l,d)),c=c&&n[i+1]>r}const i=o;if(o=n,n=i,c)break}return o[a]<=r}const oe=(e,t,r)=>{const s=((e,t)=>Object.keys(t).reduce(((r,s)=>ae(s,e.password)?[...r,...t[s]]:r),[]))(e,r);if(!t&&0===s.length)return{};const i=(e=>{if(0!==e.length)return{riskType:E.gI.Compromised,breaches:e}})(s),a=t?Q(t,E.gI.Compromised):[],o={...X(e),risks:i?a.concat(i):a};return{[e.id]:0===o.risks.length?void 0:o}},ne=(e,t,r)=>{if(!r)return Promise.resolve({});const s=t[e.id]??X(e),i=s.risks.length>0,a=((e,t)=>Object.keys(t).map((e=>t[e])).filter((t=>t.id!==e.id&&ae(t.password,e.password))).map((e=>e.id)))(e,r);if(0===a.length&&!i)return Promise.resolve({});const o=z(s)?.credentialIds??[],n=((e,t,r,s)=>{const i=r.filter((e=>!t.includes(e)));if(0===i.length)return{};const a={};for(const t of i){const r=s[t];if(!r)continue;const i=z(r);if(!i)continue;const o=Q(r,E.gI.Reused);1===i.credentialIds.length&&0===o.length?a[t]=void 0:a[t]={...r,risks:1===i.credentialIds.length?o:q(e,i,o)}}return a})(e.id,a,o,t),c=((e,t,r,s,i)=>{const a=t.filter((e=>!r.includes(e)));if(0===a.length)return{};const o={};for(const t of a){const r=s[t];if(r)o[t]=Y(e,r);else{const r=i[t];o[t]={...X(r),risks:[{riskType:E.gI.Reused,credentialIds:[e.id]}]}}}return o})(e,a,o,t,r),l=Z(e,s,a);return Promise.resolve({...n,...c,[e.id]:l})};var ce=r(85465);const le=async e=>{if(e)return await(async e=>(await(0,ce.evaluate)(e)).score)(e)/25},de=async(e,t)=>{const r=await le(e.password),s=t??X(e),i=Q(s,E.gI.Weak),a=void 0!==r&&r<2;return a||0!==i.length?{[e.id]:{...s,...$(e),risks:a?i.concat([{riskType:E.gI.Weak,strength:r}]):i}}:{[e.id]:void 0}},ue=(e,t,r)=>{if(!t)return{};const s=e.domains.some((e=>r.has(e))),i={...t,isImportant:s};return{[t.id]:i}},pe=e=>{const t={};return Object.keys(e).forEach((r=>{const s=e[r];s&&(t[r]=s)})),t},he=async({credentialUpdates:e,allCredentials:t,breaches:r,importantDomains:s,hasUpdatedBreaches:i,healthState:a,deletedCredentialIds:o})=>{const n=(e=>{const t={};return e.forEach((e=>{e.LeakedPasswords&&e.LeakedPasswords.forEach((r=>{Object.prototype.hasOwnProperty.call(t,r)?t[r].push({breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}):t[r]=[{breachId:e.Id,date:e.Content.eventDate,domains:e.Content.domains}]}))})),t})(r),c=0===e.length&&0===o.length&&!i,l={...a?.credentialsAtRisk??{}},d=e=>Object.keys(e).forEach((t=>l[t]=e[t]));o.length>0&&d(((e=[])=>e.reduce(((e,t)=>({...e,[t]:void 0})),{}))(o));const u={},p={};for(const e of Object.keys(t))t[e].excluded?u[e]=X(t[e]):p[e]=t[e];const h=[],m=[];for(const t of e)t.excluded?m.push(t):o.includes(t.id)||h.push(t);d(((e,t)=>{const r={};for(const s of Object.values(t)){if(!s)continue;const t=z(s);if(!t)continue;const i=t.credentialIds.filter((t=>!e.includes(t)));if(i.length!==t.credentialIds.length){const e=Q(s,E.gI.Reused);0===i.length&&0===e.length?r[s.id]=void 0:r[s.id]={...s,risks:0===i.length?e:[...e,{...t,credentialIds:i}]}}}return r})([...Object.values(m).map((e=>e.id)),...o],l)),c&&d((e=>{const t={};for(let r=0;r<e.length;r++){const s=e[r],i=s.password,a=s.id,o=[];for(let n=r+1;n<e.length;n++){const r=e[n].id,c=e[n].password,l=e[n];if(ae(i,c)){const e=t[r]??X(l),i=H(e,E.gI.Reused),n=i?.credentialIds??[];t[r]=Z(s,e,n.concat(a)),o.push(r)}}const n=t[a]??X(s),c=H(n,E.gI.Reused),l=c?.credentialIds??[];t[a]=Z(s,n,o.concat(l))}return t})(Object.values(p)));const g=c?Object.values(p):h;if(i)for await(const e of Object.values(p)){d(oe(e,l[e.id],n))}for await(const e of g){if(!i){d(oe(e,l[e.id],n))}if(!c){d(await ne(e,l,p))}d(await de(e,l[e.id])),d(ue(e,l[e.id],s))}return d(u),{credentialsAtRisk:pe(l),index:b(l)}};var me=r(67978),ge=r(75994);let ve=class extends me.K{constructor(e){super("assets/domains/importantDomains.json",e)}loadResource(e){if(!(t=e)||!Array.isArray(t))throw new Error("Important domains file corrupted");var t;return new Set(e)}};ve=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[ge.X])],ve);var ye=r(60399);let _e=class{constructor(e,t,r,s,i,a){this.store=e,this.credentialsGetter=t,this.breachesGetter=r,this.importantDomains=s,this.eventEmitter=i,this.client=a}async run({updatedCredentialIds:e,deletedCredentialIds:t,hasUpdatedBreaches:r=!1}){const{userFeatureFlips:s}=this.client.getClient(F.cV).queries,i=await(0,ye.z)(s());if((0,h.d6)(i)&&i.data.web_disable_password_health)return await this.store.set({credentialsAtRisk:{},index:{}}),void this.eventEmitter.sendEvent("passwordHealthComputationFinished",null);const a=await this.store.getState(),o=await(0,ye.z)(this.credentialsGetter.get()),n=await(0,ye.z)(this.breachesGetter.get()),c=await this.importantDomains.get();if((0,h.hx)(o)||(0,h.hx)(n))throw new Error("Failure getting vault data");const l=e?.length??0,d=t?.length??0,u=l>0||d>0||r,p=l+d<=50,m=u&&p?a:void 0,g=u?((e,t)=>e.reduce(((e,r)=>void 0===t[r]?e:[...e,t[r]]),[]))(e??[],o.data):[],v=await he({hasUpdatedBreaches:r,credentialUpdates:p?g:[],allCredentials:o.data,breaches:n.data,importantDomains:c,healthState:m,deletedCredentialIds:p?[...t??[]]:[]});await this.store.set({...v}),this.eventEmitter.sendEvent("passwordHealthComputationFinished",null)}};_e=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[S,j,M.U,ve,W,U.w])],_e);const fe=new N.WU;let Se=class{constructor(e,t){this.store=e,this.passwordHealthCalculationService=t}update(e){fe.runExclusive((async()=>{const t=await this.store.getState();this.store.set(((e,t)=>{const{isOutdated:r}=t;if(!r)return{isOutdated:!1,lastUpdateTimestamp:e.lastUpdateTimestamp};const{updatedCredentialIds:s,deletedCredentialIds:i,hasUpdatedBreaches:a}=t,o=e.isOutdated?{...e}:{isOutdated:!0,lastUpdateTimestamp:e.lastUpdateTimestamp,updatedCredentialIds:{},deletedCredentialIds:{},hasUpdatedBreaches:!1};return s&&(o.updatedCredentialIds={...o.updatedCredentialIds,...s.slice(0,51).reduce(((e,t)=>({...e,[t]:t})),{})}),i&&(o.deletedCredentialIds={...o.deletedCredentialIds,...i.slice(0,51).reduce(((e,t)=>({...e,[t]:t})),{})}),a&&(o.hasUpdatedBreaches=a),o})(t,e))}))}async updateHealthState(){await fe.runExclusive((async()=>{const e=await this.store.getState();(e.isOutdated||0===e.lastUpdateTimestamp||e.lastUpdateTimestamp+864e5<Date.now())&&(await this.passwordHealthCalculationService.run(this.prepCacheStateProps(e)),await this.markAsUpToDate())}))}prepCacheStateProps(e){return e.isOutdated?{updatedCredentialIds:Object.keys(e.updatedCredentialIds),deletedCredentialIds:Object.keys(e.deletedCredentialIds),hasUpdatedBreaches:e.hasUpdatedBreaches}:{}}async markAsUpToDate(){await this.store.set({isOutdated:!1,lastUpdateTimestamp:(new Date).getTime()})}};Se=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[D,_e])],Se);let Ee=class{constructor(e){this.healthCacheUpdaterService=e}execute(){return this.healthCacheUpdaterService.update({isOutdated:!0}),Promise.resolve((0,h.Vp)(void 0))}};Ee=(0,s.__decorate)([(0,u.W)(A.t),(0,s.__metadata)("design:paramtypes",[Se])],Ee);var be=r(20754),we=r(99097),Ae=r(82567);let Ce=class{constructor(e,t,r){this.store=e,this.cacheStore=t,this.healthCacheUpdater=r,this.state$=this.cacheStore.state$.pipe((0,k.V)(this.store.state$),(0,Ae.b)((()=>{this.healthCacheUpdater.updateHealthState()})),(0,G.U)((([e,t])=>t)))}};Ce=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[S,D,Se])],Ce);const Ie=(e,t)=>{const r=((e,t)=>{if(0!==t.length)switch(e){case E._x.All:{const e={[E.gI.Compromised]:3,[E.gI.Weak]:2,[E.gI.Reused]:1,[E.gI.Excluded]:0};return t.reduce(((t,r)=>t?e[r.riskType]>e[t.riskType]?r:t:r),void 0)}case E._x.Compromised:return t.find((e=>e.riskType===E.gI.Compromised));case E._x.Weak:return t.find((e=>e.riskType===E.gI.Weak));case E._x.Reused:return t.find((e=>e.riskType===E.gI.Reused));default:return}})(e,t);if(!r)return;const s={severity:E.bp.COMMON};switch(r.riskType){case E.gI.Compromised:{const e=[...r.breaches].sort(((e,t)=>{const r=Date.parse(e.date),s=Date.parse(t.date);return r===s?0:r<s?1:-1}))[0];return{...s,riskType:E.gI.Compromised,date:e.date,domain:e.domains[0]??null,severity:E.bp.STRONG}}case E.gI.Reused:return{...s,riskType:E.gI.Reused,reuseCount:r.credentialIds.length};case E.gI.Weak:return{...s,riskType:E.gI.Weak,strength:r.strength>=1?E.ub.WEAK:E.ub.EXTREMELY_WEAK}}};let Te=class{constructor(e){this.store=e}execute({body:e}){const{credentialId:t}=e;return this.store.state$.pipe((0,G.U)((e=>e.credentialsAtRisk[t]?(0,h.Vp)((e=>{const{excluded:t,risks:r}=e;return{excluded:t,corruptionData:Ie(E._x.All,r)}})(e.credentialsAtRisk[t])):(0,h.Vp)(null))))}};Te=(0,s.__decorate)([(0,be.e)(we.w),(0,s.__metadata)("design:paramtypes",[Ce])],Te);var Pe=r(75787),Oe=r(86742);const Re=e=>null===e?null:Math.round(100*e),De=(e,t)=>({total:t,excluded:e.excluded.length,compromised:e.compromised.length,reused:e.reused.length,weak:e.weak.length,score:Re((0,Oe.R9)(e.corruptedCount,e.importantCorruptedCount,t-e.excluded.length))}),Ne=(e,t)=>{const{compromised:r,reused:s,weak:i,corrupted:a,excluded:o,importantCorrupted:n}=Object.keys(e).reduce(((t,r)=>({compromised:t.compromised+e[r].compromised.length,reused:t.reused+e[r].reused.length,weak:t.weak+e[r].weak.length,corrupted:t.corrupted+e[r].corruptedCount,importantCorrupted:t.importantCorrupted+e[r].importantCorruptedCount,excluded:t.excluded+e[r].excluded.length})),{compromised:0,reused:0,weak:0,corrupted:0,importantCorrupted:0,excluded:0}),c=(0,Oe.R9)(a,n,t-o);return{compromised:r,reused:s,total:t,weak:i,score:Re(c),excluded:o}};function Ue(e,t){return(0,h.hx)(e)?0:Object.keys(e.data).filter((r=>e.data[r].spaceId===t)).length}let Fe=class{constructor(e,t,r){this.cacheStateStore=e,this.credentialsGetter=t,this.store=r}execute({body:e}){const{spaceId:t=null}=e;return this.store.state$.pipe((0,k.V)(this.credentialsGetter.get(),this.cacheStateStore.state$),(0,G.U)((([e,r,s])=>{if(null!==t&&void 0===e.index[t]){const e=Ue(r,t);return(0,h.Vp)({counters:{compromised:0,reused:0,score:100,total:e,weak:0,excluded:0},isInitialized:s.lastUpdateTimestamp>0})}if(null===t){const t=(0,h.hx)(r)?0:Object.keys(r.data).length;return(0,h.Vp)({counters:Ne(e.index,t),isInitialized:s.lastUpdateTimestamp>0})}const i=Ue(r,t);return(0,h.Vp)({counters:De(e.index[t],i),isInitialized:s.lastUpdateTimestamp>0})})))}};Fe=(0,s.__decorate)([(0,be.e)(Pe.e),(0,s.__metadata)("design:paramtypes",[D,j,Ce])],Fe);var Me=r(53489);const Le={[E.gI.Compromised]:1,[E.gI.Reused]:2,[E.gI.Weak]:3,[E.gI.Excluded]:4},xe=e=>[...e].sort(((e,t)=>{const r=Le[e.corruptionData?.riskType??E.gI.Excluded],s=Le[t.corruptionData?.riskType??E.gI.Excluded];if(r===s){const r=((e,t)=>e?.riskType===E.gI.Compromised&&t?.riskType===E.gI.Compromised?Date.parse(t.date)-Date.parse(e.date):e?.riskType===E.gI.Reused&&t?.riskType===E.gI.Reused?t.reuseCount-e.reuseCount:e?.riskType===E.gI.Weak&&t?.riskType===E.gI.Weak?e.strength===t.strength?0:e.strength===E.ub.WEAK?1:-1:0)(e.corruptionData,t.corruptionData);return 0!==r?r:e.title.localeCompare(t.title)}return r-s})),ke=(e,t)=>t===E._x.All?[...new Set([...e[E.gI.Compromised],...e[E.gI.Reused],...e[E.gI.Weak],...e[E.gI.Excluded]])]:e[t],Ge=(e,t,r,s,i)=>{let a;return a=null!==e?ke(t[e],r):r===E._x.All?Object.keys(s):Object.keys(t).reduce(((e,s)=>[...e,...ke(t[s],r)]),[]),i&&(a=a.filter((e=>i.includes(e)))),a.map((e=>((e,t)=>{const{id:r,title:s,login:i,email:a,autoProtected:o,shared:n,excluded:c,domains:l,risks:d}=e;return{id:r,title:s,login:i,email:a,autoProtected:o,shared:n,excluded:c,domainIcon:void 0,corruptionData:Ie(t,d),domain:l[0]}})(s[e],r)))};let Ve=class{constructor(e){this.store=e}execute({body:e}){const{healthFilter:t,spaceId:r}=e;return this.store.state$.pipe((0,G.U)((e=>null!==r&&void 0===e.index[r]?(0,h.Vp)([]):(0,h.Vp)(xe(Ge(r,e.index,t||E._x.All,e.credentialsAtRisk))))))}};Ve=(0,s.__decorate)([(0,be.e)(Me.Q),(0,s.__metadata)("design:paramtypes",[Ce])],Ve);var Ke=r(65796);let je=class{constructor(e){this.store=e}execute({body:e}){const{credentialIds:t}=e;return this.store.state$.pipe((0,G.U)((e=>(0,h.Vp)(((e,t)=>Object.keys(e).reduce(((t,r)=>[...t,...e[r].compromised]),[]).filter((e=>t.includes(e))))(e.index,t)))))}};je=(0,s.__decorate)([(0,be.e)(Ke.v),(0,s.__metadata)("design:paramtypes",[Ce])],je);var Be=r(32069);let We=class{constructor(e){this.store=e}execute({body:e}){const{breachId:t}=e;return this.store.state$.pipe((0,G.U)((e=>(0,h.Vp)(((e,t)=>Object.keys(e.index).reduce(((r,s)=>[...r,...e.index[s].compromised.filter((r=>{const s=H(e.credentialsAtRisk[r],E.gI.Compromised);return s?.breaches.some((e=>e.breachId===t))}))]),[]))(e,t)))))}};We=(0,s.__decorate)([(0,be.e)(Be.A),(0,s.__metadata)("design:paramtypes",[Ce])],We);var ze=r(7466);function He(e){const t={};return Object.keys(e).forEach((r=>{const s=e[r].spaceId;void 0===t[s]?t[s]=1:t[s]++})),t}let Qe=class{constructor(e,t){this.store=e,this.credentialsGetter=t}execute(){return this.store.state$.pipe((0,k.V)(this.credentialsGetter.get()),(0,G.U)((([e,t])=>{const r={};if(!(0,h.d6)(t))throw new Error("Error while retrieving credentials");const s=He(t.data),i=Object.keys(t.data).length,a=function(e){const t={};return Object.keys(e).forEach((r=>{const s=H(e[r],E.gI.Compromised),i=e[r].spaceId;if(void 0===s)return;void 0===t[i]&&(t[i]={breaches:new Set,compromisedByBreaches:{}});const a=s.breaches.map((e=>e.breachId));t[i].breaches=new Set([...t[i].breaches,...a]),t[i].compromisedByBreaches[r]=new Set(a)})),t}(e.credentialsAtRisk);let o=new Set([]),n={},c=0;return Object.keys(e.index).forEach((t=>{const i=e.index[t],l=De(i,s[t]);r[t]={...l,breaches:a[t]?.breaches??new Set,compromisedByBreach:a[t]?.compromisedByBreaches??{},corrupted:i.corruptedCount},o=new Set([...o,...a[t]?.breaches??new Set]),n={...n,...a[t]?.compromisedByBreaches??{}},c+=i.corruptedCount})),r.global={...Ne(e.index,i),breaches:o,compromisedByBreach:n,corrupted:c},(0,h.Vp)(r)})))}};Qe=(0,s.__decorate)([(0,be.e)(ze.b),(0,s.__metadata)("design:paramtypes",[S,j])],Qe);const qe=e=>{if(!e)return;const t=e;if(!((r=t.spaces)&&Array.isArray(r)&&0!==r.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r.find((e=>"accepted"===e.status)))))return;var r;const s=t.spaces.find((e=>"accepted"===e.status));return s?.teamId};let Ye=class{constructor(e){this.carbon=e}get(){const{queries:{carbonState:e}}=this.carbon;return e({path:"userSession.localSettings.premiumStatus"}).pipe((0,L.Qn)(qe))}};Ye=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[p._])],Ye);const $e=I.z.object({lastSentDate:I.z.number()}),Xe=(I.z.object({lastSentDate:I.z.number(),lastHash:I.z.string()}),e=>$e.safeParse(e).success);class Ze extends((0,g.Q)({persist:!0,storage:{initialValue:{lastSentDate:0,lastHash:""},typeGuard:Xe,schemaVersion:2,migrateStorageSchema:()=>({lastSentDate:0,lastHash:""})},scope:d.F.User,storeName:"user-activity-state",storeTypeGuard:Xe,codec:y.E,capacity:v.Y._001KB,isCache:!0})){}let Je=class{constructor(e,t){this.client=e,this.healthCacheUpdater=t}async run(){await this.healthCacheUpdater.updateHealthState()}};Je=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[U.w,Se])],Je);var et=r(25547),tt=r(68307),rt=r(87113),st=r(96303),it=r(54066);const at=0;const ot=e=>Math.floor(e/1e3);let nt=class{constructor(e,t,r,s,i,a){this.serverApiClient=e,this.userActivityStore=t,this.credentialsGetter=r,this.store=s,this.md5Hasher=i,this.currentSpaceGetter=a}async sendIfReportUpdated(){const e=await(0,ye.z)(this.currentSpaceGetter.get());if(!(0,h.d6)(e))throw new Error("Error while retrieving current space for activity report");const t=(0,h.db)(e);if(!t)return Promise.resolve();const r=await this.store.getState(),s=await this.userActivityStore.getState(),i=await(0,ye.z)(this.credentialsGetter.get()),a=Date.now(),o=ot(a),n=ot(s.lastSentDate||a);if(!(0,h.d6)(i))throw new Error("Error while retrieving credentials");const c=He(i.data),l=function(e,t,r){const s=e[r],i=t[r]??0;return s?{checkedPasswords:s.excluded.length,compromisedPasswords:s.compromised.length,nbrPasswords:i,reused:s.reused.length,safePasswords:i-s.corruptedCount,securityIndex:Re((0,Oe.R9)(s.corruptedCount,s.importantCorruptedCount,i-s.excluded.length))??at,weakPasswords:s.weak.length}:{checkedPasswords:0,compromisedPasswords:0,nbrPasswords:i,reused:0,safePasswords:i,securityIndex:i<Oe.RG?at:Oe.JK,weakPasswords:0}}(r.index,c,t),d=s.lastHash,u=(0,st.k)(this.md5Hasher.compute((0,it.u)(JSON.stringify(l))));return d===u||(await(0,ye.z)(this.serverApiClient.v1.useractivity.create({userActivity:{securityIndex:0},teamActivity:t?{teamId:parseInt(t,10),activity:l}:void 0,relativeEnd:o,relativeStart:n})),this.userActivityStore.set({lastSentDate:a,lastHash:u})),Promise.resolve()}};nt=(0,s.__decorate)([(0,C.GS)(),(0,s.__metadata)("design:paramtypes",[rt.l,Ze,j,S,o.f,Ye])],nt);var ct=r(21242);let lt=class{constructor(e,t){this.featureFlips=e,this.userActivitySender=t}async isPasswordHealthEnabled(){const{userFeatureFlips:e}=this.featureFlips.queries,t=await(0,ye.z)(e());return!!(0,h.hx)(t)||!(0,h.db)(t).web_disable_password_health}async handle(){await this.isPasswordHealthEnabled()&&await this.userActivitySender.sendIfReportUpdated()}};lt=(0,s.__decorate)([(0,tt.b)(et.w),(0,s.__metadata)("design:paramtypes",[ct.P,nt])],lt);var dt=r(20587),ut=r(11564),pt=r(26897);let ht=class{constructor(e,t){this.store=e,this.cqrsClient=t}async handle({body:e}){const{credentialId:t}=e,{commands:{trackEvent:r}}=this.cqrsClient.getClient(dt.Yu),s=(e=>({is_excluded:!!e&&re(e),is_weak:!!e&&J(e),is_reused:!!e&&ee(e),is_compromised:!!e&&te(e)}))((await(0,ye.z)(this.store.state$)).credentialsAtRisk[t]);return r({event:new pt.UserCredentialHealthReportEvent({credentialSecurityStatus:s,itemId:t})}),Promise.resolve(void 0)}};ht=(0,s.__decorate)([(0,tt.b)(ut.p),(0,s.__metadata)("design:paramtypes",[Ce,U.w])],ht);var mt=r(82706),gt=r(72989);let vt=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};vt=(0,s.__decorate)([(0,tt.b)(gt.V),(0,s.__metadata)("design:paramtypes",[Se])],vt);var yt=r(3137);let _t=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,updatedCredentialIds:t}),Promise.resolve(void 0)}};_t=(0,s.__decorate)([(0,tt.b)(yt.J),(0,s.__metadata)("design:paramtypes",[Se])],_t);var ft=r(49135);let St=class{constructor(e){this.healthCacheUpdater=e}handle({body:e}){const{ids:t,vaultItemType:r}=e;return r===mt.U.Credential&&this.healthCacheUpdater.update({isOutdated:!0,deletedCredentialIds:t}),Promise.resolve(void 0)}};St=(0,s.__decorate)([(0,tt.b)(ft.s),(0,s.__metadata)("design:paramtypes",[Se])],St);var Et=r(5998),bt=r(162);let wt=class{constructor(){}execute({body:e}){const{password:t}=e;return(0,bt.D)(le(t)).pipe((0,G.U)((e=>(0,h.Vp)(e))))}};wt=(0,s.__decorate)([(0,be.e)(Et.c),(0,s.__metadata)("design:paramtypes",[])],wt);var At=r(33850);let Ct=class{constructor(e){this.store=e}execute({body:e}){const{credentialIds:t,spaceId:r,healthFilter:s}=e;return this.store.state$.pipe((0,G.U)((e=>null!==r&&void 0===e.index[r]?(0,h.Vp)([]):(0,h.Vp)(Ge(r,e.index,s||E._x.All,e.credentialsAtRisk,t)))))}};Ct=(0,s.__decorate)([(0,be.e)(At.M),(0,s.__metadata)("design:paramtypes",[S])],Ct);let It=class{};It=(0,s.__decorate)([(0,n.Y)({api:i.d,crons:[{handler:Je,name:"health-cache",periodInMinutes:15,scope:d.F.User}],handlers:{commands:{updateIsCredentialExcluded:w,recalculatePasswordHealth:Ee},events:{...(0,n.g)(i.d,{passwordHealthComputationFinished:lt}),...(0,n.g)(c.Y,{passwordAutofillPerformed:ht}),...(0,n.g)(l.L,{updated:vt,created:_t,deleted:St})},queries:{credentialHealthData:Te,score:Fe,filterCredentials:Ve,filterCredentialsIds:Ct,compromisedCredentials:je,compromisedCredentialsIdsForBreach:We,passwordHealthReport:Qe,scoreForPassword:wt}},imports:[a.n],stores:[S,Ze,D],providers:[j,M.U,ve,_e,Se,Je,W,nt,Ce,o.f,Ye],requiredFeatureFlips:["web_disable_password_health"]})],It)},86742:(e,t,r)=>{r.d(t,{JK:()=>c,R9:()=>l,RG:()=>s});const s=5,i=.6,a=1,o=1,n=.2,c=100;function l(e,t,r){if(r<s)return null;const c=i*Math.pow(1-t/r,a),l=(1-i)*Math.pow(1-e/r,o);return n+(1-n)*(c+l)}},98157:(e,t,r)=>{r.d(t,{E:()=>Q});var s=r(88802),i=r(99634),a=r(93856),o=r(57668),n=r(60399),c=r(72250),l=r(95479),d=r(57924),u=r(67837),p=r(20587);class h extends((0,u.E)(p.Yu)){}(0,u.K)(p.Yu,h);var m=r(87279),g=r(26897),v=r(85612),y=r(47905),_=r(82706),f=r(87969),S=r(61199);const E="global";var b=r(59206),w=r(25029),A=r(95681),C=r(23347),I=r(28489),T=r(10722);const P=e=>!(!e||"object"!=typeof e)&&((0,I.l$)(e,"lastSentDate")&&"number"==typeof e.lastSentDate);class O extends((0,A.Q)({codec:T.E,persist:!0,storage:{initialValue:{lastSentDate:0},schemaVersion:1,typeGuard:P},scope:w.F.User,storeName:"vault-report",storeTypeGuard:P,capacity:C.Y._001KB,isCache:!0})){}const R={collectionsCount:-1,collectionsSharedCount:-1,multipleCollectionsCount:-1,multipleCollectionsSharedCount:-1,singleCollectionCount:-1,singleCollectionSharedCount:-1};function D(e){if(0===e.length)return 0;const t=e.flatMap((e=>e.vaultItems)),r=new Set(t.map((e=>e.id))).size;return Math.round(t.length/r)}function N(e){if(0===e.length)return 0;let t=0,r=0;for(const s of e)s.vaultItems.length>0&&(r+=s.vaultItems.length,t++);return Math.round(r/t)}function U(e){let t=0,r=0,s=0,i=0;const a=e.reduce(((e,t)=>(t.vaultItems.forEach((r=>{const s=r.id;e[s]?(e[s].all++,t.isShared&&e[s].shared++):e[s]={all:1,shared:t.isShared?1:0}})),e)),{});return Object.values(a).forEach((e=>{e.all>1?t++:1===e.all&&r++,e.shared>1?s++:1===e.shared&&i++})),{collectionsCount:e.length,collectionsSharedCount:e.filter((e=>e.isShared)).length,multipleCollectionsCount:t,multipleCollectionsSharedCount:s,singleCollectionCount:r,singleCollectionSharedCount:i}}var F=r(9811);const M=e=>e.reduce(((e,t)=>({...e,[t.id]:{...t}})),{});const L=(e,t=[])=>{const r={[E]:{totalCount:0,sharedCount:0}};return e.forEach((e=>{const s=e.spaceId;void 0===r[s]&&(r[s]={totalCount:0,sharedCount:0}),r[s].totalCount++,r[E].totalCount++,t.includes(e.id)&&(r[s].sharedCount++,r[E].sharedCount++)})),r};var x=r(86742);const k=(e,t)=>({total_count:t?.totalCount??0,shared_count:t?.sharedCount??0,collections_count:e?.collectionsCount??0,collections_shared_count:e?.collectionsSharedCount??0,multiple_collections_count:e?.multipleCollectionsCount??0,multiple_collections_shared_count:e?.multipleCollectionsSharedCount??0,single_collection_count:e?.singleCollectionCount??0,single_collection_shared_count:e?.singleCollectionSharedCount??0}),G=[_.U.Email,_.U.Address,_.U.Company,_.U.Phone,_.U.Website,_.U.Identity],V=[_.U.BankAccount,_.U.PaymentCard],K=[_.U.DriversLicense,_.U.FiscalId,_.U.IdCard,_.U.Passport,_.U.SocialSecurityId],j=[_.U.Credential,_.U.SecureNote,_.U.Secret,_.U.Passkey,...G,...V,...K];let B=class{constructor(e,t,r,s,i,a,o,n,c){this.autofillSettings=e,this.breachesGetter=t,this.store=r,this.analytics=s,this.passwordHealth=i,this.vault=a,this.vaultCrud=o,this.sharedCollections=n,this.sharedItems=c}getSpaceScope(e){switch(e){case"":return g.Scope.Personal;case E:return g.Scope.Global;default:return g.Scope.Team}}async send(){const e=await(0,n.z)(this.passwordHealth.queries.passwordHealthReport());if((0,m.hx)(e))return Promise.reject(new Error("Error while retrieving health report for creating the vault report"));const t=await(0,n.z)(this.breachesGetter.getSupportedBreaches());if((0,m.hx)(t))return Promise.reject(new Error("Error while retrieving breaches for creating the vault report"));const r=await(0,n.z)(this.vaultCrud.queries.query({vaultItemTypes:j}));if((0,m.hx)(r))return Promise.reject(new Error("Error while retrieving credentials for creating the vault report"));const s=(0,m.db)(r).credentialsResult,i=await(0,n.z)(this.autofillSettings.queries.getPreferencesForCredentials({}));if((0,m.hx)(i))return Promise.reject(new Error("Error while retrieving credential preferences for creating the vault report"));const a=await(0,n.z)(this.vault.queries.queryCollections({}));if((0,m.hx)(a))return Promise.reject(new Error("Error while retrieving collections for creating the vault report"));const o=await(0,n.z)(this.sharedCollections.queries.sharedCollectionsWithItems());if((0,m.hx)(o))return Promise.reject(new Error("Error while retrieving shared collections for creating the vault report"));const c=await(0,n.z)(this.sharedItems.queries.sharedItemsIds());if((0,m.hx)(c))return Promise.reject(new Error("Error while retrieving shared items ids for creating the vault report"));const l=function(e,t,r){const s=M(e),i=M(t),a={[E]:{domainsWithoutAutofillCount:0,totalCount:0,sharedCount:0,passwordsWithOtpCount:0,passwordsProtectedWithMasterPasswordCount:0}};return Object.keys(s).forEach((e=>{const t=s[e].spaceId;void 0===a[t]&&(a[t]={domainsWithoutAutofillCount:0,totalCount:0,sharedCount:0,passwordsWithOtpCount:0,passwordsProtectedWithMasterPasswordCount:0}),a[t].totalCount++,a[E].totalCount++,r.includes(e)&&(a[t].sharedCount++,a[E].sharedCount++),i[e].useAutoLogin||(a[t].domainsWithoutAutofillCount++,a[E].domainsWithoutAutofillCount++),(s[e].otpSecret||s[e].otpURL)&&(a[t].passwordsWithOtpCount++,a[E].passwordsWithOtpCount++),i[e].requireMasterPassword&&(a[t].passwordsProtectedWithMasterPasswordCount++,a[E].passwordsProtectedWithMasterPasswordCount++)})),a}(s.items,(0,m.db)(i),c.data),d=function(e,t){const r=new Set,s=new Set;e.forEach((e=>{(0,F.F7)(e.Content)?s.add(e.Id):r.add(e.Id)}));const i=new Set,a=new Set,o={global:{activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:s.size,publicBreachAlerts:r.size}};return Object.keys(t).forEach((e=>{if(e===E)return;const n=t[e];void 0===o[e]&&(o[e]={activePrivateBreachAlerts:0,activePublicBreachAlerts:0,passwordsCompromisedThroughPrivateBreaches:0,privateBreachAlerts:s.size,publicBreachAlerts:r.size}),[...n.breaches].forEach((t=>{r.has(t)?(o[e].activePublicBreachAlerts++,i.add(t)):s.has(t)&&(o[e].activePrivateBreachAlerts++,a.add(t))})),Object.keys(n.compromisedByBreach).forEach((t=>{[...n.compromisedByBreach[t]].some((e=>s.has(e)))&&o[e].passwordsCompromisedThroughPrivateBreaches++})),o[E].passwordsCompromisedThroughPrivateBreaches+=o[e].passwordsCompromisedThroughPrivateBreaches})),o[E].activePrivateBreachAlerts=a.size,o[E].activePublicBreachAlerts=i.size,o}(t.data,e.data);return Object.keys(l).forEach((t=>{const s=e.data[t],i=function(e,t,r){const s=[...e,...t].filter((e=>r===E||r&&e.spaceId||!r&&!e.spaceId)),i=r?t.length:0,a=i+(r===E?e.length:e.filter((e=>r&&e.spaceId||!r&&!e.spaceId)).length);return{itemsPerCollectionAverageCount:N(s),collectionsPerItemAverageCount:D(s),ids:R,passwords:U(s),payments:R,personalInfo:R,secureNotes:R,collectionsSharedCount:i,collectionsTotalCount:a}}((0,m.db)(a).collections,o.data,t),n={scope:this.getSpaceScope(t),...i,...l[t],...d[t]},u=((e,t)=>e?{passwordsSafeCount:t.totalCount-e.corrupted,passwordsExcludedCount:e.excluded,passwordsCompromisedCount:e.compromised,passwordsReusedCount:e.reused,securityScore:e.score??void 0,passwordsWeakCount:e.weak}:{passwordsSafeCount:t.totalCount,passwordsExcludedCount:0,passwordsCompromisedCount:0,passwordsReusedCount:0,securityScore:t.totalCount<x.RG?void 0:x.JK,passwordsWeakCount:0})(s,l[t]),p=((e,t,r,s,i)=>{const a=L([...t.idCardsResult.items,...t.socialSecurityIdsResult.items,...t.driversLicensesResult.items,...t.fiscalIdsResult.items,...t.passportsResult.items]),o=L(t.secureNotesResult.items,i),n=L(t.secretsResult.items,i),c=L(t.passkeysResult.items,i),l=L([...t.paymentCardsResult.items,...t.bankAccountsResult.items]),d=L([...t.addressesResult.items,...t.emailsResult.items,...t.phonesResult.items,...t.websitesResult.items,...t.companiesResult.items,...t.identitiesResult.items]),{totalCount:u,sharedCount:p}=((e,t)=>t.reduce(((t,r)=>({totalCount:t.totalCount+(r[e]?.totalCount??0),sharedCount:t.sharedCount+(r[e]?.sharedCount??0)})),{totalCount:0,sharedCount:0}))(e,[r,a,d,l,n,o,c]);return{itemsTotalCount:u,itemsSharedCount:p,ids:k(s.ids,a[e]),personalInfo:k(s.personalInfo,d[e]),secureNotes:k(s.secureNotes,o[e]),secrets:k(void 0,n[e]),passkeys:k(void 0,c[e]),payments:k(s.payments,l[e]),passwords:k(s.passwords,r[e])}})(t,r.data,l,i,c.data),h=new g.UserVaultReportEvent({...n,...u,...p});this.analytics.commands.trackEvent({event:h})})),this.store.set({lastSentDate:Date.now()}),Promise.resolve()}async shouldBeSent(){return(await(0,n.z)(this.store.state$)).lastSentDate+864e5<Date.now()}};B=(0,s.__decorate)([(0,d.GS)(),(0,s.__metadata)("design:paramtypes",[c.W,b.U,O,h,l.L,f.C,S.L,v.L,y.s])],B);var W=r(25547),z=r(68307);let H=class{constructor(e){this.vaultReportSender=e}async handle(){await this.vaultReportSender.shouldBeSent()&&this.vaultReportSender.send()}};H=(0,s.__decorate)([(0,z.b)(W.w),(0,s.__metadata)("design:paramtypes",[B])],H);let Q=class{};Q=(0,s.__decorate)([(0,i.Y)({api:a.f,handlers:{commands:{},events:{...(0,i.g)(o.d,{passwordHealthComputationFinished:H})},queries:{}},providers:[b.U,B],stores:[O]})],Q)},57578:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(86952),i=r(75183),a=r(43832);const o=(0,s.Q)({name:"userConsents",commands:{UpdateConsentsCommand:i.a},events:{},queries:{getConsents:a.o}})},75183:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},43832:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},46093:(e,t,r)=>{r.d(t,{K:()=>f});var s=r(88802),i=r(99634),a=r(57578),o=r(63663),n=r(75183),c=r(60399),l=r(57924),d=r(87113),u=r(48844),p=r(87279);let h=class{constructor(e){this.serverApiClient=e}async updateConsents({triggerBy:e,consents:t}){return await(0,c.z)(this.serverApiClient.v1.userconsents.updateConsents({triggerBy:e,consents:t}).pipe((0,u.DZ)((e=>{throw new Error(e.message)})))),(0,p.Vp)(void 0)}};h=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[d.l])],h);let m=class{constructor(e){this.userConsentsService=e}execute({body:{triggerBy:e,consents:t}}){return this.userConsentsService.updateConsents({triggerBy:e,consents:t})}};m=(0,s.__decorate)([(0,o.W)(n.a),(0,s.__metadata)("design:paramtypes",[h])],m);var g=r(20754),v=r(43832);let y=class{constructor(e){this.serverApiClient=e}execute(){return this.serverApiClient.v1.userconsents.getConsents({format:"two-consents"}).pipe((0,u.Qn)((e=>e.data)),(0,u.DZ)((e=>{throw new Error(e.message)})))}};y=(0,s.__decorate)([(0,g.e)(v.o),(0,s.__metadata)("design:paramtypes",[d.l])],y);var _=r(93850);let f=class{};f=(0,s.__decorate)([(0,i.Y)({api:a.y,imports:[_.n],providers:[h],handlers:{commands:{updateConsents:m},events:{},queries:{getConsents:y}}})],f)},89193:(e,t,r)=>{r.d(t,{g:()=>l});var s=r(86952),i=r(79448),a=r(56073),o=r(98976),n=r(57571),c=r(60678);const l=(0,s.Q)({name:"activityLogs",commands:{initiateActivityLogsRetrieval:i.b,loadNextActivityLogs:a.X,storeActivityLogs:o.M},events:{},queries:{activityLogs:n.I,areSensitiveLogsEnabled:c._}})},91943:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(67837),i=r(89193);class a extends((0,s.E)(i.g)){}(0,s.K)(i.g,a)},79448:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},56073:(e,t,r)=>{r.d(t,{X:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},98976:(e,t,r)=>{r.d(t,{M:()=>o,W:()=>s});var s,i=r(74354),a=r(25029);!function(e){e.AUDIT_LOG_MISSING_JSON_SCHEMA="AUDIT_LOG_MISSING_JSON_SCHEMA",e.AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA="AUDIT_LOG_INVALID_JSON_FOR_JSON_SCHEMA",e.AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION="AUDIT_LOG_INVALID_LOG_SCHEMA_TYPE_OR_VERSION",e.AUDIT_LOG_ERROR_READING_JSON_SCHEMA="AUDIT_LOG_ERROR_READING_JSON_SCHEMA",e.STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED="STORING_SENSITIVE_AUDIT_LOGS_NOT_ALLOWED",e.AUDIT_LOG_TYPE_NOT_CLIENT_SIDE="AUDIT_LOG_TYPE_NOT_CLIENT_SIDE",e.AUDIT_LOG_TYPE_NOT_TEAM_DEVICE_OR_CLIENT_SIDE="AUDIT_LOG_TYPE_NOT_TEAM_DEVICE_OR_CLIENT_SIDE",e.AUDIT_LOG_MISSING_CATEGORY_TO_LOG_TYPE_MAPPING="AUDIT_LOG_MISSING_CATEGORY_TO_LOG_TYPE_MAPPING"}(s||(s={}));class o extends((0,i.g)({scope:a.F.User})){}},57571:(e,t,r)=>{r.d(t,{I:()=>o,Q:()=>a});var s=r(99059),i=r(25029);const a={NOT_LOADED:"NOT_LOADED",LOADING:"LOADING",READY:"READY",ERROR:"ERROR"};class o extends((0,s.k)({scope:i.F.User})){}},60678:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},55920:(e,t,r)=>{var s,i;r.d(t,{p:()=>i,z:()=>s}),function(e){e.UserInvited="user_invited",e.UserReinvited="user_reinvited",e.UserRemoved="user_removed",e.TeamCaptainAdded="team_captain_added",e.TeamCaptainRemoved="team_captain_removed",e.GroupManagerAdded="group_manager_added",e.GroupManagerRemoved="group_manager_removed",e.MasterPasswordResetAccepted="master_password_reset_accepted",e.MasterPasswordResetRefused="master_password_reset_refused",e.BillingAdminAdded="billing_admin_added",e.BillingAdminRemoved="billing_admin_removed",e.UserGroupCreated="user_group_created",e.UserGroupRenamed="user_group_renamed",e.UserGroupDeleted="user_group_deleted",e.UserJoinedUserGroup="user_joined_user_group",e.UserLeftUserGroup="user_left_user_group",e.UserInvitedToUserGroup="user_invited_to_user_group",e.UserDeclinedInviteToUserGroup="user_declined_invite_to_user_group",e.UserRemovedFromUserGroup="user_removed_from_user_group",e.DomainRequested="domain_requested",e.DomainValidated="domain_validated",e.SensitiveLogsEnabled="collect_sensitive_data_audit_logs_enabled",e.SensitiveLogsDisabled="collect_sensitive_data_audit_logs_disabled",e.SsoIdpMetadataSet="sso_idp_metadata_set",e.SsoServiceProviderUrlSet="sso_service_provider_url_set",e.SsoEnabled="sso_enabled",e.SsoDisabled="sso_disabled",e.NitroSsoDomainProvisioned="nitro_sso_domain_provisioned",e.NitroSsoDomainRemoved="nitro_sso_domain_removed",e.NitroSsoDomainVerified="nitro_sso_domain_verified",e.NitroSsoSetupStarted="nitro_sso_setup_started",e.TeamNameChanged="team_name_changed",e.NewBillingPeriodCreated="new_billing_period_created",e.SeatsAdded="seats_added",e.ContactEmailChanged="contact_email_changed",e.MasterPasswordMobileResetEnabled="master_password_mobile_reset_enabled",e.MasterPasswordMobileResetDisabled="master_password_mobile_reset_disabled",e.MasterPasswordMobileReset="master_password_mobile_reset",e.MasterPasswordChanged="master_password_changed",e.MpToViewPasswordsEnabled="mp_to_view_passwords_enabled",e.MpToViewPasswordsDisabled="mp_to_view_passwords_disabled",e.TwoFactorAuthenticationLoginMethodAdded="two_factor_authentication_login_method_added",e.TwoFactorAuthenticationLoginMethodRemoved="two_factor_authentication_login_method_removed",e.BiometricSignInDisabled="biometric_sign_in_disabled",e.DWMEmailAdded="dwm_email_added",e.DWMEmailRemoved="dwm_email_removed",e.DWMAlertReceived="dwm_alert_received",e.UserDeviceAdded="user_device_added",e.UserDeviceRemoved="user_device_removed",e.UserDeviceLogin="user_device_login",e.MasterPasswordReset="master_password_reset",e.RequestedAccountRecovery="requested_account_recovery",e.CompletedAccountRecovery="completed_account_recovery",e.UserSharedCredentialWithGroup="user_shared_credential_with_group",e.UserSharedCredentialWithEmail="user_shared_credential_with_email",e.UserSharedCredentialWithExternal="user_shared_credential_with_external",e.UserSharedSecureNoteWithGroup="user_shared_secure_note_with_group",e.UserSharedSecureNoteWithEmail="user_shared_secure_note_with_email",e.UserSharedSecureNoteWithExternal="user_shared_secure_note_with_external",e.UserRevokedSharedCredentialGroup="user_revoked_shared_credential_group",e.UserRevokedSharedCredentialEmail="user_revoked_shared_credential_email",e.UserRevokedSharedCredentialExternal="user_revoked_shared_credential_external",e.UserRevokedSharedSecureNoteGroup="user_revoked_shared_secure_note_group",e.UserRevokedSharedSecureNoteEmail="user_revoked_shared_secure_note_email",e.UserRevokedSharedSecureNoteExternal="user_revoked_shared_secure_note_external",e.UserAcceptedSharingInviteSecureNote="user_accepted_sharing_invite_secure_note",e.UserRejectedSharingInviteSecureNote="user_rejected_sharing_invite_secure_note",e.UserAcceptedSharingInviteCredential="user_accepted_sharing_invite_credential",e.UserRejectedSharingInviteCredential="user_rejected_sharing_invite_credential",e.UserAddedCredentialToCollection="user_added_credential_to_collection",e.UserCreatedCollection="user_created_collection",e.UserDeletedCollection="user_deleted_collection",e.UserImportedCollection="user_imported_collection",e.UserRemovedCredentialFromCollection="user_removed_credential_from_collection",e.UserRenamedCollection="user_renamed_collection",e.UserSharedCollectionWithUser="user_shared_collection_with_user",e.UserSharedCollectionWithGroup="user_shared_collection_with_usergroup",e.UserAcceptedCollection="user_accepted_collection_invite",e.UserRejectedCollection="user_rejected_collection_invite",e.UserAddedItemToCollection="user_added_credential_to_shared_collection",e.UserRemovedItemFromCollection="user_removed_credential_from_shared_collection",e.UserUpdatedGroupRoleInCollection="user_updated_collection_usergroup",e.UserUpdatedUserRoleInCollection="user_updated_collection_user",e.UserRenamedSharedCollection="user_renamed_shared_collection",e.UserRevokedGroupFromCollection="user_revoked_collection_usergroup",e.UserRevokedUserFromCollection="user_revoked_collection_user",e.UserCreatedCredential="user_created_credential",e.UserModifiedCredential="user_modified_credential",e.UserDeletedCredential="user_deleted_credential",e.UserImportedCredentials="user_imported_credentials",e.UserCreatedSecureNote="user_created_secure_note",e.UserModifiedSecureNote="user_modified_secure_note",e.UserDeletedSecureNote="user_deleted_secure_note"}(s||(s={})),function(e){e.Account="account",e.Authentication="authentication",e.DarkWebMonitoring="dark_web_monitoring",e.Groups="groups",e.ImportExport="import_export",e.TeamSettings="team_settings",e.TeamSettingsActiveDirectory="team_settings_activedirectory",e.TeamSettingsPolicies="team_settings_policies",e.TeamSettingsSAMLProvisioning="team_settings_samlprovisioning",e.TeamSettingsSCIM="team_settings_scim",e.TeamSettingsSSO="team_settings_sso",e.Sharing="sharing",e.UserSettings="user_settings",e.UserSettingsAccountRecovery="user_settings_accountrecovery",e.Users="users",e.VaultCollections="vault_collections",e.VaultIDs="vault_ids",e.VaultPasswords="vault_passwords",e.VaultPayments="vault_payments",e.VaultPersonalInfo="vault_personalinfo",e.VaultSecureNotes="vault_securenotes"}(i||(i={}))},29285:(e,t,r)=>{r.r(t),r.d(t,{ActivityLogCategory:()=>d.p,ActivityLogType:()=>d.z,ActivityLogsClient:()=>i._,ActivityLogsQuery:()=>c.I,AreSensitiveLogsEnabledQuery:()=>l._,GetSiemConfigurationErrorCode:()=>h.At,GetSiemConfigurationQuery:()=>h.pr,InitiateActivityLogsRetrievalCommand:()=>a.b,LoadNextActivityLogsCommand:()=>o.X,LoadingStatus:()=>c.Q,SetSiemConfigurationCommand:()=>p.Qj,SetSiemConfigurationErrorCode:()=>p.M7,StoreActivityLogsCommand:()=>n.M,StoreActivityLogsInvalidLogsError:()=>n.W,activityLogsApi:()=>s.g,getSiemGenericError:()=>h.Nv,invalidUrlError:()=>p.q0,mismatchingAdminProvisioningKeyError:()=>p.HC,noSiemConfigurationUpdateError:()=>p.$3,setSiemGenericError:()=>p.SC,siemApi:()=>u.v,teamNotFoundError:()=>p.gY});var s=r(89193),i=r(91943),a=r(79448),o=r(56073),n=r(98976),c=r(57571),l=r(60678),d=r(55920),u=r(55102),p=r(24170),h=r(42668)},55102:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(86952),i=r(24170),a=r(42668);const o=(0,s.Q)({name:"siem",commands:{setSiemConfiguration:i.Qj},events:{},queries:{getSiemConfiguration:a.pr}})},24170:(e,t,r)=>{r.d(t,{$3:()=>l,HC:()=>c,M7:()=>s,Qj:()=>p,SC:()=>u,gY:()=>n,q0:()=>d});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.NO_SIEM_CONFIGURATION_UPDATE="NO_SIEM_CONFIGURATION_UPDATE",e.INVALID_URL="INVALID_URL"}(s||(s={}));const n=(0,o.Vj)(s.TEAM_NOT_FOUND,"Team not found"),c=(0,o.Vj)(s.MISMATCHING_ADMIN_PROVISIONING_KEY,"Mismatching admin provisioning key"),l=(0,o.Vj)(s.NO_SIEM_CONFIGURATION_UPDATE,"There's nothing to update"),d=(0,o.Vj)(s.INVALID_URL,"Invalid URL"),u=(0,o.Vj)(s.GENERIC_ERROR,"Generic error");class p extends((0,i.g)({scope:a.F.User})){}},42668:(e,t,r)=>{r.d(t,{At:()=>s,Nv:()=>n,pr:()=>c});var s,i=r(99059),a=r(25029),o=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR"}(s||(s={}));const n=(0,o.Vj)(s.GENERIC_ERROR,"Generic error");class c extends((0,i.k)({scope:a.F.User})){}},18273:(e,t,r)=>{r.d(t,{Z:()=>K});var s=r(88802),i=r(99634),a=r(93850),o=r(89193),n=r(25029),c=r(95681),l=r(23347),d=r(10722);const u=e=>!(!e||"object"!=typeof e)&&("activityLogsQueue"in e&&Array.isArray(e.activityLogsQueue));class p extends((0,c.Q)({persist:!0,storage:{initialValue:{activityLogsQueue:[]},typeGuard:u,schemaVersion:1},scope:n.F.User,storeName:"activity-logs",storeTypeGuard:u,codec:d.E,capacity:l.Y._010KB})){}var h=r(86252),m=r(57924),g=r(48844);let v=class{constructor(e){this.carbonLegacyClient=e}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,g.Qn)((e=>{if(!(e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t?.teamId&&"object"==typeof t?.details&&"string"==typeof t?.details.status}))))(e))throw new Error("Bad space item format");const t=e.find((e=>"accepted"===e.details.status)),r=t?.details.info.collectSensitiveDataAuditLogsEnabled;return Boolean(r)})))}};v=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[h._])],v);var y=r(64987),_=r(98976),f=r(63663),S=r(87279),E=r(60399);const b=new y.WU;let w=class{constructor(e,t){this.activityLogsStore=e,this.sensitiveLogsEnabledGetter=t}async execute({body:{activityLogs:e}}){const t=await(0,E.z)(this.sensitiveLogsEnabledGetter.get());if(!(0,S.d6)(t))throw new Error("Error while getting sensitive logs enabled data");const r=e.filter((e=>!e.is_sensitive||t.data));return r.length&&await this.updateActivityLogsState(r),Promise.resolve((0,S.Vp)(void 0))}async updateActivityLogsState(e){await b.runExclusive((async()=>{const t=await this.activityLogsStore.getState();await this.activityLogsStore.set({...t,activityLogsQueue:[...t.activityLogsQueue,...e]})}))}};w=(0,s.__decorate)([(0,f.W)(_.M),(0,s.__metadata)("design:paramtypes",[p,v])],w);var A=r(9671),C=r(87113);let I=class{constructor(e){this.serverApiClient=e}async sendLogs(e){return await(0,E.z)(this.serverApiClient.v1.teams.storeAuditLogs({auditLogs:e}).pipe((0,g.DZ)((()=>(0,S.Rn)("storeActivityLogs failed with an unknown HTTP error"))),(0,g.lk)((e=>e.data.invalidAuditLogs.length?(0,S.Vp)(this.serverToTechnicalSchemaErrorsMapper(e.data.invalidAuditLogs)):(0,S.Vp)(void 0)))))}serverToTechnicalSchemaErrorsMapper(e){return{invalidActivityLogs:e.map((e=>({uuid:e.uuid,error:_.W[e.error]})))}}startAuditLogQuery(e,t){return this.serverApiClient.v1.teams.startAuditLogsQuery({startDateRangeUnix:e,endDateRangeUnix:t}).pipe((0,g.DZ)((()=>{throw new Error("Error while starting audit log query")})),(0,g.Qn)((e=>e.data.queryExecutionId)))}getAuditLogQueryResults({queryExecutionId:e,nextToken:t,maxResults:r}){return this.serverApiClient.v1.teams.getAuditLogQueryResults({queryExecutionId:e,nextToken:t,maxResults:r??30}).pipe((0,g.DZ)((()=>{throw new Error("Error while retrieving audit log query result")})),(0,g.Qn)((e=>({state:e.data.state,nextToken:e.data.nextToken,logs:e.data.results.map((e=>JSON.parse(e)))}))))}};I=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[C.l])],I);let T=class{constructor(e,t,r){this.activityLogsService=e,this.allowedToFail=t,this.activityLogsStore=r}async isRunnable(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();return e.length>0}async run(){const{activityLogsQueue:e}=await this.activityLogsStore.getState();await this.attemptSendLogsToServer(e)}async attemptSendLogsToServer(e){const t=[...e];for(;t.length>0;){const e=t.splice(0,40);await this.sendLogsToServer(e)}}async sendLogsToServer(e){const t=await this.activityLogsService.sendLogs(e);if((0,S.hx)(t))return;const r=e.map((e=>e.uuid));if(await this.removeSentLogsFromActivityLogsQueue(r),t.data?.invalidActivityLogs){const r=this.createLogsTypeMap(e),s=e=>()=>{const t=r.get(e.uuid);throw new Error(`An activity log with a log type of ${t} has been detected to have a technical/schema error. (${e.error})`)};await this.allowedToFail.do((t.data.invalidActivityLogs??[]).map(s))}}createLogsTypeMap(e){const t=new Map;return e.forEach((e=>{t.set(e.uuid,e.log_type)})),t}async removeSentLogsFromActivityLogsQueue(e){const{activityLogsQueue:t}=await this.activityLogsStore.getState(),r=t.filter((t=>!e.includes(t.uuid)));await this.activityLogsStore.set({activityLogsQueue:[...r]})}};T=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[I,A.J,p])],T);var P=r(20754),O=r(57571);class R extends((0,c.Q)({persist:!1,isCache:!0,scope:n.F.User,storeName:"activity-logs",initialValue:{status:O.Q.NOT_LOADED},capacity:l.Y._100KB})){}var D=r(87065);let N=class{constructor(e){this.logsStore=e}execute(){return this.logsStore.state$.pipe((0,D.U)((e=>(0,S.Vp)({logs:e.logs??[],hasMoreData:!!e.queryInfo?.nextToken,status:e.status}))))}};N=(0,s.__decorate)([(0,P.e)(O.I),(0,s.__metadata)("design:paramtypes",[R])],N);var U=r(60678);let F=class{constructor(e){this.sensitiveLogsEnabledGetter=e}execute(){return this.sensitiveLogsEnabledGetter.get()}};F=(0,s.__decorate)([(0,P.e)(U._),(0,s.__metadata)("design:paramtypes",[v])],F);var M=r(79448);const L=(e,t)=>{if(!t)return e;const{categories:r,domain:s,logTypes:i,login:a}=t;return e.filter((e=>{if(a&&!e.properties?.author_login?.includes(a))return!1;if(r&&!r.some((t=>e.category===t)))return!1;if(i&&!i.some((t=>e.log_type===t)))return!1;if(s){const t=e.properties;if(!t.domain_url?.includes(s))return!1}return!0}))};let x=class{constructor(e,t){this.logsStore=e,this.activityLogService=t}async execute({body:{startDate:e,endDate:t,filters:r}}){this.logsStore.set({status:O.Q.LOADING,queryInfo:{filters:r}});const s=await(0,E.z)(this.activityLogService.startAuditLogQuery(e,t));if((0,S.hx)(s))return this.logsStore.set({status:O.Q.ERROR}),Promise.resolve((0,S.Vp)(void 0));const{data:i}=s;let a=!1;do{const e=await(0,E.z)(this.activityLogService.getAuditLogQueryResults({queryExecutionId:i}));if((0,S.hx)(e)||"CANCELLED"===e.data.state||"FAILED"===e.data.state){this.logsStore.set({status:O.Q.ERROR});break}const{state:t,nextToken:s,logs:o}=e.data;"QUEUED"!==t&&"RUNNING"!==t?(this.logsStore.set({status:O.Q.READY,logs:L(o,r),queryInfo:{queryExecutionId:i,nextToken:s,filters:r}}),a=!0):await new Promise((e=>setTimeout((()=>e()),3e3)))}while(!a);return Promise.resolve((0,S.Vp)(void 0))}};x=(0,s.__decorate)([(0,f.W)(M.b),(0,s.__metadata)("design:paramtypes",[R,I])],x);var k=r(56073);let G=class{constructor(e,t){this.logsStore=e,this.activityLogService=t}async execute(){const e=await this.logsStore.getState(),{queryInfo:t}=e;if(!t?.queryExecutionId||!t.nextToken)return Promise.resolve((0,S.Vp)(void 0));this.logsStore.set({...e,queryInfo:{...t,nextToken:void 0},status:O.Q.LOADING});const r=await(0,E.z)(this.activityLogService.getAuditLogQueryResults({queryExecutionId:t.queryExecutionId,nextToken:t.nextToken}));if((0,S.hx)(r))return this.logsStore.set({status:O.Q.ERROR}),Promise.resolve((0,S.Vp)(void 0));const{logs:s,nextToken:i}=r.data;return this.logsStore.set({...e,status:O.Q.READY,queryInfo:{...t,nextToken:i},logs:[...e.logs??[],...L(s,t.filters)]}),Promise.resolve((0,S.Vp)(void 0))}};var V;G=(0,s.__decorate)([(0,f.W)(k.X),(0,s.__metadata)("design:paramtypes",[R,I])],G),function(e){e.TacFilterActivityLogs="webproduct_tac_filter_activity_logs"}(V||(V={}));let K=class{};K=(0,s.__decorate)([(0,i.Y)({api:o.g,imports:[a.n],providers:[I,v],stores:[p,R],crons:[{handler:T,periodInMinutes:1,name:"activity-logs-cron",scope:n.F.User}],handlers:{commands:{initiateActivityLogsRetrieval:x,loadNextActivityLogs:G,storeActivityLogs:w},events:{},queries:{activityLogs:N,areSensitiveLogsEnabled:F}},requiredFeatureFlips:Object.values(V)})],K)},62195:(e,t,r)=>{r.d(t,{g:()=>R});var s=r(88802),i=r(99634),a=r(55102),o=r(93715),n=r(18045),c=r(34968),l=r(25029),d=r(95681),u=r(23347);const p={token:null,instanceURL:null,active:!1,siemType:null};class h extends((0,d.Q)({initialValue:!1,persist:!1,scope:l.F.User,storeName:"siem-config",capacity:u.Y._001KB})){}var m=r(57924),g=r(95842),v=r(57648),y=r(42668),_=r(24170),f=r(7165);const S=f.z.object({token:f.z.string().nullable(),instanceURL:f.z.string().nullable(),active:f.z.boolean(),siemType:f.z.enum(["splunk"]).nullable()}),E="api/siem/GetSIEMConfiguration",b="api/siem/SetSIEMConfiguration";let w=class{constructor(e,t){this.enclaveService=e,this.scimService=t}async getSiemConfiguration(){const{teamUuid:e,adminProvisioningKey:t}=await this.scimService.getTeamIdentifiers();try{return await this.enclaveService.callEnclaveEndpoint({endpoint:E,body:{teamUuid:e,adminProvisioningKey:t},responseSchema:S})}catch(e){return Promise.reject((0,y.Nv)())}}async setSiemConfiguration(e){const{teamUuid:t,adminProvisioningKey:r}=await this.scimService.getTeamIdentifiers(),s={...e,adminProvisioningKey:r,teamUuid:t};try{return await this.enclaveService.callEnclaveEndpoint({endpoint:b,body:s,responseSchema:S})}catch(e){switch(e.message){case _.M7.INVALID_URL:return Promise.reject((0,_.q0)());case _.M7.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,_.HC)());case _.M7.NO_SIEM_CONFIGURATION_UPDATE:return Promise.reject((0,_.$3)());case _.M7.TEAM_NOT_FOUND:return Promise.reject((0,_.gY)());default:return Promise.reject((0,_.SC)())}}}};w=(0,s.__decorate)([(0,m.GS)(),(0,s.__metadata)("design:paramtypes",[g.d,v.Z])],w);var A=r(20754),C=r(87279),I=r(43978);let T=class{constructor(e,t){this.siemStore=e,this.siemService=t}execute(){return this.siemStore.state$.pipe((0,I.w)((async e=>{if(!e)try{const e=await this.siemService.getSiemConfiguration();return await this.siemStore.set(e),(0,C.Vp)(e)}catch(e){return(0,C.Vp)(p)}return(0,C.Vp)(e)})))}};T=(0,s.__decorate)([(0,A.e)(y.pr),(0,s.__metadata)("design:paramtypes",[h,w])],T);var P=r(63663);let O=class{constructor(e,t){this.siemConfigStore=e,this.siemService=t}async execute({body:e}){const{token:t,instanceURL:r,active:s}=e;try{const e=await this.siemService.setSiemConfiguration({active:s,instanceURL:r,token:t,siemType:"splunk"});return this.siemConfigStore.set(e),(0,C.Vp)(void 0)}catch(e){return(0,C.Rn)(e)}}};O=(0,s.__decorate)([(0,P.W)(_.Qj),(0,s.__metadata)("design:paramtypes",[h,w])],O);let R=class{};R=(0,s.__decorate)([(0,i.Y)({api:a.v,stores:[h],providers:[w],imports:[o.E,n.i,c.D],handlers:{commands:{setSiemConfiguration:O},events:{},queries:{getSiemConfiguration:T}},requiredFeatureFlips:["setup_rollout_splunk_integration_prod"]})],R)},70305:(e,t,r)=>{r.d(t,{v:()=>o});var s=r(86952),i=r(67490),a=r(98193);const o=(0,s.Q)({name:"changeMasterPassword",commands:{temporarySendMasterPasswordChangedEvent:a.n},events:{masterPasswordChanged:i.D},queries:{}})},98193:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},67490:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},29597:(e,t,r)=>{r.r(t),r.d(t,{ChangeSessionKeyErrorTypes:()=>d.eq,CheckSessionKeyErrorTypes:()=>S.f3,CheckSessionKeyQuery:()=>h.Z,CheckSessionSessionNotCreated:()=>S.OT,CloseUserSessionCommand:()=>o.V,CreateUserSessionCommand:()=>n.lk,CreatedSessionState:()=>u.XL,CreatedSessionsStateQuery:()=>u.iH,DeleteLocalSessionCommand:()=>l.G,DeviceLimitQuery:()=>I.X,ExportSessionKeyQuery:()=>m.w,FlushLocalDataCommand:()=>i.e,IsAllowedQuery:()=>C.bY,MasterPasswordChangedEvent:()=>b.D,MultiAccountNotYetSupported:()=>c.y9,NotAllowedReason:()=>C.Oq,OpenUserSessionCommand:()=>c.Dx,PlatformView:()=>I.i,PrepareLocalDataFlushCommand:()=>a.X,SelectedOpenedSessionQuery:()=>p._,SessionAlreadyExists:()=>n.X0,SessionAlreadyOpened:()=>c.mR,SessionClient:()=>f.x,SessionCloseMode:()=>g.K,SessionClosedEvent:()=>g.X,SessionClosingEvent:()=>v.Z,SessionCreationErrorTypes:()=>n.v5,SessionKeyChecker:()=>S.BD,SessionNotCreated:()=>c.aK,SessionOpenErrorTypes:()=>c.T8,SessionOpenedEvent:()=>y.M,SessionOpeningEvent:()=>_.$,SessionQueryParamsSchema:()=>u.cM,SessionState:()=>u.sM,SessionStateQuery:()=>u.ZP,TemporarySendMasterPasswordChangedEventCommand:()=>w.n,UnableToUpdateSessionKeyForNonExistingAccount:()=>d.pX,UnableToUpdateSessionSessionNotOpened:()=>d.nA,UpdateUserSessionKeyCommand:()=>d.yt,UserNotLogged:()=>C.Fh,changeMasterPasswordApi:()=>E.v,sessionApi:()=>s.Q,vaultAccessApi:()=>A.Y});var s=r(34710),i=r(42858),a=r(15473),o=r(86334),n=r(69207),c=r(37334),l=r(54703),d=r(90032),u=r(55510),p=r(31839),h=r(45911),m=r(74156),g=r(66134),v=r(82398),y=r(5237),_=r(90775),f=r(89358),S=r(57385),E=r(70305),b=r(67490),w=r(98193),A=r(65766),C=r(57755),I=r(49273)},34710:(e,t,r)=>{r.d(t,{Q:()=>f});var s=r(86952),i=r(55510),a=r(45911),o=r(74156),n=r(5237),c=r(82398),l=r(66134),d=r(42858),u=r(15473),p=r(69207),h=r(37334),m=r(86334),g=r(54703),v=r(90775),y=r(31839),_=r(90032);const f=(0,s.Q)({name:"session",commands:{FlushLocalDataCommand:d.e,PrepareLocalDataFlushCommand:u.X,CreateUserSessionCommand:p.lk,OpenUserSessionCommand:h.Dx,CloseUserSessionCommand:m.V,DeleteLocalSessionCommand:g.G,UpdateUserSessionKeyCommand:_.yt},queries:{sessionState:i.ZP,createdSessionsState:i.iH,selectedOpenedSession:y._,checkSessionKey:a.Z,exportSessionKey:o.w},events:{SessionOpenedEvent:n.M,SessionClosingEvent:c.Z,SessionClosedEvent:l.X,SessionOpeningEvent:v.$}})},86334:(e,t,r)=>{r.d(t,{V:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},69207:(e,t,r)=>{r.d(t,{X0:()=>n,lk:()=>c,v5:()=>s});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.AlreadyExists="alreadyExists"}(s||(s={}));class n extends((0,o.Hu)(s.AlreadyExists,"The session already exists. Delete it first.")){}class c extends((0,i.g)({scope:a.F.Device})){}},54703:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},42858:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},37334:(e,t,r)=>{r.d(t,{Dx:()=>d,T8:()=>s,aK:()=>n,mR:()=>c,y9:()=>l});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.NotCreated="notCreated",e.AlreadyOpened="alreadyOpened",e.MultiAccountNotYetSupported="multiAccountNotYetSupported"}(s||(s={}));class n extends((0,o.Hu)(s.NotCreated,"The session has not been created. Create it first.")){}class c extends((0,o.Hu)(s.AlreadyOpened,"The session is already opened for this user. Close it first.")){}class l extends((0,o.Hu)(s.MultiAccountNotYetSupported,"Another session is opened. Close it first.")){}class d extends((0,i.g)({scope:a.F.Device})){}},15473:(e,t,r)=>{r.d(t,{X:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},90032:(e,t,r)=>{r.d(t,{eq:()=>s,nA:()=>c,pX:()=>n,yt:()=>l});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.NotCreated="notCreated",e.NotOpened="notOpened"}(s||(s={}));class n extends((0,o.Hu)(s.NotCreated,"The session has not been created. Create it first.")){}class c extends((0,o.Hu)(s.NotOpened,"The session has not been opened")){}class l extends((0,i.g)({scope:a.F.Device})){}},66134:(e,t,r)=>{r.d(t,{K:()=>s,X:()=>o});var s,i=r(88885),a=r(25029);!function(e){e.Close="close",e.Lock="lock"}(s||(s={}));class o extends((0,i.d)({scope:a.F.Device})){}},82398:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},5237:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},90775:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},45911:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},74156:(e,t,r)=>{r.d(t,{w:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},31839:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},55510:(e,t,r)=>{r.d(t,{XL:()=>c,ZP:()=>l,cM:()=>o,iH:()=>d,sM:()=>n});var s=r(99059),i=r(25029),a=r(7165);const o=a.z.object({email:a.z.string()});var n,c;!function(e){e.NotCreated="notCreated",e.Closed="closed",e.Open="open"}(n||(n={}));class l extends((0,s.k)({scope:i.F.Device})){}!function(e){e.Closed="closed",e.Open="open"}(c||(c={}));class d extends((0,s.k)({scope:i.F.Device})){}},57385:(e,t,r)=>{r.d(t,{BD:()=>o,OT:()=>a,f3:()=>s});var s,i=r(96168);!function(e){e.SessionNotCreated="notCreated"}(s||(s={}));class a extends((0,i.Hu)(s.SessionNotCreated,"The session has not been created. Create it first.")){}class o{}},89358:(e,t,r)=>{r.d(t,{x:()=>a});var s=r(67837),i=r(34710);class a extends((0,s.E)(i.Q)){}(0,s.K)(i.Q,a)},65766:(e,t,r)=>{r.d(t,{Y:()=>o});var s=r(86952),i=r(57755),a=r(49273);const o=(0,s.Q)({name:"vaultAccess",commands:{},events:{},queries:{isAllowed:i.bY,deviceLimit:a.X}})},49273:(e,t,r)=>{r.d(t,{X:()=>o,i:()=>s});var s,i=r(99059),a=r(25029);!function(e){e.Android="android",e.DesktopMacOS="macosx",e.DesktopWindows="windows",e.IPad="ipad",e.IPhone="iphone",e.IPod="ipod",e.Other="other",e.StandaloneExtension="saex",e.TeamAdminConsole="tac",e.WebApp="webapp"}(s||(s={}));class o extends((0,i.k)({scope:a.F.User})){}},57755:(e,t,r)=>{r.d(t,{Fh:()=>n,Oq:()=>s,bY:()=>c});var s,i=r(99059),a=r(25029),o=r(96168);!function(e){e.DeviceLimited="DeviceLimited",e.Requires2FAEnforcement="Requires2FAEnforcement",e.RequiresSSO2MPMigration="RequiresSSO2MPMigration",e.RequiresMP2SSOMigration="RequiresMP2SSOMigration",e.NoActiveUser="NoActiveUser"}(s||(s={}));class n extends((0,o.Hu)("UserNotLogged","Please log the user")){}class c extends((0,i.k)({scope:a.F.Device})){}},28365:(e,t,r)=>{r.d(t,{M:()=>h});var s=r(88802),i=r(99634),a=r(70305),o=r(81459),n=r(57924);let c=class extends o.f{};c=(0,s.__decorate)([(0,n.GS)()],c);var l=r(98193),d=r(63663),u=r(87279);let p=class{constructor(e){this.eventEmitter=e}execute(){return this.eventEmitter.sendEvent("masterPasswordChanged",void 0),Promise.resolve((0,u.Vp)(void 0))}};p=(0,s.__decorate)([(0,d.W)(l.n),(0,s.__metadata)("design:paramtypes",[c])],p);let h=class{};h=(0,s.__decorate)([(0,i.Y)({api:a.v,handlers:{commands:{temporarySendMasterPasswordChangedEvent:p},events:{},queries:{}},providers:[c]})],h)},32109:(e,t,r)=>{r.d(t,{P:()=>i});var s=r(94805);const i=e=>{const[,,t]=e.split("$");return"pbkdf2"===t?s.E1:s.mr}},87918:(e,t,r)=>{r.d(t,{t:()=>u});var s=r(88802),i=r(60399),a=r(86252),o=r(57924),n=r(54066),c=r(43293),l=r(48844),d=r(25594);let u=class{constructor(e,t){this.carbonLegacyClient=e,this.flexibleDecryptor=t}async decrypt(e){const{carbonStateList:t}=this.carbonLegacyClient.queries;return await(0,i.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey"]}).pipe((0,l.nb)({success:([t,r,s])=>{if("string"==typeof t)return this.flexibleDecryptor.decrypt((0,n.u)(t),e);if("string"==typeof r&&"string"==typeof s){const t=s+r,i=(0,c.N)(t);return this.flexibleDecryptor.decrypt((0,n.u)(i),e)}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}};u=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a._,d.a])],u)},12642:(e,t,r)=>{r.d(t,{Y:()=>n});var s=r(88802),i=r(57924),a=r(87918),o=r(73378);let n=class{constructor(e,t){this.localDataKeyDecryptor=e,this.localDatKeyaEncryptor=t}encode(e){return this.localDatKeyaEncryptor.encrypt(e)}decode(e){return this.localDataKeyDecryptor.decrypt(e)}};n=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.t,o.n])],n)},73378:(e,t,r)=>{r.d(t,{n:()=>v});var s=r(88802),i=r(60399),a=r(57924),o=r(86252),n=r(48844),c=r(94805),l=r(16698),d=r(54066),u=r(43293),p=r(66122),h=r(56268),m=r(19603),g=r(32109);let v=class{constructor(e,t,r){this.carbonLegacyClient=e,this.flexibleEncryptor=t,this.randomValuesGetter=r}async encrypt(e){const{carbonStateList:t}=this.carbonLegacyClient.queries;return await(0,i.z)(t({paths:["userSession.session.localKey","userSession.session.masterPassword","userSession.session.serverKey","userSession.personalSettings.CryptoFixedSalt","userSession.personalSettings.CryptoUserPayload"]}).pipe((0,n.nb)({success:([t,r,s,i,a])=>{if("string"==typeof t)return this.flexibleEncryptor.encrypt((0,d.u)(t),e,c.oo,l.gO);if("string"==typeof r&&"string"==typeof s){const t=s+r,o=(0,u.N)(t),n="string"==typeof a?(0,g.P)(a):c.mr,{saltLength:h}=n,m="string"===i?(0,p.R)(i):this.randomValuesGetter.get(h);return this.flexibleEncryptor.encrypt((0,d.u)(o),e,n,l.Nw,{salt:m})}throw new Error("Wrong types for local data key")},failure:()=>{throw new Error("Failure getting state list")}})))}};v=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o._,h._,m.Y])],v)},79816:(e,t,r)=>{r.d(t,{_:()=>Le});var s=r(88802),i=r(99634),a=r(25029),o=r(34710),n=r(57385),c=r(37935),l=r(6936),d=r(87918),u=r(73378),p=r(12642),h=r(57924),m=r(25594),g=r(66122),v=r(82933),y=r(54066),_=r(95087);let f=class{constructor(e){this.flexibleDecryptor=e}decrypt(e,t){const{flexibleDecryptor:r}=this;let s;switch(t.type){case"sso":s=(0,g.R)(t.ssoKey);break;case"mp":s=(0,v.K)((0,y.u)(t.masterPassword),(0,g.R)(t.secondaryKey??""));break;default:(0,_.U)(t)}return r.decrypt(s,e)}};f=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[m.a])],f);var S=r(56268),E=r(16698);let b=class{constructor(e){this.flexibleEncryptor=e}encrypt(e,t,r){const{flexibleEncryptor:s}=this,{derivation:i,salt:a}=r,{algorithm:o}=i;if("noderivation"===o)throw new Error("Session key requires derivation");let n;switch(t.type){case"sso":n=(0,g.R)(t.ssoKey);break;case"mp":n=(0,v.K)((0,y.u)(t.masterPassword),(0,g.R)(t.secondaryKey??""));break;default:(0,_.U)(t)}return s.encrypt(n,e,i,E.Nw,{salt:(0,g.R)(a)})}};b=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[S._])],b);var w=r(87279),A=r(87065),C=r(95681),I=r(23347),T=r(10722);const P=e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.entries(e).every((([,e])=>"object"==typeof e&&"derivation"in e&&"salt"in e)));class O extends((0,C.Q)({storeName:"sessions-crypto-settings-store",scope:a.F.Device,capacity:I.Y._010KB,persist:!0,storage:{schemaVersion:1,initialValue:{},typeGuard:P},codec:T.E})){}let R=class{constructor(e){this.sessionsCryptoSettingsStore=e}getConfig(e){return this.sessionsCryptoSettingsStore.state$.pipe((0,A.U)((t=>{if(e in t){const{derivation:r,salt:s}=t[e];return(0,w.Vp)({derivation:r,salt:s})}throw new Error("No crypto settings found for this user")})))}};R=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[O])],R);var D=r(63663),N=r(71949),U=r(42858);let F=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.flush(),Promise.resolve((0,w.Vp)(void 0))}};F=(0,s.__decorate)([(0,D.W)(U.e),(0,s.__metadata)("design:paramtypes",[N.X])],F);var M=r(15473);let L=class{constructor(e){this.storeFlusher=e}async execute(){return await this.storeFlusher.prepare(),Promise.resolve((0,w.Vp)(void 0))}};L=(0,s.__decorate)([(0,D.W)(M.X),(0,s.__metadata)("design:paramtypes",[N.X])],L);var x=r(86252),k=r(69207),G=r(55510),V=r(64987),K=r(60399),j=r(10370);let B=class{constructor(e,t){this.encryptor=e,this.settings=t}decode(e){const t={};for(const[r,s]of Object.entries(e))t[r]={status:"closed",encryptedLocalKey:s.encryptedLocalKey};return t}async encode(e){const t={};for(const[r,s]of Object.entries(e)){if("closed"===s.status){t[r]={encryptedLocalKey:s.encryptedLocalKey};continue}if("sso"===s.sessionKey.type)continue;if(!s.localKey){t[r]={encryptedLocalKey:null};continue}const e=await(0,K.z)(this.settings.getConfig(r));if(!(0,w.d6)(e))throw new Error("Fail to get crypto settings");t[r]={encryptedLocalKey:(0,j.s)(await this.encryptor.encrypt((0,g.R)(s.localKey),s.sessionKey,e.data))}}return t}};B=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[b,R])],B);class W extends((0,C.Q)({storeName:"sessions-state-store",scope:a.F.Device,capacity:I.Y._010KB,persist:!0,isCache:!0,codec:B,storage:{initialValue:{},schemaVersion:2,typeGuard:e=>!0,migrateStorageSchema:()=>({})}})){}const z=new V.WU;var H=r(6220);let Q=class{constructor(e,t,r){this.carbon=e,this.store=t,this.settings=r}getLocalKey(e){const t=this.generate.bind(this),r=this.changeLocalKey.bind(this);return this.store.state$.pipe((0,H.z)((async s=>{if(e in s){const t=s[e];if("open"!==t.status)throw new Error("Session is not open ");const r=t.localKey;return r?(0,g.R)(r):null}const i=await t();return await r(e,i),i})))}async changeLocalKey(e,t){const{store:r}=this,s=await(0,K.z)(this.settings.getConfig(e));if(!(0,w.d6)(s))throw new Error("Fail to get crypto settings");await z.runExclusive((async()=>{const s=await r.getState();if(!(e in s))throw new Error("Session is not created");const i=s[e];if("open"!==i.status)throw new Error("Session is not open");await r.set({...s,[e]:{status:"open",localKey:t?(0,j.s)(t):null,sessionKey:i.sessionKey}})}))}async generateKeyIfNotExist(e){await(0,K.z)(this.getLocalKey(e))}async generate(){const{carbonStateList:e}=this.carbon.queries,t=await(0,K.z)(e({paths:["userSession.session.localKey"]}));if((0,w.hx)(t))throw new Error("Failure getting state list");const[r]=t.data;return"string"==typeof r?(0,y.u)(r):null}};Q=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[x._,W,R])],Q);var q=r(32109);class Y extends((0,C.Q)({persist:!0,codec:T.E,scope:a.F.Device,storage:{initialValue:{},schemaVersion:0,typeGuard:e=>"object"==typeof e&&null!==e&&(!("encryptionKey"in e)||"string"==typeof e.encryptionKey)},storeName:"exported-session-keys-crypto",capacity:I.Y._001KB})){}var $=r(34987),X=r(92258);let Z=class{constructor(e,t){this.store=e,this.keyGenerator=t}async updateAndSetEncryptionKey(){const e=await this.keyGenerator.generate();return await this.store.set({encryptionKey:(0,j.s)(e)}),e}getOrCreateEncryptionKey(){return this.store.state$.pipe((0,$.b)((async e=>e.encryptionKey?(0,g.R)(e.encryptionKey):await this.updateAndSetEncryptionKey())))}};Z=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[Y,X.c])],Z);let J=class{constructor(e,t){this.cryptoManager=e,this.flexibleDecryptor=t}async import(e){const t=await(0,K.z)(this.cryptoManager.getOrCreateEncryptionKey()),r=await this.flexibleDecryptor.decrypt(t,(0,g.R)(e.content)),s=(new TextDecoder).decode(r),i=JSON.parse(s);return Promise.resolve(i)}};J=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[Z,m.a])],J);let ee=class{constructor(e,t,r,s,i){this.carbon=e,this.store=t,this.localKeyRepository=r,this.encryptor=s,this.importer=i}async execute({body:{sessionKey:e,email:t,personalSettings:r}}){const s="exported"===e.type?await this.importer.import(e):e,i=await this.localKeyRepository.generate(),a=i?await this.encryptor.encrypt(i,s,{derivation:(0,q.P)(r.CryptoUserPayload),salt:r.CryptoFixedSalt}):null;return await z.runExclusive((async()=>{const e=await this.store.getState();if(t in e)return(0,w.Rn)(new k.X0);switch(s.type){case"mp":{await this.store.set({...e,[t]:{status:G.sM.Closed,encryptedLocalKey:a?(0,j.s)(a):null}});const r=await this.carbon.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:t,password:s.masterPassword,rememberPassword:!1,requiredPermissions:void 0,serverKey:s.secondaryKey,loginType:"MasterPassword"}]});if((0,w.hx)(r))throw new Error("Failed to create the session in carbon");return(0,w.Vp)(void 0)}case"sso":throw new Error("Creating a SSO session in session module is not supported");default:(0,_.U)(s)}}))}};ee=(0,s.__decorate)([(0,D.W)(k.lk),(0,s.__metadata)("design:paramtypes",[x._,W,Q,b,J])],ee);var te=r(81459);let re=class extends te.f{};re=(0,s.__decorate)([(0,h.GS)()],re);var se=r(66134),ie=r(86334),ae=r(69008);let oe=class{constructor(e,t){this.emitter=e,this.requestContextClient=t}async execute({body:{email:e}}){return await this.emitter.sendEvent("sessionClosing",void 0),await this.emitter.sendEvent("sessionClosed",{email:e,mode:se.K.Close}),await this.requestContextClient.commands.setActiveUser({userName:void 0}),Promise.resolve((0,w.Vp)(void 0))}};oe=(0,s.__decorate)([(0,D.W)(ie.V),(0,s.__metadata)("design:paramtypes",[re,ae.Q])],oe);var ne=r(37334);let ce=class{constructor(e,t,r,s){this.carbon=e,this.sessionStore=t,this.sessionKeyDecryptor=r,this.importer=s}async execute({body:{email:e,sessionKey:t,rememberPassword:r}}){const s="exported"===t.type?await this.importer.import(t):t;if("sso"===s.type)throw new Error("not implemented");const{sessionStore:i,carbon:a}=this;return await z.runExclusive((async()=>{const t=await i.getState();if(!(e in t))return(0,w.Rn)(new ne.aK);if(Object.values(t).some((e=>"open"===e.status)))return(0,w.Rn)(new ne.y9);const o=t[e];return"open"===o.status||"opening"===o.status?(0,w.Rn)(new ne.mR):(await i.set({...t,[e]:{status:"opening",sessionKey:s,localKey:o.encryptedLocalKey?(0,j.s)(await this.sessionKeyDecryptor.decrypt((0,g.R)(o.encryptedLocalKey),s)):null}}),await a.commands.carbonLegacyLeeloo({name:"openSessionWithMasterPassword",arg:[{login:e,password:s.masterPassword,rememberPassword:r,requiredPermissions:void 0,serverKey:s.secondaryKey,loginType:"MasterPassword"}]}),(0,w.Vp)(void 0))}))}};ce=(0,s.__decorate)([(0,D.W)(ne.Dx),(0,s.__metadata)("design:paramtypes",[x._,W,f,J])],ce);var le=r(20754);let de=class{constructor(e){this.sessionsStateStore=e}execute({body:e}){const t=e.email;return this.sessionsStateStore.state$.pipe((0,A.U)((e=>{if(!(t in e))return(0,w.Vp)(G.sM.NotCreated);{const{status:r}=e[t];switch(r){case"open":return(0,w.Vp)(G.sM.Open);case"closed":case"opening":return(0,w.Vp)(G.sM.Closed);default:(0,_.U)(r)}}})))}};de=(0,s.__decorate)([(0,le.e)(G.ZP),(0,s.__metadata)("design:paramtypes",[W])],de);let ue=class{constructor(e){this.sessionsStateStore=e}execute(){return this.sessionsStateStore.state$.pipe((0,A.U)((e=>{const t={};for(const r in e)"open"===e[r].status?t[r]=G.XL.Open:t[r]=G.XL.Closed;return(0,w.Vp)(t)})))}};ue=(0,s.__decorate)([(0,le.e)(G.iH),(0,s.__metadata)("design:paramtypes",[W])],ue);var pe=r(6136),he=r(31839);let me=class{constructor(e){this.sessionsStateStore=e}execute(){return this.sessionsStateStore.state$.pipe((0,A.U)((e=>{let t;for(const r in e)e[r].status===G.sM.Open&&(t=r);return t})),(0,pe.x)(),(0,A.U)(w.Vp))}};me=(0,s.__decorate)([(0,le.e)(he._),(0,s.__metadata)("design:paramtypes",[W])],me);var ge=r(54703);let ve=class{execute(){return Promise.resolve((0,w.Vp)(void 0))}};ve=(0,s.__decorate)([(0,D.W)(ge.G)],ve);var ye=r(68307),_e=r(23326),fe=r(94805),Se=r(19603);let Ee=class{constructor(e,t,r,s,i,a,o,n,c){this.carbon=e,this.sessionsStateStore=t,this.sessionsCryptoSettingsStore=r,this.eventEmitter=s,this.randomValuesGetter=i,this.localKeyRepo=a,this.encryptor=o,this.settings=n,this.context=c}async getUserCryptoSettings(){const{getUserCryptoSettings:e}=this.carbon.queries,t=await(0,K.z)(e());if(!(0,w.d6)(t))throw new Error("Fail to fetch crypto settings from carbon");const{cryptoUserPayload:r,cryptoFixedSalt:s}=t.data;return{cryptoUserPayload:r,cryptoFixedSalt:s}}async getSessionKey(e){const{getMasterPasswordAndServerKey:t,getIsSSOUser:r}=this.carbon.queries,s=await(0,K.z)(r());if(!(0,w.d6)(s))throw new Error("Fail to fetch is sso user from carbon");if(s.data||e)return{type:"sso",ssoKey:""};const i=await(0,K.z)(t());if(!(0,w.d6)(i))throw new Error("Fail to fetch master password and server key from carbon");const{password:a,serverKey:o}=i.data;return{type:"mp",masterPassword:a,secondaryKey:o}}async handleLogin(e,t){await z.runExclusive((async()=>{const{cryptoUserPayload:r,cryptoFixedSalt:s}=await this.getUserCryptoSettings(),i=r?(0,q.P)(r):fe.mr,a=s||(0,j.s)(this.randomValuesGetter.get(i.saltLength)),o=await this.sessionsCryptoSettingsStore.getState();this.sessionsCryptoSettingsStore.set({...o,[e]:{derivation:i,salt:a}});const n=await this.getSessionKey(t),c=await this.sessionsStateStore.getState(),l=await this.localKeyRepo.generate();if(e in c)await this.sessionsStateStore.set({...c,[e]:{status:"open",sessionKey:n,localKey:l?(0,j.s)(l):null}});else{const t={status:"open",sessionKey:n,localKey:l?(0,j.s)(l):null};await this.sessionsStateStore.set({...c,[e]:t})}})),await this.context.commands.setActiveUser({userName:e}),await this.eventEmitter.sendEvent("sessionOpening",void 0),await this.eventEmitter.sendEvent("sessionOpened",void 0)}async handleLogout(){const e=new Array;await z.runExclusive((async()=>{const t=await this.sessionsStateStore.getState(),r={};for(const[s,i]of Object.entries(t)){if("closed"===i.status){r[s]=i;continue}if("sso"===i.sessionKey.type){e.push(s);continue}const t=await(0,K.z)(this.settings.getConfig(s));if(!(0,w.d6)(t))throw new Error("Fail to get crypto settings");const a=t.data,o=i.localKey?(0,j.s)(await this.encryptor.encrypt((0,g.R)(i.localKey),i.sessionKey,a)):null;r[s]={status:"closed",encryptedLocalKey:o},e.push(s)}await this.sessionsStateStore.set(r)}));for(const t of e)await this.eventEmitter.sendEvent("sessionClosed",{mode:se.K.Close,email:t})}async handle(e){if("loginStatusChanged"!==e.body.eventName)return;const t=e.body.eventData;t.loggedIn?await this.handleLogin(t.login,!!t.needsSSOMigration):await this.handleLogout()}};Ee=(0,s.__decorate)([(0,ye.b)(_e.Dj),(0,s.__metadata)("design:paramtypes",[x._,W,O,re,Se.Y,Q,b,R,ae.Q])],Ee);var be=r(708);let we=class{constructor(e){this.flexibleVerifier=e}verify(e,t){const{flexibleVerifier:r}=this;let s;switch(t.type){case"sso":s=(0,g.R)(t.ssoKey);break;case"mp":s=(0,v.K)((0,y.u)(t.masterPassword),(0,g.R)(t.secondaryKey??""));break;default:(0,_.U)(t)}return r.verifySignature(s,e)}};we=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[be.y])],we);let Ae=class extends n.BD{constructor(e,t){super(),this.sessionsStateStore=e,this.verifier=t}async checkSessionKey(e,t){if("mp"!==t.type)return(0,w.Vp)(!0);const r=await(0,K.z)(this.sessionsStateStore.state$);if(!(e in r))return(0,w.Vp)(!0);const s=r[e];if("open"===s.status||"opening"===s.status)return(0,w.Vp)(function(e,t){switch(e.type){case"mp":return"mp"===t.type&&e.masterPassword===t.masterPassword&&e.secondaryKey===t.secondaryKey;case"sso":return"sso"===t.type&&e.ssoKey===t.ssoKey;default:(0,_.U)(e)}}(s.sessionKey,t));if(!s.encryptedLocalKey)return(0,w.Vp)(!0);const i=(0,g.R)(s.encryptedLocalKey);return(0,w.Vp)(await this.verifier.verify(i,t))}};Ae=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[W,we])],Ae);var Ce=r(45911),Ie=r(162);let Te=class{constructor(e){this.checker=e}execute({body:{email:e,sessionKey:t}}){return(0,Ie.D)(this.checker.checkSessionKey(e,t))}};Te=(0,s.__decorate)([(0,le.e)(Ce.Z),(0,s.__metadata)("design:paramtypes",[n.BD])],Te);let Pe=class{constructor(e){this.store=e}async handle({body:{user:e}}){await z.runExclusive((async()=>{const t=await this.store.getState();delete t[e],await this.store.set(t)}))}};Pe=(0,s.__decorate)([(0,ye.b)(_e.E1),(0,s.__metadata)("design:paramtypes",[W])],Pe);var Oe=r(90032);let Re=class{constructor(e,t){this.store=e,this.importer=t}async execute({body:{email:e,sessionKey:t}}){const r="exported"===t.type?await this.importer.import(t):t;return await z.runExclusive((async()=>{const t=await this.store.getState();if(!(e in t))return(0,w.Rn)(new Oe.pX);const s=t[e];return"closed"===s.status?(0,w.Rn)(new Oe.nA):(t[e]={status:"open",localKey:s.localKey,sessionKey:r},await this.store.set(t),(0,w.Vp)(void 0))}))}};Re=(0,s.__decorate)([(0,D.W)(Oe.yt),(0,s.__metadata)("design:paramtypes",[W,J])],Re);var De=r(2240);let Ne=class{constructor(e){this.carbonLegacyClient=e}async run(){await this.carbonLegacyClient.commands.carbonLegacyLeeloo({name:"closeSession",arg:[{}]})}async isRunnable(){const e=await(0,K.z)(this.carbonLegacyClient.queries.getPremiumStatus());if((0,w.d6)(e)&&e.data.spaces){const t=e.data.spaces.find((e=>"accepted"===e.status));if(t){const e=t.info.forceAutomaticLogout;if(e){if("idle"===await(0,De.q)(60*e))return!0}}}return!1}};Ne=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[x._])],Ne);let Ue=class{constructor(e,t){this.cryptoManager=e,this.flexibleEncryptor=t}async export(e){const t=JSON.stringify(e),r=(new TextEncoder).encode(t),s=await(0,K.z)(this.cryptoManager.getOrCreateEncryptionKey()),i=await this.flexibleEncryptor.encrypt(s,r,fe.oo,E.gO);return Promise.resolve({type:"exported",content:(0,j.s)(i)})}};Ue=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[Z,S._])],Ue);var Fe=r(74156);let Me=class{constructor(e,t){this.store=e,this.exporter=t}execute(){return this.store.state$.pipe((0,$.b)((async e=>{let t;for(const r in e)e[r].status===G.sM.Open&&(t=r);if(!t)throw new Error("No opened session");const r=e[t];if("open"!==r.status)throw new Error("No opened session");return(0,w.Vp)(await this.exporter.export(r.sessionKey))})))}};Me=(0,s.__decorate)([(0,le.e)(Fe.w),(0,s.__metadata)("design:paramtypes",[W,Ue])],Me);let Le=class{};Le=(0,s.__decorate)([(0,i.Y)({api:o.Q,crons:[{handler:Ne,periodInMinutes:1,name:"close-session-idle-cron",scope:a.F.User}],handlers:{commands:{flushLocalData:F,prepareLocalDataFlush:L,closeUserSession:oe,createUserSession:ee,openUserSession:ce,deleteLocalSession:ve,updateUserSessionKey:Re},events:{...(0,i.g)(l.W,{carbonLegacy:Ee,CarbonLegacyDeviceRemotelyDeleted:Pe})},queries:{createdSessionsState:ue,sessionState:de,selectedOpenedSession:me,checkSessionKey:Te,exportSessionKey:Me}},providers:[re,d.t,u.n,p.Y,Q,f,b,we,R,B,{provide:n.BD,useClass:Ae},Ue,J,Z],exports:[d.t,u.n,p.Y,n.BD],stores:[W,O,Y],imports:[c.D]})],Le)},44580:(e,t,r)=>{r.d(t,{r:()=>T});var s,i,a,o=r(88802),n=r(99634),c=r(65766),l=r(62760),d=r(36636),u=r(43956);!function(e){e.EMAIL_TOKEN="email_token",e.DEVICE_REGISTRATION="totp_device_registration",e.LOGIN="totp_login",e.SSO="sso"}(s||(s={})),function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PENDING=1]="PENDING",e[e.ERROR=2]="ERROR",e[e.READY=3]="READY"}(i||(i={})),function(e){e.LOGIN="login",e.NEW_DEVICE="newDevice",e.DISABLED="disabled"}(a||(a={}));a.LOGIN,a.NEW_DEVICE;var p,h=r(86252),m=r(20754),g=r(87279),v=r(57755),y=r(89358),_=r(85390),f=r(30523),S=r(87065),E=r(6136);!function(e){e.OneDeviceLimitReached="OneDeviceLimitReached",e.MultipleDevicesLimitReached="MultipleDevicesLimitReached",e.UnlinkingAndOpeningSession="UnlinkingAndOpeningSession",e.UnlinkingMultipleDevicesError="UnlinkingMultipleDevicesError",e.RefreshingDeviceLimitStatus="RefreshingDeviceLimitStatus",e.OpeningSessionAfterDeviceLimitRemoval="OpeningSessionAfterDeviceLimitRemoval",e.DeviceLimitDone="DeviceLimitDone"}(p||(p={}));const b=e=>!!e?.name&&e.name!==p.DeviceLimitDone&&e.name!==p.OpeningSessionAfterDeviceLimitRemoval,w={[u.vX.MP_TO_SSO]:v.Oq.RequiresMP2SSOMigration,[u.vX.MP_TO_SSO_WITH_INFO]:v.Oq.RequiresMP2SSOMigration,[u.vX.SSO_TO_MP]:v.Oq.RequiresSSO2MPMigration};let A=class{constructor(e,t,r){this.carbon=e,this.authentication=t,this.session=r}execute(){const{selectedOpenedSession:e}=this.session.queries,{getProviderInfo:t}=this.authentication.queries,{liveLoginDeviceLimitFlow:r,liveTwoFactorAuthenticationInfo:s}=this.carbon.queries,a=e(void 0),o=t(void 0),n=r(void 0),c=s(void 0);return(0,_.a)({activeLogin:a,ssoMigrationType:o,loginDeviceLimitFlow:n,twoFactorAuthenticationInfo:c}).pipe((0,f.h)((({twoFactorAuthenticationInfo:e,activeLogin:t})=>!!(0,g.d6)(e)&&(!!(0,g.d6)(t)&&(!t.data||e.data.status===i.READY)))),(0,S.U)((({activeLogin:e,ssoMigrationType:t,loginDeviceLimitFlow:r,twoFactorAuthenticationInfo:s})=>{if(!(0,g.d6)(e))throw new Error("Enabled to retrieve active login");if(!e.data)return{isAllowed:!1,reasons:[v.Oq.NoActiveUser]};if(!(0,g.d6)(t)||!(0,g.d6)(r)||!(0,g.d6)(s)||s.data.status!==i.READY)throw new Error("One query failed");const a=b(r.data);if(void 0===t.data.migrationType&&!a&&!s.data.shouldEnforceTwoFactorAuthentication)return{isAllowed:!0};const o={isAllowed:!1,reasons:[]};return void 0!==t.data.migrationType&&o.reasons.push(w[t.data.migrationType]),a&&o.reasons.push(v.Oq.DeviceLimited),s.data.shouldEnforceTwoFactorAuthentication&&o.reasons.push(v.Oq.Requires2FAEnforcement),o})),(0,E.x)(l.shallowEqualObjects),(0,S.U)(g.Vp))}};A=(0,o.__decorate)([(0,m.e)(v.bY),(0,o.__metadata)("design:paramtypes",[h._,d.e,y.x])],A);var C=r(49273);let I=class{constructor(e){this.carbon=e}execute(){const{liveLoginDeviceLimitFlow:e}=this.carbon.queries;return e(void 0).pipe((0,S.U)((e=>{if(!(0,g.d6)(e))throw new Error("liveLoginDeviceLimitFlow failed");return(0,g.Vp)({isLimited:b(e.data)})})))}};I=(0,o.__decorate)([(0,m.e)(C.X),(0,o.__metadata)("design:paramtypes",[h._])],I);let T=class{};T=(0,o.__decorate)([(0,n.Y)({api:c.Y,handlers:{commands:{},events:{},queries:{isAllowed:A,deviceLimit:I}}})],T)},82466:(e,t,r)=>{r.d(t,{IP:()=>d,Iy:()=>n,Uv:()=>l,bd:()=>c,qb:()=>i,y$:()=>o,y3:()=>s});var s,i,a=r(7165);!function(e){e.Admin="admin",e.Limited="limited"}(s||(s={})),function(e){e.Pending="pending",e.Accepted="accepted",e.Refused="refused",e.Revoked="revoked"}(i||(i={}));const o=a.z.nativeEnum(i),n=a.z.nativeEnum(s),c=a.z.union([a.z.literal("noKey"),a.z.literal("publicKey"),a.z.literal("sharingKeys")]),l=Object.freeze({User:"user",UserGroup:"group",CollectionUser:"collectionUser",CollectionUserGroup:"collectionUserGroup"}),d=Object.freeze({Group:"group",Collection:"collection",User:"user"})},41578:(e,t,r)=>{r.r(t),r.d(t,{ATTACHMENT_IN_COLLECTION:()=>z.Pf,AcceptCollectionInviteCommand:()=>E.cD,AcceptCollectionInviteFailedError:()=>E.nu,AcceptCollectionInviteResultErrorCode:()=>E.Ti,AddItemToCollectionsCommand:()=>W.$,CreateSharedCollectionCommand:()=>z.I4,DeleteSharedCollectionCommand:()=>H.U,GetCollectionPermissionsForUserQuery:()=>x.y,GetCollectionRoleForGroupQuery:()=>k.L,GetCollectionsForUserOrGroupQuery:()=>G.Q,GetInvitesQuery:()=>I.q,GetIsLastAdminForItemQuery:()=>u.X,GetItemGroupIdForItemIdQuery:()=>n.C,GetItemIdsInSharedCollectionsQuery:()=>L.q,GetItemIdsInSharedCollectionsSchema:()=>te.Po,GetPendingCollectionsQuery:()=>T.D,GetPermissionForItemQuery:()=>l.C,GetPermissionForItemsQuery:()=>d.R,GetSharedCollectionsCountQuery:()=>K.C,GetSharedCollectionsQuery:()=>V.$,GetSharedItemsForItemIdsQuery:()=>o.z,GetSharingStatusForItemQuery:()=>c.S,GetSharingTeamLoginsQuery:()=>i.G,GetUserSharedVaultItemsQuery:()=>h.v,HasInvitesQuery:()=>P._,InviteCollectionMembersCommand:()=>Q.Q,IsSharingAllowedQuery:()=>g.B,MoveCollectionItemsToBusinessSpaceCommand:()=>ee.g,PendingCollectionSchema:()=>D,PendingItemGroupSchema:()=>N,PendingUserGroupSchema:()=>U,Permission:()=>R.y3,PermissionSchema:()=>R.Iy,RecipientTypes:()=>R.IP,RefuseCollectionInviteCommand:()=>b.UC,RefuseCollectionInviteFailedError:()=>b.R$,RefuseCollectionInviteResultErrorCode:()=>b.eT,RefuseItemGroupInviteAuthorHasInvalidStatusError:()=>w.bp,RefuseItemGroupInviteCommand:()=>w.gm,RefuseItemGroupInviteGroupHasInvalidStatusError:()=>w.Xj,RefuseItemGroupInviteInvalidItemGroupRevisionError:()=>w.Ne,RefuseItemGroupInviteNotEnoughAdminsError:()=>w.Ix,RefuseItemGroupInviteNotFoundError:()=>w.fL,RefuseItemGroupInviteResultErrorCode:()=>w.dI,RefuseItemGroupInviteUserGroupIsNotInItemGroupError:()=>w.Te,RefuseItemGroupInviteUserIsNotInItemGroupError:()=>w.hp,RefuseItemGroupInviteUserIsNotInPendingStatusError:()=>w.gR,RefuseSharedItemCommand:()=>v.l,RefuseUserGroupInviteAuthorHasInvalidStatusError:()=>A.K8,RefuseUserGroupInviteCommand:()=>A.Fo,RefuseUserGroupInviteGroupHasInvalidStatusError:()=>A.kh,RefuseUserGroupInviteInsufficientPrivilegesError:()=>A.FO,RefuseUserGroupInviteInvalidItemGroupRevisionError:()=>A.Uf,RefuseUserGroupInviteInvalidTeamIdError:()=>A.Ix,RefuseUserGroupInviteNotFoundError:()=>A.i6,RefuseUserGroupInviteResultErrorCode:()=>A.xC,RefuseUserGroupInviteUserGroupIsNotFoundError:()=>A.U1,RefuseUserGroupInviteUserGroupUpdateConflictError:()=>A.Xp,RefuseUserGroupInviteUserIsNotInPendingStatusError:()=>A.PZ,RefuseUserGroupInviteUserIsNotInUserGroupError:()=>A.xz,RemoteControlSharedItemsCommand:()=>y.v,RemoveItemFromCollectionsCommand:()=>Y.B,RenameCollectionCommand:()=>q.r,RevokeCollectionMembersCommand:()=>$.q,RsaStatusSchema:()=>R.bd,ShareItemsCommand:()=>_.S,ShareableCollectionSchema:()=>j.JQ,ShareableCollectionVaultItemSchema:()=>j.FN,SharedAccessForItemQuery:()=>p.v,SharedCollectionRole:()=>te.Yt,SharedCollectionSchema:()=>te.MX,SharedCollectionUserGroupSchema:()=>te.yD,SharedCollectionUserOrGroupViewSchema:()=>te.fg,SharedCollectionUserSchema:()=>te.Me,SharedCollectionsWithItemsQuery:()=>j.MO,SharedItemAccessLinkTypes:()=>R.Uv,SharedItemsIdsQuery:()=>m.c,SharingCollectionsClient:()=>re.L,SharingDisabledReason:()=>te.Hz,SharingEnabledQuery:()=>a.N,SharingInvitesClient:()=>F.h,SharingItemsClient:()=>f.s,Status:()=>R.qb,StatusSchema:()=>R.y$,UpdateCollectionMembersCommand:()=>Z.c,UpdatePendingCollectionsCommand:()=>C.r,UpdatePermissionForCollectionItemCommand:()=>J.a,UpdateSharedCollectionsCommand:()=>X.M,UsersAndGroupsInCollectionQuery:()=>B.O,UsersAndGroupsInCollectionSchema:()=>te.a7,createAttachmentInCollectionError:()=>z.LG,getRefuseItemGroupInviteFunctionalError:()=>w.fr,getRefuseUserGroupInviteFunctionalError:()=>A.cz,sharingCollectionsApi:()=>M.a,sharingInvitesApi:()=>S.t,sharingItemsApi:()=>s.X});var s=r(48958),i=r(31485),a=r(54003),o=r(39770),n=r(92718),c=r(20920),l=r(4975),d=r(68653),u=r(56556),p=r(11098),h=r(81620),m=r(40070),g=r(83253),v=r(43216),y=r(90198),_=r(88917),f=r(47905),S=r(58425),E=r(31609),b=r(68096),w=r(55677),A=r(84009),C=r(79517),I=r(15179),T=r(36610),P=r(36469),O=r(7165),R=r(82466);const D=O.z.object({uuid:O.z.string(),name:O.z.string(),referrer:O.z.string(),permission:O.z.nativeEnum(R.y3),seen:O.z.boolean()}),N=O.z.object({itemGroupId:O.z.string(),referrer:O.z.string(),permission:O.z.enum(["admin","limited"]),seen:O.z.boolean(),items:O.z.array(O.z.any())}),U=O.z.object({groupId:O.z.string(),name:O.z.string(),referrer:O.z.string(),permission:O.z.enum(["admin","limited"]),seen:O.z.boolean()});var F=r(88176),M=r(72721),L=r(67591),x=r(84178),k=r(39821),G=r(44282),V=r(24249),K=r(19286),j=r(11578),B=r(6233),W=r(46629),z=r(11527),H=r(50384),Q=r(89074),q=r(86590),Y=r(68827),$=r(77311),X=r(15507),Z=r(177),J=r(85980),ee=r(78743),te=r(4400),re=r(85612)},72721:(e,t,r)=>{r.d(t,{a:()=>w});var s=r(86952),i=r(44282),a=r(67591),o=r(24249),n=r(84178),c=r(39821),l=r(19286),d=r(11578),u=r(6233),p=r(46629),h=r(11527),m=r(50384),g=r(89074),v=r(177),y=r(68827),_=r(86590),f=r(77311),S=r(15507),E=r(85980),b=r(78743);const w=(0,s.Q)({name:"sharingCollections",commands:{addItemToCollections:p.$,createSharedCollection:h.I4,deleteSharedCollection:m.U,inviteCollectionMembers:g.Q,updateCollectionMembers:v.c,removeItemFromCollections:y.B,renameCollection:_.r,revokeCollectionMembers:f.q,updateSharedCollections:S.M,updatePermissionForCollectionItem:E.a,moveCollectionItemsToBusinessSpace:b.g},events:{},queries:{getCollectionsForUserOrGroup:i.Q,getItemIdsInSharedCollections:a.q,getSharedCollections:o.$,getCollectionPermissionsForUser:n.y,getCollectionRoleForGroup:c.L,getSharedCollectionsCount:l.C,sharedCollectionsWithItems:d.MO,usersAndGroupsInCollection:u.O}})},46629:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},11527:(e,t,r)=>{r.d(t,{I4:()=>c,LG:()=>n,Pf:()=>o});var s=r(74354),i=r(25029),a=r(96168);const o="ATTACHMENT_IN_COLLECTION",n=(0,a.Vj)(o,"Unable to share collections containing secure notes with attachments.");class c extends((0,s.g)({scope:i.F.User})){}},50384:(e,t,r)=>{r.d(t,{U:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},89074:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},78743:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},68827:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},86590:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},77311:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},177:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},85980:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},15507:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},67591:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},39821:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},84178:(e,t,r)=>{r.d(t,{y:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},44282:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},19286:(e,t,r)=>{r.d(t,{C:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},24249:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},11578:(e,t,r)=>{r.d(t,{FN:()=>o,JQ:()=>n,MO:()=>c});var s=r(7165),i=r(99059),a=r(25029);const o=s.z.object({id:s.z.string(),type:s.z.string(),url:s.z.optional(s.z.string())}),n=s.z.object({id:s.z.string(),name:s.z.string(),spaceId:s.z.string(),vaultItems:s.z.array(o),isShared:s.z.optional(s.z.boolean())});class c extends((0,i.k)({scope:a.F.User})){}},6233:(e,t,r)=>{r.d(t,{O:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},85612:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(67837),i=r(72721);class a extends((0,s.E)(i.a)){}(0,s.K)(i.a,a)},4400:(e,t,r)=>{r.d(t,{Hz:()=>p,MX:()=>c,Me:()=>a,Po:()=>d,Yt:()=>u,a7:()=>l,fg:()=>n,yD:()=>o});var s=r(7165),i=r(82466);const a=s.z.object({acceptSignature:s.z.optional(s.z.nullable(s.z.string())),collectionKey:s.z.optional(s.z.nullable(s.z.string())),login:s.z.string(),permission:i.Iy,proposeSignature:s.z.optional(s.z.string()),proposeSignatureUsingAlias:s.z.optional(s.z.boolean()),referrer:s.z.string(),rsaStatus:s.z.optional(i.bd),status:i.y$}),o=s.z.object({acceptSignature:s.z.optional(s.z.nullable(s.z.string())),collectionKey:s.z.optional(s.z.nullable(s.z.string())),name:s.z.string(),permission:i.Iy,proposeSignature:s.z.optional(s.z.string()),referrer:s.z.optional(s.z.string()),status:i.y$,uuid:s.z.string()}),n=s.z.object({label:s.z.string(),status:i.y$,permission:i.Iy,id:s.z.string()}),c=s.z.object({name:s.z.string(),privateKey:s.z.string(),publicKey:s.z.string(),revision:s.z.number(),userGroups:s.z.optional(s.z.array(o)),users:s.z.optional(s.z.array(a)),uuid:s.z.string(),authorLogin:s.z.optional(s.z.string())}),l=s.z.object({userGroups:s.z.optional(s.z.array(n)),users:s.z.optional(s.z.array(n))}),d=s.z.array(s.z.string());var u,p;!function(e){e.Editor="editor",e.Manager="manager"}(u||(u={})),function(e){e.DisabledInTAC="disabledInTac",e.EditorRole="editorRole",e.LimitedRightItems="limitedRightItems"}(p||(p={}))},58425:(e,t,r)=>{r.d(t,{t:()=>p});var s=r(86952),i=r(31609),a=r(68096),o=r(55677),n=r(84009),c=r(79517),l=r(15179),d=r(36610),u=r(36469);const p=(0,s.Q)({name:"sharingInvites",commands:{AcceptCollectionInviteCommand:i.cD,RefuseCollectionInviteCommand:a.UC,RefuseItemGroupInviteCommand:o.gm,RefuseUserGroupInviteCommand:n.Fo,UpdatePendingCollectionsCommand:c.r},events:{},queries:{GetInvitesQuery:l.q,GetPendingCollectionsQuery:d.D,HasInvitesQuery:u._}})},31609:(e,t,r)=>{r.d(t,{Ti:()=>s,cD:()=>c,nu:()=>n});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.AcceptFailed="AcceptFailed"}(s||(s={}));class n extends((0,o.Hu)(s.AcceptFailed,"Failed to accept collection")){}class c extends((0,i.g)({scope:a.F.User})){}},68096:(e,t,r)=>{r.d(t,{R$:()=>n,UC:()=>c,eT:()=>s});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.RefuseFailed="RefuseFailed"}(s||(s={}));class n extends((0,o.Hu)(s.RefuseFailed,"Failed to refuse collection")){}class c extends((0,i.g)({scope:a.F.User})){}},55677:(e,t,r)=>{r.d(t,{Ix:()=>h,Ne:()=>p,Te:()=>u,Xj:()=>l,bp:()=>c,dI:()=>s,fL:()=>n,fr:()=>g,gR:()=>m,gm:()=>v,hp:()=>d});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.ItemGroupNotFound="ItemGroupNotFound",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.UserIsNotInItemGroup="UserIsNotInItemGroup",e.UserGroupIsNotInItemGroup="UserGroupIsNotInItemGroup",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.NotEnoughAdmins="NotEnoughAdmins",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus"}(s||(s={}));class n extends((0,o.Hu)(s.ItemGroupNotFound,"Item Group not found")){}class c extends((0,o.Hu)(s.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}class l extends((0,o.Hu)(s.GroupHasInvalidStatus,"UserGroup is not in accepted/pending status (already refused or revoked)")){}class d extends((0,o.Hu)(s.UserIsNotInItemGroup,"User is not part of item group")){}class u extends((0,o.Hu)(s.UserGroupIsNotInItemGroup,"User group is not part of item group")){}class p extends((0,o.Hu)(s.InvalidItemGroupRevision,"Item group revision is not valid")){}class h extends((0,o.Hu)(s.NotEnoughAdmins,"The operation would let the item group with no admin")){}class m extends((0,o.Hu)(s.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}function g(e){switch(e){case"AUTHOR_HAS_INVALID_STATUS":return new c;case"GROUP_HAS_INVALID_STATUS":return new l;case"USER_IS_NOT_IN_ITEM_GROUP":return new d;case"USER_GROUP_IS_NOT_IN_ITEM_GROUP":return new u;case"INVALID_ITEM_GROUP_REVISION":return new p;case"NOT_ENOUGH_ADMINS":return new h;case"USER_IS_NOT_IN_PENDING_STATUS":return new m;default:throw new Error("Unknown server error")}}class v extends((0,i.g)({scope:a.F.User})){}},84009:(e,t,r)=>{r.d(t,{FO:()=>p,Fo:()=>_,Ix:()=>c,K8:()=>v,PZ:()=>m,U1:()=>l,Uf:()=>d,Xp:()=>u,cz:()=>y,i6:()=>n,kh:()=>g,xC:()=>s,xz:()=>h});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.UserGroupNotFound="UserGroupNotFound",e.InvalidTeamId="InvalidTeamId",e.UserGroupIsNotFound="UserGroupIsNotFound",e.InvalidItemGroupRevision="InvalidItemGroupRevision",e.UserGroupUpdateConflict="UserGroupUpdateConflict",e.InsufficientPrivileges="InsufficientPrivileges",e.UserIsNotInUserGroup="UserIsNotInUserGroup",e.UserIsNotInPendingStatus="UserIsNotInPendingStatus",e.GroupHasInvalidStatus="GroupHasInvalidStatus",e.AuthorHasInvalidStatus="AuthorHasInvalidStatus"}(s||(s={}));class n extends((0,o.Hu)(s.UserGroupNotFound,"User Group not found")){}class c extends((0,o.Hu)(s.InvalidTeamId,"Provided Team ID is not a number")){}class l extends((0,o.Hu)(s.UserGroupIsNotFound,"User group for provided ID does not exist")){}class d extends((0,o.Hu)(s.InvalidItemGroupRevision,"User group revision is not valid")){}class u extends((0,o.Hu)(s.UserGroupUpdateConflict,"Conflict between users attempting to update the same user group")){}class p extends((0,o.Hu)(s.InsufficientPrivileges,"The user does not have User Group permission to refuse the invitation")){}class h extends((0,o.Hu)(s.UserIsNotInUserGroup,"User is not part of a group")){}class m extends((0,o.Hu)(s.UserIsNotInPendingStatus,'User is not in "pending" status or not part of a group')){}class g extends((0,o.Hu)(s.GroupHasInvalidStatus,'UserGroup is not in "accepted" or "pending" status (already refused or revoked)')){}class v extends((0,o.Hu)(s.AuthorHasInvalidStatus,"User is not in accepted/pending status (already refused or revoked)")){}function y(e){switch(e){case"INVALID_TEAM_ID":return new c;case"USER_GROUP_IS_NOT_FOUND":return new l;case"INVALID_USER_GROUP_REVISION":return new d;case"USER_GROUP_UPDATE_CONFLICT":return new u;case"INSUFFICIENT_PRIVILEGES":return new p;case"USER_IS_NOT_IN_USER_GROUP":return new h;case"USER_IS_NOT_IN_PENDING_STATUS":return new m;case"GROUP_HAS_INVALID_STATUS":return new g;case"AUTHOR_HAS_INVALID_STATUS":return new v;default:throw new Error("Unknown server error")}}class _ extends((0,i.g)({scope:a.F.User})){}},79517:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},15179:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},36610:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},36469:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},88176:(e,t,r)=>{r.d(t,{h:()=>a});var s=r(67837),i=r(58425);class a extends((0,s.E)(i.t)){}(0,s.K)(i.t,a)},48958:(e,t,r)=>{r.d(t,{X:()=>f});var s=r(86952),i=r(83253),a=r(31485),o=r(54003),n=r(92718),c=r(39770),l=r(20920),d=r(4975),u=r(68653),p=r(56556),h=r(11098),m=r(81620),g=r(40070),v=r(43216),y=r(88917),_=r(90198);const f=(0,s.Q)({name:"sharingItems",commands:{refuseSharedItem:v.l,remoteControlSharedItems:_.v,shareItems:y.S},events:{},queries:{isSharingAllowed:i.B,getSharingTeamLogins:a.G,sharingEnabled:o.N,getItemGroupIdForItemId:n.C,getSharedItemsForItemIds:c.z,getSharingStatusForItem:l.S,getPermissionForItem:d.C,getPermissionForItems:u.R,getIsLastAdminForItem:p.X,sharedAccessForItem:h.v,getUserSharedVaultItems:m.v,sharedItemsIds:g.c}})},43216:(e,t,r)=>{r.d(t,{l:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},90198:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},88917:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},56556:(e,t,r)=>{r.d(t,{X:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},92718:(e,t,r)=>{r.d(t,{C:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},4975:(e,t,r)=>{r.d(t,{C:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},68653:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},39770:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},20920:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},31485:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},81620:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},83253:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},11098:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},40070:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},54003:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},47905:(e,t,r)=>{r.d(t,{s:()=>a});var s=r(67837),i=r(48958);class a extends((0,s.E)(i.X)){}(0,s.K)(i.X,a)},10647:(e,t,r)=>{r.d(t,{y:()=>p});var s=r(88802),i=r(99634),a=r(80345),o=r(72614),n=r(81982),c=r(66076),l=r(95907),d=r(59452),u=r(19617);let p=class{};p=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"sharing-carbon-helpers",providers:[a.E,c.J,o.n,n.a,u.V,l.H,d.B],exports:[a.E,c.J,o.n,n.a,u.V,l.H,d.B],imports:[]})],p)},66076:(e,t,r)=>{r.d(t,{J:()=>l});var s=r(88802),i=r(60399),a=r(57789),o=r(86252),n=r(57924),c=r(87279);let l=class{constructor(e){this.client=e}async getCarbonCredentialsByItemIds(e){const{queries:{carbonState:t}}=this.client,r=await(0,i.z)(t({path:"userSession.personalData.credentials"}));if((0,c.hx)(r))throw new Error("Unable to access credentials from carbon");const s=r.data;if(!s)throw new Error("No credentials found");if(o=s,!Array.isArray(o)||!o.every(a.G))throw new Error("Credentials are invalid");var o;const n=s.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in n&&e.push(n[t]),e)),[])}};l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],l)},72614:(e,t,r)=>{r.d(t,{n:()=>d});var s=r(88802),i=r(6136),a=r(3431),o=r(86252),n=r(57924),c=r(48844);const l=e=>{if(!e)return{teamId:"",isSharingEnabled:!1,isCollectionsSharingEnabled:!1,areSensitiveLogsEnabled:!1};const t=e;if(!((r=t.spaces)&&Array.isArray(r)&&0!==r.length&&(e=>{if(!e)return!1;const t=e;return!!(t.associatedEmail&&t.billingAdmins&&t.color&&t.info&&t.letter&&t.planType&&t.status&&t.teamAdmins&&t.teamId&&t.teamName&&t.tier)})(r.find((e=>"accepted"===e.status)))))return{teamId:"",isSharingEnabled:!0,isCollectionsSharingEnabled:!1,areSensitiveLogsEnabled:!1};var r;const s=t.spaces.find((e=>"accepted"===e.status)),i=Boolean(t.capabilities?.collectionSharing.enabled),a=t.capabilities?.sharingLimit.info?.limit;return{teamId:s?.teamId??"",isSharingEnabled:Boolean(s&&!s.info.sharingDisabled),areSensitiveLogsEnabled:Boolean(s?.info.collectSensitiveDataAuditLogsEnabled),isCollectionsSharingEnabled:i,sharedItemsLimit:a}};let d=class{constructor(e){this.carbon=e}get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,c.Qn)(l),(0,i.x)(((e,t)=>(0,a.Z)(e,t))))}};d=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],d)},81982:(e,t,r)=>{r.d(t,{a:()=>c});var s=r(88802),i=r(60399),a=r(86252),o=r(57924),n=r(48844);let c=class{constructor(e){this.client=e}async getCurrentUserWithKeys(){const{queries:{carbonStateList:e}}=this.client;return await(0,i.z)(e({paths:["userSession.account.login","userSession.session.keyPair.publicKey","userSession.session.keyPair.privateKey"]}).pipe((0,n.nb)({success:([e,t,r])=>{if("string"!=typeof e||"string"!=typeof t||"string"!=typeof r)throw new Error("Invalid format of current user keys");return{login:e,publicKey:t,privateKey:r}},failure:()=>{throw new Error("Failure getting current user and key pair")}})))}};c=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a._])],c)},19617:(e,t,r)=>{r.d(t,{V:()=>c});var s=r(88802),i=r(86252),a=r(57924),o=r(48844),n=r(31766);let c=class{constructor(e){this.carbonLegacyClient=e}get(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.sharingSync"}).pipe((0,o.Qn)((e=>{if(!(0,n.o)(e))throw new Error("Bad SharingSync format");return e})))}};c=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i._])],c)},80345:(e,t,r)=>{r.d(t,{E:()=>u});var s=r(88802),i=r(86252),a=r(57924),o=r(48844),n=r(63877);function c(e){switch(e){case"admin":return n.y3.Admin;case"limited":return n.y3.Limited}}function l(e){switch(e){case"pending":return n.qb.Pending;case"accepted":return n.qb.Accepted;case"refused":return n.qb.Refused;case"revoked":return n.qb.Revoked}}function d(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,items:e.items,users:e.users?[...e.users.map((e=>({...e,permission:c(e.permission),status:l(e.status)})))]:void 0,groups:e.groups?[...e.groups.map((e=>({...e,permission:c(e.permission),status:l(e.status)})))]:void 0,collections:e.collections?[...e.collections?.map((e=>({...e,permission:c(e.permission),status:l(e.status)})))??[]]:void 0}}let u=class{constructor(e){this.client=e}get(){const{queries:{carbonState:e}}=this.client;return e({path:"userSession.sharingData.itemGroups"}).pipe((0,o.Qn)((e=>e.map(d))))}getForItemId(e){return this.get().pipe((0,o.Qn)((t=>t.find((t=>t.items?.some((t=>e===t.itemId)))))))}getForItemGroupId(e){return this.get().pipe((0,o.Qn)((t=>t.find((t=>t.groupId===e)))))}getForItemsIds(e){return this.get().pipe((0,o.Qn)((t=>t.filter((t=>t.items?.some((t=>e.includes(t.itemId))))))))}getForCollectionId(e){return this.get().pipe((0,o.Qn)((t=>t.filter((t=>t.collections?.some((t=>e.includes(t.uuid))))))))}};u=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[i._])],u)},95907:(e,t,r)=>{r.d(t,{H:()=>l});var s=r(88802),i=r(60399);function a(e){return Boolean(e)&&"KWSecureNote"===e.kwType}var o=r(86252),n=r(57924),c=r(87279);let l=class{constructor(e){this.client=e}async getCarbonNotesByItemIds(e){const{queries:{carbonState:t}}=this.client,r=await(0,i.z)(t({path:"userSession.personalData.notes"}));if((0,c.hx)(r))throw new Error("Unable to access notes from carbon");const s=r.data;if(!s)throw new Error("No notes found");if(o=s,!Array.isArray(o)||!o.every(a))throw new Error("Notes are invalid");var o;const n=s.reduce(((e,t)=>(e[t.Id]=t,e)),{});return e.reduce(((e,t)=>(t in n&&e.push(n[t]),e)),[])}};l=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[o._])],l)},59452:(e,t,r)=>{r.d(t,{B:()=>g});var s=r(88802),i=r(60399),a=r(87065),o=r(7165),n=r(86252),c=r(57924),l=r(87279),d=r(63877);function u(e){switch(e){case"admin":return d.y3.Admin;case"limited":return d.y3.Limited}}function p(e){switch(e){case"pending":return d.qb.Pending;case"accepted":return d.qb.Accepted;case"refused":return d.qb.Refused;case"revoked":return d.qb.Revoked}}function h(e){return{groupId:e.groupId,revision:e.revision,type:e.type,teamId:e.teamId,name:e.name,privateKey:e.privateKey,publicKey:e.publicKey,externalId:e.externalId,familyId:e.familyId,users:[...e.users.map((e=>({...e,permission:u(e.permission),status:p(e.status)})))]}}const m=o.z.array(o.z.object({groupId:o.z.string(),name:o.z.string(),externalId:o.z.string().nullable().optional(),teamId:o.z.number().optional(),type:o.z.enum(["users","teamAdmins"]),publicKey:o.z.string(),privateKey:o.z.string(),revision:o.z.number(),users:o.z.array(o.z.object({userId:o.z.string(),alias:o.z.string(),referrer:o.z.string(),groupKey:o.z.string().nullable().optional(),acceptSignature:o.z.string().nullable().optional(),permission:o.z.enum(["admin","limited"]),rsaStatus:o.z.enum(["noKey","publicKey","sharingKeys"]),status:o.z.enum(["pending","accepted","refused","revoked"]),proposeSignatureUsingAlias:o.z.boolean().optional(),proposeSignature:o.z.string().optional()}))}));let g=class{constructor(e){this.client=e}getRawCarbon$(){const{queries:{carbonState:e}}=this.client;return e({path:"userSession.sharingData.userGroups"})}async getRawCarbon(){const e=await(0,i.z)(this.getRawCarbon$());if((0,l.hx)(e))throw new Error("Failure getting user groups state from carbon sharing data");return e.data}async get(){const e=await this.getRawCarbon(),t=m.safeParse(e);if(!t.success)throw new Error("Invalid format of user group state");return t.data}async getForGroupIds(e){return(await this.get()).filter((t=>e.includes(t.groupId)))}getCarbonUserGroups$(){return this.getRawCarbon$().pipe((0,a.U)((e=>{if((0,l.hx)(e))throw new Error("Failure getting user groups state from carbon sharing data");const t=m.safeParse(e.data);if(!t.success)throw new Error("Failure parsing ser groups state from carbon sharing data");return t.data.map(h)})))}async getCarbonUserGroups(){return(await this.getRawCarbon()).map(h)}};g=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],g)},4473:(e,t,r)=>{r.d(t,{S:()=>d});var s=r(95681),i=r(23347),a=r(25029),o=r(7165),n=r(4400);const c=o.z.object({sharedCollections:o.z.array(n.MX)}),l=e=>c.safeParse(e).success;class d extends((0,s.Q)({capacity:i.Y._010KB,persist:!1,scope:a.F.User,storeName:"collections-store",storeTypeGuard:l,initialValue:{sharedCollections:[]}})){}},14397:(e,t,r)=>{r.d(t,{G:()=>s});class s{}},24595:(e,t,r)=>{r.d(t,{a:()=>Xe});var s=r(88802),i=r(99634),a=r(72721),o=r(93850),n=r(37935),c=r(63663),l=r(87279),d=r(11527),u=r(87969),p=r(57924),h=r(55277),m=r(67541),g=r(80231),v=r(87853);class y{}let _=class{constructor(e,t,r,s,i){this.sharingCollectionsGateway=e,this.sharingCrypto=t,this.sharingDecryption=r,this.sharingUserGroups=s,this.sharingUsers=i}async createCollection(e,t,r,s,i,a){const o=await this.sharingCrypto.createResourceKey(),n={resourceKey:o,uuid:e},c=await this.sharingUsers.createSignedUserInvites(i,n),l=a.length>0?await this.sharingUserGroups.createSignedUserGroupInvites(a,n):void 0,{publicKey:d,privateKey:u}=await this.sharingCrypto.createRecipientKeyPair(o);return this.sharingCollectionsGateway.createCollection({collectionId:e,collectionName:r,publicKey:d,privateKey:u,users:c,userGroups:l,teamId:Number(t)})}async renameCollection(e,t){const{revision:r,uuid:s}=e;await this.sharingCollectionsGateway.renameCollection({collectionId:s,revision:r,updatedName:t})}async inviteCollectionMembers(e,t,r){const{revision:s,uuid:i}=e,a=await this.sharingDecryption.decryptCollectionKey(e);if(!a)throw new Error("Cannot decrypt collection key.");const o=t.length?this.sharingUsers.createSignedUserInvites(t,{resourceKey:a,uuid:e.uuid},!1):void 0,n=r.length?this.sharingUserGroups.createSignedUserGroupInvites(r,{resourceKey:a,uuid:e.uuid}):void 0,[c,l]=await Promise.all([o,n]);return await this.sharingCollectionsGateway.inviteCollectionMembers({revision:s,collectionId:i,users:c,userGroups:l})}async updateCollectionMembers(e,t,r){const{revision:s,uuid:i}=e;return await this.sharingCollectionsGateway.updateCollectionMembers({revision:s,collectionId:i,users:t,userGroups:r})}};_=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[y,h.O,m.c,g.o,v.E])],_);var f=r(40896),S=r(60399),E=r(82466),b=r(47905),w=r(24917),A=r(66076),C=r(95907),I=r(66122),T=r(89685),P=r(91943),O=r(82706),R=r(61199),D=r(64718),N=r(41923);let U=class{constructor(e,t,r,s,i){this.sharingInvitesCrypto=e,this.sharingCrypto=t,this.sharingDecryption=r,this.vaultItemsCrudClient=s,this.activityLogs=i}async getDomainForCredential(e){const t=await(0,S.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[O.U.Credential],ids:[e]}));if((0,l.hx)(t))throw new Error("Unable to find selected item");const r=t.data.credentialsResult.items[0];return new D.Y(r.URL).getRootDomain()}async createCollectionInvites(e,t,r){const s=await Promise.all(t.map((async t=>{const s=await this.sharingDecryption.decryptItemGroupKey(t);if(null===s)throw new Error("Unable to decrypt item group key");const i=await this.sharingDecryption.decryptCollectionKey(e);if(null===i)throw new Error("Unable to decrypt collection key");const a=await this.sharingCrypto.decryptSecureData(i,(0,I.R)(e.privateKey)),{proposeSignature:o,acceptSignature:n,resourceKey:c}=await this.sharingInvitesCrypto.createSignedInvite(e.uuid,{resourceKey:s,uuid:t.sharedItemId},e.publicKey,(0,T.v)(a));if(!n)throw new Error("should not happen");const d=await(0,S.z)(this.activityLogs.queries.areSensitiveLogsEnabled());if((0,l.hx)(d))throw new Error("Unable find preferences");const u=await(0,S.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[O.U.Credential,O.U.SecureNote],ids:[t.itemId]}));if((0,l.hx)(u))throw new Error("Unable to find selected item");let p;return u.data.credentialsResult.items.length&&(p=d.data?{captureLog:!0,domain:await this.getDomainForCredential(t.itemId),type:"AUTHENTIFIANT"}:void 0),{id:t.sharedItemId,permission:r,resourceKey:c,proposeSignature:o,acceptSignature:n,auditLogDetails:p}})));return{collectionId:e.uuid,revision:e.revision,itemGroups:s}}};U=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[N.h,h.O,m.c,R.L,P._])],U);let F=class{constructor(e,t,r,s,i,a){this.collectionInvitesService=e,this.sharingItemGroups=t,this.sharingCollectionsApi=r,this.credentialsGetter=s,this.notesGetter=i,this.sharingItemsClient=a}async addItemsToCollections(e,t,r){const s=await(0,S.z)(this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:t}));if((0,l.hx)(s))throw new Error("Unable to find item groups for items");const i=(0,l.db)(s).sharedItems;if(!i.every((e=>e.permission===E.y3.Admin)))throw new Error("User does not have access to share selected items");const a=await this.credentialsGetter.getCarbonCredentialsByItemIds(t),o=await this.notesGetter.getCarbonNotesByItemIds(t),n=[...a,...o];if(o.some((e=>e.Attachments?.length)))return(0,l.Rn)((0,d.LG)());const c=[...n.filter((({Id:e})=>!i.some((t=>t.itemId===e))))],u=c.length>0?await this.sharingItemGroups.createMultipleItemGroups(c):[];return await Promise.all(e.map((async e=>{const t=await this.collectionInvitesService.createCollectionInvites(e,[...i,...u],r.find((t=>t.collectionId===e.uuid))?.permission??E.y3.Admin);await this.sharingCollectionsApi.addItemGroupsToCollection(t)}))),(0,l.Vp)(void 0)}};F=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[U,w.k,y,A.J,C.H,b.s])],F);var M=r(94205),L=r(4400);const x=e=>e===L.Yt.Manager?E.y3.Admin:E.y3.Limited,k=e=>({login:e.login,permission:x(e.role)}),G=e=>({groupId:e.groupId,permission:x(e.role)}),V=e=>e.login,K=e=>e.groupId,j=e=>e.length>0?e.map(V):void 0;let B=class{constructor(e,t,r,s,i){this.sharingCollections=e,this.sharingCollectionsGateway=t,this.sharingCollectionItems=r,this.vaultClient=s,this.sharingSync=i}async execute({body:e}){const{teamId:t,collectionName:r,privateCollectionId:s,users:i,groups:a,defaultItemPermissions:o,itemIds:n}=e,c=(0,f.R)(),u=await this.sharingCollections.createCollection(c,t,r,o,i.map(k),a.map(G)),p={collectionId:c,permission:o};if(n.length>0)try{const e=await this.sharingCollectionItems.addItemsToCollections([u],n,[p]);if((0,l.hx)(e))throw new Error(e.error.tag)}catch(e){const t=await this.sharingCollectionsGateway.revokeCollectionMembers({collectionId:u.uuid,revision:u.revision,userGroupIds:(h=a,h.length>0?h.map(K):void 0),userLogins:j(i)});if(await this.sharingCollectionsGateway.deleteCollection(t.uuid,t.revision),await this.sharingSync.scheduleSync(),e instanceof Error&&e.message===d.Pf)return(0,l.Rn)((0,d.LG)());throw e}var h;const{commands:m}=this.vaultClient;return s?await m.deleteCollection({id:s}):await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}};B=(0,s.__decorate)([(0,c.W)(d.I4),(0,s.__metadata)("design:paramtypes",[_,y,F,u.C,M.D])],B);var W=r(50384),z=r(14397);let H=class{constructor(e,t,r){this.sharingSync=e,this.collectionsRepository=t,this.sharingCollectionsApi=r}async execute({body:e}){const{id:t}=e,r=await this.collectionsRepository.getCollection(t);if(!r)throw new Error("Failed to find collection revision");return await this.sharingCollectionsApi.deleteCollection(r.uuid,r.revision),await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}};H=(0,s.__decorate)([(0,c.W)(W.U),(0,s.__metadata)("design:paramtypes",[M.D,z.G,y])],H);var Q=r(89074);let q=class{constructor(e,t){this.sharingCollectionsService=e,this.collectionsRepository=t}async execute({body:e}){const{collectionId:t,userRecipients:r,userGroupRecipients:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Collection not found");const a=await this.sharingCollectionsService.inviteCollectionMembers(i,r?.map(k)||[],s?.map(G)||[]),o=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==a.uuid));return await this.collectionsRepository.updateCollections([...o,a]),(0,l.Vp)(void 0)}};q=(0,s.__decorate)([(0,c.W)(Q.Q),(0,s.__metadata)("design:paramtypes",[_,z.G])],q);var Y=r(21242),$=r(48844),X=r(68827),Z=r(80345),J=r(72614);let ee=class{constructor(e,t,r,s,i,a){this.sharingCollectionsGateway=e,this.itemGroupsGetter=t,this.sharingSync=r,this.currentSpaceGetter=s,this.featureFlips=i,this.vaultItemsCrudClient=a}async prepareAuditLogDetails(e){const{userFeatureFlips:t}=this.featureFlips.queries,r=await(0,S.z)(t().pipe((0,$.Qn)((e=>e.audit_logs_sharing&&e.send_activity_log)))),s=!!(0,l.d6)(r)&&(r.data??!1),i=await(0,S.z)(this.currentSpaceGetter.get());if((0,l.hx)(i))throw new Error("Error fetching current space when moving shared collection items to business space");const a=i.data.areSensitiveLogsEnabled,o=await(0,S.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[O.U.Credential],ids:[e]}));if((0,l.hx)(o))throw new Error("Unable to find selected item");const n=(0,l.db)(o),c=n.credentialsResult.matchCount?n.credentialsResult.items[0]:void 0,d=c?new D.Y(c.URL).getRootDomain():"";return s&&a?{captureLog:a,domain:c?d:void 0,type:c?"AUTHENTIFIANT":"SECURENOTE"}:void 0}async removeItemToCollection(e,t){const r=await(0,S.z)(this.itemGroupsGetter.getForItemId(e));if((0,l.hx)(r)||!r.data)throw new Error("Item group to be removed from collection cannot be found");const s=await this.prepareAuditLogDetails(e);await this.sharingCollectionsGateway.removeItemGroupCollectionAccess({collectionId:t,itemGroupId:r.data.groupId,itemGroupRevision:r.data.revision,auditLogDetails:s})}async execute({body:e}){const{collectionIds:t,itemId:r}=e;for(const e of t)await this.removeItemToCollection(r,e);return await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}};ee=(0,s.__decorate)([(0,c.W)(X.B),(0,s.__metadata)("design:paramtypes",[y,Z.E,M.D,J.n,Y.P,R.L])],ee);var te=r(86590);let re=class{constructor(e,t,r){this.sharingCollections=e,this.collectionsRepository=t,this.sharingSync=r}async execute({body:e}){const{collectionId:t,newName:r}=e,s=await this.collectionsRepository.getCollection(t);if(!s)throw new Error("Failed to find collection revision");return await this.sharingCollections.renameCollection(s,r),await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}};re=(0,s.__decorate)([(0,c.W)(te.r),(0,s.__metadata)("design:paramtypes",[_,z.G,M.D])],re);var se=r(77311);let ie=class{constructor(e,t){this.collectionsRepository=e,this.sharingCollectionsGateway=t}async execute({body:e}){const{collectionId:t,userGroupIds:r,userLogins:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Cannot access the requested collection.");const{revision:a}=i,o=await this.sharingCollectionsGateway.revokeCollectionMembers({collectionId:t,revision:a,userGroupIds:r,userLogins:s}),n=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==o.uuid));return await this.collectionsRepository.updateCollections([...n,o]),(0,l.Vp)(void 0)}};ie=(0,s.__decorate)([(0,c.W)(se.q),(0,s.__metadata)("design:paramtypes",[z.G,y])],ie);var ae=r(15507);let oe=class{constructor(e){this.collectionsRepository=e}async execute({body:e}){return await this.collectionsRepository.updateCollections(e.collections),(0,l.Vp)(void 0)}};oe=(0,s.__decorate)([(0,c.W)(ae.M),(0,s.__metadata)("design:paramtypes",[z.G])],oe);var ne=r(78743);let ce=class{constructor(e,t,r){this.itemGroupsGetter=e,this.vaultItemsCrudClient=t,this.currentSpaceGetter=r}async execute(){const e=await(0,S.z)(this.currentSpaceGetter.get());if((0,l.hx)(e))throw new Error("Error fetching current space when moving shared collection items to business space");const t=(0,l.db)(e).teamId;if(!t)return(0,l.Vp)(void 0);const r=await(0,S.z)(this.itemGroupsGetter.get());if((0,l.hx)(r))throw new Error("Error fetching shared collection items to move to business space");const s=(0,l.db)(r).reduce(((e,t)=>t.collections?.some((e=>e.status===E.qb.Accepted))&&t.items?.[0].itemId?[...e,t.items[0].itemId]:e),[]);if(s.length){if((await Promise.all(s.map((e=>this.moveItemToBusinessSpace(e,t))))).some(l.hx))throw new Error("Error when moving shared collection items to business space")}return(0,l.Vp)(void 0)}async moveItemToBusinessSpace(e,t){const{commands:r}=this.vaultItemsCrudClient,s=await(0,S.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[O.U.Credential,O.U.SecureNote],ids:[e]}));if((0,l.hx)(s))return Promise.resolve((0,l.Rn)(void 0));const i=(0,l.db)(s).credentialsResult,a=(0,l.db)(s).secureNotesResult,o=i.matchCount>0,n=a.matchCount>0;if(!o&&!n)return Promise.resolve((0,l.Vp)(void 0));return(o?i.items[0]:a.items[0]).spaceId===t?Promise.resolve((0,l.Vp)(void 0)):r.updateVaultItem({vaultItemType:o?O.U.Credential:O.U.SecureNote,id:e,content:{spaceId:t},shouldSkipSync:!0})}};ce=(0,s.__decorate)([(0,c.W)(ne.g),(0,s.__metadata)("design:paramtypes",[Z.E,R.L,J.n])],ce);var le=r(61076),de=r(43978),ue=r(69885),pe=r(87065),he=r(20754),me=r(84178),ge=r(21869),ve=r(59452);let ye=class{constructor(e,t,r,s){this.userGroupGetter=e,this.collectionsRepository=t,this.context=r,this.sharingItemsClient=s}getUserRoleInCollection$(e,t){const r=this.getCurrentUserLogin();return this.userGroupGetter.getCarbonUserGroups$().pipe((0,le.V)(this.collectionsRepository.collection$(e)),(0,pe.U)((([e,s])=>{if(!s)throw new Error("Shared collection not found");const i=t||r,a=s.users?.find((e=>e.login===i)),o=a?.permission===E.y3.Admin&&a.status===E.qb.Accepted,n=e.filter((e=>e.users.some((e=>e.userId===i&&e.status===E.qb.Accepted)))).map((e=>e.groupId)),c=s.userGroups?.filter((e=>n.includes(e.uuid))),l=c?.some((e=>e.permission===E.y3.Admin));return o||l?L.Yt.Manager:L.Yt.Editor})))}getGroupRoleInCollection$(e,t){return this.collectionsRepository.collection$(e).pipe((0,pe.U)((e=>{if(!e)throw new Error("Shared collection not found");const r=e.userGroups?.find((e=>e.uuid===t));return r?.permission===E.y3.Admin?L.Yt.Manager:L.Yt.Editor})))}canShareItems(e){return 0===e.length?(0,ue.of)((0,l.Vp)(!0)):this.sharingItemsClient.queries.getSharedItemsForItemIds({itemIds:e}).pipe((0,$.Qn)((e=>e.sharedItems.every((e=>e.permission===E.y3.Admin)))))}getCurrentUserLogin(){return this.context.get(ge.l.UserName)}};ye=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[ve.B,z.G,ge.f,b.s])],ye);let _e=class{constructor(e,t,r,s,i){this.sharingAccess=e,this.itemGroupsGetter=t,this.vaultOrganization=r,this.currentSpace=s,this.featureFlips=i}isCollectionsSharingEnabled(e){return e.isSharingEnabled&&e.isCollectionsSharingEnabled}execute({body:e}){const{collectionId:t,userId:r}=e,{queries:{queryCollections:s}}=this.vaultOrganization,{userFeatureFlip:i}=this.featureFlips.queries,a=i({featureFlip:"sharingVault_web_Share_Collections_with_limited_Rights_Items_dev"});return s({ids:[t]}).pipe((0,le.V)(this.currentSpace.get()),(0,de.w)((([e,s])=>{if((0,l.hx)(e))throw new Error("Error accessing private collections");if((0,l.hx)(s))throw new Error("Error accessing current space info");const i=this.isCollectionsSharingEnabled((0,l.db)(s)),a=(0,l.db)(e).collections.find((({id:e})=>e===t));if(a){const e=a.vaultItems.map((({id:e})=>e));return(0,ue.of)({isCollectionsSharingEnabled:i,itemIds:e,role:L.Yt.Manager,isPrivateCollection:!0})}return this.sharingAccess.getUserRoleInCollection$(t,r).pipe((0,le.V)(this.itemGroupsGetter.getForCollectionId(t)),(0,pe.U)((([e,t])=>{if((0,l.hx)(t))throw new Error("Failed to retrieve item groups for shared collection permissions query");return{itemIds:(0,l.db)(t).map((e=>e.items?.[0]?.itemId)),role:e,isCollectionsSharingEnabled:i,isPrivateCollection:!1}})))})),(0,de.w)((({itemIds:e,role:t,isCollectionsSharingEnabled:r,isPrivateCollection:s})=>{const i=t===L.Yt.Manager;return a.pipe((0,de.w)((a=>{let o;return o=!(0,l.hx)(a)&&Boolean((0,l.db)(a)),r&&i?this.sharingAccess.canShareItems(e).pipe((0,pe.U)((e=>{if((0,l.hx)(e))throw new Error("Error checking if user can share a collection");return(0,l.db)(e)?(0,l.Vp)({canShare:i,canEditRoles:i,canEdit:i,canDelete:i,role:t,sharingDisabledReason:s?L.Hz.LimitedRightItems:void 0}):(0,l.Vp)({canShare:!s&&o,canEditRoles:i,canEdit:i,canDelete:i,role:t,sharingDisabledReason:L.Hz.LimitedRightItems})}))):(0,ue.of)((0,l.Vp)({canShare:!1,canEditRoles:i,canEdit:i,canDelete:i,role:t,sharingDisabledReason:r?L.Hz.EditorRole:L.Hz.DisabledInTAC}))})))})))}};_e=(0,s.__decorate)([(0,he.e)(me.y),(0,s.__metadata)("design:paramtypes",[ye,Z.E,u.C,J.n,Y.P])],_e);var fe=r(39821);let Se=class{constructor(e){this.sharingAccess=e}execute({body:e}){const{collectionId:t,groupId:r}=e;return this.sharingAccess.getGroupRoleInCollection$(t,r).pipe((0,pe.U)((e=>(0,l.Vp)(e))))}};Se=(0,s.__decorate)([(0,he.e)(fe.L),(0,s.__metadata)("design:paramtypes",[ye])],Se);var Ee=r(44282);let be=class{constructor(e,t){this.collectionsRepository=e,this.userGroupGetter=t}execute({body:e}){const{targetId:t}=e;return this.userGroupGetter.getCarbonUserGroups$().pipe((0,le.V)(this.collectionsRepository.collections$()),(0,pe.U)((([e,r])=>{const s=r.filter((r=>{const s=r.users?.some((e=>e.login===t));if(s)return!0;const i=r.userGroups,a=i?.some((e=>e.uuid===t));if(a)return!0;const o=e.filter((e=>e.users.some((e=>e.userId===t)))),n=i?.some((e=>o.some((t=>t.groupId===e.uuid))));return n}));return(0,l.Vp)({collections:s})})))}};be=(0,s.__decorate)([(0,he.e)(Ee.Q),(0,s.__metadata)("design:paramtypes",[z.G,ve.B])],be);var we=r(67591),Ae=r(11578);const Ce=e=>{if(!e.items||1!==e.items.length)throw new Error("Corrupted item group");return{id:e.items[0].itemId,type:O.U.Credential}},Ie=(e,t,r)=>{const s=((e,t,r)=>({name:e.name,id:e.uuid,spaceId:r,isShared:!0,vaultItems:t.filter((t=>t.collections?.some((t=>t.uuid===e.uuid)))).map(Ce)}))(e,t,r);if(Ae.JQ.safeParse(s).success)return s;throw new Error("Failure to convert shared collection")};let Te=class{constructor(e,t,r){this.currentSpaceGetter=e,this.itemGroupsGetter=t,this.collectionsRepository=r}execute({body:e}){const{itemIds:t}=e;return this.collectionsRepository.collections$().pipe((0,le.V)(this.currentSpaceGetter.get(),this.itemGroupsGetter.get()),(0,pe.U)((([e,r,s])=>{if((0,l.hx)(r)||(0,l.hx)(s))throw new Error("Unable to access sharing data");const i=e.map((e=>Ie(e,s.data,r.data.teamId))).flatMap((e=>e.vaultItems)),a=t.filter((e=>i.some((t=>t.id===e))));return(0,l.Vp)(a)})))}};Te=(0,s.__decorate)([(0,he.e)(we.q),(0,s.__metadata)("design:paramtypes",[J.n,Z.E,z.G])],Te);var Pe=r(24249);let Oe=class{constructor(e){this.collectionsRepository=e}execute({body:e}){const t=e.collectionIds?e.collectionIds:[];return this.collectionsRepository.collections$().pipe((0,pe.U)((e=>(0,l.Vp)(e.filter((e=>!t.length||t.includes(e.uuid)))))))}};Oe=(0,s.__decorate)([(0,he.e)(Pe.$),(0,s.__metadata)("design:paramtypes",[z.G])],Oe);let Re=class{constructor(e,t,r){this.collectionsRepository=e,this.currentSpaceGetter=t,this.itemGroupsGetter=r}execute(){return this.collectionsRepository.collections$().pipe((0,le.V)(this.currentSpaceGetter.get(),this.itemGroupsGetter.get()),(0,pe.U)((([e,t,r])=>{if((0,l.hx)(t)||(0,l.hx)(r))throw new Error("Failed to load shared collections");return(0,l.Vp)(e.map((e=>Ie(e,r.data,t.data.teamId))))})))}};Re=(0,s.__decorate)([(0,he.e)(Ae.MO),(0,s.__metadata)("design:paramtypes",[z.G,J.n,Z.E])],Re);var De=r(6233);let Ne=class{constructor(e){this.collectionsRepository=e}execute({body:e}){const{collectionIds:t}=e;return this.collectionsRepository.collections$().pipe((0,pe.U)((e=>{const r=e.filter((e=>t.includes(e.uuid))),s=r.flatMap((e=>e.users?e.users:[])).map((e=>({id:e.login,label:e.login,status:e.status,permission:e.permission}))),i=r.flatMap((e=>e.userGroups?e.userGroups:[])).map((e=>({id:e.uuid,label:e.name,status:e.status,permission:e.permission})));return(0,l.Vp)({userGroups:i,users:s})})))}};Ne=(0,s.__decorate)([(0,he.e)(De.O),(0,s.__metadata)("design:paramtypes",[z.G])],Ne);var Ue=r(4473),Fe=r(46629);function Me(e){return void 0!==e}let Le=class{constructor(e,t,r){this.sharingCollectionItems=e,this.sharingSync=t,this.collectionsRepository=r}async execute({body:e}){const{collectionPermissions:t,itemId:r,shouldSkipSync:s}=e,i=await this.collectionsRepository.getCollectionsByIds(t.map((e=>e.collectionId)));if(i.length!==t.length)throw new Error("Unable to find some of the collections in the list");const a=await this.sharingCollectionItems.addItemsToCollections(i.filter(Me),[r],t);if((0,l.hx)(a))throw new Error("Failed adding an item to a list of collections");return s||await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}};Le=(0,s.__decorate)([(0,c.W)(Fe.$),(0,s.__metadata)("design:paramtypes",[F,M.D,z.G])],Le);let xe=class{constructor(e){this.store=e}async getCollectionsByIds(e){return(await this.store.getState()).sharedCollections.filter((t=>e.includes(t.uuid)))}async getCollections(){return(await this.store.getState()).sharedCollections}collections$(){return this.store.state$.pipe((0,pe.U)((e=>e.sharedCollections)))}collection$(e){return this.collections$().pipe((0,pe.U)((t=>t.find((t=>t.uuid===e)))))}async getCollection(e){const t=(await this.store.getState()).sharedCollections.find((t=>t.uuid===e));if(t)return t}async updateCollections(e){await this.store.set({sharedCollections:[...e]})}};xe=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[Ue.S])],xe);var ke=r(87113);const Ge=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:a,permission:o})=>({login:e,collectionKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:a,permission:o}))),Ve=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,permission:a})=>({groupUUID:e,collectionKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,permission:a})));let Ke=class{constructor(e){this.serverApiClient=e}async createCollection(e){const t=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.createCollection((e=>{const{collectionId:t,collectionName:r,users:s,userGroups:i,publicKey:a,privateKey:o,teamId:n}=e;return{collectionUUID:t,collectionName:r,publicKey:a,privateKey:o,teamId:n,users:Ge(s),userGroups:i?Ve(i):void 0}})(e)));if((0,l.hx)(t))throw new Error("Failed to create shared collection from private one");const r=(0,l.db)(t).data.collections?.find((t=>t.uuid===e.collectionId));if(!r)throw new Error("Unable to find collection");return r}async renameCollection(e){const{collectionId:t,revision:r,updatedName:s}=e,i=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.renameCollection({collectionUUID:t,revision:r,updatedName:s}));if((0,l.hx)(i))throw new Error("Failed to rename shared collection")}async addItemGroupsToCollection(e){const t=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.addItemGroupsToCollection({collectionUUID:e.collectionId,itemGroups:e.itemGroups.map((({id:e,proposeSignature:t,acceptSignature:r,permission:s,resourceKey:i,auditLogDetails:a})=>({uuid:e,proposeSignature:t,acceptSignature:r,permission:s,itemGroupKey:i,auditLogDetails:a}))),revision:e.revision}));if((0,l.hx)(t))throw new Error("Failed to add items to collection");if(0===((0,l.db)(t).data.collections||[]).length)throw new Error("Failed to add items to collection")}async updateItemPermissionsInCollection(e){const t=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.updateItemGroupMembers({collections:[{collectionUUID:e.collection.collectionId,permission:e.collection.permission}],groupId:e.groupId,revision:e.revision}));if((0,l.hx)(t))throw new Error("Failed to update item permissions in collection")}async deleteCollection(e,t){const r={collectionUUID:e,revision:t},s=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.deleteCollection(r));if((0,l.hx)(s))throw new Error("Failed to delete shared collection")}async inviteCollectionMembers({collectionId:e,revision:t,users:r,userGroups:s}){const i={collectionUUID:e,revision:t,users:r?Ge(r):void 0,userGroups:s?Ve(s):void 0},a=this.serverApiClient.v1.sharingUserdevice.inviteCollectionMembers(i),o=await(0,S.z)(a);if((0,l.hx)(o)||!o.data.data.collections)throw new Error("Failed to add members to collection");return o.data.data.collections[0]}async updateCollectionMembers({collectionId:e,revision:t,users:r,userGroups:s}){const i={collectionUUID:e,revision:t,users:r,userGroups:s?.map((({groupId:e,permission:t})=>({groupUUID:e,permission:t})))},a=this.serverApiClient.v1.sharingUserdevice.updateCollectionMembers(i),o=await(0,S.z)(a);if((0,l.hx)(o)||!o.data.data.collections)throw new Error("Failed to update collection members");return o.data.data.collections[0]}async revokeCollectionMembers({collectionId:e,revision:t,userGroupIds:r,userLogins:s}){const i=this.serverApiClient.v1.sharingUserdevice.revokeCollectionMembers({collectionUUID:e,revision:t,userLogins:s,userGroupUUIDs:r}),a=await(0,S.z)(i);if((0,l.hx)(a)||!a.data.data.collections)throw new Error("Failed to revoke access to collection");return a.data.data.collections[0]}async removeItemGroupsFromCollection(e,t){const r=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.removeItemGroupsFromCollection({collectionUUID:e.uuid,itemGroupUUIDs:t,revision:e.revision}));if((0,l.hx)(r))throw new Error("Failure to remove items from collection")}async removeItemGroupCollectionAccess(e){const{collectionId:t,itemGroupId:r,itemGroupRevision:s,auditLogDetails:i}=e,a=await(0,S.z)(this.serverApiClient.v1.sharingUserdevice.revokeItemGroupMembers({revision:s,groupId:r,collections:[t],auditLogDetails:i}));if((0,l.hx)(a))throw new Error("Failure to remove collection member from an item group")}};Ke=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[ke.l])],Ke);var je=r(28845),Be=r(71419),We=r(10647),ze=r(177);let He=class{constructor(e,t){this.sharingCollectionsService=e,this.collectionsRepository=t}async execute({body:e}){const{collectionId:t,userRecipients:r,userGroupRecipients:s}=e,i=await this.collectionsRepository.getCollection(t);if(!i)throw new Error("Collection not found");const a=await this.sharingCollectionsService.updateCollectionMembers(i,r?.map(k),s?.map(G)),o=(await this.collectionsRepository.getCollections()).filter((e=>e.uuid!==a.uuid));return await this.collectionsRepository.updateCollections([...o,a]),(0,l.Vp)(void 0)}};He=(0,s.__decorate)([(0,c.W)(ze.c),(0,s.__metadata)("design:paramtypes",[_,z.G])],He);var Qe=r(19286);let qe=class{constructor(e,t){this.collectionsRepository=e,this.context=t}execute(){const e=this.collectionsRepository.collections$(),t=this.getCurrentUserLogin();return e.pipe((0,pe.U)((e=>{const r=e.filter((e=>e.authorLogin===t));return(0,l.Vp)(r.length)})))}getCurrentUserLogin(){return this.context.get(ge.l.UserName)}};qe=(0,s.__decorate)([(0,he.e)(Qe.C),(0,s.__metadata)("design:paramtypes",[z.G,ge.f])],qe);var Ye=r(85980);let $e=class{constructor(e,t,r){this.itemGroupsGetter=e,this.sharingCollectionsGateway=t,this.sharingSync=r}async execute({body:e}){const{collection:t,groupId:r}=e,s=await(0,S.z)(this.itemGroupsGetter.getForItemGroupId(r));if((0,l.hx)(s)||!s.data)throw new Error("Item group to remove cannot be found");return await this.sharingCollectionsGateway.updateItemPermissionsInCollection({groupId:r,collection:{collectionId:t.collectionId,permission:t.permission},revision:s.data.revision}),await this.sharingSync.scheduleSync(),(0,l.Vp)(void 0)}};$e=(0,s.__decorate)([(0,c.W)(Ye.a),(0,s.__metadata)("design:paramtypes",[Z.E,y,M.D])],$e);let Xe=class{};Xe=(0,s.__decorate)([(0,i.Y)({api:a.a,stores:[Ue.S],providers:[_,U,ye,F,xe,{provide:y,useClass:Ke},{provide:z.G,useClass:xe}],exports:[z.G],handlers:{commands:{addItemToCollections:Le,createSharedCollection:B,deleteSharedCollection:H,inviteCollectionMembers:q,updateCollectionMembers:He,removeItemFromCollections:ee,renameCollection:re,revokeCollectionMembers:ie,updateSharedCollections:oe,updatePermissionForCollectionItem:$e,moveCollectionItemsToBusinessSpace:ce},events:{},queries:{getCollectionPermissionsForUser:_e,getCollectionRoleForGroup:Se,getCollectionsForUserOrGroup:be,getItemIdsInSharedCollections:Te,getSharedCollectionsCount:qe,getSharedCollections:Oe,sharedCollectionsWithItems:Re,usersAndGroupsInCollection:Ne}},imports:[o.n,n.D,je.k,Be.I,We.y],requiredFeatureFlips:["sharing_web_invalidSignatureAutoRevoke_prod","sharingVault_web_Collection_Item_Permissions_dev","sharingVault_web_Collection_Item_Permissions_prod","monetization_extension_starterRepackagingCollection"]})],Xe)},71419:(e,t,r)=>{r.d(t,{I:()=>w});var s=r(88802),i=r(99634),a=r(60399),o=r(57924),n=r(87113),c=r(48844),l=r(87279);const d=/[<>]/g;var u=r(76997);function p(e,t){const r=(0,u.B)(e);return{type:r,name:t||`Untitled ${r}`}}const h=e=>e.map((({id:e,resourceKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:a,permission:o})=>({userId:e,groupKey:t,proposeSignature:r,proposeSignatureUsingAlias:s,acceptSignature:i,alias:a,permission:o})));let m=class{constructor(e){this.serverApiClient=e}async getPublicKeysForUsers(e){const t=await(0,a.z)(this.serverApiClient.v1.sharingUserdevice.getUsersPublicKey({logins:e}).pipe((0,c.DZ)((()=>{throw new Error("Cannot get public keys of requested users.")})),(0,c.lk)((e=>(0,l.Vp)(e.data)))));if((0,l.hx)(t))throw new Error("Cannot get public keys of requested users.");return t.data.data.map((e=>{return{login:e.login??(t=e.email,t.trim().toLowerCase().replace(d,"")),publicKey:e.publicKey};var t}))}async createItemGroup({users:e,item:t,itemTitle:r,groupId:s}){const i=await(0,a.z)(this.serverApiClient.v1.sharingUserdevice.createItemGroup({groupId:s,items:[t],users:h(e),itemsForEmailing:[p(t.itemType,r)]}));if((0,l.hx)(i))throw new Error("Failed to create item group");const o=(0,l.db)(i).data.itemGroups?.find((e=>e.groupId===s));if(!o)throw new Error("Error creating item group");return o}async createMultipleItemGroups(e){const t=e.map((({users:e,item:t,itemTitle:r,groupId:s})=>({groupId:s,items:[t],users:h(e),itemsForEmailing:[p(t.itemType,r)]}))),r=await(0,a.z)(this.serverApiClient.v1.sharingUserdevice.createMultipleItemGroups({itemgroups:t}));if((0,l.hx)(r))throw new Error("Failed to create multiple item groups");const s=(0,l.db)(r).data;if(s.itemGroupErrors?.length)throw new Error("Failed to create some of multiple item groups");if(!s.itemGroups?.length)throw new Error("No item groups have been created");return s.itemGroups}async revokeItemGroupMembers(e){const{itemGroupId:t,revision:r,userLogins:s,collectionIds:i,userGroupIds:o}=e,n=await(0,a.z)(this.serverApiClient.v1.sharingUserdevice.revokeItemGroupMembers({groupId:t,revision:r,collections:i,users:s,groups:o}));if((0,l.hx)(n))throw new Error("Revoking members of item groups have failed");const c=(0,l.db)(n).data;if(!c.itemGroups?.length)throw new Error("No members of item groups have been revoked");if(c.itemGroupErrors?.length)throw new Error("Revoking of some members of item groups failed");return c.itemGroups}async refuseItemGroup(e){const{itemGroupId:t,revision:r}=e,s=await(0,a.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:t,revision:r}));if((0,l.hx)(s))throw new Error("Refusing item group have failed");const i=(0,l.db)(s).data;if(!i.itemGroups?.length)throw new Error("No members of item groups have been revoked");if(i.itemGroupErrors?.length)throw new Error("Revoking of some members of item groups failed");return i.itemGroups}};m=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[n.l])],m);var g=r(24917),v=r(94205),y=r(80231),_=r(87853),f=r(28845),S=r(93850),E=r(10647),b=r(51911);let w=class{};w=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"sharing-common",providers:[g.k,v.D,y.o,_.E,{provide:b.b,useClass:m}],exports:[g.k,v.D,y.o,_.E,b.b],imports:[f.k,S.n,E.y]})],w)},24917:(e,t,r)=>{r.d(t,{k:()=>p});var s=r(88802),i=r(57924),a=r(10370),o=r(82466),n=r(40896),c=r(55277),l=r(87853),d=r(51911),u=r(76997);let p=class{constructor(e,t,r){this.sharingApi=e,this.sharingCrypto=t,this.sharingUsers=r}async prepareCreateItemGroupModel(e){const t=(0,n.R)(),r=await this.sharingCrypto.createResourceKey(),s=await this.sharingUsers.createSignedUserInvites([],{resourceKey:r,uuid:t}),i=await this.sharingCrypto.createResourceKey(),o=await this.sharingCrypto.encryptSecureData(r,i),c=await this.sharingCrypto.encryptSharingItem(i,e);return{groupId:t,item:{itemId:e.Id,itemType:(0,u.l)(e),itemKey:(0,a.s)(o),content:(0,a.s)(c)},itemTitle:e.Title,users:s}}convertToSharedItem(e){const t=e.items?.[0];if(!t)throw new Error("Newly created item group is missing an item");const r=e.users?.[0];if(!r)throw new Error("Newly created item group is missing an admin");const{itemKey:s,itemId:i}=t;if(!r.groupKey)throw new Error("Newly created item group is missing a resource key");return{isLastAdmin:!0,sharedItemId:e.groupId,itemKey:s,itemId:i,accessLink:{accessType:o.Uv.User,encryptedResourceKey:r.groupKey,permission:o.y3.Admin},permission:o.y3.Admin,recipientIds:{userIds:[r.userId],collectionIds:null,userGroupIds:null},revision:e.revision}}async createItemGroup(e){const t=await this.prepareCreateItemGroupModel(e);return this.sharingApi.createItemGroup(t)}async createMultipleItemGroups(e){const t=await Promise.all(e.map((e=>this.prepareCreateItemGroupModel(e))));return(await this.sharingApi.createMultipleItemGroups(t)).map(this.convertToSharedItem)}};p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[d.b,c.O,l.E])],p)},94205:(e,t,r)=>{r.d(t,{D:()=>u});var s=r(88802),i=r(87279),a=r(60399),o=r(30523),n=r(57924),c=r(76183),l=r(81038),d=r(26897);let u=class{constructor(e){this.syncClient=e}async scheduleSync(){const{commands:e,queries:t}=this.syncClient;return await(0,a.z)(t.syncProgress().pipe((0,o.h)(i.d6),(0,o.h)((e=>e.data.status!==c.L.IN_PROGRESS)))),await e.sync({trigger:d.Trigger.Sharing}),(0,i.Vp)(void 0)}};u=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[l.Q])],u)},80231:(e,t,r)=>{r.d(t,{o:()=>d});var s=r(88802),i=r(57924),a=r(82466),o=r(59452),n=r(81982),c=r(55277),l=r(41923);let d=class{constructor(e,t,r,s){this.userGroupsGetter=e,this.sharingCrypto=t,this.sharingInvitesCrypto=r,this.currentUserGetter=s}async createSignedUserGroupInvites(e,t){const r=await this.currentUserGetter.getCurrentUserWithKeys(),s=await this.userGroupsGetter.getForGroupIds(e.map((e=>e.groupId)));return await Promise.all(s.map((async s=>{const i=e.find((e=>e.groupId===s.groupId))?.permission??a.y3.Limited,o=s.users.find((e=>e.userId===r.login)),n=o?.groupKey;if(!n)throw new Error("Unable to get user group key.");const c=await this.sharingCrypto.decryptResourceKeyToClearText(r.privateKey,s.privateKey,n),{proposeSignature:l,acceptSignature:d,resourceKey:u}=await this.sharingInvitesCrypto.createSignedInvite(s.groupId,t,s.publicKey,c);return{permission:i,proposeSignature:l,acceptSignature:d,id:s.groupId,resourceKey:u}})))}};d=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.B,c.O,l.h,n.a])],d)},87853:(e,t,r)=>{r.d(t,{E:()=>l});var s=r(88802),i=r(57924),a=r(82466),o=r(81982),n=r(41923),c=r(51911);let l=class{constructor(e,t,r){this.currentUserGetter=e,this.invitesCryptoService=t,this.sharingGateway=r}async createSignedUserInvites(e,t,r=!0){const s=e.length?await this.sharingGateway.getPublicKeysForUsers(e.map((e=>e.login))):[],i=await this.currentUserGetter.getCurrentUserWithKeys(),o=[...r?[{login:i.login,publicKey:i.publicKey,permission:a.y3.Admin}]:[],...s.map((t=>({...t,permission:e.find((e=>e.login===t.login))?.permission??a.y3.Limited})))];return await Promise.all(o.map((async e=>{const r=i.login===e.login;if(!e.publicKey)throw new Error("missing user public key");return{...await this.invitesCryptoService.createSignedInvite(e.login,t,e.publicKey,r?i.privateKey:void 0),id:e.login,alias:e.login,permission:r?a.y3.Admin:e.permission}})))}};l=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.a,n.h,c.b])],l)},51911:(e,t,r)=>{r.d(t,{b:()=>s});class s{}},28845:(e,t,r)=>{r.d(t,{k:()=>d});var s=r(88802),i=r(99634),a=r(10647),o=r(55277),n=r(67541),c=r(41923),l=r(37935);let d=class{};d=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"sharing-crypto",providers:[o.O,n.c,c.h],exports:[o.O,n.c,c.h],imports:[a.y,l.D]})],d)},55277:(e,t,r)=>{r.d(t,{O:()=>A});var s=r(88802),i=r(57924),a=r(31222),o=r(92258),n=r(40173),c=r(72580),l=r(83919),d=r(12554),u=r(77970),p=r(28008),h=r(10370),m=r(54066),g=r(86286),v=r(9034),y=r(83168),_=r(66122),f=r(89685),S=r(86252),E=r(43293),b=r(21131);var w=r(87279);let A=class{constructor(e,t,r,s,i,a,o,n,c){this.client=e,this.hmacSigner=t,this.keyGeneratorAes256=r,this.rsaKeyPairGenerator=s,this.kwc5Decryptor=i,this.kwc5Encryptor=a,this.rsaDecryptor=o,this.rsaEncryptor=n,this.rsaSigner=c}async createResourceKey(){return await this.keyGeneratorAes256.generate()}async encryptSecureData(e,t){return await this.kwc5Encryptor.encrypt(e,t)}async decryptSecureData(e,t){return await this.kwc5Decryptor.decrypt(e,t)}async createProposeSignature(e,t){const r=await this.hmacSigner.sign(e,t);return(0,h.s)(r)}async createRecipientKeyPair(e){const{publicKey:t,privateKey:r}=await this.rsaKeyPairGenerator.generate(),s=(0,m.u)((0,g.R)(r)),i=await this.encryptSecureData(e,s);return{publicKey:(0,v.y)(t),privateKey:(0,h.s)(i)}}async createAcceptSignature(e,t,r){const s=`${t}-accepted-${(0,h.s)(r)}`,i=(0,m.u)(s),a=await this.rsaSigner.sign((0,y.B)(e),i);return(0,h.s)(a)}async encryptResourceKey(e,t){return await this.rsaEncryptor.encrypt(e,t)}async decryptResourceKey(e,t){return await this.rsaDecryptor.decrypt(e,t)}async decryptResourceKeyToClearText(e,t,r){const s=await this.decryptResourceKey((0,y.B)(e),(0,_.R)(r)),i=await this.decryptSecureData(s,(0,_.R)(t));return(0,f.v)(i)}async encryptSharingItem(e,t){const{commands:{carbon:r}}=this.client,s=await r({name:"convertItemToDashlaneXml",args:[{item:t}]}),i=(a=s,(0,w.hx)(a)||"string"!=typeof a.data.carbonResult.xml?null:a.data.carbonResult.xml);var a;if(""===i||null===i)throw new Error("Unable to convert item to XML");const o=(e=>{const t=(0,E.N)(e),r=(0,m.u)(t);return(0,b.n)(r)})(i);return await this.encryptSecureData(e,o)}async decryptEncapsulatedPrivateKey(e,t,r){const s=await this.decryptResourceKey(e,(0,_.R)(t)),i=await this.decryptSecureData(s,(0,_.R)(r));return(0,y.B)((0,f.v)(i))}};A=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[S._,a.q,o.c,n.e,c.$,l.o,d.g,u.H,p.k])],A)},67541:(e,t,r)=>{r.d(t,{c:()=>p});var s=r(88802),i=r(57924),a=r(63877),o=r(83168),n=r(66122),c=r(82466),l=r(55277),d=r(81982),u=r(59452);let p=class{constructor(e,t,r){this.sharingCrypto=e,this.currentUserGetter=t,this.userGroupsGetter=r}async decryptItemGroupKey(e){const t=await this.currentUserGetter.getCurrentUserWithKeys(),{accessLink:r}=e;return r?.accessType===c.Uv.User?this.decryptViaUserMember(r,t):r?.accessType===c.Uv.UserGroup?this.decryptViaGroupMember(r,t):r?.accessType===c.Uv.CollectionUser?this.decryptViaCollectionUserMember(r,t):r?.accessType===c.Uv.CollectionUserGroup?this.decryptViaCollectionUserGroupMember(r,t):null}async decryptViaUserMember(e,t){try{return await this.sharingCrypto.decryptResourceKey((0,o.B)(t.privateKey),(0,n.R)(e.encryptedResourceKey))}catch{return null}}async decryptViaGroupMember(e,t){const{encryptedResourceKey:r,groupEncryptedKey:s,groupPrivateKey:i}=e;if(!s||!i)return null;try{const e=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,o.B)(t.privateKey),s,i);return await this.sharingCrypto.decryptResourceKey(e,(0,n.R)(r))}catch(e){return null}}async decryptViaCollectionUserMember(e,t){const{encryptedResourceKey:r,collectionEncryptedKey:s,collectionPrivateKey:i}=e;if(!s||!i)return null;const a=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,o.B)(t.privateKey),s,i);return await this.sharingCrypto.decryptResourceKey(a,(0,n.R)(r))}async decryptViaCollectionUserGroupMember(e,t){const{encryptedResourceKey:r,collectionEncryptedKey:s,collectionPrivateKey:i,groupEncryptedKey:a,groupPrivateKey:c}=e;if(!(s&&i&&a&&c))return null;const l=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,o.B)(t.privateKey),a,c),d=await this.sharingCrypto.decryptEncapsulatedPrivateKey(l,s,i);return await this.sharingCrypto.decryptResourceKey(d,(0,n.R)(r))}async decryptCollectionKey(e,t=a.qb.Accepted){const r=await this.currentUserGetter.getCurrentUserWithKeys(),s=e.users?.find((e=>e.login===r.login&&e.status===t&&e.collectionKey));if(s?.collectionKey)return await this.decryptCollectionKeyViaUserMember(s,r);const i=(await this.userGroupsGetter.getCarbonUserGroups()).filter((e=>e.users.some((e=>e.userId===r.login&&e.status===t&&!e.proposeSignatureUsingAlias&&e.groupKey)))),o=e.userGroups?.find((e=>i.some((t=>t.groupId===e.uuid))&&e.status===t&&e.collectionKey));return o?.collectionKey?await this.decryptCollectionKeyViaGroupMember(o,r,i):null}async decryptCollectionKeyViaUserMember(e,t){if(!e.collectionKey)return null;try{return await this.sharingCrypto.decryptResourceKey((0,o.B)(t.privateKey),(0,n.R)(e.collectionKey))}catch{return null}}async decryptCollectionKeyViaGroupMember(e,t,r){if(!e.collectionKey)return null;try{const s=r.find((({groupId:t})=>t===e.uuid)),i=s?.users.find((({userId:e})=>e===t.login));if(!i?.groupKey||!s)return null;const a=await this.sharingCrypto.decryptEncapsulatedPrivateKey((0,o.B)(t.privateKey),i.groupKey,s.privateKey);return await this.sharingCrypto.decryptResourceKey(a,(0,n.R)(e.collectionKey))}catch{return null}}};p=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[l.O,d.a,u.B])],p)},41923:(e,t,r)=>{r.d(t,{h:()=>d});var s=r(88802),i=r(57924),a=r(3417),o=r.n(a),n=r(54066);var c=r(10370),l=r(55277);let d=class{constructor(e){this.sharingCrypto=e}async createSignedInvite(e,t,r,s){const i=await this.sharingCrypto.encryptResourceKey(function(e){const{asn1:t,pki:r}=o(),s=r.publicKeyFromPem(e),i=r.publicKeyToAsn1(s),a=t.toDer(i).getBytes();return(0,n.u)(a)}(r),t.resourceKey),a=(0,c.s)(i),l=(0,n.u)(e);return{proposeSignature:await this.sharingCrypto.createProposeSignature(t.resourceKey,l),acceptSignature:s?await this.sharingCrypto.createAcceptSignature(s,t.uuid,t.resourceKey):void 0,resourceKey:a,proposeSignatureUsingAlias:!r}}};d=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[l.O])],d)},31766:(e,t,r)=>{r.d(t,{o:()=>s});const s=e=>{if(!e)return!1;const t=e;return!!t.pendingItemGroups&&!!t.pendingUserGroups}},63090:(e,t,r)=>{r.d(t,{p:()=>ue});var s=r(88802),i=r(99634),a=r(58425),o=r(93850),n=r(37935),c=r(85390),l=r(87065),d=r(21869),u=r(20754),p=r(87279),h=r(15179),m=r(19617),g=r(7165),v=r(95681),y=r(23347),_=r(25029),f=r(4400);const S=g.z.object({pendingCollections:g.z.array(f.MX)}),E=e=>S.safeParse(e).success;class b extends((0,v.Q)({capacity:y.Y._010KB,persist:!1,scope:_.F.User,storeName:"pending-shared-collections-state",storeTypeGuard:E,initialValue:{pendingCollections:[]}})){}var w=r(82466);const A=e=>void 0!==e.referrer&&void 0!==e.permission,C=(e,t)=>e.map((e=>{const r=(e.users||[]).find((e=>e.login===t&&e.status===w.qb.Pending));return{uuid:e.uuid,name:e.name,referrer:r?.referrer,permission:r?.permission,seen:!0}})).filter(A);let I=class{constructor(e,t,r){this.inviteGetter=e,this.store=t,this.context=r}execute(){const e=this.inviteGetter.get(),t=this.store.state$,r=this.getCurrentUserLogin();return(0,c.a)([e,t]).pipe((0,l.U)((([e,t])=>{const s=(0,p.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},i=r?C(t.pendingCollections,r):[];return(0,p.Vp)({pendingItemGroups:s.pendingItemGroups,pendingUserGroups:s.pendingUserGroups,pendingCollections:i})})))}getCurrentUserLogin(){return this.context.get(d.l.UserName)}};I=(0,s.__decorate)([(0,u.e)(h.q),(0,s.__metadata)("design:paramtypes",[m.V,b,d.f])],I);var T=r(36610);let P=class{constructor(e,t){this.store=e,this.context=t}execute(){const e=this.getCurrentUserLogin();if(void 0===e)throw new Error("Unable to get pending collections, user login not found");return this.store.state$.pipe((0,l.U)((t=>{const r=C(t.pendingCollections,e);return(0,p.Vp)(r)})))}getCurrentUserLogin(){return this.context.get(d.l.UserName)}};P=(0,s.__decorate)([(0,u.e)(T.D),(0,s.__metadata)("design:paramtypes",[b,d.f])],P);var O=r(6136),R=r(36469),D=r(48844),N=r(86252),U=r(31766);let F=class{constructor(e,t){this.carbonLegacyClient=e,this.store=t}execute(){const{queries:{carbonState:e}}=this.carbonLegacyClient,t=e({path:"userSession.sharingSync"}).pipe((0,D.Qn)((e=>{if(!(0,U.o)(e))throw new Error("Bad SharingSync format");return e}))),r=this.store.state$;return(0,c.a)([t,r]).pipe((0,l.U)((([e,t])=>{const r=(0,p.d6)(e)?e.data:{pendingItemGroups:[],pendingUserGroups:[]},s=r.pendingItemGroups.length>0,i=r.pendingUserGroups.length>0,a=t.pendingCollections.length>0;return s||i||a})),(0,O.x)(),(0,l.U)(p.Vp))}};F=(0,s.__decorate)([(0,u.e)(R._),(0,s.__metadata)("design:paramtypes",[N._,b])],F);var M=r(60399),L=r(63663),x=r(87113),k=r(31609),G=r(63877),V=r(55277),K=r(67541),j=r(94205),B=r(81982);let W=class{constructor(e,t,r,s,i,a){this.serverApiClient=e,this.sharingCrypto=t,this.sharingDecryption=r,this.pendingCollectionsStore=s,this.sharingSync=i,this.currentUserGetter=a}async execute(e){const{body:{collectionId:t}}=e,r=(await this.pendingCollectionsStore.getState()).pendingCollections.find((({uuid:e})=>e===t));if(!r)throw new Error("Pending Collection not found");const s=await this.sharingDecryption.decryptCollectionKey(r,G.qb.Pending);if(!s)throw new Error("Unable to decrypt Collection Key for pending collection");const i=await this.currentUserGetter.getCurrentUserWithKeys(),a=await this.sharingCrypto.createAcceptSignature(i.privateKey,t,s),o=await(0,M.z)(this.serverApiClient.v1.sharingUserdevice.acceptCollection({collectionUUID:t,revision:r.revision,acceptSignature:a}));return(0,p.hx)(o)?(0,p.Rn)(new k.nu):(await this.sharingSync.scheduleSync(),(0,p.Vp)(void 0))}};W=(0,s.__decorate)([(0,L.W)(k.cD),(0,s.__metadata)("design:paramtypes",[x.l,V.O,K.c,b,j.D,B.a])],W);var z=r(68096);let H=class{constructor(e,t){this.serverApiClient=e,this.pendingCollectionsStore=t}async execute(e){const{body:{collectionId:t}}=e,r=(await this.pendingCollectionsStore.getState()).pendingCollections.find((({uuid:e})=>e===t));if(!r)throw new Error("Pending Collection not found");const s=await(0,M.z)(this.serverApiClient.v1.sharingUserdevice.refuseCollection({collectionUUID:t,revision:r.revision}));return(0,p.hx)(s)?(0,p.Rn)(new z.R$):(0,p.Vp)(void 0)}};H=(0,s.__decorate)([(0,L.W)(z.UC),(0,s.__metadata)("design:paramtypes",[x.l,b])],H);var Q=r(82567),q=r(21242),Y=r(55677),$=r(57789),X=r(64718),Z=r(76997);const J=e=>{const t=(0,Z.l)(e);return{type:(0,Z.B)(t),name:e.Title}};var ee=r(80345);let te=class{constructor(e,t,r,s,i,a){this.carbonLegacyClient=e,this.serverApiClient=t,this.inviteGetter=r,this.itemGroupsGetter=s,this.featureFlips=i,this.sharingSync=a}async execute(e){const{body:{itemGroupId:t}}=e,r=await(0,M.z)(this.itemGroupsGetter.getForItemGroupId(t));if((0,p.hx)(r))throw new Error("Failed to retrieve item group for pending item group with");const s=(0,p.db)(r);if(void 0===s)return(0,p.Rn)(new Y.fL);const i=await this.getItemContent(t),a=await this.prepareAuditLogDetails(i);return(0,M.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:s.groupId,revision:s.revision,itemsForEmailing:[J(i)],auditLogDetails:a}).pipe((0,D.DZ)((e=>{if("BusinessError"===e.tag)return(0,Y.fr)(e.code);throw new Error(e.message)})),(0,D.lk)((e=>{if(void 0===e.data.itemGroupErrors||0===e.data.itemGroupErrors.length)return(0,p.Vp)(void 0);if(e.data.itemGroupErrors.length>0)throw new Error("Error when refusing an item group invite");throw new Error("Unknown server error")})),(0,Q.b)((async e=>{(0,p.d6)(e)&&await this.sharingSync.scheduleSync()}))))}async getItemContent(e){const t=this.inviteGetter.get().pipe((0,D.Qn)((t=>{const r=t.pendingItemGroups.find((t=>t.itemGroupId===e));if(!r)throw new Error("Pending item group not found when refusing invite");if(r.items.length<1)throw new Error("Missing item content for pending item group when refusing invite");return r.items[0]}))),r=await(0,M.z)(t);if((0,p.hx)(r))throw new Error("Failed to retrieve item content for pending item group when refusing invite");return r.data}async prepareAuditLogDetails(e){const{queries:{carbonState:t}}=this.carbonLegacyClient,r=t({path:"userSession.localSettings.premiumStatus"}).pipe((0,D.Qn)((e=>(e=>(e.spaces??[]).filter((e=>"accepted"===e.status)))(e)[0]))),{userFeatureFlips:s}=this.featureFlips.queries,i=await(0,M.z)(s().pipe((0,D.Qn)((e=>e.audit_logs_sharing&&e.send_activity_log))));if(!(!!(0,p.d6)(i)&&(i.data??!1)))return;const a=await(0,M.z)(r);if((0,p.hx)(a))return;const o=(0,p.db)(a)?.info.collectSensitiveDataAuditLogsEnabled;return o?((e,t)=>{const r=!!t?.SpaceId&&e,s=t&&(0,$.G)(t),i=s?new X.Y(t.Url).getRootDomain():"",a=s?i||"":void 0,o=(0,Z.l)(t);return r?{captureLog:r,domain:a,type:o}:void 0})(o,e):void 0}};te=(0,s.__decorate)([(0,L.W)(Y.gm),(0,s.__metadata)("design:paramtypes",[N._,x.l,m.V,ee.E,q.P,j.D])],te);var re=r(84009),se=r(59452);let ie=class{constructor(e,t,r){this.serverApiClient=e,this.userGroupGetter=t,this.sharingSync=r}async execute(e){const{body:{userGroupId:t}}=e,r=await this.userGroupGetter.getForGroupIds([t]);if(0===r.length)throw new Error(`Failed to retrieve user group for pending user group with id ${t}`);const{groupId:s,revision:i}=r[0];return await(0,M.z)(this.serverApiClient.v1.sharingUserdevice.refuseUserGroup({groupId:s,revision:i,provisioningMethod:G.ET.USER}).pipe((0,D.DZ)((e=>{if("BusinessError"===e.tag)return(0,re.cz)(e.code);throw new Error(e.message)})),(0,D.lk)((e=>{if(void 0===e.data.userGroupErrors||0===e.data.userGroupErrors.length)return(0,p.Vp)(void 0);if(e.data.userGroupErrors.length>0)throw new Error(`Error for user group ${e.data.userGroupErrors[0].groupId}: ${e.data.userGroupErrors[0].message}`);throw new Error("Unknown server error")})),(0,Q.b)((async e=>{(0,p.d6)(e)&&await this.sharingSync.scheduleSync()}))))}};ie=(0,s.__decorate)([(0,L.W)(re.Fo),(0,s.__metadata)("design:paramtypes",[x.l,se.B,j.D])],ie);var ae=r(79517);let oe=class{constructor(e,t){this.store=e,this.context=t}execute({body:e}){const t=e,r=this.getCurrentUserLogin(),s=t.filter((e=>(e.users||[]).some((e=>e.login===r&&e.status===w.qb.Pending))));return this.store.set({pendingCollections:s}),Promise.resolve((0,p.Vp)(void 0))}getCurrentUserLogin(){return this.context.get(d.l.UserName)}};oe=(0,s.__decorate)([(0,L.W)(ae.r),(0,s.__metadata)("design:paramtypes",[b,d.f])],oe);var ne=r(28845),ce=r(4473),le=r(71419),de=r(10647);let ue=class{};ue=(0,s.__decorate)([(0,i.Y)({api:a.t,stores:[b,ce.S],handlers:{commands:{acceptCollectionInvite:W,refuseCollectionInvite:H,refuseItemGroupInvite:te,refuseUserGroupInvite:ie,updatePendingCollections:oe},events:{},queries:{getInvites:I,getPendingCollections:P,hasInvites:F}},imports:[o.n,n.D,ne.k,le.I,de.y],requiredFeatureFlips:["audit_logs_sharing","send_activity_log","sharingVault_web_Share_Collections_with_limited_Rights_Items_dev"],providers:[]})],ue)},78165:(e,t,r)=>{r.d(t,{F:()=>Ie});var s=r(88802),i=r(99634),a=r(93850),o=r(48958),n=r(87065),c=r(43978),l=r(69885),d=r(6136),u=r(20754),p=r(87279),h=r(83253),m=r(72614);class g{}let v=class{constructor(e,t){this.currentSpaceGetter=e,this.sharedItemsRepository=t}execute(){return this.currentSpaceGetter.get().pipe((0,n.U)((e=>{if((0,p.hx)(e))throw new Error("Problem retrieving current space information to assess sharing capacity");return(0,p.db)(e).sharedItemsLimit})),(0,c.w)((e=>void 0===e?(0,l.of)((0,p.Vp)(!0)):this.sharedItemsRepository.sharedItems$().pipe((0,n.U)((e=>e.length)),(0,d.x)(),(0,n.U)((t=>(0,p.Vp)(e-t>0)))))))}};v=(0,s.__decorate)([(0,u.e)(h.B),(0,s.__metadata)("design:paramtypes",[m.n,g])],v);var y=r(87113),_=r(48844),f=r(31485);let S=class{constructor(e,t){this.serverApiClient=e,this.premiumSpaceGetter=t}execute(){return this.premiumSpaceGetter.get().pipe((0,c.w)((e=>{if((0,p.hx)(e))throw new Error("Error retrieving space for user");return(0,p.db)(e).teamId?this.serverApiClient.v1.sharingUserdevice.getTeamLogins().pipe((0,_.Qn)((e=>({userLogins:e.data.teamLogins}))),(0,_.DZ)((e=>{throw e}))):(0,l.of)((0,p.Vp)({userLogins:[]}))})))}};S=(0,s.__decorate)([(0,u.e)(f.G),(0,s.__metadata)("design:paramtypes",[y.l,m.n])],S);var E=r(54003);let b=class{constructor(e){this.currentSpaceGetter=e}execute(){return this.currentSpaceGetter.get().pipe((0,_.Qn)((e=>e.isSharingEnabled)))}};b=(0,s.__decorate)([(0,u.e)(E.N),(0,s.__metadata)("design:paramtypes",[m.n])],b);var w=r(80345),A=r(92718);let C=class{constructor(e){this.itemGroupsGetter=e}execute({body:e}){const{itemId:t}=e;return this.itemGroupsGetter.getForItemId(t).pipe((0,_.Qn)((e=>({itemGroupId:e?.groupId}))))}};C=(0,s.__decorate)([(0,u.e)(A.C),(0,s.__metadata)("design:paramtypes",[w.E])],C);var I=r(39770);let T=class{constructor(e){this.sharedItemsRepository=e}execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,n.U)((e=>(0,p.Vp)({sharedItems:e}))))}};T=(0,s.__decorate)([(0,u.e)(I.z),(0,s.__metadata)("design:paramtypes",[g])],T);var P=r(60399),O=r(61076),R=r(62760),D=r(89358),N=r(82466),U=r(20920),F=r(59452);let M=class{constructor(e,t,r){this.sessionClient=e,this.itemGroupGetter=t,this.userGroupsGetter=r}async getCurrentUserLogin(){return await(0,P.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,_.lk)((e=>(0,p.Vp)(e)))))}execute({body:e}){const{itemId:t}=e;return this.itemGroupGetter.getForItemId(t).pipe((0,O.V)(this.userGroupsGetter.get(),this.getCurrentUserLogin()),(0,n.U)((([e,t,r])=>{if((0,p.hx)(e))throw new Error("Error when retrieving item group to check sharing status");const s=(0,p.db)(e);if(!s)return{isShared:!1,isSharedViaUserGroup:!1};if(!(0,p.d6)(r))throw new Error("Error when trying to get user login to check sharing status for item");const i=t.filter((({users:e})=>e.some((e=>e.userId===r.data&&e.status===N.qb.Accepted)))).map((({groupId:e})=>e));return{isShared:!0,isSharedViaUserGroup:s.groups?.some((({groupId:e,status:t})=>i.includes(e)&&"accepted"===t))??!1}})),(0,d.x)(R.shallowEqualObjects),(0,n.U)(p.Vp))}};M=(0,s.__decorate)([(0,u.e)(U.S),(0,s.__metadata)("design:paramtypes",[D.x,w.E,F.B])],M);var L=r(4975);let x=class{constructor(e){this.sharedItemsRepository=e}execute({body:e}){const{itemId:t}=e;return this.sharedItemsRepository.sharedItemForId$(t).pipe((0,n.U)((e=>(0,p.Vp)({permission:e?.permission}))))}};x=(0,s.__decorate)([(0,u.e)(L.C),(0,s.__metadata)("design:paramtypes",[g])],x);var k=r(68653);let G=class{constructor(e){this.sharedItemsRepository=e}execute({body:e}){const{itemIds:t}=e;return this.sharedItemsRepository.sharedItemsForIds$(t).pipe((0,n.U)((e=>(0,p.Vp)(e.reduce(((e,t)=>(e[t.itemId]=t.permission,e)),{})))))}};G=(0,s.__decorate)([(0,u.e)(k.R),(0,s.__metadata)("design:paramtypes",[g])],G);var V=r(56556);let K=class{constructor(e){this.sharedItemsRepository=e}execute({body:e}){const{itemId:t}=e;return this.sharedItemsRepository.sharedItemForId$(t).pipe((0,n.U)((e=>(0,p.Vp)({isLastAdmin:Boolean(e?.isLastAdmin)}))))}};K=(0,s.__decorate)([(0,u.e)(V.X),(0,s.__metadata)("design:paramtypes",[g])],K);var j=r(11098),B=r(14397);let W=class{constructor(e,t,r){this.itemGroupsGetter=e,this.userGroupsGetter=t,this.collectionsRepository=r}execute({body:e}){const{itemId:t}=e;return this.itemGroupsGetter.getForItemId(t).pipe((0,n.U)((e=>{if((0,p.hx)(e))throw new Error("Error when retrieving item group for shared access");const t=(0,p.db)(e);if(!t)return;const r=t.users?.map((e=>({permission:e.permission,status:e.status,recipientId:e.userId,recipientName:e.alias,recipientType:N.IP.User}))).filter((e=>!["revoked","refused"].includes(e.status??""))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName))),s=t.groups?.map((e=>({permission:e.permission,status:e.status,recipientId:e.groupId,recipientName:e.name,recipientType:N.IP.Group}))).filter((e=>!["revoked","refused"].includes(e.status))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName))),i=t.collections?.map((e=>({permission:e.permission,status:e.status,recipientId:e.uuid,recipientName:e.name,recipientType:N.IP.Collection}))).filter((e=>!["revoked","refused"].includes(e.status))).sort(((e,t)=>e.recipientName.localeCompare(t.recipientName)));return{users:r??[],groups:s??[],collections:i??[],itemGroupId:t.groupId}})),(0,c.w)((e=>e?.groups.length?this.userGroupsGetter.getCarbonUserGroups$().pipe((0,n.U)((t=>({...e,groups:e.groups.map((e=>({...e,recipientName:t.find((t=>t.groupId===e.recipientId))?.name??e.recipientName})))})))):(0,l.of)(e))),(0,c.w)((e=>e?.collections.length?this.collectionsRepository.collections$().pipe((0,n.U)((t=>({...e,collections:e.collections.map((e=>({...e,recipientName:t.find((t=>t.uuid===e.recipientId))?.name??e.recipientName})))})))):(0,l.of)(e))),(0,n.U)((e=>(0,p.Vp)(e?{...e,count:e.users.length+e.groups.length+e.collections.length}:void 0))))}};W=(0,s.__decorate)([(0,u.e)(j.v),(0,s.__metadata)("design:paramtypes",[w.E,F.B,B.G])],W);var z=r(81620),H=r(82706),Q=r(72965);let q=class{constructor(e,t){this.vaultClient=e,this.itemGroupGetter=t}getVaultItems(e,t,r,s){return this.vaultClient.queries.search({searchQuery:r,vaultItemTypes:e,propertyFilters:null!==s?[{property:"spaceId",value:s}]:void 0,ids:t})}execute({body:e}){const{userId:t,groupId:r,query:s,spaceId:i}=e;if(!t&&!r)throw new Error("No userId and no groupId has been provided");return this.itemGroupGetter.get().pipe((0,c.w)((e=>{if(!(0,p.d6)(e))throw new Error("Incorrect type");const a=e.data.filter((e=>t?e.users?.filter((e=>e.userId===t)).length:r?e.groups?.filter((e=>e.groupId===r&&e.status!==N.qb.Revoked)).length:void 0)).flatMap((e=>e.items?.map((e=>e.itemId))||[]));return this.getVaultItems([H.U.Credential,H.U.SecureNote,H.U.Secret],a,s,i).pipe((0,n.U)((e=>{if(!(0,p.d6)(e))throw new Error("Unable to retrieve vault items");const t=e.data.credentialsResult.items,r=e.data.secureNotesResult.items,s=e.data.secretsResult.items;return(0,p.Vp)({sharedCredentials:t,sharedSecureNotes:r,sharedSecrets:s})})))})))}};q=(0,s.__decorate)([(0,u.e)(z.v),(0,s.__metadata)("design:paramtypes",[Q.T,w.E])],q);var Y=r(40070);let $=class{constructor(e){this.itemGroups=e}execute(){return this.itemGroups.get().pipe((0,_.Qn)((e=>e.reduce(((e,t)=>[...e,...t.items?.map((e=>e.itemId))??[]]),[]))))}};$=(0,s.__decorate)([(0,u.e)(Y.c),(0,s.__metadata)("design:paramtypes",[w.E])],$);var X=r(10647),Z=r(24595),J=r(57924),ee=r(86252);const te=(e,t)=>t.permission===N.y3.Admin?t.permission:e,re=e=>e.reduce(te,N.y3.Limited),se=(e,t)=>e?.filter((e=>t.some((t=>t.uuid===e.uuid))&&e.status===N.qb.Accepted&&e.itemGroupKey)),ie=(...e)=>e.find((e=>e?.link))??e[0],ae=({permission:e,status:t})=>e===N.y3.Admin&&t===N.qb.Accepted,oe=(e,t,r,s)=>{const i=((e,t)=>{const r=e.users?.filter((e=>e.userId===t&&e.status===N.qb.Accepted&&e.groupKey)),s=e.users?.some((({userId:e,permission:r,rsaStatus:s,status:i})=>e!==t&&r===N.y3.Admin&&"sharingKeys"===s&&i===N.qb.Accepted))??!1;if(r?.length){const e=r[0];if(e.groupKey){const{permission:t,acceptSignature:i,proposeSignature:a}=e;return{link:{permission:t,acceptSignature:i,proposeSignature:a,encryptedResourceKey:e.groupKey,accessType:N.Uv.User},permission:re(r),otherAdminsFound:s}}}return{permission:N.y3.Limited,otherAdminsFound:s}})(e,t),a=Boolean(i?.otherAdminsFound)||Boolean(e.groups?.some(ae))||Boolean(e.collections?.some(ae));if(null!==i&&i.permission===N.y3.Admin)return{...i,otherAdminsFound:a};const o=r.filter((e=>e.users.some((e=>e.userId===t&&e.status===N.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.groupKey)))),n=((e,t,r)=>{const s=e.groups?.filter((e=>r.some((t=>t.groupId===e.groupId))&&e.status===N.qb.Accepted&&e.groupKey));if(s?.length){const e=s[0],i=re(s);if(e.groupKey){const{permission:s,acceptSignature:a,proposeSignature:o}=e,n=r.find((t=>t.groupId===e.groupId)),c=n?.users.find((e=>e.userId===t));if(c?.groupKey)return{link:{permission:s,acceptSignature:a,proposeSignature:o,encryptedResourceKey:e.groupKey,groupEncryptedKey:c.groupKey,groupPrivateKey:n?.privateKey,accessType:N.Uv.UserGroup},permission:i}}}return null})(e,t,o);if(null!==n&&n.permission===N.y3.Admin)return{...ie(i,n),permission:N.y3.Admin,otherAdminsFound:a};const c=((e,t,r)=>{const s=r.filter((e=>e.users?.some((e=>e.login===t&&e.status===N.qb.Accepted&&!e.proposeSignatureUsingAlias&&e.collectionKey)))),i=se(e.collections,s);if(i?.length){const e=i[0],r=re(i);if(e.itemGroupKey){const{permission:i,acceptSignature:a,proposeSignature:o}=e,n=s.find((t=>t.uuid===e.uuid)),c=n?.users?.find((e=>e.login===t));if(c&&n&&n.privateKey&&c.collectionKey)return{link:{permission:i,acceptSignature:a,proposeSignature:o,encryptedResourceKey:e.itemGroupKey,collectionEncryptedKey:c.collectionKey,collectionPrivateKey:n.privateKey,accessType:N.Uv.CollectionUser},permission:r}}}return null})(e,t,s);if(null!==c&&c.permission===N.y3.Admin)return{...ie(i,n,c),permission:N.y3.Admin,otherAdminsFound:a};const l=((e,t,r,s)=>{const i=s.filter((e=>e.userGroups?.some((e=>r.some((t=>t.groupId===e.uuid))&&e.status===N.qb.Accepted&&e.collectionKey)))),a=se(e.collections,i);if(a?.length){const e=a[0],s=re(a);if(e.itemGroupKey){const{permission:a,acceptSignature:o,proposeSignature:n}=e,c=i.find((t=>t.uuid===e.uuid)),l=c?.userGroups?.find((e=>r.some((t=>t.groupId===e.uuid))));if(!l)return null;const d=r.find((({groupId:e})=>e===l.uuid)),u=d?.users.find((({userId:e})=>e===t));if(l.collectionKey&&c&&u?.groupKey)return{link:{permission:a,acceptSignature:o,proposeSignature:n,encryptedResourceKey:e.itemGroupKey,collectionEncryptedKey:l.collectionKey,collectionPrivateKey:c.privateKey,groupPrivateKey:d?.privateKey,groupEncryptedKey:u.groupKey,accessType:N.Uv.CollectionUserGroup},permission:s}}}return null})(e,t,o,s);return{...ie(i,n,c,l),permission:l?.permission??N.y3.Limited,otherAdminsFound:a}},ne=(e,t,r,s)=>{const{link:i,permission:a,otherAdminsFound:o}=oe(e,s,t,r);if(!i)throw new Error("No access to a requested shared item");const{items:n,revision:c,groupId:l,groups:d,collections:u,users:p}=e,h=n?.[0];if(!h)throw new Error("No items associated with item group");const{itemId:m,itemKey:g}=h;return{permission:a,accessLink:i,itemId:m,itemKey:g,sharedItemId:l,revision:c,isLastAdmin:a===N.y3.Admin&&!o,recipientIds:{userIds:p?.map((({userId:e})=>e))??null,collectionIds:u?.map((({uuid:e})=>e))??null,userGroupIds:d?.map((({groupId:e})=>e))??null}}};let ce=class{constructor(e,t,r,s){this.itemGroupsGetter=e,this.userGroupsGetter=t,this.collectionsRepository=r,this.carbonLegacyClient=s}userId$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"state.userSession.account.login"}).pipe((0,n.U)((e=>{if((0,p.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))}combineWithCollectionsAndUserGroups(e,t){return e.pipe((0,O.V)(this.userGroupsGetter.getCarbonUserGroups$(),this.collectionsRepository.collections$(),this.userId$()),(0,n.U)((([e,r,s,i])=>{if((0,p.hx)(e))throw new Error("Error when retrieving item groups");return t((0,p.db)(e),r,s,i)})))}sharedItems$(){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.get(),((e,t,r,s)=>e.map((e=>ne(e,t,r,s)))))}sharedItemsForIds$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemsIds(e),((e,t,r,s)=>e.map((e=>ne(e,t,r,s)))))}sharedItemForId$(e){return this.combineWithCollectionsAndUserGroups(this.itemGroupsGetter.getForItemId(e),((e,t,r,s)=>e?ne(e,t,r,s):null))}};ce=(0,s.__decorate)([(0,J.GS)(),(0,s.__metadata)("design:paramtypes",[w.E,F.B,B.G,ee._])],ce);var le=r(63663),de=r(43216);let ue=class{constructor(e,t){this.serverApiClient=e,this.itemGroupsGetter=t}async execute({body:e}){const{vaultItemId:t}=e,r=await(0,P.z)(this.itemGroupsGetter.getForItemId(t));if((0,p.hx)(r))throw new Error("Failed to retrieve item group for pending item group with");const s=(0,p.db)(r);if(void 0===s)throw new Error("Failed to retrieve item group for pending item group with");return await(0,P.z)(this.serverApiClient.v1.sharingUserdevice.refuseItemGroup({groupId:s.groupId,revision:s.revision})),(0,p.Vp)(void 0)}};ue=(0,s.__decorate)([(0,le.W)(de.l),(0,s.__metadata)("design:paramtypes",[y.l,w.E])],ue);var pe=r(30523),he=r(82567),me=r(89618),ge=r(9671),ve=r(90198),ye=r(88176),_e=r(51911),fe=r(94205);const Se=async(e,t=2)=>{const r=[...e];let s=0;for(;r.length;){const e=r.splice(0,t).map((e=>e()));s+=(await Promise.all(e)).length}return s};let Ee=class{constructor(e,t,r,s,i,a,o){this.sharedItemsRepository=e,this.commonGateway=t,this.carbonClient=r,this.sessionClient=s,this.sharingSync=i,this.sharingInvitesClient=a,this.allowedToFail=o}async execute(e){const{body:{vaultItemIds:t,pendingInvitesIds:r,shouldRunSync:s}}=e;if(!t.length&&!r.length)return(0,p.Vp)(void 0);const i=await this.getCurrentUserLoginAfterGrapheneSessionOpening(),a=r.map((e=>()=>this.refusePendingInvite(e))),o=await Se(a),n=await this.getRevokeSharedItemsTasks(i,t),c=await Se(n);return(s||(o>0||c>0))&&this.sharingSync.scheduleSync(),(0,p.Vp)(void 0)}async refusePendingInvite(e){const{commands:{refuseItemGroupInvite:t}}=this.sharingInvitesClient,r=await t({itemGroupId:e});if((0,p.hx)(r))throw new Error("Failure to refuse pending invite for a force categorized item");return(0,p.db)(r)}async getRevokeSharedItemsTasks(e,t){if(!t.length)return[];return(await(0,P.z)(this.sharedItemsRepository.sharedItemsForIds$(t))).map((t=>()=>this.revokeSharedItem(t,e)))}async revokeSharedItem({isLastAdmin:e,revision:t,recipientIds:{userIds:r,collectionIds:s,userGroupIds:i},sharedItemId:a,itemId:o,permission:n},c){const l=r?.filter((e=>e!==c));if(e&&(l||s||i))return this.commonGateway.revokeItemGroupMembers({itemGroupId:a,revision:t,userLogins:l?.length?l:void 0,collectionIds:s??void 0,userGroupIds:i??void 0});const d=await this.commonGateway.refuseItemGroup({itemGroupId:a,revision:t});return n===N.y3.Admin?this.duplicateVaultItem(o):d}async duplicateVaultItem(e){const{commands:{duplicateVaultItem:t}}=this.carbonClient,r=await t({vaultItemId:e});if((0,p.hx)(r))throw new Error("Failed to duplicate a shared item that is revoked because of forced catgorization");return(0,p.db)(r)}async getCurrentUserLoginAfterGrapheneSessionOpening(){return await(0,P.z)(this.sessionClient.queries.selectedOpenedSession().pipe((0,pe.h)(p.d6),(0,n.U)(p.db),(0,he.b)((e=>{e||this.allowedToFail.doOne((()=>{throw new Error("Unexpected user login value for remote control of shared items")}))})),(0,pe.h)((e=>"string"==typeof e&&""!==e)),(0,me.V)({first:3e3,with:()=>{throw new Error("Timeout retrieving user login after Graphene Session Opening for remote control of shared items")}})))}};Ee=(0,s.__decorate)([(0,le.W)(ve.v),(0,s.__metadata)("design:paramtypes",[g,_e.b,ee._,D.x,fe.D,ye.h,ge.J])],Ee);var be=r(88917);let we=class{constructor(e){this.serverApiClient=e}async execute(){this.serverApiClient.v1.sharingUserdevice;const e=await(0,P.z)((0,l.of)(void 0));return(0,p.Vp)(e)}};we=(0,s.__decorate)([(0,le.W)(be.S),(0,s.__metadata)("design:paramtypes",[y.l])],we);var Ae=r(71419),Ce=r(63090);let Ie=class{};Ie=(0,s.__decorate)([(0,i.Y)({api:o.X,providers:[{provide:g,useClass:ce}],handlers:{commands:{refuseSharedItem:ue,remoteControlSharedItems:Ee,shareItems:we},events:{},queries:{isSharingAllowed:v,getSharingTeamLogins:S,sharingEnabled:b,getItemGroupIdForItemId:C,getSharedItemsForItemIds:T,getSharingStatusForItem:M,getPermissionForItem:x,getPermissionForItems:G,getIsLastAdminForItem:K,sharedAccessForItem:W,getUserSharedVaultItems:q,sharedItemsIds:$}},imports:[a.n,X.y,Ae.I,Ce.p,Z.a]})],Ie)},40896:(e,t,r)=>{r.d(t,{R:()=>i});var s=r(78776);const i=()=>`{${(0,s.Z)().toUpperCase()}}`},76997:(e,t,r)=>{function s(e){switch(e?.kwType){case"KWAuthentifiant":return"AUTHENTIFIANT";case"KWSecureNote":return"SECURENOTE";default:return"SECRET"}}function i(e){switch(e){case"AUTHENTIFIANT":return"password";case"SECURENOTE":return"note";default:return"secret"}}r.d(t,{B:()=>i,l:()=>s})},77007:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(86952),i=r(76471);const a=(0,s.Q)({name:"enclaveSdkApi",commands:{createTeamInEnclave:i.f},events:{},queries:{}})},76471:(e,t,r)=>{r.d(t,{f:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},64483:(e,t,r)=>{r.d(t,{m:()=>c});var s=r(86952),i=r(15181),a=r(75437),o=r(49540),n=r(76264);const c=(0,s.Q)({name:"scim",commands:{updateScimConfiguration:i.G,generateScimToken:a.S},events:{},queries:{scimConfiguration:o.I,scimEndpoint:n.v}})},75437:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},15181:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},49540:(e,t,r)=>{r.d(t,{I:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},76264:(e,t,r)=>{r.d(t,{v:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},95082:(e,t,r)=>{r.d(t,{y:()=>_});var s=r(86952),i=r(85355),a=r(26758),o=r(2073),n=r(41689),c=r(39118),l=r(80974),d=r(94603),u=r(50179),p=r(74746),h=r(82249),m=r(66012),g=r(26250),v=r(1434),y=r(21589);const _=(0,s.Q)({name:"confidentialSSOApi",commands:{CheckDNSValidationCommand:i.o,ClearSettingsCommand:a.h,CreateTeamCommand:o.p,DeleteDomainCommand:n.k,EnableSsoCommand:c.F,InitSsoProvisioningCommand:l.S,LoginUserWithEnclaveSSOCommand:d.B,ProvisionDomainCommand:u.p,TestLoginUserWithEnclaveSSOCommand:p.b,UpdateMetadataCommand:h.o,ValidateMetadataCommand:m.l,UpdateGroupProvisioningConfigurationCommand:g.Z5},events:{},queries:{SsoProvisioningQuery:v._,GetGroupProvisioningConfigurationQuery:y.$}})},64532:(e,t,r)=>{r.d(t,{E:()=>a});var s=r(67837),i=r(95082);class a extends((0,s.E)(i.y)){}(0,s.K)(i.y,a)},85355:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},26758:(e,t,r)=>{r.d(t,{h:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},2073:(e,t,r)=>{r.d(t,{p:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},41689:(e,t,r)=>{r.d(t,{k:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},39118:(e,t,r)=>{r.d(t,{F:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},80974:(e,t,r)=>{r.d(t,{S:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},94603:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},50179:(e,t,r)=>{r.d(t,{p:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},74746:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},26250:(e,t,r)=>{r.d(t,{B3:()=>l,HC:()=>c,Y3:()=>u,Z5:()=>p,b2:()=>d,gY:()=>n,hJ:()=>s});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.GENERIC_ERROR="GENERIC_ERROR",e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.MISMATCHING_ADMIN_PROVISIONING_KEY="MISMATCHING_ADMIN_PROVISIONING_KEY",e.IDP_NOT_FOUND="IDP_NOT_FOUND",e.NO_IDP_CONFIGURATION_UPDATE="NO_IDP_CONFIGURATION_UPDATE"}(s||(s={}));const n=(0,o.Vj)(s.TEAM_NOT_FOUND,"Team not found"),c=(0,o.Vj)(s.MISMATCHING_ADMIN_PROVISIONING_KEY,"Mismatching admin provisioning key"),l=(0,o.Vj)(s.IDP_NOT_FOUND,"IDP not found"),d=(0,o.Vj)(s.NO_IDP_CONFIGURATION_UPDATE,"No IDP configuration update"),u=(0,o.Vj)(s.GENERIC_ERROR,"Generic error");class p extends((0,i.g)({scope:a.F.User})){}},82249:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},66012:(e,t,r)=>{r.d(t,{l:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},21589:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},1434:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},36577:(e,t,r)=>{r.d(t,{$m:()=>n,Ep:()=>o,N6:()=>a,xp:()=>i});const s=["local","staging","prod"];function i(e){return s.includes(e)}class a{constructor(e,t,r){this.cloudflareHeaders=e,this.enclaveUrl=t,this.environment=r}}const o=e=>"local"===e?"MIICqzCCAjKgAwIBAgIUGdKnU0kGWeXtXL7BK1VpIbnjXZkwCgYIKoZIzj0EAwMwgYQxCzAJBgNVBAYTAkZSMQ8wDQYDVQQIDAZGcmFuY2UxDjAMBgNVBAcMBVBhcmlzMQswCQYDVQQKDAJETDELMAkGA1UECwwCREwxFjAUBgNVBAMMDU5pdHJvIFRlc3QgQ0ExIjAgBgkqhkiG9w0BCQEWE3NlcnZlckBkYXNobGFuZS5jb20wHhcNMjIwNDI3MTI0NTQ5WhcNNDIwNDIyMTI0NTQ5WjCBhDELMAkGA1UEBhMCRlIxDzANBgNVBAgMBkZyYW5jZTEOMAwGA1UEBwwFUGFyaXMxCzAJBgNVBAoMAkRMMQswCQYDVQQLDAJETDEWMBQGA1UEAwwNTml0cm8gVGVzdCBDQTEiMCAGCSqGSIb3DQEJARYTc2VydmVyQGRhc2hsYW5lLmNvbTB2MBAGByqGSM49AgEGBSuBBAAiA2IABLeu4raurW6XA9/c13rzPwzbk1aYAR/fPj49YoaZI+K0PFfo75rKUr0m7LawW/jpwkAqWad44SXxj2fF+REDz4ii8tUjVl8Ijp1ohrQEAvDZLcxS98bQV+NFmoyx6QxbQKNjMGEwHQYDVR0OBBYEFM5p3QEkzjDGWRntWRdqC0aWiGiaMB8GA1UdIwQYMBaAFM5p3QEkzjDGWRntWRdqC0aWiGiaMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2cAMGQCMGdird9+5r9vw9vt2x4q86nMJwu2eGXbcOE6sVRSQ92nWYHk2VX2NZix1tBX3nMGiQIwRHALNGgnkUofNBOoxZ/Pntk14Djv5Kt3/fKd6NWFRhyFZ97jho4c+slS7u9LrttE":"MIICETCCAZagAwIBAgIRAPkxdWgbkK/hHUbMtOTn+FYwCgYIKoZIzj0EAwMwSTELMAkGA1UEBhMCVVMxDzANBgNVBAoMBkFtYXpvbjEMMAoGA1UECwwDQVdTMRswGQYDVQQDDBJhd3Mubml0cm8tZW5jbGF2ZXMwHhcNMTkxMDI4MTMyODA1WhcNNDkxMDI4MTQyODA1WjBJMQswCQYDVQQGEwJVUzEPMA0GA1UECgwGQW1hem9uMQwwCgYDVQQLDANBV1MxGzAZBgNVBAMMEmF3cy5uaXRyby1lbmNsYXZlczB2MBAGByqGSM49AgEGBSuBBAAiA2IABPwCVOumCMHzaHDimtqQvkY4MpJzbolL//Zy2YlES1BR5TSksfbb48C8WBoyt7F2Bw7eEtaaP+ohG2bnUs990d0JX28TcPQXCEPZ3BABIeTPYwEoCWZEh8l5YoQwTcU/9KNCMEAwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUkCW1DdkFR+eWw5b6cp3PmanfS5YwDgYDVR0PAQH/BAQDAgGGMAoGCCqGSM49BAMDA2kAMGYCMQCjfy+Rocm9Xue4YnwWmNJVA44fA0P5W2OpYow9OYCVRaEevL8uO1XYru5xtMPWrfMCMQCi85sWBbJwKKXdS6BptQFuZbT73o/gBh1qUxl/nNr12UO8Yfwr6wPLb+6NIwLz3/Y=",n=e=>"local"===e?{0:"9e33eca6497ec3b68ae13735cd28b1a9be1235d3440f10121327150495de4a4f854eb902a62991b366757f3d87ce57e4"}:"staging"===e?{3:"90528150e0f0537fa9e96b067137f6494d525f2fcfd15b478ce28ab2cfaf38dd4e24ad73f9d9d6f238a7f39f2d1956b7"}:{3:"dfb6428f132530b8c021bea8cbdba2c87c96308ba7e81c7aff0655ec71228122a9297fd31fe5db7927a7322e396e4c16",8:"4dbb92401207e019e132d86677857081d8e4d21f946f3561b264b7389c6982d3a86bcf9560cef4a2327eac5c5c6ab820"}},93715:(e,t,r)=>{r.d(t,{E:()=>w});var s,i=r(88802),a=r(99634),o=r(25504),n=r(77007),c=r(63663),l=r(87279),d=r(86252),u=r(76471),p=r(42645),h=r(7165);!function(e){e.SSO_CONNECTOR="sso_connector",e.ENCRYPTION_SERVICE="encryption_service",e.NITRO="nitro_encryption_service"}(s||(s={}));const m=h.z.object({data:h.z.object({deviceAccessKey:h.z.string(),deviceSecretKey:h.z.string()})}),g=h.z.object({data:h.z.object({devicePrivateKey:h.z.string(),devicePublicKey:h.z.string()})});var v;!function(e){e.TEAMS_CREATE_TEAM="api/teams/CreateTeam"}(v||(v={}));const y=h.z.object({adminProvisioningKey:h.z.string()});var _=r(95842),f=r(33229);let S=class{constructor(e,t,r){this.enclaveService=e,this.carbonClient=t,this.teamPlanClient=r}async execute(){let e;try{const t=await this.getTeamUuid(),r=await this.registerTeamDeviceWithAccount();e=r.deviceAccessKey;const s=(await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:v.TEAMS_CREATE_TEAM,body:t,responseSchema:y}))(this.enclaveService,{teamDeviceCredentials:{teamUuid:t,accessKey:r.deviceAccessKey,secretKey:r.deviceSecretKey,sharingPublicKey:r.devicePublicKey,sharingPrivateKey:r.devicePrivateKey}})).adminProvisioningKey;return await this.persistAdminProvisionningKey(s),(0,l.Vp)(void 0)}catch(t){switch(e&&await this.rollBackTeamCreation(e),t){case"TeamIdNotFound":return(0,l.Rn)({tag:"TeamIdNotFound"});case"RegisterTeamDeviceFailed":return(0,l.Rn)({tag:"RegisterTeamDeviceFailed"});default:return(0,l.Rn)({tag:"CreateTeamInEnclaveApiError"})}}}async getTeamUuid(){const e=await(0,f.I)(this.carbonClient);if((0,l.hx)(e))throw new Error("TeamIdNotFound");const{teamInfo:{uuid:t}}=e.data;if(!t)throw new Error("TeamIdNotFound");return t}async registerTeamDeviceWithAccount(){const e=await(async e=>{const t=await e.commands.registerTeamDevice({platform:s.NITRO,deviceName:"Nitro Encryption Service"});if((0,l.hx)(t))return t;const{data:{deviceAccessKey:r,deviceSecretKey:i}}=m.parse((0,l.db)(t)),a=await e.commands.registerTeamDeviceAccount({deviceAccessKey:r,shouldGenerateDeviceKeyPair:!0});if((0,l.hx)(a))return a;const{data:{devicePrivateKey:o,devicePublicKey:n}}=g.parse((0,l.db)(a));return(0,l.Vp)({deviceAccessKey:r,deviceSecretKey:i,devicePrivateKey:o,devicePublicKey:n})})(this.carbonClient);if((0,l.hx)(e))throw new Error("RegisterTeamDeviceFailed");return(0,l.db)(e)}async persistAdminProvisionningKey(e){await this.carbonClient.commands.persistAdminProvisioningKey({adminProvisioningKey:e})}async rollBackTeamCreation(e){await this.carbonClient.commands.deactivateTeamDevice({teamDeviceAccessKey:e})}};S=(0,i.__decorate)([(0,c.W)(u.f),(0,i.__metadata)("design:paramtypes",[_.d,d._,p.e])],S);var E=r(36577),b=r(43673);let w=class{};w=(0,i.__decorate)([(0,a.Y)({api:n.S,imports:[o.X,b.i],providers:[_.d],exports:[_.d],configurations:{enclaveApiSettings:{token:E.N6}},handlers:{commands:{createTeamInEnclave:S},events:{},queries:{}}})],w)},95842:(e,t,r)=>{r.d(t,{d:()=>F});var s=r(88802),i=r(57924),a=r(73774),o=r(58895),n=r(36577),c=r(56695),l=r(96412),d=r(60399),u=r(87279),p=r(7165);const h=e=>{const t=e.match(/[\da-f]{2}/gi);return t?new Uint8Array(t.map((e=>parseInt(e,16)))).buffer:(new Uint8Array).buffer},m=p.z.object({data:p.z.object({attestation:p.z.string(),clientIdentifier:p.z.string()}),requestId:p.z.string()});class g{decode(e){const t=m.safeParse(e);if(!t.success)throw new Error("Invalid response format");return{attestation:h(t.data.data.attestation),clientIdentifier:t.data.data.clientIdentifier}}}const v=async(e,t)=>{const{headers:r,httpClient:s,publicKey:i}=t,a=await(async e=>(await c.ready,{clientPublicKey:c.to_hex(e)}))(i),o=await(0,d.z)(s.post(e,a,{observe:"body",responseType:"json",responseBodyDecoder:new g,withCredentials:!0,headers:r}));if((0,u.hx)(o))throw new Error("string"==typeof o.error?o.error:"HTTP Error");return o.data};var y=r(73155);const _=p.z.object({requestId:p.z.string(),errors:p.z.array(p.z.object({status:p.z.string(),code:p.z.string(),message:p.z.string()}))});class f{assertData(e){if(!e)throw new Error("toDecode expected to be truthy");if("[object Object]"!=`${e}`||Array.isArray(e))throw new Error("toDecode expected to be object");if(!Object.prototype.hasOwnProperty.call(e,"data"))throw new Error('toDecode expected to contain a "data" property');const t=e;if("string"!=typeof t.data)throw new Error("toDecode.data expected to be type string but was "+typeof t.data)}decode(e){return this.assertData(e),e.data}}var S=r(76465);function E(e){return(0,S.Jx)(new Uint8Array(e))}const b=e=>{const t=E(new Uint8Array(e)),r=(s=t,Array.isArray(s)?s:s.value);var s;const[i,,a,o]=r;if(!i)throw new Error("parseSignedMessage: no protected header field");if(!a)throw new Error("parseSignedMessage: no payload field");if(!o)throw new Error("parseSignedMessage: no signature field");return{payload:new Uint8Array(a).buffer,protectedHeaders:new Uint8Array(i).buffer,signature:new Uint8Array(o).buffer}};var w=r(89685),A=r(66122);const C=p.z.object({module_id:p.z.string(),timestamp:p.z.bigint(),digest:p.z.string(),pcrs:p.z.record(p.z.string(),p.z.instanceof(Uint8Array)),certificate:p.z.instanceof(Uint8Array),cabundle:p.z.array(p.z.instanceof(Uint8Array)),user_data:p.z.instanceof(Uint8Array),nonce:p.z.instanceof(Uint8Array).nullable()}),I=p.z.object({header:p.z.string(),publicKey:p.z.string()});var T=r(71833);const P=async(e,t,r,s)=>{const i=T.KBB.fromBER(s),a=await i.getPublicKey(),o=["Signature1",t,new ArrayBuffer(0),r],n=(c=o,(0,S.cv)(c));var c;return crypto.subtle.verify({name:"ECDSA",hash:"SHA-384"},a,e,n)};var O=r(96303);const R=e=>(0,O.k)((e=>new Uint8Array(e).buffer)(e)),D=async e=>{const{attestation:t,rootCertBER:r,expectedPCRs:s}=e,{protectedHeaders:i,payload:a,signature:o}=b(t),n=(e=>{const t=E(e),r=C.safeParse(t);if(!r.success)throw new Error("failed to parse attestation document");const s=r.data,i=(0,w.v)(s.user_data),a=JSON.parse(i),o=I.safeParse(a);if(!o.success)throw new Error("failed to parse server crypto info");const n=o.data;return{moduleId:s.module_id,timestamp:s.timestamp,digest:s.digest,pcrs:s.pcrs,certificate:new Uint8Array(s.certificate).buffer,cabundle:(c=s.cabundle,c.map((e=>new Uint8Array(e).buffer))),serverHeader:(0,A.R)(n.header),serverPublicKey:(0,A.R)(n.publicKey),nonce:null!==s.nonce?new Uint8Array(s.nonce).buffer:null};var c})(a),c=await(async(e,t,r)=>{const s=T.KBB.fromBER(e),i=t.map((e=>T.KBB.fromBER(e)));i.push(s);const a=[T.KBB.fromBER((0,A.R)(r))],o=new T.DMg({trustedCerts:a,certs:i});return(await o.verify()).result})(n.certificate,n.cabundle,r);if(!c)throw new Error("Invalid cert chain!");if(!await P(o,i,a,n.certificate))throw new Error("Invalid signature!");return((e,t)=>{for(const[r,s]of Object.entries(t))if(s!==R(e[Number(r)]))throw new Error("PCRs did not match")})(n.pcrs,s),{serverPublicKey:n.serverPublicKey,serverHeader:n.serverHeader}};var N;!function(e){e.CLIENT_HELLO="api/tunnel/ClientHello",e.TERMINATE_HELLO="api/tunnel/TerminateHello"}(N||(N={}));const U=async(e,t)=>{await c.ready;const{enclaveApiSettings:{cloudflareHeaders:r,enclaveUrl:s},rootCertBER:i,expectedPCRs:a,httpClient:o,platformInfo:n,data:p}=t,h={};h["dashlane-client-agent"]=JSON.stringify({platform:n.platformName,osversion:n.osVersion,version:n.appVersion}),r.accessKey&&r.secretKey&&(h["CF-Access-Client-Id"]=r.accessKey,h["CF-Access-Client-Secret"]=r.secretKey);const m=c.crypto_kx_keypair(),{clientHelloUrl:g,terminateHelloUrl:S,secureContentUrl:E}=((e,t)=>({clientHelloUrl:`${e}${N.CLIENT_HELLO}`,terminateHelloUrl:`${e}${N.TERMINATE_HELLO}`,secureContentUrl:`${e}${t}`}))(s,e),b=await v(g,{headers:h,httpClient:o,publicKey:m.publicKey}),{serverPublicKey:w,serverHeader:A}=await D({attestation:b.attestation,rootCertBER:i,expectedPCRs:a});(0,l.t)({url:s,name:"ClientIdentifier",value:b.clientIdentifier,expirationDate:(new Date).getTime()+15e5,sameSite:"strict",secure:!0});const C=await(async(e,t)=>{const{headers:r,clientKeyPair:s,httpClient:i,serverPublicKey:a}=t;await c.ready;const o=c.crypto_kx_client_session_keys(s.publicKey,s.privateKey,new Uint8Array(a)),n=c.crypto_secretstream_xchacha20poly1305_init_push(o.sharedRx),l=n.state,p=n.header,h={clientHeader:c.to_hex(p)},m=await(0,d.z)(i.post(e,h,{observe:"response",responseType:"json",withCredentials:!0,headers:r}));if((0,u.hx)(m))throw new Error("HTTP error");return{clientStateOut:l,sessionKeys:o}})(S,{headers:h,httpClient:o,clientKeyPair:m,serverPublicKey:w});return(async(e,t)=>{const{clientStateOut:r,serverHeader:s,sessionKeys:i,headers:a,httpClient:o}=t;await c.ready;const n=c.crypto_secretstream_xchacha20poly1305_push(r,c.from_string(t.data),null,c.crypto_secretstream_xchacha20poly1305_TAG_MESSAGE),l={data:c.to_hex(n)},p=await(0,d.z)(o.post(e,l,{observe:"body",responseType:"json",responseBodyDecoder:new f,withCredentials:!0,headers:a}));if((0,u.hx)(p)){if(p.error instanceof y.R){const e=await JSON.parse(await p.error.response.text()),t=_.safeParse(e);if(t.success){const e=t.data.errors[0];throw new Error(e.code)}}throw new Error("HTTP error")}const h=c.crypto_secretstream_xchacha20poly1305_init_pull(new Uint8Array(s),i.sharedTx),m=c.crypto_secretstream_xchacha20poly1305_pull(h,c.from_hex(p.data)).message;return{decryptedResponse:c.to_string(m)}})(E,{data:p,headers:h,httpClient:o,clientStateOut:C.clientStateOut,sessionKeys:C.sessionKeys,serverHeader:A})};let F=class{constructor(e,t,r){this.platformInfoService=e,this.httpClient=t,this.enclaveApiSettings=r}async callEnclaveEndpoint(e){const{body:t,endpoint:r,responseSchema:s}=e,i=JSON.stringify(t),a=await this.platformInfoService.getPlatformInfo(),o=(0,n.Ep)(this.enclaveApiSettings.environment),c=(0,n.$m)(this.enclaveApiSettings.environment),{decryptedResponse:l}=await U(r,{data:i,httpClient:this.httpClient,enclaveApiSettings:this.enclaveApiSettings,rootCertBER:o,expectedPCRs:c,platformInfo:a}),d=s.safeParse(JSON.parse(l));if(!d.success)throw new Error(`Enclave response parsing failed. Endpoint: ${r}.`);return d.data}getEnclaveApiSettings(){return this.enclaveApiSettings}};F=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.t,a.e,n.N6])],F)},18045:(e,t,r)=>{r.d(t,{i:()=>L});var s=r(88802),i=r(99634),a=r(37935),o=r(64483),n=r(25029),c=r(7165);const l=c.z.object({token:c.z.string(),active:c.z.boolean()}).optional();var d=r(95681),u=r(23347);const p=e=>l.safeParse(e).success;class h extends((0,d.Q)({persist:!1,capacity:u.Y._001KB,initialValue:undefined,scope:n.F.User,storeName:"confidential-scim-state",storeTypeGuard:p})){}var m=r(63663),g=r(87279),v=r(15181),y=r(57648);let _=class{constructor(e,t){this.confidentialScimService=e,this.confidentialScimStore=t}async execute({body:e}){const t=await this.confidentialScimStore.getState();try{const r={token:e.token??(t?.token||""),active:e.active??!!t?.active};return await this.confidentialScimStore.set({...r}),await this.confidentialScimService.setConfidentialScimConfig({...t,...e}),(0,g.Vp)(void 0)}catch(e){return await this.confidentialScimStore.set(t),(0,g.Rn)({tag:e.message})}}};_=(0,s.__decorate)([(0,m.W)(v.G),(0,s.__metadata)("design:paramtypes",[y.Z,h])],_);var f=r(19603),S=r(75437),E=r(64532),b=r(10370),w=r(42645),A=r(60399);let C=class{constructor(e,t,r,s,i){this.randomValuesGetter=e,this.confidentialScimStore=t,this.confidentialScimService=r,this.ssoClient=s,this.teamPlansClient=i}async execute(){const e=await this.confidentialScimStore.getState(),t=await this.hasNitroTeam();try{t||await this.createTeam();const e=this.randomValuesGetter.get(64),r=(0,b.s)(e);return await this.confidentialScimStore.set({token:r,active:!1}),await this.confidentialScimService.setConfidentialScimConfig({token:r,active:!1}),(0,g.Vp)(void 0)}catch(t){return this.confidentialScimStore.set(e),(0,g.Rn)({tag:`Something wrong happened: ${t}`})}}async createTeam(){const e=await(0,A.z)(this.teamPlansClient.queries.getTeamId());if((0,g.hx)(e))throw new Error("TeamID not found, are you logged in?");await this.ssoClient.commands.initSsoProvisioning({teamId:`${e.data.teamId}`}),await this.ssoClient.commands.createTeam()}async hasNitroTeam(){try{return!!(await this.confidentialScimService.getTeamIdentifiers()).adminProvisioningKey}catch{return!1}}};C=(0,s.__decorate)([(0,m.W)(S.S),(0,s.__metadata)("design:paramtypes",[f.Y,h,y.Z,E.E,w.e])],C);var I=r(43978),T=r(20754),P=r(49540);let O=class{constructor(e,t,r){this.confidentialScimStore=e,this.scimConfigurationService=t,this.scimStore=r}execute(){return this.confidentialScimStore.state$.pipe((0,I.w)((async e=>e?(0,g.Vp)(e):await this.getInitState())))}async getInitState(){try{const e=await this.scimConfigurationService.getConfidentialScimConfig();return await this.scimStore.set(e),(0,g.Vp)(e)}catch(e){return(0,g.Vp)({active:!1,token:null})}}};O=(0,s.__decorate)([(0,T.e)(P.I),(0,s.__metadata)("design:paramtypes",[h,y.Z,h])],O);var R=r(93715),D=r(37182),N=r(69885),U=r(76264),F=r(36577);let M=class{constructor(e,t,r){this.enclaveApiSettings=e,this.confidentialScimService=t,this.confidentialScimStore=r}execute(){return this.confidentialScimStore.state$.pipe((0,I.w)((async e=>{if(!e?.token)return(0,g.Rn)({tag:"Could not load team uuid"});const t=await this.confidentialScimService.getTeamIdentifiers(),r=new URL(`scim/${t.teamUuid}`,this.enclaveApiSettings.enclaveUrl);return(0,g.Vp)({endpoint:r.href})})),(0,D.K)((()=>(0,N.of)((0,g.Rn)({tag:"Could not load team uuid"})))))}};M=(0,s.__decorate)([(0,T.e)(U.v),(0,s.__metadata)("design:paramtypes",[F.N6,y.Z,h])],M);let L=class{};L=(0,s.__decorate)([(0,i.Y)({api:o.m,imports:[R.E,a.D],handlers:{commands:{updateScimConfiguration:_,generateScimToken:C},events:{},queries:{scimConfiguration:O,scimEndpoint:M}},stores:[h],providers:[y.Z],exports:[y.Z]})],L)},57648:(e,t,r)=>{r.d(t,{Z:()=>y});var s=r(88802),i=r(7165),a=r(57924),o=r(95842),n=r(42645),c=r(86252),l=r(60399),d=r(87279),u=r(33229),p=r(13878);const h="api/scim/GetSCIMConfiguration",m="api/scim/SetSCIMConfiguration",g=i.z.object({token:i.z.string().nullable(),active:i.z.boolean()}),v=i.z.object({token:i.z.string(),active:i.z.boolean()});let y=class{constructor(e,t,r){this.enclaveService=e,this.teamPlansClient=t,this.carbonClient=r}async getConfidentialScimConfig(){const e={token:"",active:!1},{teamUuid:t,adminProvisioningKey:r}=await this.getTeamIdentifiers(),s=await this.enclaveService.callEnclaveEndpoint({endpoint:h,body:{teamUuid:t,adminProvisioningKey:r},responseSchema:g});return e.active=s.active,e.token=s.token??"",e}async setConfidentialScimConfig(e){const{teamUuid:t,adminProvisioningKey:r}=await this.getTeamIdentifiers();await this.enclaveService.callEnclaveEndpoint({endpoint:m,body:{teamUuid:t,adminProvisioningKey:r,...e},responseSchema:v})}async getTeamIdentifiers(){const e=await(0,l.z)(this.teamPlansClient.queries.getTeamId());if((0,d.hx)(e))throw new Error("Could not get teamId");const t=await(0,u.I)(this.carbonClient);if((0,d.hx)(t))throw new Error("Could not get team info");const{teamInfo:{uuid:r}}=t.data;if(!r)throw new Error("No team uuid found. Is confidential team created?");const s=e.data.teamId??"",i=await(0,p.B)(s,this.carbonClient.queries.carbonState);if(!i)throw new Error("No admin provisioning key found. Is confidential team created?");return{teamUuid:r,adminProvisioningKey:i}}};y=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o.d,n.e,c._])],y)},13878:(e,t,r)=>{r.d(t,{B:()=>n});var s=r(7165),i=r(60399),a=r(48844);const o=s.z.object({adminProvisioningKey:s.z.object({adminProvisioningKey:s.z.ostring().nullable(),itemId:s.z.ostring().nullable()}).optional().nullable()}),n=async(e,t)=>{const r=t({path:`userSession.teamAdminData.teams.${e}`}).pipe((0,a.nb)({success:e=>{const t=o.safeParse(e);if(!t.success)throw t.error;return t.data.adminProvisioningKey?.adminProvisioningKey??null},failure:()=>""}));return await(0,i.z)(r)}},33229:(e,t,r)=>{r.d(t,{I:()=>d});var s=r(7165),i=r(87279),a=r(22450);const o=s.z.object({enabled:s.z.boolean()}).optional(),n=s.z.object({teamInfo:s.z.object({uuid:s.z.ostring().nullable(),ssoEnabled:s.z.boolean(),ssoIsNitroProvider:s.z.boolean(),ssoServiceProviderUrl:s.z.ostring().nullable(),ssoIdpMetadata:s.z.ostring().nullable(),ssoIdpEntrypoint:s.z.ostring().nullable()}),capabilities:s.z.object({sso:o})}),c=s.z.object({data:n}),l=s.z.object({message:s.z.string(),reason:s.z.nativeEnum(a._V)}),d=async e=>{const{getTeamInfo:t}=e.commands,r=await t();if((0,i.hx)(r)){switch(l.parse(r.error).reason){case a._V.UNAUTHORIZED:return(0,i.Rn)({tag:"UserNotAuthorized"});case a._V.UNKNOWN_ERROR:return(0,i.Rn)({tag:"CouldNotGetTeamStatus"});default:throw new Error("An unexpected error happened while trying to retrieve team info")}}const{data:{teamInfo:s,capabilities:o}}=c.parse(r.data);return(0,i.Vp)({teamInfo:s,capabilities:o})}},34968:(e,t,r)=>{r.d(t,{D:()=>qe});var s=r(88802),i=r(99634),a=r(25504),o=r(43673),n=r(95082),c=r(93715);class l{}var d,u=r(63663),p=r(87279),h=r(94603),m=r(7165);!function(e){e.AUTH_CONFIRM_LOGIN="api/authentication/ConfirmLogin2",e.AUTH_REQUEST_LOGIN="api/authentication/RequestLogin2",e.AUTH_REQUEST_TEST_LOGIN="api/authentication/RequestTestLogin2",e.AUTH_CONFIRM_TEST_LOGIN="api/authentication/ConfirmTestLogin2",e.DOMAINS_CREATE_DOMAIN="api/domains/CreateDomain",e.DOMAINS_DELETE_DOMAIN="api/domains/DeleteDomain2",e.DOMAINS_UPDATE_DOMAIN="api/domains/UpdateDomain2",e.DOMAINS_CHECK_DNS_VALIDATION="api/domains/CheckDNSValidation2",e.TEAMS_CREATE_TEAM="api/teams/CreateTeam",e.TEAMS_GET_TEAM="api/teams/GetTeam",e.TEAMS_DELETE_TEAM="api/teams/DeleteTeam",e.IDPS_CREATE_IDP="api/idps/CreateIdp",e.IDPS_UPDATE_IDP="api/idps/UpdateIdp",e.IDPS_DELETE_IDP="api/idps/DeleteIdp",e.TEAMS_GET_TEAM_STATUS="api/teams/GetTeamStatus"}(d||(d={}));const g=m.z.object({idpAuthorizeUrl:m.z.string(),teamUuid:m.z.string(),spCallbackUrl:m.z.string(),domainName:m.z.string()}),v=m.z.object({exists:m.z.boolean(),ssoToken:m.z.string(),userServiceProviderKey:m.z.string(),currentAuthenticationMethods:m.z.string().array(),expectedAuthenticationMethods:m.z.string().array()});var y=r(86252),_=r(95842);let f=class{constructor(e,t,r){this.enclaveService=e,this.enclaveLoginContext=t,this.carbonLegacyClient=r}async execute(e){const t=e.body.userEmailAddress,r=t.slice(t.indexOf("@")+1),s=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.AUTH_REQUEST_LOGIN,body:t,responseSchema:g}))(this.enclaveService,{login:t}),{idpAuthorizeUrl:i,teamUuid:a}=s,{samlToken:o}=await this.enclaveLoginContext.getSamlFromLogin(i,!0),n=btoa(atob(o).replace(/\n/g,"")),c={...await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.AUTH_CONFIRM_LOGIN,body:t,responseSchema:v}))(this.enclaveService,{domainName:r,samlResponse:n,teamUuid:a}),login:e.body.userEmailAddress};return await this.enclaveLoginContext.redirectUserIntoLoginFlow(c),(0,p.Vp)(void 0)}};f=(0,s.__decorate)([(0,u.W)(h.B),(0,s.__metadata)("design:paramtypes",[_.d,l,y._])],f);var S=r(21242);m.z.object({groupProvisioningActivated:m.z.boolean()});const E=m.z.object({idpUuid:m.z.string().uuid(),certificates:m.z.array(m.z.string()),entrypoint:m.z.string(),groupProvisioningActivated:m.z.boolean().optional(),creationDateUnix:m.z.number(),updateDateUnix:m.z.number()}),b=m.z.enum(["valid","pending","expired","invalid"]),w=m.z.enum(["tokenNotFound","invalidToken"]),A=m.z.object({status:b.nullable(),verificationToken:m.z.string(),lastCheckDateUnix:m.z.number(),pendingReason:w.nullable(),expiryDateUnix:m.z.number()}),C=m.z.object({creationDateUnix:m.z.number(),dnsCheckStatus:A,domainName:m.z.string(),idpUuid:m.z.ostring(),updateDateUnix:m.z.number()}),I=m.z.enum(["NitroComplete","NitroIncomplete","SelfHostedComplete","SelfHostedIncomplete","SsoConnectorIncomplete","SsoConnectorComplete","SsoConnectorToSelfHostedMigration","None","Unknown"]),T=m.z.object({subdomainValue:m.z.string().nullable(),txtValue:m.z.string().nullable(),verificationStatus:b.nullable(),tokenFound:m.z.string().nullable(),pendingReason:w.nullable()}),P=m.z.array(m.z.object({domainName:m.z.string().url(),verificationStatus:b,idpUuid:m.z.string().optional().nullable()})),O=m.z.object({global:m.z.object({adminProvisioningKey:m.z.string().nullable(),isTeamProvisionedInNitro:m.z.boolean().nullable(),inferredSsoState:I,teamUuid:m.z.string().nullable(),ssoCapable:m.z.boolean().nullable()}),idpApplication:m.z.object({entityId:m.z.string().nullable(),acsUrl:m.z.string().nullable(),signOnUrl:m.z.string().nullable()}),idpMetadata:m.z.object({metadataValue:m.z.string().nullable(),idpUuid:m.z.string().nullable(),groupProvisioningActivated:m.z.boolean().nullable()}),domainSetup:P,domainVerificationInfo:m.z.record(m.z.string().url(),T),enableSSO:m.z.object({ssoEnabled:m.z.boolean().nullable()})});var R=r(50179),D=r(64718);const N=m.z.object({error:m.z.string()}),U=m.z.object({data:m.z.object({samlIdpEntryPoint:m.z.string(),samlIdpCertificate:m.z.string()})}),F=async(e,t)=>{if(null===t)return{samlIdpEntryPoint:"",samlIdpCertificate:""};let r="";if(new D.Y(t).isUrlValid()){const e=await fetch(t);r=await e.text()}else r=t;const{parseMetadataFields:s}=e.commands,i=await s({ssoIdpMetadata:r});if((0,p.d6)(i))return U.parse(i.data).data;throw new Error("failed to parse metadata, please validate first.")};var M=r(57924),L=r(25029),x=r(95681),k=r(23347);const G=e=>O.safeParse(e).success,V={global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:I.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}};class K extends((0,x.Q)({persist:!1,capacity:k.Y._010KB,initialValue:V,scope:L.F.User,storeName:"nitro-sso-provisioning-state",storeTypeGuard:G})){}const j="_dashlane-challenge";let B=class{constructor(e){this.store=e}async reset(){await this.store.init({global:{adminProvisioningKey:null,teamUuid:null,isTeamProvisionedInNitro:null,inferredSsoState:I.enum.Unknown,ssoCapable:null},idpApplication:{entityId:null,acsUrl:null,signOnUrl:null},idpMetadata:{metadataValue:null,idpUuid:null,groupProvisioningActivated:null},domainSetup:[],domainVerificationInfo:{},enableSSO:{ssoEnabled:null}})}set(e){return this.store.set(e)}};B=(0,s.__decorate)([(0,M.GS)(),(0,s.__metadata)("design:paramtypes",[K])],B);const W=m.z.object({dnsVerificationToken:m.z.string()});let z=class{constructor(e,t,r,s,i){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlipsClient=s,this.carbonLegacyClient=i}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,p.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,p.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,p.Rn)({tag:"DomainNameNotProvided"});const r=t.idpMetadata.metadataValue?await F(this.carbonLegacyClient,t.idpMetadata.metadataValue):null,s={domainName:e.domainName,adminProvisioningKey:t.global.adminProvisioningKey,idpMetadata:r?{certificate:r.samlIdpCertificate,entrypoint:r.samlIdpEntryPoint}:void 0,teamUuid:t.global.teamUuid};if(new Set(t.domainSetup.map((e=>e.domainName))).has(e.domainName))return(0,p.Rn)({tag:"DomainAlreadyProvisioned"});const{dnsVerificationToken:i}=await(async(e,t)=>await e.callEnclaveEndpoint({body:t,endpoint:d.DOMAINS_CREATE_DOMAIN,responseSchema:W}))(this.enclaveService,s),a=[...t.domainSetup,{idpUuid:t.idpMetadata.idpUuid,domainName:e.domainName,verificationStatus:b.enum.pending}],o={...t.domainVerificationInfo,[e.domainName]:{txtValue:i,verificationStatus:b.enum.pending,subdomainValue:j,pendingReason:null,tokenFound:null}};return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:a,domainVerificationInfo:{...t.domainVerificationInfo,...o}}),(0,p.Vp)(void 0)}};z=(0,s.__decorate)([(0,u.W)(R.p),(0,s.__metadata)("design:paramtypes",[_.d,B,K,S.P,y._])],z);var H=r(2073),Q=r(67837),q=r(77007);class Y extends((0,Q.E)(q.S)){}(0,Q.K)(q.S,Y);var $=r(13878),X=r(42645),Z=r(60399);let J=class{constructor(e,t,r,s,i,a){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.carbonClient=s,this.enclaveSdkClient=i,this.teamPlanDetailsClient=a,this.ssoServiceProviderUrl=new URL(this.enclaveService.getEnclaveApiSettings().enclaveUrl).origin}async execute(){const e=await this.enclaveSdkClient.commands.createTeamInEnclave();if((0,p.hx)(e))return(0,p.Rn)({tag:"CreateTeamApiError"});try{await this.runSideEffect()}catch(e){return(0,p.Rn)({tag:"CreateTeamApiError"})}return(0,p.Vp)(void 0)}async runSideEffect(){const e=await this.ssoProvisioningStore.getState();await this.carbonClient.commands.updateTeamSettings({ssoServiceProviderUrl:this.ssoServiceProviderUrl});const t=await(0,Z.z)(this.teamPlanDetailsClient.queries.getTeamId());if((0,p.hx)(t))throw new Error("Failed to get teamId");const{teamId:r}=(0,p.db)(t);if(!r)throw new Error("Failed to get teamId");const s=await(0,$.B)(r,this.carbonClient.queries.carbonState);await this.ssoProvisioningStoreUpdater.set({...e,global:{...e.global,adminProvisioningKey:s,isTeamProvisionedInNitro:!0,inferredSsoState:I.enum.NitroIncomplete}})}};J=(0,s.__decorate)([(0,u.W)(H.p),(0,s.__metadata)("design:paramtypes",[_.d,B,K,y._,Y,X.e])],J);var ee=r(41689);m.z.object({domainName:m.z.string(),teamUuid:m.z.string(),adminProvisioningKey:m.z.string()});const te=["DOMAIN_NOT_FOUND","DOMAIN_CONFIGURATION_NOT_FOUND"];let re=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlipsClient=s}async execute({body:e}){const t=await this.ssoProvisioningStore.getState();if(!t.global.teamUuid)return(0,p.Rn)({tag:"TeamIdNotFound"});if(!t.global.adminProvisioningKey)return(0,p.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!e.domainName)return(0,p.Rn)({tag:"DomainNameNotProvided"});const r={domainName:e.domainName,teamUuid:t.global.teamUuid,adminProvisioningKey:t.global.adminProvisioningKey};try{await(async(e,t)=>{await e.callEnclaveEndpoint({endpoint:d.DOMAINS_DELETE_DOMAIN,body:t,responseSchema:m.z.object({})})})(this.enclaveService,r)}catch(e){const t=e instanceof Error?e.message:"Unable to delete domain.";if(!te.includes(t))throw e}return await this.applyDeleteDomainOnState(t,e.domainName),(0,p.Vp)(void 0)}async applyDeleteDomainOnState(e,t){e.domainSetup=e.domainSetup.filter((e=>e.domainName!==t)),delete e.domainVerificationInfo[t],await this.ssoProvisioningStoreUpdater.set(e)}};re=(0,s.__decorate)([(0,u.W)(ee.k),(0,s.__metadata)("design:paramtypes",[_.d,B,K,S.P])],re);var se=r(58895),ie=r(74746);const ae=m.z.object({idpAuthorizeUrl:m.z.string(),spCallbackUrl:m.z.ostring()});var oe=r(36577);let ne=class{constructor(e,t,r,s,i,a){this.enclaveService=e,this.enclaveLoginContext=t,this.enclaveApiSettings=r,this.platformInfoService=s,this.ssoProvisioningStore=i,this.featureFlips=a}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r,teamUuid:s},idpMetadata:{idpUuid:i}}=t,a=e.body.domainName;if(!(r&&a&&s&&i))return(0,p.Rn)({tag:"MissingCommandParameters"});try{const e=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.AUTH_REQUEST_TEST_LOGIN,body:t,responseSchema:ae}))(this.enclaveService,{adminProvisioningKey:r,teamUuid:s,idpUuid:i}),{samlToken:t}=await this.enclaveLoginContext.getSamlFromLogin(e.idpAuthorizeUrl,!1);return await(async(e,t)=>{await e.callEnclaveEndpoint({endpoint:d.AUTH_CONFIRM_TEST_LOGIN,body:t,responseSchema:m.z.object({})})})(this.enclaveService,{domainName:a,samlResponse:t,adminProvisioningKey:r,teamUuid:s}),await this.enclaveLoginContext.cleanupTestLogin(),(0,p.Vp)(void 0)}catch{return(0,p.Rn)({tag:"FailedToLoginIntoSsoProvider"})}}};ne=(0,s.__decorate)([(0,u.W)(ie.b),(0,s.__metadata)("design:paramtypes",[_.d,l,oe.N6,se.t,K,S.P])],ne);var ce=r(26457),le=r(65255),de=r(80974);const ue=m.z.enum(["sso_connector","encryption_service","nitro_encryption_service","command_line"]),pe=[ue.enum.encryption_service,ue.enum.nitro_encryption_service,ue.enum.sso_connector],he=m.z.object({platform:ue,accessKey:m.z.string(),deviceName:m.z.string().nullable(),activated:m.z.boolean(),creationDateUnix:m.z.number(),updateDateUnix:m.z.number(),enabledServices:m.z.object({sso:m.z.boolean(),scim:m.z.boolean()})}),me=m.z.object({data:m.z.object({teamDevices:m.z.array(he)})}),ge=async e=>{const{listTeamDevices:t}=e.commands,r=await t();if((0,p.hx)(r))throw new Error("Failed to get team devices");const{data:{teamDevices:s}}=me.parse(r.data),i=s.filter((e=>pe.includes(e.platform)&&e.activated)),a=e=>e.reduce(((e,t)=>!e||t.updateDateUnix>e.updateDateUnix?t:e),null),o=i.filter((e=>e.platform===ue.enum.nitro_encryption_service)),n=i.filter((e=>e.platform===ue.enum.encryption_service&&e.enabledServices.sso)),c=i.filter((e=>e.platform===ue.enum.sso_connector));return c.length?a(c):n.length?a(n):a(o)},ve=m.z.object({}),ye=(m.z.object({teamUuid:m.z.string().uuid(),adminProvisioningKey:m.z.string(),idpUuid:m.z.string().uuid()}),m.z.object({idpUuid:m.z.string().uuid()})),_e=m.z.record(m.z.string(),C),fe=m.z.object({domains:_e,idps:m.z.record(m.z.string(),E),updateDateUnix:m.z.number()});var Se=r(33229),Ee=r(87065);let be=class{constructor(e,t,r,s,i){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.carbonLegacyClient=r,this.featureFlipsClient=s,this.appLogger=i,this.fetchInitialStateInfo=async e=>{const t=[(0,$.B)(e,this.carbonLegacyClient.queries.carbonState),(0,Se.I)(this.carbonLegacyClient),ge(this.carbonLegacyClient)],[r,s,i]=await Promise.all(t);if((0,p.hx)(s))return s;let a=this.makeGetTeamDecryptedResponse();const{teamInfo:o,capabilities:n}=s.data;r&&o.uuid&&(a=await this.performGetTeam(r,o.uuid));const c=this.extractCapabilities(n);return(0,p.Vp)({provisioningKey:r,teamInfo:o,teamStatus:a,capabilities:c,currentTeamDevice:i})},this.makeGetTeamDecryptedResponse=()=>({domains:{},idps:{},updateDateUnix:0})}async execute({body:{teamId:e}}){if(!e)return(0,p.Rn)({tag:"TeamIdNotFound"});try{await this.ssoProvisioningStoreUpdater.reset();const r=await this.fetchInitialStateInfo(e);if((0,p.hx)(r))return r;const{teamStatus:s,teamInfo:i,provisioningKey:a,capabilities:o,currentTeamDevice:n}=r.data;if(!i.uuid)return(0,p.Rn)({tag:"TeamIdNotFound"});let c=I.enum.Unknown;try{c=((e,t,r,s)=>{if(!r)return I.enum.None;if(s&&r.platform===ue.enum.sso_connector)return I.enum.SsoConnectorToSelfHostedMigration;if(t)return e?I.enum.NitroComplete:I.enum.NitroIncomplete;switch(r.platform){case ue.enum.sso_connector:return e?I.enum.SsoConnectorComplete:I.enum.SsoConnectorIncomplete;case ue.enum.encryption_service:return e?I.enum.SelfHostedComplete:I.enum.SelfHostedIncomplete;case ue.enum.nitro_encryption_service:return e?I.enum.NitroComplete:I.enum.NitroIncomplete}throw new Error("Invalid SSO state reached")})(i.ssoEnabled,i.ssoIsNitroProvider,n,!!await this._shouldUseSSOMigration())}catch{return(0,p.Rn)({tag:"InvalidSsoState"})}const l=Object.keys(s.idps)[0]??null;return await this.ssoProvisioningStoreUpdater.set({global:{adminProvisioningKey:a??null,isTeamProvisionedInNitro:!!a,inferredSsoState:c,ssoCapable:o.sso,teamUuid:i.uuid},idpApplication:{acsUrl:(t=this.enclaveService.getEnclaveApiSettings().enclaveUrl,t?`${new URL(t).origin}/saml/callback`:""),entityId:"dashlane-nitro-sso",signOnUrl:"https://app.dashlane.com"},idpMetadata:{idpUuid:l,metadataValue:i.ssoIdpMetadata??null,groupProvisioningActivated:l?s.idps[l].groupProvisioningActivated??null:null},domainSetup:this.getDomainSetupState(s.domains),domainVerificationInfo:this.getDomainVerificationInfo(s.domains),enableSSO:{ssoEnabled:i.ssoEnabled}}),(0,p.Vp)(void 0)}catch(e){return this.appLogger.error(e),(0,p.Rn)({tag:"GenericSsoError"})}var t}getDomainSetupState(e){return Object.entries(e).map((([e,t])=>({domainName:e,verificationStatus:t.dnsCheckStatus.status??"pending"})))}getDomainVerificationInfo(e){return Object.entries(e).reduce(((e,[t,r])=>(e[t]={txtValue:r.dnsCheckStatus.verificationToken,verificationStatus:b.parse(r.dnsCheckStatus.status),subdomainValue:j,pendingReason:r.dnsCheckStatus.pendingReason,tokenFound:null},e)),{})}fixTeamStatusDomains(e,t,r){const s=Object.values(e.idps);if(s.length<=1)return Promise.resolve(e);const i=s.sort(((e,t)=>e.updateDateUnix-t.updateDateUnix)).pop();return i?(Object.values(e.domains).reduce(((e,s)=>s.idpUuid!==i.idpUuid?e.then((()=>(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.DOMAINS_UPDATE_DOMAIN,body:t,responseSchema:ve}))(this.enclaveService,{domainName:s.domainName,adminProvisioningKey:t,teamUuid:r,idpUuid:i.idpUuid}).then((()=>(s.idpUuid=i.idpUuid,Promise.resolve()))))):Promise.resolve()),Promise.resolve()),s.reduce(((e,s)=>i.idpUuid!==s.idpUuid?e.then((()=>(async(e,t)=>await e.callEnclaveEndpoint({body:t,endpoint:d.IDPS_DELETE_IDP,responseSchema:ye}))(this.enclaveService,{teamUuid:r,adminProvisioningKey:t,idpUuid:s.idpUuid}))).then((()=>Promise.resolve())):Promise.resolve()),Promise.resolve()),e.idps={[i.idpUuid]:i},Promise.resolve(e)):Promise.resolve(e)}async performGetTeam(e,t){let r=await(async(e,t)=>t.teamUuid&&t.adminProvisioningKey?await e.callEnclaveEndpoint({endpoint:d.TEAMS_GET_TEAM,body:t,responseSchema:fe}):{domains:{},idps:{},updateDateUnix:0})(this.enclaveService,{adminProvisioningKey:e,teamUuid:t});return r=await this.fixTeamStatusDomains(r,e,t),r}extractCapabilities(e){return Object.entries(e).reduce(((e,[t,r])=>({...e,[t]:r.enabled})),{})}_shouldUseSSOMigration(){return this._getFeatureFlip(le.w.ItadminTacEncryptionserviceSSOmigrationReset)}_getFeatureFlip(e){const{userFeatureFlips:t}=this.featureFlipsClient.queries;return(0,Z.z)(t().pipe((0,Ee.U)((t=>{if((0,p.d6)(t)){return(0,p.db)(t)[e]}}))))}};be=(0,s.__decorate)([(0,u.W)(de.S),(0,s.__metadata)("design:paramtypes",[_.d,B,y._,S.P,ce.V])],be);var we=r(66012);let Ae=class{constructor(e){this.carbonLegacy=e}async execute({body:e}){const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,t)=>{if(null===t)return;const r=await e({name:"parseMetadataFields",args:[{ssoIdpMetadata:t}]});return(0,p.d6)(r)?void 0:N.parse(r.error).error})(t,e.metadata);return r?(0,p.Rn)({tag:r}):(0,p.Vp)(void 0)}};Ae=(0,s.__decorate)([(0,u.W)(we.l),(0,s.__metadata)("design:paramtypes",[y._])],Ae);var Ce=r(82249);m.z.object({teamUuid:m.z.string().uuid(),adminProvisioningKey:m.z.string(),idpMetadata:m.z.object({certificates:m.z.array(m.z.string()),entrypoint:m.z.string()})});const Ie=m.z.object({idpUuid:m.z.string().uuid()}),Te=(m.z.object({teamUuid:m.z.string().uuid(),adminProvisioningKey:m.z.string(),idpMetadata:m.z.object({idpUuid:m.z.string(),certificates:m.z.array(m.z.string()),entrypoint:m.z.string()})}),m.z.object({}));m.z.object({idpUuid:m.z.string().uuid()});let Pe=class{constructor(e,t,r,s,i,a){this.enclaveService=e,this.enclaveApiSettings=t,this.platformInfoService=r,this.ssoProvisioningStoreUpdater=s,this.ssoProvisioningStore=i,this.carbon=a}async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:r,teamUuid:s}=t.global;if(!r||!s)return(0,p.Rn)({tag:"internal_error"});const{metadata:i}=e;let a="",o="";try{const e=await F(this.carbon,i);o=e.samlIdpEntryPoint,a=e.samlIdpCertificate}catch{return(0,p.Rn)({tag:"invalid_metadata_content"})}try{const e=t.idpMetadata.idpUuid,n={adminProvisioningKey:r,teamUuid:s,idpMetadata:{certificates:[a],entrypoint:o}},c=e?await(async(e,t)=>(await e.callEnclaveEndpoint({endpoint:d.IDPS_UPDATE_IDP,body:t,responseSchema:Te}),{idpUuid:t.idpMetadata.idpUuid}))(this.enclaveService,{...n,idpMetadata:{...n.idpMetadata,idpUuid:e}}):await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.IDPS_CREATE_IDP,body:t,responseSchema:Ie}))(this.enclaveService,n);await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,idpUuid:c.idpUuid,metadataValue:i}});try{await(async(e,{metadata:t,entrypoint:r})=>{const s={ssoIdpMetadata:t||null,ssoIdpEntrypoint:t?r:null};await e({name:"updateTeamSettings",args:[s]})})(this.carbon.commands.carbon,{metadata:i,entrypoint:o})}catch(e){return(0,p.Rn)({tag:"save_metadata_failed"})}}catch(e){return(0,p.Rn)({tag:"domain_update_failed"})}return(0,p.Vp)(void 0)}};Pe=(0,s.__decorate)([(0,u.W)(Ce.o),(0,s.__metadata)("design:paramtypes",[_.d,oe.N6,se.t,B,K,y._])],Pe);var Oe=r(85355);const Re=m.z.object({previousStatus:m.z.string(),status:m.z.enum(["valid","pending","expired","invalid"]),verificationToken:m.z.string(),lastCheckDateUnix:m.z.number(),pendingReason:m.z.enum(["tokenNotFound","invalidToken"]).nullable(),tokenFound:m.z.string().optional()});let De=class{constructor(e,t,r,s){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.featureFlips=s}async execute(e){const t=await this.ssoProvisioningStore.getState(),{global:{adminProvisioningKey:r},domainVerificationInfo:s,domainSetup:i}=t,a=e.body.domainName;if(!r)return(0,p.Rn)({tag:"AdminProvisioningKeyNotFound"});if(!a)return(0,p.Rn)({tag:"DomainNameNotProvided"});let o;try{o=await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.DOMAINS_CHECK_DNS_VALIDATION,body:t,responseSchema:Re}))(this.enclaveService,{domainName:a,adminProvisioningKey:r,teamUuid:t.global.teamUuid??""})}catch{return(0,p.Rn)({tag:"CouldNotVerifyDns"})}const n=s[a];n.txtValue=o.verificationToken,n.verificationStatus=o.status,n.tokenFound=o.tokenFound??null,n.pendingReason=o.pendingReason;const c=i.map((e=>(e.domainName===a&&(e.verificationStatus=o.status),e)));return await this.ssoProvisioningStoreUpdater.set({...t,domainSetup:c,domainVerificationInfo:{...s,[a]:n}}),(0,p.Vp)(void 0)}};De=(0,s.__decorate)([(0,u.W)(Oe.o),(0,s.__metadata)("design:paramtypes",[_.d,B,K,S.P])],De);var Ne=r(39118);let Ue=class{constructor(e,t,r){this.ssoProvisioningStoreUpdater=e,this.ssoProvisioningStore=t,this.carbonLegacy=r}async execute(){const e=await this.ssoProvisioningStore.getState();if(e.enableSSO.ssoEnabled)return(0,p.Rn)({tag:"SsoAlreadyEnabled"});const{commands:{carbon:t}}=this.carbonLegacy,r=await(async(e,{ssoEnabled:t})=>{const r=await e({name:"updateTeamSettings",args:[{ssoEnabled:t}]});return!(0,p.hx)(r)})(t,{ssoEnabled:!0});return r?(await this.ssoProvisioningStore.set({...e,global:{...e.global,inferredSsoState:I.enum.NitroComplete},enableSSO:{...e.enableSSO,ssoEnabled:!0}}),(0,p.Vp)(void 0)):(0,p.Rn)({tag:"EnableSsoFailed"})}};Ue=(0,s.__decorate)([(0,u.W)(Ne.F),(0,s.__metadata)("design:paramtypes",[B,K,y._])],Ue);var Fe=r(94189),Me=r(26758),Le=r(64532);const xe=m.z.object({});let ke=class{constructor(e,t,r,s,i,a,o){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r,this.appLogger=s,this.ssoClient=i,this.cqrsClient=a,this.carbon=o}async execute({body:{teamId:e}}){const t=await this.ssoProvisioningStore.getState(),r=[],s=await(0,$.B)(e,this.carbon.queries.carbonState);let i=null;const a=await(0,Se.I)(this.carbon);(0,p.d6)(a)&&a.data.teamInfo.uuid&&(i=a.data.teamInfo.uuid),t.enableSSO.ssoEnabled&&r.push((0,p.Rn)({tag:"SsoAlreadyEnabled"})),i||r.push((0,p.Rn)({tag:"TeamIdNotFound"})),s||r.push((0,p.Rn)({tag:"NitroTeamNotProvisioned"}));const o=[this.deleteDomainCurrentlyRegistered.bind(this),this.deleteCurrentTeam.bind(this)],n=this.setCleaningFunctorApplier({...t,global:{...t.global,adminProvisioningKey:s,teamUuid:i}}),c=await o.reduce(n,Promise.resolve([]));return[...r,...c].forEach((e=>{this.appLogger.error(`[Clear Settings Error]: ${e.tag}`)})),await this.ssoProvisioningStoreUpdater.reset(),(0,p.Vp)(void 0)}setCleaningFunctorApplier(e){return async(t,r)=>{const s=await t,i=await r(e);return(0,p.hx)(i)&&(this.appLogger.error((0,p.Yv)(i)),s.push((0,p.Yv)(i))),s}}async deactivateTeamDeviceStep(){try{const e=await ge(this.carbon);e?.platform===ue.enum.nitro_encryption_service&&await(async(e,t)=>{const{deactivateTeamDevice:r}=e.commands,s=await r({teamDeviceAccessKey:t});return!(0,p.hx)(s)})(this.carbon,e.accessKey)}catch{return(0,p.Rn)({tag:"CouldNotDeactivateTeamDevice"})}return(0,p.Vp)(void 0)}async deleteDomainCurrentlyRegistered(e){const t=(await e.domainSetup.reduce((async(e,t)=>{const r=await e;try{const e=await this.ssoClient.commands.deleteDomain({domainName:t.domainName});return[...r,e]}catch(e){return[...r,(0,p.Rn)({tag:"CouldNotDeleteDomainCurrentlyRegistered"})]}}),Promise.resolve([]))).find((e=>(0,p.hx)(e)));return t||(0,p.Vp)(void 0)}async deleteCurrentTeam(e){const{global:t}=e;if(!t.adminProvisioningKey)return(0,p.Rn)({tag:"NitroTeamNotProvisioned"});const r={teamUuid:t.teamUuid,adminProvisioningKey:t.adminProvisioningKey};try{await(async(e,t)=>await e.callEnclaveEndpoint({endpoint:d.TEAMS_DELETE_TEAM,body:t,responseSchema:xe}))(this.enclaveService,r)}catch(e){const t=e.message;return"TEAM_NOT_FOUND"===t||"UNKNOWN_ERROR"===t||"MISMATCHING_ADMIN_PROVISIONING_KEY"===t?this.runDeleteTeamSideEffect():(0,p.Rn)({tag:"CouldNotDeleteNitroTeam"})}return this.runDeleteTeamSideEffect()}async runDeleteTeamSideEffect(){const e=await this.deactivateTeamDeviceStep();if((0,p.hx)(e))return e;const t=await this.removeAdmingProvisionningKey();return(0,p.hx)(t)?t:this.clearLegacyTeamSettings()}async clearLegacyTeamSettings(){try{await(async(e,t)=>{const{updateTeamSettings:r}=e.commands;await r({...t})})(this.carbon,{ssoServiceProviderUrl:null,ssoIdpMetadata:null,ssoIdpEntrypoint:null})}catch{return(0,p.Rn)({tag:"CouldNotClearLegacyTeamSettings"})}return(0,p.Vp)(void 0)}async removeAdmingProvisionningKey(){try{const{removeAdminProvisioningKey:e}=this.carbon.commands;await e()}catch{return(0,p.Rn)({tag:"CouldNotCouldNotDeleteAdminProvisioningKey"})}return(0,p.Vp)(void 0)}};ke=(0,s.__decorate)([(0,u.W)(Me.h),(0,s.__metadata)("design:paramtypes",[_.d,B,K,ce.V,Le.E,Fe.w,y._])],ke);var Ge=r(26250);const Ve=m.z.object({});let Ke=class{constructor(e,t,r){this.enclaveService=e,this.ssoProvisioningStoreUpdater=t,this.ssoProvisioningStore=r}async execute({body:e}){const t=await this.ssoProvisioningStore.getState(),{adminProvisioningKey:r,teamUuid:s}=t.global;if(!r||!s)return(0,p.Rn)((0,Ge.Y3)());const{groupProvisioningActivated:i}=e;try{await this.enclaveService.callEnclaveEndpoint({endpoint:d.IDPS_UPDATE_IDP,body:{adminProvisioningKey:r,teamUuid:s,idpMetadata:{idpUuid:t.idpMetadata.idpUuid,groupProvisioningActivated:i}},responseSchema:Ve}),await this.ssoProvisioningStoreUpdater.set({...t,idpMetadata:{...t.idpMetadata,groupProvisioningActivated:i}})}catch(e){switch(e.message){case Ge.hJ.MISMATCHING_ADMIN_PROVISIONING_KEY:return Promise.reject((0,p.Rn)((0,Ge.HC)()));case Ge.hJ.TEAM_NOT_FOUND:return Promise.reject((0,p.Rn)((0,Ge.gY)()));case Ge.hJ.IDP_NOT_FOUND:return Promise.reject((0,p.Rn)((0,Ge.B3)()));case Ge.hJ.NO_IDP_CONFIGURATION_UPDATE:return Promise.reject((0,p.Rn)((0,Ge.b2)()));default:return Promise.reject((0,p.Rn)((0,Ge.Y3)()))}}return(0,p.Vp)(void 0)}};Ke=(0,s.__decorate)([(0,u.W)(Ge.Z5),(0,s.__metadata)("design:paramtypes",[_.d,B,K])],Ke);var je=r(20754),Be=r(73774),We=r(1434);let ze=class{constructor(e,t){this.httpClient=e,this.ssoProvisioningStore=t}execute(){return this.ssoProvisioningStore.state$.pipe((0,Ee.U)((e=>(0,p.Vp)(e))))}};ze=(0,s.__decorate)([(0,je.e)(We._),(0,s.__metadata)("design:paramtypes",[Be.e,K])],ze);var He=r(21589);let Qe=class{constructor(e){this.ssoProvisioningStore=e}execute(){return this.ssoProvisioningStore.state$.pipe((0,Ee.U)((e=>(0,p.Vp)({groupProvisioningActivated:e.idpMetadata.groupProvisioningActivated??!1}))))}};Qe=(0,s.__decorate)([(0,je.e)(He.$),(0,s.__metadata)("design:paramtypes",[K])],Qe);let qe=class{};qe=(0,s.__decorate)([(0,i.Y)({api:n.y,handlers:{commands:{loginUserWithEnclaveSSO:f,provisionDomain:z,createTeam:J,deleteDomain:re,testLoginUserWithEnclaveSSO:ne,initSsoProvisioning:be,validateMetadata:Ae,updateMetadata:Pe,checkDNSValidation:De,enableSso:Ue,clearSettings:ke,updateGroupProvisioningConfiguration:Ke},events:{},queries:{ssoProvisioning:ze,getGroupProvisioningConfiguration:Qe}},configurations:{enclaveLoginContextInfrastructure:{token:l}},imports:[a.X,o.i,c.E],stores:[K],providers:[B],requiredFeatureFlips:["itadmin_tac_encryptionservice_SSOmigration_reset","setup_rollout_reset_confidential_button","setup_rollout_web_ssoconnector_card","setup_rollout_web_tech-week-integrations"]})],qe)},26667:(e,t,r)=>{r.d(t,{X:()=>g});var s=r(7165),i=r(56773),a=r(37298),o=r(2235),n=r(45599),c=r(31460),l=r(72733),d=r(24715),u=r(61222),p=r(92204),h=r(49259);const m=s.z.object({type:s.z.string(),saml:s.z.string()});class g{constructor(){this.interceptedTabId=void 0,this.originalTabId=void 0,this.samlReceived=!1;try{this.onMessageListener=new a.j(o.p,this.checkMessageType.bind(this))}catch{}}checkMessageType(e){return!this.samlReceived&&"SamlAssertionIntercepted"===e.type}interceptSamlFromTab(){return new Promise(((e,t)=>{if(!this.onMessageListener)return t(new Error("OnMessage event listener is not available in current context"));const r=n.$.addListener((e=>{e===this.interceptedTabId&&(n.$.removeListener(r),t(new Error("Intercepting SAML - tab closed unexpectedly")))}));this.onMessageListener.events$.pipe((0,i.P)()).subscribe((([s])=>{const i=m.safeParse(s);i.success?(this.samlReceived=!0,n.$.removeListener(r),e({samlToken:i.data.saml})):t(new Error("Intercepting SAML - received message could not be parsed"))}))}))}async redirectTabToUrl(e){if(this.interceptedTabId)return await(0,c.V)(this.interceptedTabId,{url:e});{const t=(await(0,l.T)({windowTypes:["normal"]})).id;return await(0,d.U)({windowId:t,url:e})}}async getActiveExtensionTabId(){const e=await(0,u.I)({currentWindow:!0,active:!0}),t=e.length>0?e[0]:null,r=(0,p.A)("");if(t?.id&&t.url?.includes(r))return t.id}getSamlFromLogin(e,t){this.samlReceived=!1,this.originalTabId=void 0,this.interceptedTabId&&((0,h.O)([this.interceptedTabId]),this.interceptedTabId=void 0);const r=async()=>{const t=await(0,d.U)({url:e});return this.interceptedTabId=t.id,await this.interceptSamlFromTab()},s=async t=>{this.interceptedTabId=t;const r=this.interceptSamlFromTab();return await(0,c.V)(t,{url:e}),r};return t?this.getActiveExtensionTabId().then((e=>e?s(e):r())):this.getActiveExtensionTabId().then((e=>(this.originalTabId=e,r())))}async redirectUserIntoLoginFlow(e){const t={ssoToken:e.ssoToken,exists:e.exists,currentAuths:e.currentAuthenticationMethods,expectedAuths:e.expectedAuthenticationMethods,key:e.userServiceProviderKey,login:e.login},r=Object.entries(t).map((e=>`${e[0]}=${encodeURIComponent(e[1].toString())}`)).join("&"),s=(0,p.A)(`index.html#/sso?${r}`);await this.redirectTabToUrl(s)}async redirectUserToLoginPage(){const e=(0,p.A)("index.html#/login");await this.redirectTabToUrl(e)}async cleanupTestLogin(){this.interceptedTabId&&await(0,h.O)([this.interceptedTabId]),this.originalTabId&&(0,c.V)(this.originalTabId,{active:!0})}}},81038:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(67837),i=r(33470);class a extends((0,s.E)(i.r)){}(0,s.K)(i.r,a)},33470:(e,t,r)=>{r.d(t,{r:()=>o});var s=r(86952),i=r(20417),a=r(9599);const o=(0,s.Q)({name:"sync",commands:{SyncCommand:i.t},queries:{SyncProgressQuery:a.F},events:{}})},20417:(e,t,r)=>{r.d(t,{t:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},9599:(e,t,r)=>{r.d(t,{F:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.Device})){}},76183:(e,t,r)=>{var s;r.d(t,{L:()=>s,_:()=>i}),function(e){e.READY="ready",e.IN_PROGRESS="in_progress",e.SUCCESS="success",e.FAILURE="failure"}(s||(s={}));class i{}},80310:(e,t,r)=>{r.d(t,{R:()=>I});var s=r(88802),i=r(99634),a=r(25029),o=r(33470),n=r(76183),c=r(87279),l=r(63663),d=r(20417);let u=class{constructor(e){this.syncService=e}execute(e){const{trigger:t}=e.body;return this.syncService.attemptSync(t),Promise.resolve((0,c.Vp)(void 0))}};u=(0,s.__decorate)([(0,l.W)(d.t),(0,s.__metadata)("design:paramtypes",[n._])],u);var p=r(20754),h=r(9599);let m=class{constructor(e){this.syncService=e}execute(){return this.syncService.getSyncState()}};m=(0,s.__decorate)([(0,p.e)(h.F),(0,s.__metadata)("design:paramtypes",[n._])],m);var g=r(30523),v=r(60399),y=r(57924),_=r(86252),f=r(48844);const S=e=>"object"==typeof e&&null!==e&&"status"in e&&Object.values(n.L).includes(e.status);var E=r(96168);class b extends((0,E.Hu)("SyncError","An error occoured while trying to sync the vault")){}let w=class{constructor(e){this.carbonLegacy=e}async attemptSync(e){await this.carbonLegacy.commands.carbonLegacyLeeloo({name:"sessionForceSync",arg:[{trigger:e}]})}async waitForSync(e){const t=this.getSyncState().pipe((0,g.h)((e=>!(!(0,c.d6)(e)||!S(e.data))&&[n.L.FAILURE,n.L.SUCCESS].includes(e.data.status))),(0,f.DZ)((()=>new b)),(0,f.lk)((e=>e.status===n.L.FAILURE?(0,c.Rn)({tag:"Sync failed"}):(0,c.Vp)(void 0))));return await this.attemptSync(e),(0,v.z)(t)}getSyncState(){return this.carbonLegacy.queries.carbonState({path:"userSession.sync"}).pipe((0,f.Qn)((e=>{if(!S(e))throw new Error("Bad sync state format");return{status:e.status}})))}};w=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[_._])],w);var A=r(26897);let C=class{constructor(e){this.syncService=e}async run(){return await this.syncService.attemptSync(A.Trigger.Periodic),Promise.resolve()}};C=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],C);let I=class{};I=(0,s.__decorate)([(0,i.Y)({api:o.r,handlers:{commands:{sync:u},events:{},queries:{syncProgress:m}},crons:[{handler:C,periodInMinutes:5,name:"periodic-sync-cron",scope:a.F.User}],providers:[{provide:n._,useClass:w}],exports:[n._]})],I)},65106:(e,t,r)=>{r.d(t,{$:()=>i});var s=r(96168);class i extends((0,s.Hu)("UserIsNotAdmin","User is not an admin")){}},17305:(e,t,r)=>{r.d(t,{t:()=>I});var s=r(86952),i=r(56622),a=r(3171),o=r(21625),n=r(87696),c=r(48920),l=r(6986),d=r(14745),u=r(35997),p=r(5633),h=r(57233),m=r(75153),g=r(73852),v=r(66494),y=r(5407),_=r(14400),f=r(93341),S=r(96491),E=r(50713),b=r(71616),w=r(48317),A=r(90109),C=r(99507);const I=(0,s.Q)({name:"teamAdminNotifications",commands:{markActivityLogsInfoboxSeen:i.o,markB2BPlanDiscontinuedSeen:a.q,markIdPFailedNotificationSeen:o.b,markIdPNeedsSeatsInfoboxSeen:n.k,markIdPNeedsSeatsInfoboxInPopupSeen:c.N,markIdPProvisioningsPendingInfoboxSeen:l.r,markNewRestrictSharingPolicySeen:d.o,markNotificationTrialExtendedSeen:u.D,markOfferToExtendFreeTrialSeen:p.R,markStarterRepackagePolicyInfoboxSeen:h.z},events:{},queries:{getIdPFailedProvisioningsData:m.It,getIdPFixedProvisioningsData:g.Un,hasSeenActivityLogsInfobox:v.g,hasSeenB2BPlanDiscontinued:y.z,hasSeenIdPFailedNotification:_.g,hasSeenIdPNeedsSeatsInfoboxInPopup:f.k,hasSeenIdPNeedsSeatsInfobox:S.T,hasSeenIdPProvisioningsPendingInfobox:E.S,hasSeenNewRestrictSharingPolicy:b.x,hasSeenNotificationTrialExtended:w.q,hasSeenOfferToExtendFreeTrial:A.U,HasSeenStarterRepackagePolicyInfobox:C.i}})},56622:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},3171:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},21625:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},48920:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},87696:(e,t,r)=>{r.d(t,{k:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},6986:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},14745:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},35997:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},5633:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},57233:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},75153:(e,t,r)=>{r.d(t,{C$:()=>s,It:()=>c,qj:()=>n});var s,i=r(99059),a=r(25029),o=r(96168);!function(e){e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error"}(s||(s={}));const n=(0,o.Vj)(s.NOT_ADMIN,"User is not an admin");(0,o.Vj)(s.SERVER_ERROR,"Server error while retrieving IdP Notifications data");class c extends((0,i.k)({scope:a.F.User})){}},73852:(e,t,r)=>{r.d(t,{Go:()=>n,Un:()=>c});var s,i=r(99059),a=r(25029),o=r(96168);!function(e){e.NOT_ADMIN="not_admin",e.SERVER_ERROR="server_error"}(s||(s={}));const n=(0,o.Vj)(s.NOT_ADMIN,"User is not an admin");(0,o.Vj)(s.SERVER_ERROR,"Server error while retrieving IdP Notifications data");class c extends((0,i.k)({scope:a.F.User})){}},66494:(e,t,r)=>{r.d(t,{g:()=>i});var s=r(99059);class i extends((0,s.k)()){}},5407:(e,t,r)=>{r.d(t,{z:()=>i});var s=r(99059);class i extends((0,s.k)()){}},14400:(e,t,r)=>{r.d(t,{g:()=>i});var s=r(99059);class i extends((0,s.k)()){}},93341:(e,t,r)=>{r.d(t,{k:()=>i});var s=r(99059);class i extends((0,s.k)()){}},96491:(e,t,r)=>{r.d(t,{T:()=>i});var s=r(99059);class i extends((0,s.k)()){}},50713:(e,t,r)=>{r.d(t,{S:()=>i});var s=r(99059);class i extends((0,s.k)()){}},71616:(e,t,r)=>{r.d(t,{x:()=>i});var s=r(99059);class i extends((0,s.k)()){}},48317:(e,t,r)=>{r.d(t,{q:()=>i});var s=r(99059);class i extends((0,s.k)()){}},90109:(e,t,r)=>{r.d(t,{U:()=>i});var s=r(99059);class i extends((0,s.k)()){}},99507:(e,t,r)=>{r.d(t,{i:()=>i});var s=r(99059);class i extends((0,s.k)()){}},13823:(e,t,r)=>{r.d(t,{L:()=>d});var s=r(86952),i=r(11848),a=r(70653),o=r(39881),n=r(66627),c=r(72403),l=r(25043);const d=(0,s.Q)({name:"teamMembers",commands:{proposeMembers:i.og,dismissNonMembersInfobox:a.Y},events:{membersAdded:l.q},queries:{getNonMembersCount:o.H,getNonMembersList:n.Fz,getHasAdminDismissedInfobox:c.K}})},70653:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},11848:(e,t,r)=>{r.d(t,{Wv:()=>m,og:()=>g});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.InvalidOrigin="InvalidOrigin",e.NoFreeSlot="NoFreeSlot",e.NoFreeSlotFreePlan="NoFreeSlotFreePlan",e.UserTeamInviteTokenNotFound="UserTeamInviteTokenNotFound",e.PaymentFailed="PaymentFailed",e.NotBillingAdmin="NotBillingAdmin",e.CannotAddSeatDuringGracePeriod="CannotAddSeatDuringGracePeriod"}(s||(s={}));class n extends((0,o.Hu)(s.InvalidOrigin,"Invalid origin")){}class c extends((0,o.Hu)(s.NoFreeSlot,"No free slot")){}class l extends((0,o.Hu)(s.NoFreeSlotFreePlan,"No free slot in free plan")){}class d extends((0,o.Hu)(s.UserTeamInviteTokenNotFound,"No invite token to a team available for user")){}class u extends((0,o.Hu)(s.PaymentFailed,"Payment failed")){}class p extends((0,o.Hu)(s.NotBillingAdmin,"User is not the billing admin")){}class h extends((0,o.Hu)(s.CannotAddSeatDuringGracePeriod,"Seats cannot be added during grace period")){}function m(e){switch(e){case"invalid_origin":return new n;case"no_free_slot":return new c;case"no_free_slot_free_plan":return new l;case"USER_TEAM_INVITE_TOKEN_NOT_FOUND":return new d;case"payment_failed":return new u;case"not_billing_admin":return new p;case"cannot_add_seat_during_grace_period":return new h;default:throw new Error("Unknown server error")}}class g extends((0,i.g)({scope:a.F.User})){}},25043:(e,t,r)=>{r.d(t,{q:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},72403:(e,t,r)=>{r.d(t,{K:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},39881:(e,t,r)=>{r.d(t,{H:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},66627:(e,t,r)=>{r.d(t,{Fz:()=>c,R0:()=>o,RD:()=>n});var s=r(7165),i=r(99059),a=r(25029);const o=s.z.object({userId:s.z.number(),login:s.z.string(),premiumStatus:s.z.enum(["free","subscribed","legacy"]),lastActivityDateUnix:s.z.number(),proposedState:s.z.enum(["proposed","not_in_team","in_team","revoked"])}),n=s.z.array(o);class c extends((0,i.k)({scope:a.F.User})){}},46888:(e,t,r)=>{r.d(t,{B:()=>a});var s=r(86952),i=r(42014);const a=(0,s.Q)({name:"teamPasswordHealth",commands:{},events:{},queries:{getReport:i.z}})},42014:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},13511:(e,t,r)=>{r.d(t,{o:()=>I});var s=r(86952),i=r(97355),a=r(25904),o=r(82276),n=r(12813),c=r(26657),l=r(94894),d=r(83043),u=r(98356),p=r(26992),h=r(9128),m=r(30525),g=r(89859),v=r(73972),y=r(19068),_=r(80926),f=r(64380),S=r(65245),E=r(704),b=r(27056),w=r(26730),A=r(207),C=r(75336);const I=(0,s.Q)({name:"teamPlanDetails",commands:{addSeats:i.E,extendFreeTrial:a.No,requestTeamPlanCancellation:o.y7,editTeamName:n.Q2,editTeamPolicies:c.m,sendFeedback:l.cr},events:{},queries:{getIndustryBenchmarkData:d.l,getTeamActiveDirectoryInfo:u.e,getTeamBillingInformation:p._,getTeamCancellationStatus:h.F,getTeamCapabilities:m.Y,getTeamCreationDateUnixQuery:g.T,getTeamDuoInfo:v.Z,getTeamId:y.e,getTeamName:_.j,getTeamRoles:f.R,getTeamPolicies:S.K,getTeamSeats:E.W,getTeamSecurityScore:b.R,getTeamSsoInfo:w.m,getTeamTrialStatus:A.P,isTeamCreator:C.G7}})},42645:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(67837),i=r(13511);class a extends((0,s.E)(i.o)){}(0,s.K)(i.o,a)},97355:(e,t,r)=>{r.d(t,{E:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},12813:(e,t,r)=>{r.d(t,{Kv:()=>d,Q2:()=>u,QI:()=>l,U8:()=>n,mX:()=>c});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.DUPLICATE="team_name_already_exists",e.INVALID_TEAM_SETTING_VALUE="INVALID_TEAM_SETTING_VALUE",e.NOT_ADMIN="not_admin",e.NOT_AUTHORIZED="not_authorized"}(s||(s={}));const n=(0,o.Vj)(s.DUPLICATE,"That team name already exists"),c=(0,o.Vj)(s.INVALID_TEAM_SETTING_VALUE,"The team setting value is invalid"),l=(0,o.Vj)(s.NOT_ADMIN,"User is not admin"),d=(0,o.Vj)(s.NOT_AUTHORIZED,"User is not authorized to perform this action");class u extends((0,i.g)({scope:a.F.User})){}},26657:(e,t,r)=>{r.d(t,{m:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},25904:(e,t,r)=>{r.d(t,{AP:()=>c,No:()=>u,RQ:()=>l,gv:()=>n,lO:()=>d,sK:()=>s});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.TEAM_NOT_FOUND="TEAM_NOT_FOUND",e.NOT_IN_FREE_TRIAL="TEAM_NOT_FREE_TRIAL",e.IN_GRACE_PERIOD="TEAM_IN_GRACE_PERIOD",e.USER_NOT_ADMIN="not_admin"}(s||(s={}));const n=(0,o.Vj)(s.TEAM_NOT_FOUND,"Team not found"),c=(0,o.Vj)(s.NOT_IN_FREE_TRIAL,"Team is not in a free trial"),l=(0,o.Vj)(s.IN_GRACE_PERIOD,"User trial is already extended. User is in grace period"),d=(0,o.Vj)(s.USER_NOT_ADMIN,"User is not admin");class u extends((0,i.g)({scope:a.F.User})){}},82276:(e,t,r)=>{r.d(t,{Rb:()=>l,VH:()=>n,fz:()=>c,y7:()=>d});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.IN_FREE_TRIAL="TEAM_IN_FREE_TRIAL",e.IS_DISCONTINUED="TEAM_IS_DISCONTINUED",e.USER_NOT_ADMIN="NOT_ADMIN"}(s||(s={}));const n=(0,o.Vj)(s.IN_FREE_TRIAL,"Team is in a free trial"),c=(0,o.Vj)(s.IS_DISCONTINUED,"Team is discontinued"),l=(0,o.Vj)(s.USER_NOT_ADMIN,"User is not admin");class d extends((0,i.g)({scope:a.F.User})){}},94894:(e,t,r)=>{r.d(t,{b6:()=>n,cr:()=>c});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.INVALID_FEEDBACK="INVALID_FEEDBACK"}(s||(s={}));const n=(0,o.Vj)(s.INVALID_FEEDBACK,"The provided feedback is invalid and won't be shared");class c extends((0,i.g)({scope:a.F.User})){}},83043:(e,t,r)=>{r.d(t,{l:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},98356:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},26992:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},9128:(e,t,r)=>{r.d(t,{F:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},30525:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},89859:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},73972:(e,t,r)=>{r.d(t,{Z:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},19068:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},80926:(e,t,r)=>{r.d(t,{j:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},65245:(e,t,r)=>{r.d(t,{K:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},64380:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},704:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},27056:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},26730:(e,t,r)=>{r.d(t,{m:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},207:(e,t,r)=>{r.d(t,{P:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},75336:(e,t,r)=>{r.d(t,{G7:()=>c});var s,i=r(99059),a=r(25029),o=r(96168);!function(e){e.NOT_LOGGED="NOT_LOGGED",e.NOT_ADMIN="NOT_ADMIN"}(s||(s={}));const n=(0,o.Vj)(s.NOT_LOGGED,"Please log the user");(0,o.Vj)(s.NOT_ADMIN,"User is not an admin");class c extends((0,i.k)({scope:a.F.User,noUserError:n()})){}},81598:(e,t,r)=>{r.d(t,{F:()=>a,Gr:()=>c,Uz:()=>o,lD:()=>s,qo:()=>i,ym:()=>d,yt:()=>l});var s,i,a,o,n=r(7165);!function(e){e.Legacy="legacy",e.Starter="starter",e.Team="team",e.Business="business",e.Enterprise="entreprise"}(s||(s={})),function(e){e.ProcessOut="processout",e.Invoice="invoice"}(i||(i={})),function(e){e.USD="usd",e.EUR="eur"}(a||(a={})),function(e){e.Pending="pending",e.Canceled="canceled",e.None="none",e.Unknown="unknown"}(o||(o={}));const c={ChoseOtherPasswordManager:"chose_other_password_manager",DownsizedEmployeeCount:"downsized_employee_count",MissingCriticalFeatures:"missing_critical_features",NoInternalUsage:"no_internal_usage",Other:"other",TechnicalIssues:"technical_issues",TooExpensive:"too_expensive"};var l;!function(e){e.InTeam="in_team",e.NotPremium="not_premium",e.NoPayment="no_payment",e.IsUnpaidFamilyMember="is_unpaid_family_member",e.DefaultSettings="default_settings",e.NoVPNCapability="no_vpn_capability",e.DisabledForFreeUser="disabled_for_free_user"}(l||(l={}));const d=n.z.object({allowPersistenceForMasterPassword:n.z.boolean(),allowSharing:n.z.boolean(),sharingRestrictedToTeam:n.z.boolean(),enforce2FA:n.z.boolean(),cryptoForcedPayload:n.z.string(),disableAutoLoginDomains:n.z.array(n.z.string()),enableForcedDomains:n.z.boolean(),enablePersonalSpace:n.z.boolean(),enableRemoveForcedContent:n.z.boolean(),enableVPN:n.z.boolean(),forceAutomaticLogout:n.z.number(),lockOnExit:n.z.boolean(),vaultExportEnabled:n.z.boolean(),collectSensitiveDataAuditLogsEnabled:n.z.boolean(),ssoEnabled:n.z.boolean(),ssoProvisioning:n.z.boolean(),teamDomain:n.z.array(n.z.string()),restrictSharingToTeam:n.z.boolean(),recoveryEnabled:n.z.boolean(),richIconsEnabled:n.z.boolean()})},41216:(e,t,r)=>{r.d(t,{K:()=>l});var s=r(86952),i=r(15678),a=r(31911),o=r(35313),n=r(80204),c=r(35642);const l=(0,s.Q)({name:"teamPlanUpdate",commands:{changeTierMidcycle:i.G,legacyChangeTierMidcycle:a.R},events:{},queries:{getTeamOffers:o.g,getMidcycleTierUpgradePrice:n.X,getLegacyMidcycleTierUpgradePrice:c.t}})},15678:(e,t,r)=>{r.d(t,{G:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},31911:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},35642:(e,t,r)=>{r.d(t,{t:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},80204:(e,t,r)=>{r.d(t,{X:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},35313:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},1701:(e,t,r)=>{r.d(t,{a:()=>c});var s=r(86952),i=r(57220),a=r(56333),o=r(15961),n=r(70302);const c=(0,s.Q)({name:"teamVat",commands:{DeleteTeamVatCommand:i.Hy,UpsertTeamVatCommand:a.XW},events:{},queries:{getTeamVat:o.N7,getTaxAmount:n.B}})},57220:(e,t,r)=>{r.d(t,{Hy:()=>d,zK:()=>l});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class n extends((0,o.Hu)(s.TeamNotFound,"The given user is not part of a single team")){}class c extends((0,o.Hu)(s.NotBillingAdmin,"The user is not Billing Admin")){}function l(e){switch(e){case"TEAM_NOT_FOUND":return new n;case"not_billing_admin":return new c;default:throw new Error("Unknown server error")}}class d extends((0,i.g)({scope:a.F.User})){}},56333:(e,t,r)=>{r.d(t,{XW:()=>u,q5:()=>d});var s,i=r(74354),a=r(25029),o=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.NotBillingAdmin="NotBillingAdmin",e.VatNumberNotUpserted="VatNumberNotUpserted"}(s||(s={}));class n extends((0,o.Hu)(s.TeamNotFound,"The given user is not part of a single team")){}class c extends((0,o.Hu)(s.NotBillingAdmin,"The user is not Billing Admin")){}class l extends((0,o.Hu)(s.VatNumberNotUpserted,"The VAT number couldn't be upserted")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new n;case"not_billing_admin":return new c;case"VAT_NUMBER_NOT_UPSERTED":return new l;default:throw new Error("Unknown server error")}}class u extends((0,i.g)({scope:a.F.User})){}},70302:(e,t,r)=>{r.d(t,{A:()=>a,B:()=>o});var s=r(99059),i=r(96168);class a extends((0,i.Hu)("GetExpectedTaxInformationFailed","Could not return tax amount")){}class o extends((0,s.k)()){}},15961:(e,t,r)=>{r.d(t,{K$:()=>d,N7:()=>u});var s,i=r(99059),a=r(25029),o=r(96168);!function(e){e.TeamNotFound="TeamNotFound",e.VatNumberNotFound="VatNumberNotFound",e.NotBillingAdmin="NotBillingAdmin"}(s||(s={}));class n extends((0,o.Hu)(s.TeamNotFound,"The given user is not part of a single team")){}class c extends((0,o.Hu)(s.VatNumberNotFound,"The given Team does not have a VAT number")){}class l extends((0,o.Hu)(s.NotBillingAdmin,"The user is not Billing Admin")){}function d(e){switch(e){case"TEAM_NOT_FOUND":return new n;case"VAT_NUMBER_NOT_FOUND":return new c;case"not_billing_admin":return new l;default:throw new Error("Unknown server error")}}class u extends((0,i.k)({scope:a.F.User})){}},23495:(e,t,r)=>{r.d(t,{E:()=>we});var s,i=r(88802),a=r(99634),o=r(93850),n=r(17305),c=r(29762),l=r(94121),d=r(71607),u=r(91751),p=r(63663),h=r(87279),m=r(56622),g=r(25029),v=r(95681),y=r(23347),_=r(10722),f=r(7165);!function(e){e.OfferToExtendFreeTrial="offerToExtendFreeTrial",e.NotificationTrialExtended="notificationTrialExtended",e.RestrictSharingPolicy="restrictSharingPolicy",e.B2BPlanDiscontinued="b2bPlanDiscontinued",e.ActivityLogsInfobox="activityLogsInfobox",e.StarterRepackagePolicyInfobox="starterRepackagePolicyInfobox",e.IdPFailedNotification="idpFailedNotification",e.IdPNeedsSeatsInfobox="idpNeedsSeatsInfobox",e.IdPProvisioningsPendingInfobox="idpProvisioningsPendingInfobox",e.IdPNeedsSeatsInfoboxInPopup="idpNeedsSeatsInfoboxInPopup"}(s||(s={}));const S=f.z.object({seenNotifications:f.z.record(f.z.nativeEnum(s),f.z.boolean())}),E=e=>S.safeParse(e).success;class b extends((0,v.Q)({storage:{schemaVersion:1,initialValue:{seenNotifications:{offerToExtendFreeTrial:!1,notificationTrialExtended:!1,restrictSharingPolicy:!1,b2bPlanDiscontinued:!1,activityLogsInfobox:!1,starterRepackagePolicyInfobox:!1,idpFailedNotification:!1,idpNeedsSeatsInfobox:!1,idpProvisioningsPendingInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1}},typeGuard:E},persist:!0,scope:g.F.User,storeName:"team-admin-notifications-store",capacity:y.Y._010KB,codec:_.E})){}let w=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,activityLogsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};w=(0,i.__decorate)([(0,p.W)(m.o),(0,i.__metadata)("design:paramtypes",[b])],w);var A=r(57233);let C=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,starterRepackagePolicyInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};C=(0,i.__decorate)([(0,p.W)(A.z),(0,i.__metadata)("design:paramtypes",[b])],C);var I=r(3171);let T=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,b2bPlanDiscontinued:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};T=(0,i.__decorate)([(0,p.W)(I.q),(0,i.__metadata)("design:paramtypes",[b])],T);var P=r(21625);let O=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpFailedNotification:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};O=(0,i.__decorate)([(0,p.W)(P.b),(0,i.__metadata)("design:paramtypes",[b])],O);var R=r(87696);let D=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};D=(0,i.__decorate)([(0,p.W)(R.k),(0,i.__metadata)("design:paramtypes",[b])],D);var N=r(48920);let U=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpNeedsSeatsInfoboxInPopup:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};U=(0,i.__decorate)([(0,p.W)(N.N),(0,i.__metadata)("design:paramtypes",[b])],U);var F=r(6986);let M=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,idpProvisioningsPendingInfobox:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};M=(0,i.__decorate)([(0,p.W)(F.r),(0,i.__metadata)("design:paramtypes",[b])],M);var L=r(14745);let x=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,restrictSharingPolicy:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};x=(0,i.__decorate)([(0,p.W)(L.o),(0,i.__metadata)("design:paramtypes",[b])],x);var k=r(35997);let G=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,notificationTrialExtended:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};G=(0,i.__decorate)([(0,p.W)(k.D),(0,i.__metadata)("design:paramtypes",[b])],G);var V=r(5633);let K=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.seenNotifications,offerToExtendFreeTrial:!0};return await this.store.set({...e,seenNotifications:t}),Promise.resolve((0,h.Vp)(void 0))}};K=(0,i.__decorate)([(0,p.W)(V.R),(0,i.__metadata)("design:paramtypes",[b])],K);var j=r(20754),B=r(75153),W=r(25859),z=r(87065),H=r(60399),Q=r(82567),q=r(57924),Y=r(87113),$=r(73852);const X=f.z.object({failedProvisionings:f.z.union([f.z.object({eventDateUnix:f.z.number(),failedLogins:f.z.array(f.z.string()),nbOfFailedCreations:f.z.number(),requiredSeats:f.z.number(),nbOfPendingProvisionings:f.z.number(),shouldShowNotifications:f.z.object({warningProvisioningsPending:f.z.boolean(),alertFailuresNeedSeats:f.z.boolean()})}),f.z.undefined()]),fixedProvisionings:f.z.union([f.z.array(f.z.object({buyingUserId:f.z.number().nullable(),eventDateUnix:f.z.number(),nbOfSeatsBought:f.z.number()})),f.z.undefined()]),lastRefreshDate:f.z.number(),error:f.z.union([f.z.string(),f.z.undefined()])}),Z=e=>X.safeParse(e).success;class J extends((0,v.Q)({storage:{schemaVersion:1,initialValue:{lastRefreshDate:0},typeGuard:Z},persist:!0,scope:g.F.User,storeName:"idp-notifications-store",capacity:y.Y._010KB,codec:_.E})){}let ee=class{constructor(e,t,r,s){this.serverApiClient=e,this.teamAdminService=t,this.idpNotificationsStore=r,this.adminNotificationsStore=s,this.MIN_DELAY_BETWEEN_REFRESHES=500,this.getIdPFailedProvisioningsData=()=>(0,W.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,z.U)((e=>"not_admin"===e.error?(0,h.Rn)((0,B.qj)()):(0,h.Vp)(e.failedProvisionings))))))),this.getIdPFixedProvisioningsData=()=>(0,W.P)((()=>(this.refreshState(),this.idpNotificationsStore.state$.pipe((0,z.U)((e=>"not_admin"===e.error?(0,h.Rn)((0,$.Go)()):(0,h.Vp)(e.fixedProvisionings)))))))}async refreshState(){const e=await this.teamAdminService.refreshState();if(!e?.isBillingOrFullAdmin)return void this.idpNotificationsStore.set({lastRefreshDate:0,error:B.C$.NOT_ADMIN});const t=await this.idpNotificationsStore.getState();if(t.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now())return;const r=(await this.adminNotificationsStore.getState()).seenNotifications;return(0,H.z)(this.serverApiClient.v1.teams.getIdpNotifications({}).pipe((0,z.U)((t=>{if((0,h.hx)(t))return{lastRefreshDate:Date.now(),error:t.error.message};const r=t.data.data.logs.failedProvisionings,s=r?.nbOfFailedCreations,i=e.seats.remaining,a=s?Math.max(s-i,0):0,o={warningProvisioningsPending:i>0,alertFailuresNeedSeats:a>0};return{failedProvisionings:r?.nbOfFailedCreations?{...r,requiredSeats:a,nbOfPendingProvisionings:i,shouldShowNotifications:o}:void 0,fixedProvisionings:t.data.data.logs.fixedProvisionings,lastRefreshDate:Date.now()}})),(0,Q.b)((async e=>{let s=!1,i=!1,a=!1;e.failedProvisionings&&e.failedProvisionings.eventDateUnix===t.failedProvisionings?.eventDateUnix?e.failedProvisionings.requiredSeats!==t.failedProvisionings.requiredSeats&&(s=!0):(s=!0,a=!0),e.failedProvisionings?.nbOfPendingProvisionings!==t.failedProvisionings?.nbOfPendingProvisionings&&(i=!0),await this.adminNotificationsStore.set({seenNotifications:{...r,...s?{idpNeedsSeatsInfobox:!1,idpNeedsSeatsInfoboxInPopup:!1}:{},idpFailedNotification:!a&&r.idpFailedNotification,idpProvisioningsPendingInfobox:!i&&r.idpProvisioningsPendingInfobox}}),await this.idpNotificationsStore.set(e)}))))}};ee=(0,i.__decorate)([(0,q.GS)(),(0,i.__metadata)("design:paramtypes",[Y.l,l.k,J,b])],ee);let te=class{constructor(e){this.idpNotificationsDataService=e}execute(){return this.idpNotificationsDataService.getIdPFailedProvisioningsData()}};te=(0,i.__decorate)([(0,j.e)(B.It),(0,i.__metadata)("design:paramtypes",[ee])],te);let re=class{constructor(e){this.idpNotificationsDataService=e}execute(){return this.idpNotificationsDataService.getIdPFixedProvisioningsData()}};re=(0,i.__decorate)([(0,j.e)($.Un),(0,i.__metadata)("design:paramtypes",[ee])],re);var se=r(66494);let ie=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.activityLogsInfobox))))}};ie=(0,i.__decorate)([(0,j.e)(se.g),(0,i.__metadata)("design:paramtypes",[b])],ie);var ae=r(99507);let oe=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.starterRepackagePolicyInfobox))))}};oe=(0,i.__decorate)([(0,j.e)(ae.i),(0,i.__metadata)("design:paramtypes",[b])],oe);var ne=r(5407);let ce=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.b2bPlanDiscontinued))))}};ce=(0,i.__decorate)([(0,j.e)(ne.z),(0,i.__metadata)("design:paramtypes",[b])],ce);var le=r(14400);let de=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.idpFailedNotification))))}};de=(0,i.__decorate)([(0,j.e)(le.g),(0,i.__metadata)("design:paramtypes",[b])],de);var ue=r(96491);let pe=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.idpNeedsSeatsInfobox))))}};pe=(0,i.__decorate)([(0,j.e)(ue.T),(0,i.__metadata)("design:paramtypes",[b])],pe);var he=r(93341);let me=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.idpNeedsSeatsInfoboxInPopup))))}};me=(0,i.__decorate)([(0,j.e)(he.k),(0,i.__metadata)("design:paramtypes",[b])],me);var ge=r(50713);let ve=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.idpProvisioningsPendingInfobox))))}};ve=(0,i.__decorate)([(0,j.e)(ge.S),(0,i.__metadata)("design:paramtypes",[b])],ve);var ye=r(71616);let _e=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.restrictSharingPolicy))))}};_e=(0,i.__decorate)([(0,j.e)(ye.x),(0,i.__metadata)("design:paramtypes",[b])],_e);var fe=r(48317);let Se=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.notificationTrialExtended))))}};Se=(0,i.__decorate)([(0,j.e)(fe.q),(0,i.__metadata)("design:paramtypes",[b])],Se);var Ee=r(90109);let be=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,z.U)((e=>(0,h.Vp)(!!e.seenNotifications.offerToExtendFreeTrial))))}};be=(0,i.__decorate)([(0,j.e)(Ee.U),(0,i.__metadata)("design:paramtypes",[b])],be);let we=class{};we=(0,i.__decorate)([(0,a.Y)({api:n.t,imports:[u.H,o.n],stores:[J,b,c.C],providers:[ee,d.J,l.k],handlers:{commands:{markActivityLogsInfoboxSeen:w,markStarterRepackagePolicyInfoboxSeen:C,markB2BPlanDiscontinuedSeen:T,markIdPFailedNotificationSeen:O,markIdPNeedsSeatsInfoboxSeen:D,markIdPNeedsSeatsInfoboxInPopupSeen:U,markIdPProvisioningsPendingInfoboxSeen:M,markNewRestrictSharingPolicySeen:x,markNotificationTrialExtendedSeen:G,markOfferToExtendFreeTrialSeen:K},events:{},queries:{getIdPFailedProvisioningsData:te,getIdPFixedProvisioningsData:re,hasSeenActivityLogsInfobox:ie,HasSeenStarterRepackagePolicyInfobox:oe,hasSeenB2BPlanDiscontinued:ce,hasSeenIdPFailedNotification:de,hasSeenIdPNeedsSeatsInfobox:pe,hasSeenIdPNeedsSeatsInfoboxInPopup:me,hasSeenIdPProvisioningsPendingInfobox:ve,hasSeenNewRestrictSharingPolicy:_e,hasSeenNotificationTrialExtended:Se,hasSeenOfferToExtendFreeTrial:be}},requiredFeatureFlips:["monetization_extension_activity_logs_repackage","monetization_extension_trial_activity_logs","monetization_extension_group_sharing_repackage"]})],we)},62263:(e,t,r)=>{r.d(t,{X:()=>K});var s=r(88802),i=r(99634),a=r(93850),o=r(13823),n=r(63663),c=r(11848),l=r(60399),d=r(82567),u=r(57924),p=r(87113),h=r(48844),m=r(87279),g=r(81459);let v=class extends g.f{};v=(0,s.__decorate)([(0,u.GS)()],v);let y=class{constructor(e,t){this.serverApiClient=e,this.eventEmitter=t}async callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}){try{return await(0,l.z)(this.serverApiClient.v1.teams.proposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}).pipe((0,h.DZ)((e=>{if("BusinessError"===e.tag)return(0,c.Wv)(e.code);throw new Error(e.message)})),(0,h.lk)((e=>(0,m.Vp)(e.data))),(0,d.b)((()=>{this.eventEmitter.sendEvent("membersAdded",void 0)}))))}catch(e){return(0,m.Rn)({tag:"failure",error:`Propose Members failed - ${e}`})}}};y=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[p.l,v])],y);let _=class{constructor(e){this.proposeMembersService=e}execute({body:{proposedMemberLogins:e,force:t,origin:r,notificationOptions:s}}){return this.proposeMembersService.callProposeMembers({proposedMemberLogins:e,force:t,origin:r,notificationOptions:s})}};_=(0,s.__decorate)([(0,n.W)(c.og),(0,s.__metadata)("design:paramtypes",[y])],_);var f=r(70653),S=r(95681),E=r(23347),b=r(25029),w=r(66627),A=r(7165);const C=A.z.object({adminHasDismissInfobox:A.z.boolean(),nonMembersCount:A.z.number().optional(),nonMembersList:w.RD.optional()}),I=e=>C.safeParse(e).success;class T extends((0,S.Q)({initialValue:{adminHasDismissInfobox:!1},storeTypeGuard:I,persist:!1,scope:b.F.User,storeName:"non-member-store",capacity:E.Y._001KB})){}let P=class{constructor(e){this.nonMemberStore=e}async execute(){return await this.nonMemberStore.set({adminHasDismissInfobox:!0}),(0,m.Vp)(void 0)}};P=(0,s.__decorate)([(0,n.W)(f.Y),(0,s.__metadata)("design:paramtypes",[T])],P);var O=r(43978),R=r(69885),D=r(87065),N=r(20754),U=r(39881),F=r(65106);let M=class{constructor(e){this.serverApiClient=e}getCount(){return this.serverApiClient.v1.teams.countDomainUsersNotInTeam({}).pipe((0,D.U)((e=>(0,m.hx)(e)?(0,m.Rn)(new F.$):(0,m.Vp)(e.data.data.usersCount))))}getList(){return this.serverApiClient.v1.teams.getDomainUsersNotInTeam({}).pipe((0,D.U)((e=>(0,m.hx)(e)?(0,m.Rn)(new F.$):(0,m.Vp)(e.data.data.users.map((e=>w.R0.parse(e)))))))}};M=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[p.l])],M);let L=class{constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}execute(){return this.nonMembersStore.state$.pipe((0,O.w)((e=>void 0!==e.nonMembersCount?(0,R.of)(e.nonMembersCount):this.nonMembersService.getCount().pipe((0,D.U)((t=>(0,m.hx)(t)?0:(this.nonMembersStore.set({...e,nonMembersCount:t.data}),t.data)))))),(0,D.U)((e=>(0,m.Vp)(e))))}};L=(0,s.__decorate)([(0,N.e)(U.H),(0,s.__metadata)("design:paramtypes",[T,M])],L);let x=class{constructor(e,t){this.nonMembersStore=e,this.nonMembersService=t}execute(){return this.nonMembersStore.state$.pipe((0,O.w)((e=>void 0!==e.nonMembersList?(0,R.of)(e.nonMembersList):this.nonMembersService.getList().pipe((0,D.U)((t=>{if((0,m.hx)(t))return[];const r=t.data;return this.nonMembersStore.set({...e,nonMembersList:r}),r}))))),(0,D.U)((e=>(0,m.Vp)(e))))}};x=(0,s.__decorate)([(0,N.e)(w.Fz),(0,s.__metadata)("design:paramtypes",[T,M])],x);var k=r(72403);let G=class{constructor(e){this.nonMembersStore=e}execute(){return this.nonMembersStore.state$.pipe((0,D.U)((e=>(0,m.Vp)(e.adminHasDismissInfobox))))}};G=(0,s.__decorate)([(0,N.e)(k.K),(0,s.__metadata)("design:paramtypes",[T])],G);var V=r(34623);let K=class{};K=(0,s.__decorate)([(0,i.Y)({api:o.L,imports:[a.n],providers:[y,M,v,V.G],stores:[T],handlers:{commands:{proposeMembers:_,dismissNonMembersInfobox:P},events:{},queries:{getNonMembersCount:L,getNonMembersList:x,getHasAdminDismissedInfobox:G}},exports:[V.G]})],K)},34623:(e,t,r)=>{r.d(t,{G:()=>n});var s=r(88802),i=r(48844),a=r(57924),o=r(87113);let n=class{constructor(e){this.serverApiClient=e,this.get=e=>this.serverApiClient.v1.teams.getTeamMembers({teamId:parseInt(e,10),orderBy:"joinedDateUnix",limit:0}).pipe((0,i.Qn)((({data:e})=>e)),(0,i.DZ)((e=>{throw e})))}};n=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o.l])],n)},65529:(e,t,r)=>{r.d(t,{V:()=>v});var s=r(88802),i=r(99634),a=r(93850),o=r(46888),n=r(20754),c=r(42014),l=r(57924),d=r(87113),u=r(87279),p=r(48844),h=r(87065);let m=class{constructor(e){this.serverApiClient=e,this.getTeamReport=()=>this.getTeamReportData().pipe((0,h.U)((e=>{if((0,u.hx)(e))throw new Error("could't retrieve team report");const{data:t}=e;return(0,u.Vp)(t)}))),this.getTeamReportData=()=>this.serverApiClient.v1.teams.report({}).pipe((0,p.Qn)((({data:e})=>e)),(0,p.DZ)((e=>{throw e})))}};m=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[d.l])],m);let g=class{constructor(e){this.teamReportService=e}execute(){return this.teamReportService.getTeamReport()}};g=(0,s.__decorate)([(0,n.e)(c.z),(0,s.__metadata)("design:paramtypes",[m])],g);let v=class{};v=(0,s.__decorate)([(0,i.Y)({api:o.B,imports:[a.n],providers:[m],handlers:{commands:{},events:{},queries:{getReport:g}}})],v)},71607:(e,t,r)=>{r.d(t,{J:()=>p});var s=r(88802),i=r(43956),a=r(86252),o=r(57924),n=r(87279),c=r(60399),l=r(87065),d=r(7165);const u=d.z.array(d.z.object({details:d.z.object({isBillingAdmin:d.z.boolean(),isTeamAdmin:d.z.boolean(),status:d.z.nativeEnum(i.fE)})}));let p=class{constructor(e){this.carbonLegacyClient=e}async isUserTeamAdmin(){return await(0,c.z)(this.carbonLegacyClient.queries.carbonState({path:"userSession.spaceData.spaces"}).pipe((0,l.U)((e=>{return!((0,n.hx)(e)||(t=e.data,!u.safeParse(t).success)||0===e.data.length)&&e.data.some((e=>e.details.status===i.fE.Accepted&&(e.details.isBillingAdmin||e.details.isTeamAdmin)));var t}))))}};p=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[a._])],p)},79156:(e,t,r)=>{r.d(t,{O:()=>s,e:()=>o});const s=(e,t)=>({allowPersistenceForMasterPassword:!e.mpPersistenceDisabled,allowSharing:!e.sharingDisabled,sharingRestrictedToTeam:!!e.sharingRestrictedToTeam,enforce2FA:"newDevice"===e.twoFAEnforced,cryptoForcedPayload:e.cryptoForcedPayload??"",disableAutoLoginDomains:e.autologinDomainDisabledArray??[],enableForcedDomains:!!e.forcedDomainsEnabled,enablePersonalSpace:!!e.personalSpaceEnabled,enableRemoveForcedContent:!!e.removeForcedContentEnabled,enableVPN:!!e.secureWifiEnabled,forceAutomaticLogout:Number(e.forceAutomaticLogout||0),lockOnExit:!!e.lockOnExit,vaultExportEnabled:!!e.vaultExportEnabled,collectSensitiveDataAuditLogsEnabled:!!e.collectSensitiveDataAuditLogsEnabled,ssoEnabled:!!e.ssoEnabled,ssoProvisioning:"automatic"===e.ssoProvisioning,teamDomain:e.teamDomains??[],restrictSharingToTeam:"boolean"==typeof e.sharingRestrictedToTeam?e.sharingRestrictedToTeam:t.internalSharingOnly.enabled,recoveryEnabled:!!e.recoveryEnabled,richIconsEnabled:!!e.richIconsEnabled}),i=(e,t,r)=>{const s=[];return r?.added&&r.added.forEach((t=>s.push({type:e,value:t}))),r?.removed&&r.removed.forEach((e=>s.push({type:t,value:e}))),s},a=(e,t)=>void 0!==t?[{type:e,value:t}]:[],o=(e,t)=>{const r=[...i("add_team_domain","remove_team_domain",t.teamDomain),...i("add_autologin_domain_disabled","remove_autologin_domain_disabled",t.disableAutoLoginDomains),...a("set_forced_domains_enabled",t.enableForcedDomains),...a("set_rm_forced_content_enabled",t.enableRemoveForcedContent),...a("set_vault_export_enabled",t.vaultExportEnabled),...a("set_secure_wifi",t.enableVPN),...a("set_lock_on_exit",t.lockOnExit),...a("set_collect_sensitive_data_audit_logs_enabled",t.collectSensitiveDataAuditLogsEnabled),...a("set_sharing_restricted_to_team",t.restrictSharingToTeam),...(s="set_sharing_disabled",o=t.allowSharing,void 0!==o?[{type:s,value:!o}]:[])];var s,o;return void 0!==t.enforce2FA&&r.push({type:"set_two_factor_authentication_enforced",value:t.enforce2FA?"newDevice":"disabled"}),void 0!==t.forceAutomaticLogout&&r.push({type:null===t.forceAutomaticLogout?"unset_force_automatic_logout":"set_force_automatic_logout",value:t.forceAutomaticLogout}),void 0!==t.cryptoForcedPayload&&r.push({type:"set_crypto_forced_payload",value:t.cryptoForcedPayload}),void 0!==t.ssoProvisioning&&r.push({type:"set_sso_provisioning",value:t.ssoProvisioning?"automatic":"disabled"}),void 0!==t.richIconsEnabled&&r.push({type:"set_rich_icons_enabled",value:t.richIconsEnabled}),{operations:r,teamId:e}}},91751:(e,t,r)=>{r.d(t,{H:()=>lt});var s=r(88802),i=r(99634),a=r(93850),o=r(13511),n=r(13823);var c,l=r(34710),d=r(63663),u=r(87279),p=r(97355),h=r(94121),m=r(60399),g=r(57924),v=r(87113),y=r(96168);!function(e){e.CannotAddSeatDuringFreeTrial="cannot_add_seat_during_free_trial",e.CannotAddSeatIfDiscontinued="cannot_add_seat_on_soft_discontinued",e.CannotAddSeatDuringGracePeriod="cannot_add_seat_during_grace_period",e.UnsupportedPaymentMean="unsupported_payment_mean",e.UserIsNotBillingAdmin="not_billing_admin",e.PaymentFailed="payment_failed"}(c||(c={}));const _=(0,y.Vj)(c.CannotAddSeatDuringFreeTrial,"Not possible to add seats during free trial"),f=(0,y.Vj)(c.CannotAddSeatIfDiscontinued,"Not possible to add seats if team is discontinued"),S=(0,y.Vj)(c.CannotAddSeatDuringGracePeriod,"Not possible to add seats during grace period"),E=(0,y.Vj)(c.UnsupportedPaymentMean,"Payment mean is not supported"),b=(0,y.Vj)(c.UserIsNotBillingAdmin,"User is not billing admin"),w=(0,y.Vj)(c.PaymentFailed,"The payment has failed");var A=r(48844),C=r(18533),I=r(20195);let T=class{constructor(e){this.serverApiClient=e,this.getAddSeatsFunctionalError=e=>{switch(e){case c.CannotAddSeatDuringFreeTrial:return _();case c.CannotAddSeatDuringGracePeriod:return S();case c.CannotAddSeatIfDiscontinued:return f();case c.UnsupportedPaymentMean:return E();case c.UserIsNotBillingAdmin:return b();case c.PaymentFailed:default:return w()}}}addSeats({seats:e}){return(0,m.z)(this.serverApiClient.v1.teams.addSeats({seats:e}).pipe((0,A.DZ)((e=>(0,C.EQ)(e,{BusinessError:e=>this.getAddSeatsFunctionalError(e.code),FetchFailedError:I.j,BadStatus:I.j,InternalServerError:I.j,InvalidRequest:I.j,RateLimited:I.j,ServiceUnavailable:I.j,UnspecifiedBadStatus:I.j}))),(0,A.Qn)((e=>e.data))))}};T=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[v.l])],T);let P=class{constructor(e,t){this.teamAdminService=e,this.addSeatsService=t}async execute({body:e}){const{seats:t}=e,r=await this.addSeatsService.addSeats({seats:t});return(0,u.d6)(r)&&await this.teamAdminService.refreshState(),r}};P=(0,s.__decorate)([(0,d.W)(p.E),(0,s.__metadata)("design:paramtypes",[h.k,T])],P);var O=r(25904);let R=class{constructor(e){this.serverApiClient=e,this.extendFreeTrial=async()=>{const e=await(0,m.z)(this.serverApiClient.v1.teams.extendFreeTrial({}));return(0,u.hx)(e)&&this.getExtendTrialFunctionalError(e.error.message),(0,u.Vp)(void 0)},this.getExtendTrialFunctionalError=e=>{switch(e){case O.sK.TEAM_NOT_FOUND:return(0,O.gv)();case O.sK.NOT_IN_FREE_TRIAL:return(0,O.AP)();case O.sK.IN_GRACE_PERIOD:return(0,O.RQ)();case O.sK.USER_NOT_ADMIN:return(0,O.lO)();default:return(0,O.gv)()}}}};R=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[v.l])],R);let D=class{constructor(e,t){this.freeTrialService=e,this.teamAdminService=t}async execute(){const e=await this.freeTrialService.extendFreeTrial();return(0,u.d6)(e)&&await this.teamAdminService.refreshState(),e}};D=(0,s.__decorate)([(0,d.W)(O.No),(0,s.__metadata)("design:paramtypes",[R,h.k])],D);var N,U=r(82276),F=r(81598);!function(e){e.NoInternalUsage="cancellation_lack_of_adoption",e.DownsizedEmployeeCount="cancellation_acquisition_or_restructured",e.ChoseOtherPasswordManager="cancellation_switched_to_competitor",e.MissingCriticalFeatures="cancellation_lack_of_features",e.TechnicalIssues="cancellation_technical_issues",e.TooExpensive="cancellation_price",e.Other="cancellation_other"}(N||(N={}));const M={[F.Gr.ChoseOtherPasswordManager]:N.ChoseOtherPasswordManager,[F.Gr.DownsizedEmployeeCount]:N.DownsizedEmployeeCount,[F.Gr.MissingCriticalFeatures]:N.MissingCriticalFeatures,[F.Gr.NoInternalUsage]:N.NoInternalUsage,[F.Gr.Other]:N.Other,[F.Gr.TechnicalIssues]:N.TechnicalIssues,[F.Gr.TooExpensive]:N.TooExpensive};var L=r(87065),x=r(85390),k=r(82567),G=r(86252),V=r(95681),K=r(23347),j=r(25029),B=r(10722);const W=e=>e===F.Uz.Canceled||e===F.Uz.None||e===F.Uz.Pending;class z extends((0,V.Q)({storage:{schemaVersion:1,initialValue:F.Uz.None,typeGuard:W},persist:!0,scope:j.F.User,storeName:"plan-cancellation-store",capacity:K.Y._001KB,codec:B.E})){}let H=class{constructor(e,t,r){this.serverApiClient=e,this.planCancellationStore=t,this.carbon=r,this.createZendeskCancellationTicket=async e=>{const t=await(0,m.z)(this.serverApiClient.v1.teams.createZendeskCancellationTicket(e));return(0,u.hx)(t)&&this.getBusinessErrorsForCreateZendeskCancellationTicket(t.error.message),(0,u.Vp)(void 0)},this.getZendeskCancellationTicket=()=>(this.refreshState(),this.planCancellationStore.state$.pipe((0,L.U)(u.Vp))),this.getBusinessErrorsForCreateZendeskCancellationTicket=e=>"TEAM_IN_FREE_TRIAL"===e?(0,U.VH)():"TEAM_IS_DISCONTINUED"===e?(0,U.fz)():(0,U.Rb)(),this.serverToDomainCancelStatusMapper=(e,t)=>(0,u.hx)(e)?F.Uz.Unknown:t?F.Uz.Canceled:void 0!==(0,u.db)(e).id?F.Uz.Pending:F.Uz.None,this.getIsRenewalStopped=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,L.U)((e=>{if((0,u.hx)(e))throw new Error("Cannot retrieve node premium status from Carbon");return e.data.b2bStatus?.currentTeam?.isRenewalStopped}))),this.getTickets=()=>this.serverApiClient.v1.teams.getZendeskCancellationTicket({}).pipe((0,A.DZ)((e=>({tag:e.message}))),(0,A.Qn)((e=>e.data)))}async refreshState(){const e=this.getTickets(),t=this.getIsRenewalStopped();return await(0,m.z)((0,x.a)([e,t]).pipe((0,L.U)((([e,t])=>this.serverToDomainCancelStatusMapper(e,t))),(0,k.b)((e=>{this.planCancellationStore.set(e)}))))}};H=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[v.l,z,G._])],H);let Q=class{constructor(e){this.planCancellationService=e}async execute({body:e}){const{reasons:t}=e,r=(e=>({reasons:e.map((e=>M[e]))}))(t),s=await this.planCancellationService.createZendeskCancellationTicket(r);return(0,u.d6)(s)&&await this.planCancellationService.refreshState(),s}};Q=(0,s.__decorate)([(0,d.W)(U.y7),(0,s.__metadata)("design:paramtypes",[H])],Q);var q=r(12813);let Y=class{constructor(e){this.serverApiClient=e}async execute({body:e}){const{teamId:t,newTeamName:r}=e,s=await(0,m.z)(this.serverApiClient.v1.teams.editSettings({teamId:t,operations:[{type:"set_name",value:r}]}));return(0,u.hx)(s)?"team_name_already_exists"===s.error.message?(0,u.Rn)((0,q.U8)()):"NOT_ADMIN"===s.error.message?(0,u.Rn)((0,q.QI)()):"NOT_AUTHORIZED"===s.error.message?(0,u.Rn)((0,q.Kv)()):(0,u.Rn)((0,q.mX)()):(0,u.Vp)(void 0)}};Y=(0,s.__decorate)([(0,d.W)(q.Q2),(0,s.__metadata)("design:paramtypes",[v.l])],Y);var $=r(26657),X=r(79156);let Z=class{constructor(e,t){this.teamAdminService=e,this.serverApiClient=t}async execute({body:e}){const{teamId:t,policyUpdates:r}=e;return await(0,m.z)(this.serverApiClient.v1.teams.editSettings((0,X.e)(t,r))),await this.teamAdminService.refreshState(),(0,u.Vp)(void 0)}};Z=(0,s.__decorate)([(0,d.W)($.m),(0,s.__metadata)("design:paramtypes",[h.k,v.l])],Z);var J=r(94894);let ee=class{constructor(e){this.serverApiClient=e}async execute({body:e}){const{feedbackBody:t}=e,r=await(0,m.z)(this.serverApiClient.v1.feedback.sendFeedback({title:"A team Admin just wrote to us:",body:t}));return(0,u.hx)(r)?(0,u.Rn)((0,J.b6)()):(0,u.Vp)(void 0)}};ee=(0,s.__decorate)([(0,d.W)(J.cr),(0,s.__metadata)("design:paramtypes",[v.l])],ee);var te=r(162),re=r(20754),se=r(83043),ie=r(25859),ae=r(65106),oe=r(95557),ne=r(10994),ce=r(92481),le=r(50793);const de=e=>{if(!e)return new Date;const t=(0,oe.Z)(e,"yyyy-MM-dd",new Date);return"Invalid Date"!==t.toString()?t:new Date(e)},ue=e=>{const t=de((0,ne.Z)(e).toString());return(0,ce.Z)(t,"yyyy-MM-dd")===(0,ce.Z)(de((new Date).toString()),"yyyy-MM-dd")},pe=e=>{const t=new Date,r=(0,ne.Z)(e);return r.setDate(r.getDate()+6),s=r,t.setHours(0,0,0,0)>s.setHours(0,0,0,0);var s},he=e=>(0,le.Z)((0,ne.Z)(e),new Date);var me=r(29762);let ge=class{constructor(e,t,r){this.carbon=e,this.teamAdminStore=t,this.teamAdminService=r,this.getTeamTrialStatus=()=>(0,ie.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,L.U)((e=>{if(!e.isBillingOrFullAdmin)return(0,u.Rn)(new ae.$);const t={isFreeTrial:e.billing.isFreeTrial,isGracePeriod:e.billing.isGracePeriod,isFirstDayOfTrial:ue(e.creationDateUnix),isSecondStageOfTrial:pe(e.creationDateUnix),daysLeftInTrial:he(e.billing.nextBillingDetails.dateUnix),spaceTier:e.billing.planTier};return(0,u.Vp)(t)})))))),this.getTeamBillingDetails=()=>(0,x.a)([this.teamAdminStore.state$,this.getTeamSubscriptionInformation()]).pipe((0,L.U)((([e,t])=>{if(!e.isBillingOrFullAdmin)return(0,u.Rn)(new ae.$);const{billing:r,seats:s}=e,i={amount:r.nextBillingDetails.amount,currency:"usd"===r.nextBillingDetails.currency?F.F.USD:F.F.EUR,dateUnix:r.nextBillingDetails.dateUnix};return(0,u.Vp)({billingType:"invoice"===t?.billingInformation?.billingType?F.qo.Invoice:F.qo.ProcessOut,spaceTier:r.planTier,creditCardLastDigits:t?.billingInformation?.last4??null,lastBillingDateUnix:r.lastBillingDateUnix,nextBillingDetails:i,seatsNumber:s.paid+s.extraFree,usersToBeRenewedCount:r.usersToBeRenewedCount,daysLeftUntilNextBillingPeriod:he(r.nextBillingDetails.dateUnix),planDetails:r.planDetails})}))),this.getTeamCapabilities=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.capabilities):(0,u.Rn)(new ae.$)))),this.getTeamCreationDateUnix=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>"LOADED"!==e.loadingState?(0,u.Vp)(null):e.isBillingOrFullAdmin?(0,u.Vp)(e.creationDateUnix):(0,u.Rn)(new ae.$)))),this.getTeamSeats=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.seats):(0,u.Rn)(new ae.$)))),this.getTeamSecurityScore=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.securityScore):(0,u.Rn)(new ae.$)))),this.getIndustryBenchmarkData=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.industryBenchmarkData):(0,u.Rn)(new ae.$)))),this.getTeamName=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.teamName):(0,u.Rn)(new ae.$)))),this.getTeamRoles=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.teamRoles):(0,u.Rn)(new ae.$)))),this.getTeamActiveDirectoryInfo=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.settings.activeDirectoryInfo):(0,u.Rn)(new ae.$)))),this.getTeamDuoInfo=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.settings.duoInfo):(0,u.Rn)(new ae.$)))),this.getTeamSsoInfo=()=>this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.settings.ssoInfo):(0,u.Rn)(new ae.$)))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,L.U)((e=>{if(!(0,u.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,u.db)(e).b2bSubscription})))},this.getTeamPolicies=()=>(0,ie.P)((()=>(this.teamAdminService.refreshState(),this.teamAdminStore.state$.pipe((0,L.U)((e=>e.isBillingOrFullAdmin?(0,u.Vp)(e.policies):(0,u.Rn)(new ae.$)))))))}};ge=(0,s.__decorate)([(0,g.GS)(),(0,s.__metadata)("design:paramtypes",[G._,me.C,h.k])],ge);let ve=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getIndustryBenchmarkData())}};ve=(0,s.__decorate)([(0,re.e)(se.l),(0,s.__metadata)("design:paramtypes",[ge])],ve);var ye=r(98356);let _e=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return this.getTeamPlanDetailsService.getTeamActiveDirectoryInfo()}};_e=(0,s.__decorate)([(0,re.e)(ye.e),(0,s.__metadata)("design:paramtypes",[ge])],_e);var fe=r(26992);let Se=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamBillingDetails())}};Se=(0,s.__decorate)([(0,re.e)(fe._),(0,s.__metadata)("design:paramtypes",[ge])],Se);var Ee=r(9128);let be=class{constructor(e){this.planCancellationService=e}execute(){return this.planCancellationService.getZendeskCancellationTicket()}};be=(0,s.__decorate)([(0,re.e)(Ee.F),(0,s.__metadata)("design:paramtypes",[H])],be);var we=r(30525);let Ae=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamCapabilities())}};Ae=(0,s.__decorate)([(0,re.e)(we.Y),(0,s.__metadata)("design:paramtypes",[ge])],Ae);var Ce=r(89859);let Ie=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamCreationDateUnix())}};Ie=(0,s.__decorate)([(0,re.e)(Ce.T),(0,s.__metadata)("design:paramtypes",[ge])],Ie);var Te=r(73972);let Pe=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return this.getTeamPlanDetailsService.getTeamDuoInfo()}};Pe=(0,s.__decorate)([(0,re.e)(Te.Z),(0,s.__metadata)("design:paramtypes",[ge])],Pe);var Oe=r(19068);let Re=class{constructor(e){this.carbon=e}execute(){const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.spaceData.spaces"}).pipe((0,L.U)((e=>{if(!(0,u.d6)(e))throw new Error("Cannot retrieve user spaces");const t=e.data.find((e=>"accepted"===e.details.status));return t?{teamId:t.teamId}:{teamId:null}}))).pipe((0,L.U)(u.Vp))}};Re=(0,s.__decorate)([(0,re.e)(Oe.e),(0,s.__metadata)("design:paramtypes",[G._])],Re);var De=r(80926);let Ne=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamName())}};Ne=(0,s.__decorate)([(0,re.e)(De.j),(0,s.__metadata)("design:paramtypes",[ge])],Ne);var Ue=r(64380);let Fe=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamRoles())}};Fe=(0,s.__decorate)([(0,re.e)(Ue.R),(0,s.__metadata)("design:paramtypes",[ge])],Fe);var Me=r(65245);let Le=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamPolicies())}};Le=(0,s.__decorate)([(0,re.e)(Me.K),(0,s.__metadata)("design:paramtypes",[ge])],Le);var xe=r(704);let ke=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamSeats())}};ke=(0,s.__decorate)([(0,re.e)(xe.W),(0,s.__metadata)("design:paramtypes",[ge])],ke);var Ge=r(27056);let Ve=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamSecurityScore())}};Ve=(0,s.__decorate)([(0,re.e)(Ge.R),(0,s.__metadata)("design:paramtypes",[ge])],Ve);var Ke=r(26730);let je=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return this.getTeamPlanDetailsService.getTeamSsoInfo()}};je=(0,s.__decorate)([(0,re.e)(Ke.m),(0,s.__metadata)("design:paramtypes",[ge])],je);var Be=r(207);let We=class{constructor(e){this.getTeamPlanDetailsService=e}execute(){return(0,te.D)(this.getTeamPlanDetailsService.getTeamTrialStatus())}};We=(0,s.__decorate)([(0,re.e)(Be.P),(0,s.__metadata)("design:paramtypes",[ge])],We);var ze=r(43978),He=r(69885),Qe=r(61076),qe=r(75336),Ye=r(42645),$e=r(34623),Xe=r(7165);const Ze=Xe.z.object({isLoading:Xe.z.boolean(),isTeamCreator:Xe.z.boolean().optional()}),Je=e=>Ze.safeParse(e).success;class et extends((0,V.Q)({initialValue:{isLoading:!1},storeTypeGuard:Je,persist:!1,isCache:!0,scope:j.F.User,storeName:"team-creator-store",capacity:K.Y._010KB})){}let tt=class{constructor(e,t,r,s){this.carbon=e,this.getTeamMembersData=t,this.teamPlanDetailsClient=r,this.teamCreatorStore=s,this.getUserLogin=()=>{const{carbonState:e}=this.carbon.queries;return e({path:"state.userSession.account.login"}).pipe((0,L.U)((e=>{if((0,u.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")})))},this.getTeamId=()=>{const{getTeamId:e}=this.teamPlanDetailsClient.queries;return e().pipe((0,ze.w)((e=>(0,u.hx)(e)||!e.data.teamId||""===e.data.teamId?(0,He.of)(""):(0,He.of)(e.data.teamId))))},this.loadIsTeamCreator=()=>{this.teamCreatorStore.set({isLoading:!0});const e=this.getUserLogin();return this.getTeamId().pipe((0,L.U)((t=>{if(""!==t)return(0,m.z)(this.getTeamMembersData.get(t).pipe((0,Qe.V)(e),(0,L.U)((([e,t])=>{if((0,u.hx)(e))throw new Error("Error : could not retrieve team's members");const{data:r}=e,s=r.members.filter((e=>e.isTeamCaptain&&"accepted"===e.status)).sort(((e,t)=>(e.joinedDateUnix??0)-(t.joinedDateUnix??0)));this.teamCreatorStore.set({isTeamCreator:s[0]?.login===t,isLoading:!1})}))));this.teamCreatorStore.set({isTeamCreator:!1,isLoading:!1})})))}}execute(){return this.teamCreatorStore.state$.pipe((0,k.b)((e=>{e.isLoading||void 0!==e.isTeamCreator||(0,m.z)(this.loadIsTeamCreator())})),(0,L.U)((e=>(0,u.Vp)(e.isTeamCreator??null))))}};tt=(0,s.__decorate)([(0,re.e)(qe.G7),(0,s.__metadata)("design:paramtypes",[G._,$e.G,Ye.e,et])],tt);var rt=r(5237),st=r(68307);let it=class{constructor(e){this.teamAdminService=e}async handle(){await this.teamAdminService.refreshState()}};it=(0,s.__decorate)([(0,st.b)(rt.M),(0,s.__metadata)("design:paramtypes",[h.k])],it);var at=r(25043);let ot=class{constructor(e){this.teamAdminService=e}async handle(){await this.teamAdminService.refreshState()}};ot=(0,s.__decorate)([(0,st.b)(at.q),(0,s.__metadata)("design:paramtypes",[h.k])],ot);var nt=r(71607),ct=r(62263);let lt=class{};lt=(0,s.__decorate)([(0,i.Y)({api:o.o,imports:[a.n,ct.X],providers:[T,R,ge,h.k,nt.J,H],stores:[me.C,z,et],handlers:{commands:{addSeats:P,extendFreeTrial:D,requestTeamPlanCancellation:Q,editTeamName:Y,editTeamPolicies:Z,sendFeedback:ee},events:{...(0,i.g)(l.Q,{sessionOpened:it}),...(0,i.g)(n.L,{membersAdded:ot})},queries:{getIndustryBenchmarkData:ve,getTeamActiveDirectoryInfo:_e,getTeamBillingInformation:Se,getTeamCancellationStatus:be,getTeamCapabilities:Ae,getTeamCreationDateUnix:Ie,getTeamDuoInfo:Pe,getTeamId:Re,getTeamName:Ne,getTeamRoles:Fe,getTeamPolicies:Le,getTeamSeats:ke,getTeamSecurityScore:Ve,getTeamSsoInfo:je,getTeamTrialStatus:We,isTeamCreator:tt}},requiredFeatureFlips:Object.values({DashHackIndustryBenchmarkDev:"dashhack_web_securityScoreBenchmark"})})],lt)},94121:(e,t,r)=>{r.d(t,{k:()=>w});var s=r(88802),i=r(60399),a=r(87065),o=r(82567),n=r(57924),c=r(87113),l=r(87279),d=r(71607),u=r(81598);const p=e=>{switch(e){case"legacy":default:return u.lD.Legacy;case"starter":return u.lD.Starter;case"team":return u.lD.Team;case"business":return u.lD.Business;case"entreprise":return u.lD.Enterprise}},h=e=>{switch(e){case"in_team":return u.yt.InTeam;case"not_premium":return u.yt.NotPremium;case"no_payment":return u.yt.NoPayment;case"is_unpaid_family_member":return u.yt.IsUnpaidFamilyMember;case"default_settings":default:return u.yt.DefaultSettings;case"no_vpn_capability":return u.yt.NoVPNCapability;case"disabled_for_free_user":return u.yt.DisabledForFreeUser}};var m=r(79156);const g=e=>{const{enabled:t,info:r}=e;let s;return r&&(s={limit:r.limit??void 0,maxFileSize:r.maxFileSize??void 0,quota:r.quota??void 0,reason:r.reason?h(r.reason):void 0,excludedPolicies:r.excludedPolicies??void 0}),{enabled:t,info:s}},v=e=>{const{activeDirectorySync:t,activityLog:r,phoneSupport:s,samlProvisioning:i,scim:a,sso:o,usageReports:n,adminPolicies:c,groupSharing:l}=e;return{activeDirectorySync:g(t),activityLog:g(r),phoneSupport:g(s),samlProvisioning:g(i),scim:g(a),sso:g(o),usageReports:g(n),adminPolicies:g(c),groupSharing:g(l)}},y=(e,t)=>({...e,planTier:p(t)}),_=e=>new Set(Object.keys(e)),f=(e,t)=>({activeDirectoryInfo:{activeDirectorySyncType:e.activeDirectorySyncType,activeDirectoryToken:e.activeDirectoryToken,activeDirectorySyncStatus:t},duoInfo:{duo:e.duo,duoApiHostname:e.duoApiHostname,duoIntegrationKey:e.duoIntegrationKey,duoSecretKey:e.duoSecretKey,recoveryEnabled:e.recoveryEnabled},ssoInfo:{ssoServiceProviderUrl:e.ssoServiceProviderUrl,ssoIdpMetadata:e.ssoIdpMetadata,ssoIdpEntrypoint:e.ssoIdpEntrypoint}}),S=(e,t)=>{if(!t||!e)return null;const{averageSecurityScore:r,top25Percentile:s}=t;return{averageSecurityScore:r,top25Percentile:s,ratingVSIndustry:e>r?"higher":e<r?"lower":"onPar",deltaVSIndustry:Math.abs(e-r)}};var E=r(29762);let b=null,w=class{constructor(e,t,r){this.serverApiClient=e,this.isUserTeamAdminService=t,this.teamAdminStore=r,this.MIN_DELAY_BETWEEN_REFRESHES=500}async refresh(e){this.teamAdminStore.set({...e,loadingState:"LOADING",lastRefreshDate:Date.now()});const t=await(0,i.z)(this.serverApiClient.v1.teams.getDirectorySyncToken({}).pipe((0,a.U)((e=>{if(!(0,l.hx)(e))return e.data.data.activeDirectorySyncStatus})))),r=await(0,i.z)(this.serverApiClient.v1.teams.teamStatus({}).pipe((0,a.U)((e=>(0,l.hx)(e)?{isBillingOrFullAdmin:!1}:((e,t)=>{const{securityScore:r,industryBenchmarkData:s,creationDateUnix:i,billing:a,capabilities:o,seats:n,planTier:c,info:l}=e,{name:d,groupManagers:u,teamCaptains:p}=l;return{isBillingOrFullAdmin:!0,creationDateUnix:i,loadingState:"LOADED",teamName:d,securityScore:r,industryBenchmarkData:S(r,s),seats:n,capabilities:v(o),billing:y(a,c),teamRoles:{groupManagersIds:u,teamCaptainsIds:_(p)},lastRefreshDate:Date.now(),policies:(0,m.O)(l,o),settings:f(l,t)}})(e.data.data,t))),(0,o.b)((e=>{this.teamAdminStore.set(e)}))));return b=null,r}async refreshState(){if(!await this.isUserTeamAdminService.isUserTeamAdmin())return void this.teamAdminStore.set({isBillingOrFullAdmin:!1,loadingState:"LOADED",lastRefreshDate:0});const e=await this.teamAdminStore.getState();return e.isBillingOrFullAdmin&&e.lastRefreshDate+this.MIN_DELAY_BETWEEN_REFRESHES>Date.now()?void 0:(b||(b=this.refresh(e)),await b)}};w=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[c.l,d.J,E.C])],w)},29762:(e,t,r)=>{r.d(t,{C:()=>S});var s=r(95681),i=r(23347),a=r(25029),o=r(7165),n=r(81598);const c=o.z.union([o.z.object({reason:o.z.union([o.z.custom(),o.z.undefined()]),quota:o.z.union([o.z.object({max:o.z.union([o.z.number(),o.z.undefined()]),remaining:o.z.union([o.z.number(),o.z.undefined()])}),o.z.undefined()]),maxFileSize:o.z.union([o.z.number(),o.z.undefined()]),limit:o.z.union([o.z.number(),o.z.undefined()]),excludedPolicies:o.z.union([o.z.array(o.z.string()),o.z.undefined()])}),o.z.undefined()]),l=o.z.object({paid:o.z.number(),extraFree:o.z.number(),remaining:o.z.number()}),d=o.z.object({billingMethod:o.z.union([o.z.custom(),o.z.undefined()]),creditCardLastDigits:o.z.union([o.z.string(),o.z.undefined()]),isFreeTrial:o.z.boolean(),isGracePeriod:o.z.boolean(),planTier:o.z.custom(),lastBillingDateUnix:o.z.number(),nextBillingDetails:o.z.object({amount:o.z.number(),currency:o.z.union([o.z.literal("eur"),o.z.literal("usd")]),dateUnix:o.z.number()}),usersToBeRenewedCount:o.z.number(),planDetails:o.z.object({currency:o.z.union([o.z.literal("eur"),o.z.literal("usd")]),priceRanges:o.z.array(o.z.object({startMembers:o.z.number(),price:o.z.number(),equivalentPrice:o.z.number()}))})}),u=o.z.object({enabled:o.z.boolean(),info:c}),p=o.z.object({samlProvisioning:u,sso:u,scim:u,phoneSupport:u,activeDirectorySync:u,activityLog:u,usageReports:u,adminPolicies:u,groupSharing:u}),h=o.z.object({lastSuccessfulSync:o.z.union([o.z.object({id:o.z.number(),teamId:o.z.number(),status:o.z.string(),proposedCount:o.z.union([o.z.number(),o.z.undefined()]),reproposedCount:o.z.union([o.z.number(),o.z.undefined()]),unproposedCount:o.z.union([o.z.number(),o.z.undefined()]),removedCount:o.z.union([o.z.number(),o.z.undefined()]),validCount:o.z.union([o.z.number(),o.z.undefined()]),durationMs:o.z.number(),eventDateUnix:o.z.number()}),o.z.null()]),lastFailedSync:o.z.union([o.z.object({id:o.z.number(),teamId:o.z.number(),status:o.z.string(),error:o.z.union([o.z.string(),o.z.undefined()]),durationMs:o.z.number(),eventDateUnix:o.z.number()}),o.z.null(),o.z.undefined()]),failedSyncCount:o.z.union([o.z.number(),o.z.undefined()])}),m=o.z.object({activeDirectoryInfo:o.z.object({activeDirectorySyncType:o.z.union([o.z.string(),o.z.undefined()]),activeDirectoryToken:o.z.union([o.z.string(),o.z.undefined()]),activeDirectorySyncStatus:o.z.union([h,o.z.undefined()])}),duoInfo:o.z.object({duo:o.z.union([o.z.boolean(),o.z.undefined()]),duoApiHostname:o.z.union([o.z.string(),o.z.undefined()]),duoIntegrationKey:o.z.union([o.z.string(),o.z.undefined()]),duoSecretKey:o.z.union([o.z.string(),o.z.undefined()]),recoveryEnabled:o.z.union([o.z.boolean(),o.z.undefined()])}),ssoInfo:o.z.object({ssoServiceProviderUrl:o.z.string().nullable(),ssoIdpMetadata:o.z.string().nullable(),ssoIdpEntrypoint:o.z.string().nullable()})}),g=o.z.enum(["NOT_LOADED","LOADING","LOADED"]),v=o.z.object({isBillingOrFullAdmin:o.z.literal(!0),loadingState:g,lastRefreshDate:o.z.number(),billing:d,seats:l,capabilities:p,securityScore:o.z.number().nullable(),industryBenchmarkData:o.z.custom().nullable(),creationDateUnix:o.z.number(),teamName:o.z.string(),teamRoles:o.z.object({groupManagersIds:o.z.array(o.z.number()),teamCaptainsIds:o.z.set(o.z.string())}),policies:n.ym,settings:m}),y=o.z.object({isBillingOrFullAdmin:o.z.literal(!1),loadingState:g,lastRefreshDate:o.z.number()}),_=o.z.discriminatedUnion("isBillingOrFullAdmin",[v,y]),f=e=>_.safeParse(e).success;class S extends((0,s.Q)({initialValue:{isBillingOrFullAdmin:!1,lastRefreshDate:0,loadingState:"NOT_LOADED"},storeTypeGuard:f,persist:!1,isCache:!0,scope:a.F.User,storeName:"team-admin-store",capacity:i.Y._010KB})){}},79281:(e,t,r)=>{r.d(t,{c:()=>O});var s=r(88802),i=r(99634),a=r(93850),o=r(41216);var n,c=r(63663),l=r(15678),d=r(60399),u=r(57924),p=r(87113);!function(e){e.PaymentMeanIsNotCreditCard="PaymentMeanIsNotCreditCard",e.CurrentPlanStartDateInFuture="CurrentPlanStartDateInFuture",e.ChangeTierMidCycleError="ChangeTierMidCycleError",e.PaymentMeanIsNotInvoice="PaymentMeanIsNotInvoice",e.ChangeTierAmountTooExpensive="ChangeTierAmountTooExpensive",e.ErrorCalculatingTierChange="ErrorCalculatingTierChange",e.InsufficientAmount="InsufficientAmount",e.AssignedPlanSameTierAsCurrentPlan="AssignedPlanSameTierAsCurrentPlan",e.SalesTaxMismatch="SalesTaxMismatch",e.NotBillingAdmin="NotBillingAdmin",e.ChangeTierMidCycleInternalServer="ChangeTierMidCycleInternalServer"}(n||(n={}));var h=r(48844),m=r(18533),g=r(20195),v=r(87279);let y=class{constructor(e){this.serverApiClient=e,this.getFunctionalError=e=>{switch(e){case"PAYMENT_MEAN_IS_NOT_CREDITCARD":return{tag:n.PaymentMeanIsNotCreditCard};case"CURRENT_PLAN_START_DATE_IN_FUTURE":return{tag:n.CurrentPlanStartDateInFuture};case"CHANGE_TIER_MID_CYCLE_ERROR":return{tag:n.ChangeTierMidCycleError};case"PAYMENT_MEAN_IS_NOT_INVOICE":return{tag:n.PaymentMeanIsNotInvoice};case"CHANGE_TIER_AMOUNT_TOO_EXPENSIVE":return{tag:n.ChangeTierAmountTooExpensive};case"ERROR_CALCULATING_TIER_CHANGE_DISCOUNT":return{tag:n.ErrorCalculatingTierChange};case"INSUFFICIENT_AMOUNT":return{tag:n.InsufficientAmount};case"ASSIGNED_PLAN_SAME_TIER_AS_CURRENT_PLAN":return{tag:n.AssignedPlanSameTierAsCurrentPlan};case"sales_tax_mismatch":return{tag:n.SalesTaxMismatch};case"not_billing_admin":return{tag:n.NotBillingAdmin};default:throw new Error(`ChangeTierMidCycle: error ${e}`)}}}changeTierMidcycle({amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:i,billingContactEmail:a}){return(0,d.z)(this.serverApiClient.v1.teams.changeTierMidCycleV2({amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:i,billingContactEmail:a}).pipe((0,h.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:g.j,BadStatus:g.j,InternalServerError:()=>({tag:n.ChangeTierMidCycleInternalServer}),InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,h.Qn)((e=>e.data))))}legacyChangeTierMidcycle({amountToPay:e,taxes:t,planId:r,couponCode:s,seatsToAdd:i,billingContactEmail:a}){return(0,d.z)(this.serverApiClient.v1.teams.changeTierMidCycle({amountToPay:e,taxes:t,planId:r,couponCode:s,seatsToAdd:i,billingContactEmail:a}).pipe((0,h.DZ)((e=>(0,m.EQ)(e,{BusinessError:e=>this.getFunctionalError(e.code),FetchFailedError:g.j,BadStatus:g.j,InternalServerError:()=>({tag:n.ChangeTierMidCycleInternalServer}),InvalidRequest:g.j,RateLimited:g.j,ServiceUnavailable:g.j,UnspecifiedBadStatus:g.j}))),(0,h.Qn)((e=>e.data))))}getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}){return(0,d.z)(this.serverApiClient.v1.teams.getMidCycleTierUpgradePriceV2({newTotalNumberOfSeats:e,newPlan:t}).pipe((0,h.DZ)((e=>(0,v.Rn)({tag:`MidcycleTierUpgradePriceFailed: ${e.message}`}))),(0,h.Qn)((e=>e.data))))}getLegacyMidcycleTierUpgradePrice({numberOfSeats:e,newPlan:t}){return(0,d.z)(this.serverApiClient.v1.teams.getMidCycleTierUpgradePrice({numberOfSeats:e,newPlan:t}).pipe((0,h.DZ)((e=>(0,v.Rn)({tag:`LegacyMidcycleTierUpgradePriceFailed: ${e.message}`}))),(0,h.Qn)((e=>e.data))))}};y=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[p.l])],y);let _=class{constructor(e){this.midcycleTierService=e}execute({body:{amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:i,billingContactEmail:a}}){return this.midcycleTierService.changeTierMidcycle({amountToPay:e,taxes:t,planId:r,couponCode:s,newTotalNumberOfSeats:i,billingContactEmail:a})}};_=(0,s.__decorate)([(0,c.W)(l.G),(0,s.__metadata)("design:paramtypes",[y])],_);var f=r(31911);let S=class{constructor(e){this.midcycleTierService=e}execute({body:{amountToPay:e,taxes:t,planId:r,couponCode:s,seatsToAdd:i,billingContactEmail:a}}){return this.midcycleTierService.legacyChangeTierMidcycle({amountToPay:e,taxes:t,planId:r,couponCode:s,seatsToAdd:i,billingContactEmail:a})}};S=(0,s.__decorate)([(0,c.W)(f.R),(0,s.__metadata)("design:paramtypes",[y])],S);var E=r(20754),b=r(35313);let w=class{constructor(e){this.serverApiClient=e}execute({body:{couponCode:e}}){return this.serverApiClient.v1.teams.getTeamOffers({couponCode:e,withStarterOffer:!0}).pipe((0,h.Qn)((e=>e.data)),(0,h.DZ)((e=>{throw new Error(e.message)})))}};w=(0,s.__decorate)([(0,E.e)(b.g),(0,s.__metadata)("design:paramtypes",[p.l])],w);var A=r(162),C=r(35642);let I=class{constructor(e){this.midcycleTierService=e}execute({body:{numberOfSeats:e,newPlan:t}}){return(0,A.D)(this.midcycleTierService.getLegacyMidcycleTierUpgradePrice({numberOfSeats:e,newPlan:t}))}};I=(0,s.__decorate)([(0,E.e)(C.t),(0,s.__metadata)("design:paramtypes",[y])],I);var T=r(80204);let P=class{constructor(e){this.midcycleTierService=e}execute({body:{newTotalNumberOfSeats:e,newPlan:t}}){return(0,A.D)(this.midcycleTierService.getMidcycleTierUpgradePrice({newTotalNumberOfSeats:e,newPlan:t}))}};P=(0,s.__decorate)([(0,E.e)(T.X),(0,s.__metadata)("design:paramtypes",[y])],P);let O=class{};O=(0,s.__decorate)([(0,i.Y)({api:o.K,imports:[a.n],providers:[y],handlers:{commands:{changeTierMidcycle:_,legacyChangeTierMidcycle:S},events:{},queries:{getTeamOffers:w,getLegacyMidcycleTierUpgradePrice:I,getMidcycleTierUpgradePrice:P}},requiredFeatureFlips:["monetization_extension_policies_repackage","monetization_extension_policies_revert_notice",...Object.values({EcommerceWebReduceSeatsDev:"ecommerce_web_seat_reduction_frontend_dev",EcommerceWebReduceSeatsProd:"ecommerce_web_seat_reduction_frontend_prod2"})]})],O)},27927:(e,t,r)=>{r.d(t,{K:()=>T});var s=r(88802),i=r(99634),a=r(93850),o=r(1701),n=r(63663),c=r(57220),l=r(87065),d=r(60399),u=r(85390),p=r(6220),h=r(57924),m=r(87113),g=r(48844),v=r(87279),y=r(70302),_=r(15961),f=r(56333),S=r(86252);let E=class{constructor(e,t){this.serverApiClient=e,this.carbon=t,this.getTaxAmount=e=>this.getExpectedTaxInformation(e).pipe((0,g.DZ)((e=>{if("BusinessError"===e.tag)return new y.A;throw new Error(e.message)})),(0,g.lk)((e=>(0,v.Vp)({amount:e.data.expectedTaxesInCents})))),this.getUserLogin=()=>this.carbon.queries.getUserLogin().pipe((0,l.U)((e=>{if((0,v.d6)(e)&&"string"==typeof e.data)return e.data;throw new Error("No active login")}))),this.getTeamSubscriptionInformation=()=>{const{getSubscriptionInformation:e}=this.carbon.queries;return e().pipe((0,l.U)((e=>{if(!(0,v.d6)(e))throw new Error("Cannot retrieve subscription information from Carbon");return(0,v.db)(e).b2bSubscription})))}}async deleteTeamVat(){return await(0,d.z)(this.serverApiClient.v1.teams.deleteTeamVat().pipe((0,g.DZ)((e=>{if("BusinessError"===e.tag)return(0,c.zK)(e.code);throw new Error(e.message)})))),(0,v.Vp)(void 0)}getTeamVat(){return this.serverApiClient.v1.teams.getTeamVat().pipe((0,g.DZ)((e=>{if("BusinessError"===e.tag)return(0,_.K$)(e.code);throw new Error(e.message)})),(0,g.lk)((e=>(0,v.Vp)(e.data.vatNumber))))}async upsertTeamVat({newVATNumber:e}){return await(0,d.z)(this.serverApiClient.v1.teams.upsertTeamVat({newVATNumber:e}).pipe((0,g.DZ)((e=>{if("BusinessError"===e.tag)return(0,f.q5)(e.code);throw new Error(e.message)})),(0,g.lk)((e=>(0,v.Vp)(e.data)))))}getExpectedTaxInformation(e){return(0,u.a)([this.getTeamSubscriptionInformation(),this.getUserLogin()]).pipe((0,p.z)((([t,r])=>{if(!t?.billingInformation)throw new Error("Could not retrieve subscription information");const{country:s,address_zip:i}=t.billingInformation;return this.serverApiClient.v1.payments.getExpectedTaxInformation({login:r,zipCode:i??"",country:s??"",taxOrigin:"team",priceInCents:e})})))}};E=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[m.l,S._])],E);let b=class{constructor(e){this.teamVatService=e}execute(){return this.teamVatService.deleteTeamVat()}};b=(0,s.__decorate)([(0,n.W)(c.Hy),(0,s.__metadata)("design:paramtypes",[E])],b);let w=class{constructor(e){this.teamVatService=e}async execute({body:{newVATNumber:e}}){return await this.teamVatService.upsertTeamVat({newVATNumber:e}),(0,v.Vp)(void 0)}};w=(0,s.__decorate)([(0,n.W)(f.XW),(0,s.__metadata)("design:paramtypes",[E])],w);var A=r(20754);let C=class{constructor(e){this.teamVatService=e}execute(){return this.teamVatService.getTeamVat()}};C=(0,s.__decorate)([(0,A.e)(_.N7),(0,s.__metadata)("design:paramtypes",[E])],C);let I=class{constructor(e){this.teamVatService=e}execute({body:e}){const{totalPrice:t}=e;return this.teamVatService.getTaxAmount(t)}};I=(0,s.__decorate)([(0,A.e)(y.B),(0,s.__metadata)("design:paramtypes",[E])],I);let T=class{};T=(0,s.__decorate)([(0,i.Y)({api:o.a,imports:[a.n],providers:[E],handlers:{commands:{deleteTeamVat:b,upsertTeamVat:w},events:{},queries:{getTeamVat:C,getTaxAmount:I}}})],T)},89885:(e,t,r)=>{r.r(t),r.d(t,{CanUserAddNewPasswordQuery:()=>j.K,CollectionsQuery:()=>L.I,Country:()=>_.c,CreateCollectionCommand:()=>F.e,CreateVaultItemCommand:()=>a._,CreatedEvent:()=>l.J,CredentialSchema:()=>E,DeleteCollectionCommand:()=>U.T,DeleteVaultItemsCommand:()=>o.c,DeletedEvent:()=>d.s,DomainIconDetailsMapSchema:()=>f.x,DomainIconDetailsQuery:()=>p.s,DomainIconDetailsSchema:()=>f.N,EmailType:()=>b,EmitTemporaryVaultItemEventCommand:()=>c.c,EventType:()=>c.t,FilterOperators:()=>h.l,GetPasswordLimitStatusQuery:()=>B.r,GetVaultNotificationsStatusQuery:()=>D.M,IdentityTitle:()=>A.t,IsFreeUserFrozenQuery:()=>W.k,NoteColors:()=>I.L,OperationType:()=>M.C,PASSWORD_LIMIT_FEATURE_FLIPS:()=>z.t,PaymentCardColorType:()=>w.X,PhoneType:()=>C.z,RichIconsEnabledQuery:()=>y.M,SecureNoteCategoryQuery:()=>m.F,SecureNoteSchema:()=>I._,SetVaultNotificationsStatusCommand:()=>R.x,SortDirection:()=>g.S,UpdateCollectionCommand:()=>M.s,UpdateVaultItemCommand:()=>n.K,UpdatedEvent:()=>u.V,VaultItemType:()=>T.U,VaultItemTypeToResultDictionary:()=>P.N,VaultItemsCrudClient:()=>i.L,VaultItemsQuery:()=>v.W,VaultOrganizationClient:()=>x.C,VaultSearchClient:()=>G.T,VaultSearchQuery:()=>V.W,passwordLimitApi:()=>K.Z,vaultItemsCrudApi:()=>s.L,vaultNotificationsApi:()=>O.e,vaultOrganizationApi:()=>N.v,vaultSearchApi:()=>k.R});var s=r(48430),i=r(61199),a=r(273),o=r(31154),n=r(54547),c=r(47412),l=r(3137),d=r(49135),u=r(72989),p=r(55713),h=r(9531),m=r(83984),g=r(24652),v=r(96342),y=r(20517),_=r(75257),f=r(19074),S=r(7165);const E=S.z.object({alternativeUsername:S.z.string(),email:S.z.string(),itemName:S.z.string(),password:S.z.string(),username:S.z.string(),URL:S.z.string(),linkedURLs:S.z.array(S.z.string())});var b,w=r(45146);!function(e){e.Perso="PERSO",e.Pro="PRO",e.NoType="NO_TYPE"}(b||(b={}));var A=r(11329),C=r(82009),I=r(7149),T=r(82706),P=r(64035),O=r(22499),R=r(12338),D=r(19892),N=r(99074),U=r(25041),F=r(533),M=r(96862),L=r(6519),x=r(87969),k=r(73883),G=r(72965),V=r(88994),K=r(52484),j=r(63197),B=r(58684),W=r(96440),z=r(15183)},52484:(e,t,r)=>{r.d(t,{Z:()=>n});var s=r(86952),i=r(63197),a=r(58684),o=r(96440);const n=(0,s.Q)({name:"passwordLimit",commands:{},events:{},queries:{canUserAddNewPassword:i.K,getPasswordLimitStatus:a.r,isFreeUserFrozen:o.k}})},15183:(e,t,r)=>{r.d(t,{t:()=>s});const s={B2CRestrictPasswordFreePlan:"b2c_web_restrict_password_free_plan_dev",B2CFreeUserFrozenState:"b2c_web_free_users_frozen_state"}},63197:(e,t,r)=>{r.d(t,{K:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},58684:(e,t,r)=>{r.d(t,{r:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},96440:(e,t,r)=>{r.d(t,{k:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},48430:(e,t,r)=>{r.d(t,{L:()=>g});var s=r(86952),i=r(273),a=r(31154),o=r(54547),n=r(47412),c=r(3137),l=r(49135),d=r(72989),u=r(55713),p=r(96342),h=r(83984),m=r(20517);const g=(0,s.Q)({name:"vaultItemsCrud",commands:{createVaultItem:i._,deleteVaultItems:a.c,updateVaultItem:o.K,emitTemporaryVaultItemEvent:n.c},events:{createdEvent:c.J,deletedEvent:l.s,updatedEvent:d.V},queries:{domainIconDetails:u.s,query:p.W,secureNoteCategory:h.F,richIconsEnabled:m.M}})},61199:(e,t,r)=>{r.d(t,{L:()=>a});var s=r(67837),i=r(48430);class a extends((0,s.E)(i.L)){}(0,s.K)(i.L,a)},273:(e,t,r)=>{r.d(t,{_:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},31154:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},47412:(e,t,r)=>{r.d(t,{c:()=>o,t:()=>s});var s,i=r(74354),a=r(25029);!function(e){e.Deleted="deleted",e.Updated="updated",e.Created="created"}(s||(s={}));class o extends((0,i.g)({scope:a.F.User})){}},54547:(e,t,r)=>{r.d(t,{K:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},77649:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(88885),i=r(25029);class a extends((0,s.d)({scope:i.F.User})){}},3137:(e,t,r)=>{r.d(t,{J:()=>i});var s=r(77649);class i extends s.D{}},49135:(e,t,r)=>{r.d(t,{s:()=>i});var s=r(77649);class i extends s.D{}},72989:(e,t,r)=>{r.d(t,{V:()=>i});var s=r(77649);class i extends s.D{}},55713:(e,t,r)=>{r.d(t,{s:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},9531:(e,t,r)=>{var s;r.d(t,{l:()=>s}),function(e){e.Equal="equal",e.LessThan="lessThan",e.GreaterThan="greaterThan"}(s||(s={}))},20517:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},83984:(e,t,r)=>{r.d(t,{F:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},24652:(e,t,r)=>{var s;r.d(t,{S:()=>s}),function(e){e.Ascend="ascend",e.Descend="descend"}(s||(s={}))},96342:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},75257:(e,t,r)=>{var s;r.d(t,{c:()=>s}),function(e){e.NO_TYPE="NO_TYPE",e.UNIVERSAL="UNIVERSAL",e.AD="AD",e.AE="AE",e.AF="AF",e.AG="AG",e.AI="AI",e.AL="AL",e.AM="AM",e.AO="AO",e.AQ="AQ",e.AR="AR",e.AS="AS",e.AT="AT",e.AU="AU",e.AW="AW",e.AX="AX",e.AZ="AZ",e.BA="BA",e.BB="BB",e.BD="BD",e.BE="BE",e.BF="BF",e.BG="BG",e.BH="BH",e.BI="BI",e.BJ="BJ",e.BL="BL",e.BM="BM",e.BN="BN",e.BO="BO",e.BR="BR",e.BS="BS",e.BT="BT",e.BV="BV",e.BW="BW",e.BY="BY",e.BZ="BZ",e.CA="CA",e.CC="CC",e.CD="CD",e.CF="CF",e.CG="CG",e.CH="CH",e.CI="CI",e.CK="CK",e.CL="CL",e.CM="CM",e.CN="CN",e.CO="CO",e.CR="CR",e.CU="CU",e.CV="CV",e.CX="CX",e.CY="CY",e.CZ="CZ",e.DE="DE",e.DJ="DJ",e.DK="DK",e.DM="DM",e.DO="DO",e.DZ="DZ",e.EC="EC",e.EE="EE",e.EG="EG",e.EH="EH",e.ER="ER",e.ES="ES",e.ET="ET",e.FI="FI",e.FJ="FJ",e.FK="FK",e.FM="FM",e.FO="FO",e.FR="FR",e.GA="GA",e.GB="GB",e.GD="GD",e.GE="GE",e.GF="GF",e.GG="GG",e.GH="GH",e.GI="GI",e.GL="GL",e.GM="GM",e.GN="GN",e.GP="GP",e.GQ="GQ",e.GR="GR",e.GS="GS",e.GT="GT",e.GU="GU",e.GW="GW",e.GY="GY",e.HK="HK",e.HM="HM",e.HN="HN",e.HR="HR",e.HT="HT",e.HU="HU",e.ID="ID",e.IE="IE",e.IL="IL",e.IM="IM",e.IN="IN",e.IO="IO",e.IQ="IQ",e.IR="IR",e.IS="IS",e.IT="IT",e.JE="JE",e.JM="JM",e.JO="JO",e.JP="JP",e.KE="KE",e.KG="KG",e.KH="KH",e.KI="KI",e.KM="KM",e.KN="KN",e.KP="KP",e.KR="KR",e.KW="KW",e.KY="KY",e.KZ="KZ",e.LA="LA",e.LB="LB",e.LC="LC",e.LI="LI",e.LK="LK",e.LR="LR",e.LS="LS",e.LT="LT",e.LU="LU",e.LV="LV",e.LY="LY",e.MA="MA",e.MC="MC",e.MD="MD",e.ME="ME",e.MF="MF",e.MG="MG",e.MH="MH",e.MK="MK",e.ML="ML",e.MM="MM",e.MN="MN",e.MO="MO",e.MP="MP",e.MQ="MQ",e.MR="MR",e.MS="MS",e.MT="MT",e.MU="MU",e.MV="MV",e.MW="MW",e.MX="MX",e.MY="MY",e.MZ="MZ",e.NA="NA",e.NC="NC",e.NE="NE",e.NF="NF",e.NG="NG",e.NI="NI",e.NL="NL",e.NO="NO",e.NP="NP",e.NR="NR",e.NU="NU",e.NZ="NZ",e.OM="OM",e.PA="PA",e.PE="PE",e.PF="PF",e.PG="PG",e.PH="PH",e.PK="PK",e.PL="PL",e.PM="PM",e.PN="PN",e.PR="PR",e.PS="PS",e.PT="PT",e.PW="PW",e.PY="PY",e.QA="QA",e.RE="RE",e.RO="RO",e.RS="RS",e.RU="RU",e.RW="RW",e.SA="SA",e.SB="SB",e.SC="SC",e.SD="SD",e.SE="SE",e.SG="SG",e.SH="SH",e.SI="SI",e.SJ="SJ",e.SK="SK",e.SL="SL",e.SM="SM",e.SN="SN",e.SO="SO",e.SR="SR",e.ST="ST",e.SV="SV",e.SY="SY",e.SZ="SZ",e.TC="TC",e.TD="TD",e.TF="TF",e.TG="TG",e.TH="TH",e.TJ="TJ",e.TK="TK",e.TL="TL",e.TM="TM",e.TN="TN",e.TO="TO",e.TR="TR",e.TT="TT",e.TV="TV",e.TW="TW",e.TZ="TZ",e.UA="UA",e.UG="UG",e.UM="UM",e.US="US",e.UY="UY",e.UZ="UZ",e.VA="VA",e.VC="VC",e.VE="VE",e.VG="VG",e.VI="VI",e.VN="VN",e.VU="VU",e.WF="WF",e.WS="WS",e.XK="XK",e.YE="YE",e.YT="YT",e.ZA="ZA",e.ZM="ZM",e.ZW="ZW"}(s||(s={}))},19074:(e,t,r)=>{r.d(t,{N:()=>o,x:()=>n});var s=r(7165);const i=["crawled","xs","sm","sm@2x","md","md.tiff","xmd","xmd@2x","l","l@2x","xl","xl@2x","46x30","46x30@2x","50x33","50x33@2x","56x56","56x56@2x","118x98","118x98@2x","160x106","160x106@2x"],a=(s.z.enum(i),i.reduce(((e,t)=>e.setKey(t,s.z.string().optional().nullable())),s.z.object({}))),o=s.z.object({backgroundColor:s.z.string(),mainColor:s.z.string(),urls:a}),n=s.z.map(s.z.string(),o)},45146:(e,t,r)=>{var s;r.d(t,{X:()=>s}),function(e){e.Black="BLACK",e.Blue1="BLUE1",e.Blue2="BLUE2",e.Gold="GOLD",e.Green1="GREEN1",e.Green2="GREEN2",e.Orange="ORANGE",e.Red="RED",e.Silver="SILVER",e.White="WHITE"}(s||(s={}))},11329:(e,t,r)=>{var s;r.d(t,{t:()=>s}),function(e){e.Mr="MR",e.Mrs="MRS",e.Miss="MISS",e.Ms="MS",e.Mx="MX",e.NoneOfThese="NONEOFTHESE"}(s||(s={}))},82009:(e,t,r)=>{var s;r.d(t,{z:()=>s}),function(e){e.Any="ANY",e.Fax="FAX",e.Landline="LANDLINE",e.Mobile="MOBILE",e.WorkFax="WORKFAX",e.WorkLandline="WORKLANDLINE",e.WorkMobile="WORKMOBILE"}(s||(s={}))},7149:(e,t,r)=>{r.d(t,{L:()=>s,_:()=>a});var s,i=r(7165);!function(e){e.BLUE="BLUE",e.BROWN="BROWN",e.GRAY="GRAY",e.GREEN="GREEN",e.ORANGE="ORANGE",e.PINK="PINK",e.PURPLE="PURPLE",e.RED="RED",e.YELLOW="YELLOW"}(s||(s={}));const a=i.z.object({color:i.z.string(),isSecured:i.z.boolean(),title:i.z.string(),content:i.z.string(),categoryId:i.z.string()})},82706:(e,t,r)=>{var s;r.d(t,{U:()=>s}),function(e){e.Address="KWAddress",e.BankAccount="KWBankStatement",e.Company="KWCompany",e.Credential="KWAuthentifiant",e.DriversLicense="KWDriverLicence",e.Email="KWEmail",e.FiscalId="KWFiscalStatement",e.IdCard="KWIDCard",e.Identity="KWIdentity",e.Passkey="KWPasskey",e.Passport="KWPassport",e.PaymentCard="KWPaymentMean_creditCard",e.Phone="KWPhone",e.Secret="KWSecret",e.SecureNote="KWSecureNote",e.SocialSecurityId="KWSocialSecurityStatement",e.Website="KWPersonalWebsite"}(s||(s={}))},64035:(e,t,r)=>{r.d(t,{N:()=>i});var s=r(82706);const i={[s.U.Address]:"addressesResult",[s.U.BankAccount]:"bankAccountsResult",[s.U.Company]:"companiesResult",[s.U.Credential]:"credentialsResult",[s.U.DriversLicense]:"driversLicensesResult",[s.U.Email]:"emailsResult",[s.U.FiscalId]:"fiscalIdsResult",[s.U.IdCard]:"idCardsResult",[s.U.Identity]:"identitiesResult",[s.U.Passkey]:"passkeysResult",[s.U.Passport]:"passportsResult",[s.U.PaymentCard]:"paymentCardsResult",[s.U.Phone]:"phonesResult",[s.U.Secret]:"secretsResult",[s.U.SecureNote]:"secureNotesResult",[s.U.SocialSecurityId]:"socialSecurityIdsResult",[s.U.Website]:"websitesResult"}},22499:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(86952),i=r(12338),a=r(19892);const o=(0,s.Q)({name:"vaultNotifications",commands:{setVaultNotificationsStatus:i.x},events:{},queries:{getVaultNotificationsStatus:a.M}})},12338:(e,t,r)=>{r.d(t,{x:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},19892:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},99074:(e,t,r)=>{r.d(t,{v:()=>c});var s=r(86952),i=r(25041),a=r(533),o=r(96862),n=r(6519);const c=(0,s.Q)({name:"vaultOrganization",commands:{deleteCollection:i.T,createCollection:a.e,updateCollection:o.s},events:{},queries:{queryCollections:n.I}})},533:(e,t,r)=>{r.d(t,{e:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},25041:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},96862:(e,t,r)=>{r.d(t,{C:()=>s,s:()=>o});var s,i=r(74354),a=r(25029);!function(e){e.SUBSTRACT_VAULT_ITEMS="subtract_vault_items",e.APPEND_VAULT_ITEMS="append_vault_items"}(s||(s={}));class o extends((0,i.g)({scope:a.F.User})){}},6519:(e,t,r)=>{r.d(t,{I:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},87969:(e,t,r)=>{r.d(t,{C:()=>a});var s=r(67837),i=r(99074);class a extends((0,s.E)(i.v)){}(0,s.K)(i.v,a)},73883:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(86952),i=r(88994);const a=(0,s.Q)({name:"vaultSearch",commands:{},events:{},queries:{search:i.W}})},72965:(e,t,r)=>{r.d(t,{T:()=>a});var s=r(67837),i=r(73883);class a extends((0,s.E)(i.R)){}(0,s.K)(i.R,a)},88994:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(99059),i=r(25029);class a extends((0,s.k)({scope:i.F.User})){}},91421:(e,t,r)=>{r.d(t,{a:()=>C});var s=r(88802),i=r(99634),a=r(52484),o=r(15183),n=r(77428),c=r(85390),l=r(87065),d=r(20754),u=r(87279),p=r(63197),h=r(6136),m=r(43978),g=r(69885),v=r(86252),y=r(57924),_=r(82706);let f=class{constructor(e,t){this.carbon=e,this.vaultRepository=t,this.isPasswordLimitEnabled=()=>this._getPasswordsLimitCapability().pipe((0,l.U)((e=>e?.enabled??!1))),this.getNumberOfPasswordsLeft=()=>{const e=this._getCredentialCount(),t=this._getPasswordsLimitCapability().pipe((0,l.U)((e=>e?.info?.limit)));return(0,c.a)([e,t]).pipe((0,l.U)((([e,t])=>{if("number"==typeof t)return t-e})))},this.isFreeUserFrozen=()=>this._getPasswordsLimitCapability().pipe((0,l.U)((e=>e?.enabled&&"enforce_freeze"===e.info?.action&&e.info?.limit)),(0,h.x)()).pipe((0,m.w)((e=>e?this._getCredentialCount().pipe((0,l.U)((t=>t>e))):(0,g.of)(!1)))),this.getCurrentPasswordLimit=()=>this._getPasswordsLimitCapability().pipe((0,l.U)((e=>{if(e?.enabled&&!e.info?.limit&&0!==e.info?.limit)throw new Error("Cannot get password limit from server");return e?.info?.limit}))),this._getPasswordsLimitCapability=()=>this.carbon.queries.getNodePremiumStatus().pipe((0,l.U)((e=>{if(!(0,u.d6)(e))throw new Error("Cannot retrieve node premium status from carbon");return(0,u.db)(e).capabilities?.passwordsLimit}))),this._getCredentialCount=()=>this.vaultRepository.fetchVaultItems$({vaultItemTypes:[_.U.Credential]}).pipe((0,l.U)((e=>{if(!(0,u.d6)(e))throw new Error("Cannot retrieve credentials from vault");return(0,u.db)(e).credentialsResult.matchCount})))}};f=(0,s.__decorate)([(0,y.GS)(),(0,s.__metadata)("design:paramtypes",[v._,n.g])],f);let S=class{constructor(e){this.passwordLimitRepository=e}execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft();return(0,c.a)(e,t).pipe((0,l.U)((([e,t])=>e&&"number"==typeof t?(0,u.Vp)(t>0):(0,u.Vp)(!0))))}};S=(0,s.__decorate)([(0,d.e)(p.K),(0,s.__metadata)("design:paramtypes",[f])],S);var E=r(58684);let b=class{constructor(e){this.passwordLimitRepository=e}execute(){const e=this.passwordLimitRepository.isPasswordLimitEnabled(),t=this.passwordLimitRepository.getNumberOfPasswordsLeft(),r=this.passwordLimitRepository.getCurrentPasswordLimit();return(0,c.a)(e,t,r).pipe((0,l.U)((([e,t,r])=>e&&"number"==typeof t&&"number"==typeof r?(0,u.Vp)({hasLimit:e,passwordsLeft:t,limit:r}):(0,u.Vp)({hasLimit:!1}))))}};b=(0,s.__decorate)([(0,d.e)(E.r),(0,s.__metadata)("design:paramtypes",[f])],b);var w=r(96440);let A=class{constructor(e){this.passwordLimitRepository=e}execute(){return this.passwordLimitRepository.isFreeUserFrozen().pipe((0,l.U)((e=>(0,u.Vp)(e))))}};A=(0,s.__decorate)([(0,d.e)(w.k),(0,s.__metadata)("design:paramtypes",[f])],A);let C=class{};C=(0,s.__decorate)([(0,i.Y)({api:a.Z,stores:[],handlers:{commands:{},events:{},queries:{canUserAddNewPassword:S,getPasswordLimitStatus:b,isFreeUserFrozen:A}},providers:[n.g,f],requiredFeatureFlips:[...Object.values(o.t)]})],C)},77569:(e,t,r)=>{r.d(t,{z:()=>ee});var s,i=r(88802),a=r(99634),o=r(37935),n=r(48430);!function(e){e.PasskeysInVaultDev="vault_web_passkey_dev",e.PasskeysInVaultProd="vault_web_passkey_prod",e.RichIconsDev="sharingVault_web_rich_icons_setting"}(s||(s={}));var c=r(63663),l=r(87279),d=r(86252),u=r(82706),p=r(273),h=r(81459),m=r(57924);let g=class extends h.f{};g=(0,i.__decorate)([(0,m.GS)()],g);var v=r(50415);(0,v.Enum)("PAYMENT_TYPE_VISA","PAYMENT_TYPE_MASTERCARD","PAYMENT_TYPE_AMEX","PAYMENT_TYPE_DISCOVER","PAYMENT_TYPE_JCB","PAYMENT_TYPE_DINERSCLUB");const y=(0,v.Enum)("BLACK","SILVER","WHITE","RED","ORANGE","GOLD","BLUE_1","BLUE_2","GREEN_1","GREEN_2");var _=r(18952),f=r(11329),S=r(45146),E=r(82009),b=r(75257);const w={[f.t.Mr]:"MR",[f.t.Mrs]:"MME",[f.t.Miss]:"MLLE",[f.t.Ms]:"MS",[f.t.Mx]:"MX",[f.t.NoneOfThese]:"NONE_OF_THESE"},A={[S.X.Black]:y.BLACK,[S.X.Blue1]:y.BLUE_1,[S.X.Blue2]:y.BLUE_2,[S.X.Gold]:y.GOLD,[S.X.Green1]:y.GREEN_1,[S.X.Green2]:y.GREEN_2,[S.X.Orange]:y.ORANGE,[S.X.Red]:y.RED,[S.X.Silver]:y.SILVER,[S.X.White]:y.WHITE},C={[E.z.Any]:_.z.PHONE_TYPE_ANY,[E.z.Fax]:_.z.PHONE_TYPE_FAX,[E.z.Landline]:_.z.PHONE_TYPE_LANDLINE,[E.z.Mobile]:_.z.PHONE_TYPE_MOBILE,[E.z.WorkFax]:_.z.PHONE_TYPE_WORK_FAX,[E.z.WorkLandline]:_.z.PHONE_TYPE_WORK_LANDLINE,[E.z.WorkMobile]:_.z.PHONE_TYPE_WORK_MOBILE},I=e=>e?Date.parse(e)/1e3:null,T={[u.U.Address]:e=>({addressFull:e.streetName,addressName:e.itemName,linkedPhone:e.linkedPhoneId,...e}),[u.U.BankAccount]:e=>({...e,bank:e.bankCode,localeFormat:e.country||b.c.US,name:e.accountName,owner:e.ownerName}),[u.U.Company]:e=>({name:e.companyName,...e}),[u.U.Credential]:e=>({login:e.username,otpUrl:e.otpURL,otpSecret:e.otpSecret,secondaryLogin:e.alternativeUsername,title:e.itemName,url:e.URL,linkedWebsites:{addedByUser:e.linkedURLs},...e}),[u.U.DriversLicense]:e=>({...e,country:e.country??b.c.US,expirationDate:I(e.expirationDate),idNumber:e.idNumber??"",issueDate:I(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",state:e.state??""}),[u.U.Email]:e=>({email:e.emailAddress,emailName:e.itemName,...e}),[u.U.FiscalId]:e=>({...e,country:e.country??b.c.US,idNumber:e.fiscalNumber??"",spaceId:e.spaceId??"",teledeclarantNumber:e.teledeclarantNumber??""}),[u.U.IdCard]:e=>({...e,country:e.country??b.c.US,expirationDate:I(e.expirationDate),idNumber:e.idNumber??"",issueDate:I(e.issueDate),name:e.idName??"",spaceId:e.spaceId??""}),[u.U.Identity]:e=>({...e,title:e.title?w[e.title]:void 0}),[u.U.Passkey]:e=>({...e}),[u.U.Passport]:e=>({...e,country:e.country??b.c.US,expirationDate:I(e.expirationDate),idNumber:e.idNumber??"",issueDate:I(e.issueDate),name:e.idName??"",spaceId:e.spaceId??"",deliveryPlace:e.issuePlace??""}),[u.U.PaymentCard]:e=>({...e,cardName:e.itemName,color:e.color?A[e.color]:void 0,personalNote:e.note}),[u.U.Phone]:e=>({...e,phoneName:e.itemName,number:e.phoneNumber,type:e.type?C[e.type]:void 0}),[u.U.Secret]:e=>({...e,secured:e.isSecured}),[u.U.SecureNote]:e=>({...e}),[u.U.SocialSecurityId]:e=>({...e,country:e.country??b.c.US,idNumber:e.idNumber??"",name:e.idName??"",spaceId:e.spaceId??""}),[u.U.Website]:e=>({name:e.itemName,website:e.URL,...e})};let P=class{constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}async execute({body:e}){const{vaultItemType:t,content:r,shouldSkipSync:s}=e;if([u.U.DriversLicense,u.U.FiscalId,u.U.IdCard,u.U.Passport,u.U.SocialSecurityId].includes(t))return this.createId(t,r);if(t===u.U.Passkey)return this.createPasskey(r);const{commands:i}=this.carbonLegacyClient,a=await i.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:t,origin:"MANUAL",content:T[t](r),shouldSkipSync:s}]});if((0,l.hx)(a))return this.handleError(t);const o=(0,l.db)(a).carbonResult;return this.handleSuccess(t,o.itemId)}handleError(e){return Promise.resolve((0,l.Rn)({tag:"error",errorMessage:`Failed to create ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("created",{ids:[t],vaultItemType:e}),Promise.resolve((0,l.Vp)({id:t}))}async createId(e,t){const{commands:{addDriverLicense:r,addFiscalId:s,addIdCard:i,addPassport:a,addSocialSecurityId:o}}=this.carbonLegacyClient,n={[u.U.DriversLicense]:r,[u.U.FiscalId]:s,[u.U.IdCard]:i,[u.U.Passport]:a,[u.U.SocialSecurityId]:o},c=await n[e](T[e](t));return(0,l.hx)(c)?this.handleError(e):this.handleSuccess(e,(0,l.db)(c).id)}async createPasskey(e){const{commands:{addPasskey:t}}=this.carbonLegacyClient,r=await t(e);return(0,l.hx)(r)?this.handleError(u.U.Passkey):this.handleSuccess(u.U.Passkey,(0,l.db)(r).id)}};P=(0,i.__decorate)([(0,c.W)(p._),(0,i.__metadata)("design:paramtypes",[d._,g])],P);var O=r(26897),R=r(31154),D=r(81038);let N=class{constructor(e,t,r){this.carbonLegacyClient=e,this.eventEmitter=t,this.syncClient=r}async execute({body:e}){const{vaultItemType:t,ids:r}=e,{commands:s}=this.carbonLegacyClient,i=[],a=r.map((e=>s.carbonLegacyLeeloo({name:"removePersonalDataItem",arg:[{id:e}]}).then((t=>{(0,l.d6)(t)&&i.push(e)}))));return await Promise.allSettled(a),i.length>0&&this.eventEmitter.sendEvent("deleted",{ids:i,vaultItemType:t}),await s.removeItemsFromCollections({ids:r}),i.length!==r.length?Promise.resolve((0,l.Rn)({tag:"error",errorMessage:`Error: Failed to delete all ${t}s`,failedDeletionIds:r.filter((e=>!i.includes(e)))})):(await this.syncClient.commands.sync({trigger:O.Trigger.Save}),Promise.resolve((0,l.Vp)(void 0)))}};N=(0,i.__decorate)([(0,c.W)(R.c),(0,i.__metadata)("design:paramtypes",[d._,g,D.Q])],N);var U=r(54547);let F=class{constructor(e,t){this.carbonLegacyClient=e,this.eventEmitter=t}async execute({body:e}){const{content:t,id:r,vaultItemType:s,shouldSkipSync:i}=e;if([u.U.DriversLicense,u.U.FiscalId,u.U.IdCard,u.U.Passport,u.U.SocialSecurityId].includes(s))return this.updateId(s,t,r);if(s===u.U.Passkey)return this.updatePasskey(t,r);const{commands:a}=this.carbonLegacyClient,o=await a.carbonLegacyLeeloo({name:"savePersonalDataItem",arg:[{kwType:s,origin:"MANUAL",content:{...T[s](t),id:r},shouldSkipSync:i}]});return(0,l.hx)(o)?Promise.resolve((0,l.Rn)({tag:"error",errorMessage:`Failed to update ${s}`})):(this.eventEmitter.sendEvent("updated",{ids:[r],vaultItemType:s}),Promise.resolve((0,l.Vp)(void 0)))}handleError(e){return Promise.resolve((0,l.Rn)({tag:"error",errorMessage:`Failed to update ${e}`}))}handleSuccess(e,t){return this.eventEmitter.sendEvent("updated",{ids:[t],vaultItemType:e}),Promise.resolve((0,l.Vp)(void 0))}async updateId(e,t,r){const{commands:{editDriverLicense:s,editFiscalId:i,editIdCard:a,editPassport:o,editSocialSecurityId:n}}=this.carbonLegacyClient,c={[u.U.DriversLicense]:s,[u.U.FiscalId]:i,[u.U.IdCard]:a,[u.U.Passport]:o,[u.U.SocialSecurityId]:n},d=await c[e]({...T[e](t),id:r});return(0,l.hx)(d)?this.handleError(e):this.handleSuccess(e,r)}async updatePasskey(e,t){const{commands:{updatePasskey:r}}=this.carbonLegacyClient,s=await r({...e,id:t});return(0,l.hx)(s)?this.handleError(u.U.Passkey):this.handleSuccess(u.U.Passkey,t)}};F=(0,i.__decorate)([(0,c.W)(U.K),(0,i.__metadata)("design:paramtypes",[d._,g])],F);var M=r(47412);let L=class{constructor(e){this.eventEmitter=e}execute({body:e}){const{ids:t,eventType:r}=e;return this.eventEmitter.sendEvent(r,{ids:t,vaultItemType:u.U.Credential}),Promise.resolve((0,l.Vp)(void 0))}};L=(0,i.__decorate)([(0,c.W)(M.c),(0,i.__metadata)("design:paramtypes",[g])],L);var x=r(20754),k=r(55713),G=r(48844),V=r(60733),K=r(96303),j=r(54066),B=r(19074);let W=class{constructor(e,t){this.carbonLegacyClient=e,this.md5Hasher=t}execute({body:{domain:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.iconsCache.domains"}).pipe((0,G.Qn)((t=>{if(r=t,!B.x.safeParse(r).success)throw new Error("Bad domain icons cache format");var r;return t.get((0,K.k)(this.md5Hasher.compute((0,j.u)(e))))})))}};W=(0,i.__decorate)([(0,x.e)(k.s),(0,i.__metadata)("design:paramtypes",[d._,V.f])],W);var z=r(96342),H=r(77428);let Q=class{constructor(e){this.vaultRepository=e}execute({body:e}){return this.vaultRepository.fetchVaultItems$(e)}};Q=(0,i.__decorate)([(0,x.e)(z.W),(0,i.__metadata)("design:paramtypes",[H.g])],Q);var q=r(83984);let Y=class{constructor(e){this.carbonLegacyClient=e}execute({body:{id:e}}){const{queries:{carbonState:t}}=this.carbonLegacyClient;return t({path:"userSession.personalData.noteCategories"}).pipe((0,G.Qn)((t=>{if(r=t,!Array.isArray(r)||0!==r.length&&"KWSecureNoteCategory"!==r[0].kwType)throw new Error("Bad secure note category format");var r;if(void 0===e)return t;const s=t.find((t=>t.Id===e))?.CategoryName;return s})))}};Y=(0,i.__decorate)([(0,x.e)(q.F),(0,i.__metadata)("design:paramtypes",[d._])],Y);var $=r(20517),X=r(52597);const Z=e=>{if(!e)return{richIconsEnabled:!0};const t=e;if(!(0,X.u)(t.spaces))return{richIconsEnabled:!0};const r=t.spaces.find((e=>"accepted"===e.status));return{richIconsEnabled:r?.info.richIconsEnabled??!0}};let J=class{constructor(e){this.carbon=e}get(){const{getNodePremiumStatus:e}=this.carbon.queries;return e().pipe((0,G.Qn)(Z))}execute(){return this.get().pipe((0,G.Qn)((e=>e.richIconsEnabled)))}};J=(0,i.__decorate)([(0,x.e)($.M),(0,i.__metadata)("design:paramtypes",[d._])],J);let ee=class{};ee=(0,i.__decorate)([(0,a.Y)({api:n.L,handlers:{commands:{createVaultItem:P,deleteVaultItems:N,updateVaultItem:F,emitTemporaryVaultItemEvent:L},events:{},queries:{domainIconDetails:W,query:Q,secureNoteCategory:Y,richIconsEnabled:J}},imports:[o.D],providers:[g,H.g],requiredFeatureFlips:Object.values(s)})],ee)},20491:(e,t,r)=>{r.d(t,{K:()=>E});var s=r(88802),i=r(99634),a=r(22499),o=r(95681),n=r(23347),c=r(25029),l=r(10722);const d=e=>!(!e||"object"!=typeof e)&&"isCollectionGuidedIntroEnabled"in e,u={isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1};class p extends((0,o.Q)({persist:!0,storage:{initialValue:u,typeGuard:d,schemaVersion:2,migrateStorageSchema:()=>({isCollectionGuidedIntroEnabled:!0,hasSeenFreeUserFrozenState:!1})},scope:c.F.User,storeName:"vault-notifications",capacity:n.Y._001KB,codec:l.E})){}var h=r(63663),m=r(87279),g=r(12338);let v=class{constructor(e){this.store=e}async execute({body:e}){const{notificationName:t,isEnabled:r}=e;try{const e=await this.store.getState();return await this.store.set({...e,[t]:r}),(0,m.Vp)(void 0)}catch{throw new Error("SetVaultNotificationsStatus command from vault-core failed")}}};v=(0,s.__decorate)([(0,h.W)(g.x),(0,s.__metadata)("design:paramtypes",[p])],v);var y=r(87065),_=r(20754),f=r(19892);let S=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,y.U)(m.Vp))}};S=(0,s.__decorate)([(0,_.e)(f.M),(0,s.__metadata)("design:paramtypes",[p])],S);let E=class{};E=(0,s.__decorate)([(0,i.Y)({api:a.e,handlers:{commands:{setVaultNotificationsStatus:v},events:{},queries:{getVaultNotificationsStatus:S}},stores:[p]})],E)},97090:(e,t,r)=>{r.d(t,{H:()=>k});var s=r(88802),i=r(99634),a=r(99074),o=r(60399),n=r(25041),c=r(63663),l=r(86252),d=r(87279),u=r(26897),p=r(55920),h=r(91943),m=r(48844);const g=e=>!!Array.isArray(e)&&(0===e.length||e.every((e=>{const t=e;return"string"==typeof t.Id&&"string"==typeof t.Name&&Array.isArray(t.VaultItems)})));function v(e,t){const{queries:{carbonState:r}}=e;return r({path:"userSession.personalData.collections"}).pipe((0,m.Qn)((e=>{if(!g(e))throw new Error("Collection array has a wrong format");return{collections:(t&&t.length>0?e.filter((e=>t.includes(e.Id))):e).map((e=>({id:e.Id,name:e.Name,spaceId:e.SpaceId??"",vaultItems:e.VaultItems.map((e=>({id:e.Id,type:e.Type})))})))}})))}function y(e,t,r,s){const i=new u.UserUpdateCollectionEvent({collectionId:r,action:t,itemCount:s,isShared:!1});return e.commands.carbon({name:"logEvent",args:[{event:i}]})}var _=r(78776);const f=(e,t)=>({log_type:e,category:p.p.VaultCollections,date_time:(new Date).getTime(),schema_version:"1.0.0",is_sensitive:!0,uuid:(0,_.Z)().toUpperCase(),properties:t});let S=class{constructor(e,t){this.carbonLegacyClient=e,this.activityLogs=t}async execute({body:e}){const{id:t,name:r=""}=e,s=await(0,o.z)(v(this.carbonLegacyClient,[t]));if((0,d.hx)(s))throw new Error(`Failed to fetch additional collection info: ${s.error}`);const i=await this.carbonLegacyClient.commands.carbon({name:"deleteCollection",args:[{id:t}]});if((0,d.hx)(i))throw new Error(`Failed to delete collection: ${i.error}`);y(this.carbonLegacyClient,u.CollectionAction.Delete,t,s.data.collections[0]?.vaultItems?.length);const a={collection_name:r},n=f(p.z.UserDeletedCollection,a);return this.activityLogs.commands.storeActivityLogs({activityLogs:[n]}),Promise.resolve((0,d.Vp)(void 0))}};S=(0,s.__decorate)([(0,c.W)(n.T),(0,s.__metadata)("design:paramtypes",[l._,h._])],S);var E=r(533),b=r(28489);let w=class{constructor(e,t){this.activityLogs=e,this.activityLogs=e,this.carbonLegacy=t}async execute({body:e}){const{content:{name:t,spaceId:r="",vaultItems:s=[]}}=e,i=await this.carbonLegacy.commands.carbon({name:"addCollection",args:[{name:t,spaceId:r,vaultItems:s}]});if((0,d.hx)(i))throw new Error(`Failed to create collection: ${i.error}`);if("object"!=typeof(a=i.data.carbonResult)||null===a||!(0,b.l$)(a,"id")||"string"!=typeof a.id||!(0,b.l$)(a,"success")||"boolean"!=typeof a.success)throw new Error("Failed to find created collection id");var a;if(r){const e={collection_name:t},r=[f(p.z.UserCreatedCollection,e)];this.activityLogs.commands.storeActivityLogs({activityLogs:r})}return y(this.carbonLegacy,u.CollectionAction.Add,i.data.carbonResult.id,s.length),s.length&&y(this.carbonLegacy,u.CollectionAction.AddCredential,i.data.carbonResult.id,s.length),(0,d.Vp)({id:i.data.id})}};w=(0,s.__decorate)([(0,c.W)(E.e),(0,s.__metadata)("design:paramtypes",[h._,l._])],w);var A=r(96862),C=r(82706),I=r(61199),T=r(64718);let P=class{constructor(e,t,r){this.carbonLegacyClient=e,this.activityLogs=t,this.vaultItemsCrudClient=r}async execute({body:e}){const{id:t,collection:r,operationType:s=A.C.APPEND_VAULT_ITEMS}=e,i=await(0,o.z)(v(this.carbonLegacyClient,[t]));if((0,d.hx)(i))throw new Error(`Failed to fetch additional collection info: ${i.error}`);const a=i.data.collections[0];let n;if(r.vaultItems){const e=await(0,o.z)(this.vaultItemsCrudClient.queries.query({vaultItemTypes:[C.U.Credential,C.U.SecureNote],ids:r.vaultItems.map((e=>e.id))}));if((0,d.hx)(e))throw new Error("Unable to find items in collection");const t=e.data.credentialsResult.items,i=e.data.secureNotesResult.items,c=[...t.map((e=>({id:e.id,type:C.U.Credential,url:e.URL}))),...i.map((e=>({id:e.id,type:C.U.SecureNote})))];n={id:r.id,name:r.name,spaceId:r.spaceId,vaultItems:c},a.vaultItems=this.mutateCollectionVaultItems(a,s,c)}else n={id:r.id,name:r.name,spaceId:r.spaceId};const c=await this.carbonLegacyClient.commands.carbon({name:"updateCollection",args:[{id:a.id,name:r.name??a.name,spaceId:r.spaceId??a.spaceId,vaultItems:a.vaultItems}]});if((0,d.hx)(c))throw new Error(`Failed to update collection: ${c.error}`);return this.handleLogs(a,n,s),Promise.resolve((0,d.Vp)(void 0))}handleLogs(e,t,r){let s=null;const i={};if(t.name&&(y(this.carbonLegacyClient,u.CollectionAction.Edit,e.id,e.vaultItems.length),t.name!==e.name&&(s=p.z.UserRenamedCollection,i.collection_name=t.name,i.old_collection_name=e.name)),t.vaultItems&&(y(this.carbonLegacyClient,r===A.C.SUBSTRACT_VAULT_ITEMS?u.CollectionAction.DeleteCredential:u.CollectionAction.AddCredential,e.id,1),t.vaultItems[0]?.type===C.U.Credential&&(s=r===A.C.APPEND_VAULT_ITEMS?p.z.UserAddedCredentialToCollection:p.z.UserRemovedCredentialFromCollection,i.collection_name=e.name,i.domain_url=new T.Y(t.vaultItems[0].url).getRootDomain())),e.spaceId&&s){const e=f(s,i);this.activityLogs.commands.storeActivityLogs({activityLogs:[e]})}}getDeduplicatedList(e){return[...new Map(e.map((e=>[e.id,e]))).values()]}mutateCollectionVaultItems(e,t,r){return t===A.C.SUBSTRACT_VAULT_ITEMS?e.vaultItems.filter((e=>!r.some((t=>t.id===e.id)))):this.getDeduplicatedList([...e.vaultItems,...r])}};P=(0,s.__decorate)([(0,c.W)(A.s),(0,s.__metadata)("design:paramtypes",[l._,h._,I.L])],P);var O=r(6519),R=r(20754);let D=class{constructor(e){this.carbonLegacyClient=e}execute({body:e}){const{ids:t}=e;return v(this.carbonLegacyClient,t)}};D=(0,s.__decorate)([(0,R.e)(O.I),(0,s.__metadata)("design:paramtypes",[l._])],D);var N=r(25029),U=r(95681),F=r(23347),M=r(10722);const L=e=>!0;class x extends((0,U.Q)({persist:!0,scope:N.F.Device,storeName:"collections-store",storeTypeGuard:L,capacity:F.Y._001KB,codec:M.E,storage:{schemaVersion:3,initialValue:{isCredentialCategoriesMigrated:{}},typeGuard:L,migrateStorageSchema:()=>({isCredentialCategoriesMigrated:{}})}})){}let k=class{};k=(0,s.__decorate)([(0,i.Y)({api:a.v,stores:[x],handlers:{commands:{deleteCollection:S,createCollection:w,updateCollection:P},events:{},queries:{queryCollections:D}},requiredFeatureFlips:["vault_web_collection_migration_space_prod_v2","vault_web_popupSavedState_release","sharingVault_web_Secure_Notes_Revamp_dev","sharingVault_web_Secure_Notes_Revamp_prod","sharingVault_web_Secure_Notes_in_Collections_dev","sharingVault_web_Secure_Notes_in_Collections_prod"]})],k)},52597:(e,t,r)=>{r.d(t,{u:()=>s});const s=e=>function(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;const r=e[0];for(let e=0;e<t.length;e++){const s=t[e];if(!Object.prototype.hasOwnProperty.call(r,s))return!1}return!0}(e,["teamId"])},77428:(e,t,r)=>{r.d(t,{g:()=>pe});var s=r(88802),i=r(85390),a=r(87065),o=r(6136),n=r(57924),c=r(87279),l=r(48844),d=r(86252),u=r(64035),p=r(82706);function h(e,t){if(!Array.isArray(e))return!1;if(0===e.length)return!0;return e[0].kwType===t}const m=e=>h(e,p.U.Address),g=e=>h(e,p.U.Company),v=e=>h(e,p.U.Email),y=e=>h(e,p.U.Identity),_=e=>h(e,p.U.Phone),f=e=>h(e,p.U.Website),S=e=>h(e,p.U.BankAccount),E=e=>h(e,p.U.Credential),b=e=>h(e,p.U.DriversLicense),w=e=>h(e,p.U.FiscalId),A=e=>h(e,p.U.IdCard),C=e=>h(e,p.U.Passport),I=e=>h(e,p.U.SocialSecurityId),T=e=>h(e,p.U.Passkey),P=e=>h(e,p.U.PaymentCard),O=e=>h(e,p.U.SecureNote);var R=r(52597),D=r(9531),N=r(92481);function U(e,t){return e in t}function F(e){const t={};for(const r in e)t[r.charAt(0).toLowerCase()+r.slice(1)]=e[r];return t}const M=e=>{if(!e||3!==e.split("-").length)return"";const t=e.split("-"),r=Number(t[0]),s=Number(t[1])-1,i=Number(t[2]);return(0,N.Z)(new Date(r,s,i),"yyyy-MM-dd")};function L(e,t,r){return t||r?e.filter((e=>!(t&&!t.every((t=>U(t.property,e)&&function(e,t,r=D.l.Equal){return{[D.l.Equal]:()=>e===t,[D.l.LessThan]:()=>e<t,[D.l.GreaterThan]:()=>e>t}[r]()}(e[t.property],t.value,t.operator))))&&(r?.(e)??!0))):e}var x=r(24652);function k(e,t){if(!t||!e.length||!U(t.property,e[0]))return e;const r=t.property,s=t.direction||x.S.Ascend;return e.sort(((e,t)=>{const i=e[r],a=t[r];return i||a?i?a?function(e,t,r){const s=Number(e),i=Number(t);return"string"==typeof e&&"string"==typeof t?r===x.S.Ascend?e.localeCompare(t):t.localeCompare(e):"number"==typeof e&&"number"==typeof t?r===x.S.Ascend?e-t:t-e:isNaN(s)||isNaN(i)?0:r===x.S.Ascend?s-i:i-s}(i,a,s):s===x.S.Ascend?1:-1:s===x.S.Ascend?-1:1:0}))}const G=e=>{const{AddressName:t,LinkedPhone:r,StreetName:s,AddressFull:i,StateLevel2:a,...o}=e;return{...F(o),itemName:t,linkedPhoneId:r,streetName:s||i}},V=e=>{const{BankAccountName:t,BankAccountOwner:r,BankAccountIBAN:s,BankAccountBIC:i,BankAccountBank:a,...o}=e,n=a?.split("-"),c=n?.length>1?n[1]??a:a;return{...F(o),accountName:t,bankCode:c||"",BIC:i,country:o.LocaleFormat,IBAN:s,ownerName:r}},K=e=>{const{Name:t,PersonalNote:r,LocaleFormat:s,...i}=e;return{...F(i),companyName:t}},j=e=>{const{CreationDatetime:t,Email:r,Id:s,LastBackupTime:i,LastUse:a,LinkedServices:o,Login:n,Note:c,OtpSecret:l,OtpUrl:d,Password:u,SecondaryLogin:p,SpaceId:h,Title:m,Url:g,UserModificationDatetime:v,UserSelectedUrl:y}=e;return{...F({CreationDatetime:t,Email:r,Id:s,LastBackupTime:i,LastUse:a,Note:c,Password:u,SpaceId:h,UserModificationDatetime:v}),alternativeUsername:p,itemName:m??"",linkedURLs:o?.associated_domains.map((e=>e.domain))??[],otpURL:d,otpSecret:l,URL:g||y||"",username:n}},B=e=>e?[e.FirstName,e.MiddleName,e.LastName,e.LastName2].filter(Boolean).join(" "):"",W=(e,t)=>{const{DeliveryDate:r,ExpireDate:s,Fullname:i,Number:a,DateOfBirth:o,Sex:n,...c}=e;return{...F(c),idName:B(t)||i||"",idNumber:a,issueDate:M(r),expirationDate:M(s),country:c.LocaleFormat}},z=e=>{const{EmailName:t,Email:r,Type:s,LocaleFormat:i,...a}=e;return{...F(a),itemName:t,emailAddress:r,type:s}},H=e=>({...F(e),country:e.LocaleFormat}),Q=(e,t)=>{const{DateOfBirth:r,DeliveryDate:s,ExpireDate:i,Fullname:a,Number:o,Sex:n,...c}=e;return{...F(c),idName:B(t)||a||"",idNumber:o,issueDate:M(s),expirationDate:M(i),country:c.LocaleFormat}};var q=r(11329);const Y={"":void 0,MR:q.t.Mr,MME:q.t.Mrs,MLLE:q.t.Miss,MS:q.t.Ms,MX:q.t.Mx,NONE_OF_THESE:q.t.NoneOfThese},$=e=>{const{Title:t,LocaleFormat:r,...s}=e;return{...F(s),title:Y[t]}},X=(e,t)=>{const{DeliveryDate:r,DeliveryPlace:s,ExpireDate:i,Fullname:a,Number:o,DateOfBirth:n,Sex:c,...l}=e;return{...F(l),idName:B(t)||a||"",idNumber:o||"",issueDate:M(r),issuePlace:s||"",expirationDate:M(i),country:l.LocaleFormat}};var Z=r(45146);const J={BLACK:Z.X.Black,BLUE_1:Z.X.Blue1,BLUE_2:Z.X.Blue2,GOLD:Z.X.Gold,GREEN_1:Z.X.Green1,GREEN_2:Z.X.Green2,ORANGE:Z.X.Orange,RED:Z.X.Red,SILVER:Z.X.Silver,WHITE:Z.X.White},ee=e=>{const{Name:t,CCNote:r,Color:s,Bank:i,CardNumberLastDigits:a,IssueNumber:o,StartMonth:n,StartYear:c,Type:l,LocaleFormat:d,...u}=e;return{...F(u),itemName:t,color:J[s],note:r||""}};var te=r(18952),re=r(82009);const se={[te.z.PHONE_TYPE_ANY]:re.z.Any,[te.z.PHONE_TYPE_FAX]:re.z.Fax,[te.z.PHONE_TYPE_LANDLINE]:re.z.Landline,[te.z.PHONE_TYPE_MOBILE]:re.z.Mobile,[te.z.PHONE_TYPE_WORK_FAX]:re.z.WorkFax,[te.z.PHONE_TYPE_WORK_LANDLINE]:re.z.WorkLandline,[te.z.PHONE_TYPE_WORK_MOBILE]:re.z.WorkMobile},ie=e=>{const{PhoneName:t,Number:r,Type:s,...i}=e;return{...F(i),itemName:t,phoneNumber:r,type:se[s]}};var ae=r(7149);const oe=e=>{const{Secured:t,Type:r,Category:s,LocaleFormat:i,...a}=e;return{...F(a),categoryId:s,isSecured:t,color:ae.L[r]||ae.L.GRAY}},ne=e=>{const{DateOfBirth:t,LinkedIdentity:r,Sex:s,SocialSecurityFullname:i,SocialSecurityNumber:a,...o}=e;return{...F(o),idName:i,idNumber:a,country:o.LocaleFormat}},ce=e=>{const{Website:t,Name:r,PersonalNote:s,LocaleFormat:i,...a}=e;return{...F(a),itemName:r,URL:t}},le=e=>h(e,p.U.Secret),de=e=>{const{LocaleFormat:t,Secured:r,...s}=e;return{...F(s),isSecured:r}},ue=u.N[p.U.Identity].replace("Result","");let pe=class{constructor(e){this.carbonLegacyClient=e,this.getVaultItems$TypeDictionary={[p.U.Address]:()=>this.getVaultItems$(u.N[p.U.Address],m,G),[p.U.BankAccount]:()=>this.getVaultItems$(u.N[p.U.BankAccount],S,V),[p.U.Company]:()=>this.getVaultItems$(u.N[p.U.Company],g,K),[p.U.Credential]:()=>this.getVaultItems$(u.N[p.U.Credential],E,j),[p.U.DriversLicense]:()=>this.getVaultItems$(u.N[p.U.DriversLicense],b,W,"driverLicenses"),[p.U.Email]:()=>this.getVaultItems$(u.N[p.U.Email],v,z),[p.U.FiscalId]:()=>this.getVaultItems$(u.N[p.U.FiscalId],w,H),[p.U.IdCard]:()=>this.getVaultItems$(u.N[p.U.IdCard],A,Q),[p.U.Identity]:()=>this.getVaultItems$(u.N[p.U.Identity],y,$),[p.U.Passkey]:()=>this.getVaultItems$(u.N[p.U.Passkey],T,F),[p.U.Passport]:()=>this.getVaultItems$(u.N[p.U.Passport],C,X),[p.U.PaymentCard]:()=>this.getVaultItems$(u.N[p.U.PaymentCard],P,ee),[p.U.Phone]:()=>this.getVaultItems$(u.N[p.U.Phone],_,ie),[p.U.Secret]:()=>this.getVaultItems$(u.N[p.U.Secret],le,de),[p.U.SecureNote]:()=>this.getVaultItems$(u.N[p.U.SecureNote],O,oe,"notes"),[p.U.SocialSecurityId]:()=>this.getVaultItems$(u.N[p.U.SocialSecurityId],I,ne),[p.U.Website]:()=>this.getVaultItems$(u.N[p.U.Website],f,ce,"personalWebsites")},this.getEmptyVaultItemsQueryResult=()=>({addressesResult:this.getEmptyItemsQueryResult(),bankAccountsResult:this.getEmptyItemsQueryResult(),companiesResult:this.getEmptyItemsQueryResult(),credentialsResult:this.getEmptyItemsQueryResult(),driversLicensesResult:this.getEmptyItemsQueryResult(),emailsResult:this.getEmptyItemsQueryResult(),fiscalIdsResult:this.getEmptyItemsQueryResult(),idCardsResult:this.getEmptyItemsQueryResult(),identitiesResult:this.getEmptyItemsQueryResult(),passkeysResult:this.getEmptyItemsQueryResult(),passportsResult:this.getEmptyItemsQueryResult(),paymentCardsResult:this.getEmptyItemsQueryResult(),phonesResult:this.getEmptyItemsQueryResult(),secretsResult:this.getEmptyItemsQueryResult(),secureNotesResult:this.getEmptyItemsQueryResult(),socialSecurityIdsResult:this.getEmptyItemsQueryResult(),websitesResult:this.getEmptyItemsQueryResult()}),this.getEmptyItemsQueryResult=()=>({items:[],matchCount:0})}initializeVaultItemsQueryParams(e){const{ids:t,pageSize:r,pageNumber:s,propertyFilters:i,propertySorting:a}=e;this.ids=t,this.propertyFilters=i,this.propertySorting=a,this.pageSize=r,this.pageNumber=s}fetchVaultItems$(e,t){const{vaultItemTypes:r,...s}=e;this.initializeVaultItemsQueryParams(s),this.additionalFilterFunc=t;const o=(0,i.a)(r.map((e=>this.getVaultItems$TypeDictionary[e]()))),n=this.getEmptyVaultItemsQueryResult();return o.pipe((0,a.U)((e=>(e.forEach((e=>{if("failure"===e.tag)throw new Error("Error while fetching vault items");Object.assign(n,e.data)})),(0,c.Vp)(n)))))}getVaultItems$(e,t,r,s){return s=s??e.replace("Result",""),(0,i.a)([this.getCarbonVaultItems$(e,t,s),this.getCarbonVaultItems$(u.N[p.U.Identity],y,ue),this.getQuarantinedSpacesTeamIds$()],((e,t,s)=>(0,c.Vp)(function(e,t,r,s,i){return e.flatMap((e=>{if(r.includes(e.SpaceId)||i&&!i.some((t=>t.toUpperCase()===e.Id.toUpperCase())))return[];e.LastUse||(e.LastUse=-1);const a=e.LinkedIdentity?t.find((t=>t.Id===e.LinkedIdentity)):void 0;return s(e,a)}))}(e,t,s,r,this.ids)))).pipe((0,l.Qn)((t=>{const r=k(L(t,this.propertyFilters,this.additionalFilterFunc),this.propertySorting);return{[e]:{items:this.getPage(r),matchCount:r.length}}})))}getPage(e){return this.pageNumber&&this.pageSize?e.slice(this.pageSize*(this.pageNumber-1),this.pageSize*this.pageNumber):e}getCarbonVaultItems$(e,t,r){const{queries:{carbonState:s}}=this.carbonLegacyClient;return s({path:`userSession.personalData.${r}`}).pipe((0,a.U)((r=>{if((0,c.hx)(r)||!t(r.data))throw new Error(`Bad ${e} format`);return r.data})))}getQuarantinedSpacesTeamIds$(){const{queries:{carbonState:e}}=this.carbonLegacyClient;return e({path:"userSession.spaceData.spaces"}).pipe((0,a.U)((e=>{if((0,c.hx)(e)||!(0,R.u)(e.data))throw new Error("Bad spaces format");return e.data.filter((e=>this.isPremiumStatusSpaceQuarantined(e.details)))})),(0,a.U)((e=>e.map((e=>e.teamId)).sort())),(0,o.x)(((e,t)=>JSON.stringify(e)!==JSON.stringify(t))))}isPremiumStatusSpaceQuarantined(e){return"accepted"!==e.status.toLowerCase()&&Boolean(e.info.removeForcedContentEnabled)}};pe=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[d._])],pe)},36988:(e,t,r)=>{r.d(t,{U:()=>y});var s=r(88802),i=r(99634),a=r(73883),o=r(85390),n=r(43978),c=r(20754),l=r(87279),d=r(48844),u=r(85612),p=r(82706),h=r(88994),m=r(87969),g=r(77428);let v=class{constructor(e,t,r){this.vaultRepository=e,this.vaultOrganizationClient=t,this.sharingCollectionsClient=r,this.separator=",",this.collections=[],this.searchQuery="",this.normalizeString=e=>e.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase(),this.isVaultItemMatch=e=>{let t="";return this.collections.forEach((r=>{r.vaultItems.some((t=>t.id===e.id))&&(t+=`${r.name}${this.separator}`)})),this.isMatch(e,t)}}execute({body:e}){const{vaultItemTypes:t,searchQuery:r,...s}=e;this.searchQuery=r;const{queries:{queryCollections:i}}=this.vaultOrganizationClient,{queries:{sharedCollectionsWithItems:a}}=this.sharingCollectionsClient;return(0,o.a)([i({}),a()]).pipe((0,n.w)((([e,r])=>{if((0,l.hx)(e)||(0,l.hx)(r))throw new Error("Error querying collections");return this.collections=e.data.collections.concat(r.data),t?this.vaultRepository.fetchVaultItems$({vaultItemTypes:t,...s},this.isVaultItemMatch):this.vaultRepository.fetchVaultItems$({vaultItemTypes:Object.values(p.U),...s},this.isVaultItemMatch)})),(0,d.Qn)((e=>{let r;if(t)r={items:[],matchCount:0};else{const e=this.collections.filter((e=>this.isMatch(e)));r={items:e,matchCount:e.length}}return{...e,collectionsResult:r}})))}isMatch(e,t=""){return t+=Object.values(e).filter((e=>"object"!=typeof e)).join(this.separator),this.normalizeString(t).includes(this.normalizeString(this.searchQuery))}};v=(0,s.__decorate)([(0,c.e)(h.W),(0,s.__metadata)("design:paramtypes",[g.g,m.C,u.L])],v);let y=class{};y=(0,s.__decorate)([(0,i.Y)({api:a.R,handlers:{commands:{},events:{},queries:{search:v}},providers:[g.g]})],y)},74840:(e,t,r)=>{r.d(t,{z:()=>c});var s=r(86952),i=r(4212),a=r(34718),o=r(4613),n=r(79394);const c=(0,s.Q)({name:"vpnNotifications",commands:{markVpnProviderSeen:i.M,markInstallVpnSeen:a.b},events:{},queries:{hasSeenVpnProvider:o.D,hasSeenInstallVpn:n.w}})},34718:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},4212:(e,t,r)=>{r.d(t,{M:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.User})){}},79394:(e,t,r)=>{r.d(t,{w:()=>i});var s=r(99059);class i extends((0,s.k)()){}},4613:(e,t,r)=>{r.d(t,{D:()=>i});var s=r(99059);class i extends((0,s.k)()){}},72475:(e,t,r)=>{r.d(t,{u:()=>T});var s,i=r(88802),a=r(99634),o=r(74840),n=r(63663),c=r(87279),l=r(4212),d=r(25029),u=r(95681),p=r(23347),h=r(10722),m=r(7165);!function(e){e.VpnProvider="vpnProvider",e.InstallVpn="installVpn"}(s||(s={}));const g=m.z.object({notifications:m.z.record(m.z.nativeEnum(s),m.z.boolean())}),v=e=>g.safeParse(e).success;class y extends((0,u.Q)({storage:{schemaVersion:1,initialValue:{notifications:{vpnProvider:!1,installVpn:!1}},typeGuard:v},persist:!0,scope:d.F.User,storeName:"vpn-notifications-store",capacity:p.Y._010KB,codec:h.E})){}let _=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.notifications,vpnProvider:!0};return await this.store.set({...e,notifications:t}),(0,c.Vp)(void 0)}};_=(0,i.__decorate)([(0,n.W)(l.M),(0,i.__metadata)("design:paramtypes",[y])],_);var f=r(34718);let S=class{constructor(e){this.store=e}async execute(){const e=await this.store.getState(),t={...e.notifications,installVpn:!0};return await this.store.set({...e,notifications:t}),(0,c.Vp)(void 0)}};S=(0,i.__decorate)([(0,n.W)(f.b),(0,i.__metadata)("design:paramtypes",[y])],S);var E=r(87065),b=r(20754),w=r(4613);let A=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,E.U)((e=>(0,c.Vp)(!!e.notifications.vpnProvider))))}};A=(0,i.__decorate)([(0,b.e)(w.D),(0,i.__metadata)("design:paramtypes",[y])],A);var C=r(79394);let I=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,E.U)((e=>(0,c.Vp)(!!e.notifications.installVpn))))}};I=(0,i.__decorate)([(0,b.e)(C.w),(0,i.__metadata)("design:paramtypes",[y])],I);let T=class{};T=(0,i.__decorate)([(0,a.Y)({api:o.z,stores:[y],handlers:{commands:{markVpnProviderSeen:_,markInstallVpnSeen:S},events:{},queries:{hasSeenVpnProvider:A,hasSeenInstallVpn:I}}})],T)},43866:(e,t,r)=>{r.d(t,{d:()=>s});class s{constructor(){this.shutdownHooks=[],this.externalComponentReadyConditions=[],this.appReadyHooks=[]}addExternalComponentReadyCondition(e){this.externalComponentReadyConditions.push(e)}addAppReadyHook(e){this.appReadyHooks.push(e)}addShutdownHook(e){this.shutdownHooks.push(e)}removeShutdownHook(e){const t=this.shutdownHooks.indexOf(e);t>=0&&this.shutdownHooks.splice(t,1)}startup(){const e=this.waitAndTriggerAppReady();if(!this.externalComponentReadyConditions.length)return e;this.addShutdownHook((async()=>await e))}async shutDown(){for(;this.shutdownHooks.length>0;){const e=this.shutdownHooks.pop();e&&await e()}}async waitAndTriggerAppReady(){await Promise.all(this.externalComponentReadyConditions.map((e=>e()))),await this.executeStartupHooks(this.appReadyHooks)}async executeStartupHooks(e){for(;e.length>0;){const t=e.shift();if(t){const e=await t();e&&this.addShutdownHook(e)}}}}},21904:(e,t,r)=>{r.d(t,{O:()=>c,r:()=>l});var s=r(60399),i=r(24966),a=r(87065),o=r(30523),n=r(58376);class c{async waitTimeout(e){await(0,s.z)(this.createObservableTimer(e,e))}}class l extends c{constructor(){super(...arguments),this.subscribers$=new i.X(new Set),this.time=0,this.pendingTimerCount$=this.subscribers$.pipe((0,a.U)((e=>e.size)))}fireTimer(e=1){this.time+=e,[...this.subscribers$.value].forEach((e=>{e.next(this.time)}))}async allSubscribersDisconnected(){await(0,s.z)(this.pendingTimerCount$.pipe((0,o.h)((e=>!e))))}createObservableTimer(){return new n.y((e=>(this.subscribers$.next(new Set([...this.subscribers$.value,e])),()=>{this.subscribers$.next(new Set([...this.subscribers$.value].filter((t=>t!==e))))})))}}},96259:(e,t,r)=>{r.d(t,{t:()=>i,u:()=>a});var s=r(8987);const i=(e,t)=>(()=>{const e=t=>({define:()=>t,with:r=>{const s={api:r.module,main:r.on,queryOnly:r.queryOnly??[]},i={[r.module.name]:s};return e({...t,...i})}});return e({})})().with({module:s.t$,on:e}),a=i("node",[])},26457:(e,t,r)=>{r.d(t,{V:()=>s,W:()=>i});class s{}class i extends s{log(){}error(){}warn(){}trace(){}}},84065:(e,t,r)=>{r.d(t,{b:()=>L});var s=r(1484),i=r(31408),a=r(42949),o=r(94189),n=r(96917),c=r(16855),l=r(83081),d=r(43866),u=r(26457),p=r(88802),h=r(17988),m=r(10514);const g={name:"api",commands:{},events:{},queries:{}};var v=r(25029),y=r(95087),_=r(21869),f=r(22838);let S=class{constructor(e,t,r){this.introspection=e,this.moduleRef=t,this.clients=r}async execute(e){const t=s.ContextIdFactory.getByRequest(e),{type:r}=e;if(!(e.module in this.introspection.modules))throw new Error("Unknown module "+e.module);const i=this.introspection.modules[e.module],a=i.api??g,o=i.handlers??f.TB;switch(r){case m.Y.Query:{const{queries:r}=a;if(e.name in r){const s=new(0,r[e.name])(e.body),i=o.queries[e.name];return{result:(await this.moduleRef.resolve(i,t,{strict:!1})).execute(s,{name:e.name})}}throw new Error("Unknown query "+e.name)}case m.Y.Command:{const{commands:r}=a;if(e.name in r){const s=new(0,r[e.name])(e.body),i=o.commands[e.name],a=await this.moduleRef.resolve(i,t,{strict:!1});return{result:await a.execute(s,{name:e.name})}}throw new Error("Unknown command "+e.name)}case m.Y.Event:{const{events:r}=a;if(e.name in r){const s=new(0,r[e.name])(e.body),i=Object.values(this.introspection.modules).flatMap((t=>(t.handlers??f.TB).events[e.module]?.events[e.name])),a=await Promise.all(i.filter((e=>this.introspection.supportedEventHandlers.has(e))).map((async e=>await this.moduleRef.resolve(e,t,{strict:!1}))));return void await Promise.all(a.map((e=>e.handle(s))))}throw new Error("Unknown event "+e.name)}case m.Y.Cron:{const r=(i.crons??[]).find((t=>t.name===e.name));if(!r)throw new Error("unknown cron "+e.name);if(r.scope===v.F.User){if(!e.context.getOrFail(_.l.UserName,{errorMessage:`Expected ${_.l.UserName} to be set in the request context`}))return{result:!1}}const s=await this.moduleRef.resolve(r.handler,t,{strict:!1});return s.isRunnable&&!await s.isRunnable()?{result:!1}:(await s.run(),{result:!0})}}return(0,y.U)(r)}};(0,p.__decorate)([(0,h.All)(),(0,p.__param)(0,(0,h.Req)()),(0,p.__metadata)("design:type",Function),(0,p.__metadata)("design:paramtypes",[Object]),(0,p.__metadata)("design:returntype",Promise)],S.prototype,"execute",null),S=(0,p.__decorate)([(0,h.Controller)({scope:h.Scope.REQUEST,durable:!1}),(0,p.__metadata)("design:paramtypes",[f.Q1,s.ModuleRef,o.m])],S);var E=r(21904),b=r(11053),w=r(38144),A=r(23711),C=r(43702),I=r(10722),T=r(91199),P=r(4603),O=r(75994),R=r(9671),D=r(71949),N=r(56860);let U=class{catch(e,t){t.switchToHttp().getResponse().fail(e)}};U=(0,p.__decorate)([(0,h.Catch)(Error)],U);const F={provide:_.f,scope:h.Scope.REQUEST,inject:[s.REQUEST],useFactory:e=>{const t=(()=>{switch(e.type){case m.Y.Command:case m.Y.Event:case m.Y.Query:case m.Y.Cron:return e.context;case m.Y.Init:return new _.f;default:(0,y.U)(e)}})();return t.getOrAdd(_.l.UseCaseId,(()=>String(s.ContextIdFactory.getByRequest(e).id))),t}};var M=r(97631);class L{static addGlobalNestInterceptor(e){this.globalInterceptors.push(e)}static create({brokers:{cqrs:e,event:t},configProviders:r,keyValueStorageInfrastructure:p,lifeCycle:h,logger:m,modules:g,nodeConfiguration:v,storeInfrastructureFactory:y,timers:x,jsonFetcher:k,defaultDeviceStorageEncryptionCodecProvider:G,defaultUserStorageEncryptionCodecProvider:V,storeList:K,interceptors:j,introspection:B,moduleClientsProviders:W,userUseCaseScopeProvider:z}){return{module:L,providers:[i.ExplorerService,{provide:T.QI,useValue:p},{provide:d.d,useValue:h},{provide:c.$,useValue:v},{provide:a.d,useValue:e},{provide:n.a,useValue:t},{provide:O.X,useValue:k},o.w,o.m,...r,{provide:u.V,useValue:m},F,{provide:l.G,useValue:y},{provide:E.O,useValue:x},b.u1,{provide:P.u,useValue:new P.u(p)},A.z,G,V,C.b,I.E,{provide:f.Q1,useValue:B},{provide:N.D,useValue:K},D.X,R.J,{provide:s.APP_FILTER,useClass:U},...[...this.globalInterceptors,...j].flatMap((e=>[{provide:s.APP_INTERCEPTOR,useClass:e},e])),...W,z],imports:[...g],exports:[d.d,c.$,a.d,n.a,o.w,o.m,...r.map((({provide:e})=>e)),u.V,_.f,l.G,E.O,b.u1,A.z,w.h,w.s,C.b,I.E,P.u,T.QI,O.X,D.X,R.J,f.Q1,...W.map((({provide:e})=>e)),M.g],controllers:[S],global:!0}}}L.globalInterceptors=[]},10514:(e,t,r)=>{r.d(t,{H:()=>a,Y:()=>s});r(65192);var s,i=r(21869);!function(e){e.Command="command",e.Query="query",e.Event="event",e.Init="init",e.Cron="cron"}(s||(s={}));const a={body:void 0,context:new i.f,module:"module",name:"command",type:s.Command}},9201:(e,t,r)=>{r.d(t,{u:()=>Te,W:()=>Pe});var s=r(10722),i=r(30523),a=r(60399),o=r(1484),n=r(28489);var c=r(84065),l=r(17988),d=r(87279),u=r(95087),p=r(24966),h=r(17350),m=r(162),g=r(46420),v=r(10514),y=r(21869);const _=()=>{},f=()=>{throw new Error("Not supported")};class S{constructor(e,t,r){this.cqrsBroker=e,this.eventsBroker=t,this.cronsBroker=r,this.isListening$=new p.X(!1),this.use=f,this.get=f,this.post=f,this.head=f,this.delete=f,this.put=f,this.options=f,this.patch=f,this.end=f,this.applyVersionFilter=f,this.disconnect=_,this.close=_,this.status=f,this.render=f,this.redirect=f,this.setHeader=f,this.enableCors=f,this.initHttpServer=f,this.registerParserMiddleware=f,this.createMiddlewareFactory=f}isHeadersSent(){return!1}bindHandler(e){if(this.cqrsCallbacks||this.eventCallbacks)throw new Error("Handler already registered");this.cqrsCallbacks={onCommand:(t,r,s,i)=>new Promise(((a,o)=>{e({type:v.Y.Command,module:t,name:r,body:s,context:i},{type:v.Y.Command,value:{result:(0,d.Vp)(void 0)},reply:e=>a(e),fail:e=>o(e)})})),onQuery:(t,r,s,i)=>{const a=new Promise(((a,o)=>{e({type:v.Y.Query,module:t,name:r,body:s,context:i},{type:v.Y.Query,value:{result:h.E},reply:e=>a(e),fail:e=>o(e)})}));return(0,m.D)(a).pipe((0,g.J)())}},this.eventCallbacks={onLocalEvent:(t,r,s,i,a)=>new Promise(((r,o)=>{e({type:v.Y.Event,body:i,context:a,name:s,module:t},{type:v.Y.Event,reply:()=>r(),fail:e=>o(e)})}))},this.cronCallbacks=(t,r)=>new Promise(((s,i)=>{e({type:v.Y.Cron,context:new y.f,module:t,name:r},{type:v.Y.Cron,value:{result:!1},reply:e=>s(e),fail:e=>i(e)})}))}all(e,t){if(!t)throw new Error("Provide a handler");return this.bindHandler(t)}async listen(){if(!this.cqrsCallbacks||!this.eventCallbacks||!this.cronCallbacks)throw new Error("Please call `all(path, handler)` first");const e=await this.cqrsBroker.connect(this.cqrsCallbacks).start(),t=await this.eventsBroker.connect(this.eventCallbacks).start(),r=await this.cronsBroker.connect(this.cronCallbacks).start(),{isListening$:s}=this;this.disconnect=()=>{e.stop(),t.stop(),r.stop(),s.complete()},this.close=this.disconnect,this.isListening$.next(!0)}reply(e,t){switch(e.type){case v.Y.Query:case v.Y.Command:e.reply(t.result);break;case v.Y.Event:e.reply();break;case v.Y.Cron:e.reply(t.result);break;default:(0,u.U)(e)}}getInstance(){return this}getHttpServer(){return{once:_,address:()=>"",removeListener:_}}getType(){return"AppCoreNode"}}const E=()=>{};class b extends o.AbstractHttpAdapter{constructor(e,t,r){super(new S(e,t,r)),this.createMiddlewareFactory=this.instance.createMiddlewareFactory,this.close=this.instance.close,this.reply=this.instance.reply,this.useStaticAssets=E,this.setViewEngine=E,this.getRequestHostname=E,this.status=E,this.render=E,this.redirect=E,this.setNotFoundHandler=E,this.setHeader=E,this.registerParserMiddleware=E,this.enableCors=E,this.setErrorHandler=E,this.end=E,this.isListening$=this.instance.isListening$}initHttpServer(){this.setHttpServer({once:E,address:()=>"",removeListener:E})}getRequestMethod(){return l.RequestMethod.ALL}getRequestUrl(){return"/"}getType(){return"CoreApp"}isHeadersSent(){return!1}applyVersionFilter(){throw new Error("Versioning not supported")}}var w=r(43866),A=r(96917),C=r(42949),I=r(40945),T=r(73018),P=r(79063),O=r(22838);const R=(e,t)=>t.reduce(((t,r)=>{const s=Reflect.getMetadata(P.o,r.module);if(!(0,O.Vy)(s))return t;s.onFrameworkInit&&(s.onFrameworkInit instanceof Array?t.onFrameworkInits=t.onFrameworkInits.concat(s.onFrameworkInit):t.onFrameworkInits.push(s.onFrameworkInit));const i=s.api?.name??s.sharedModuleName??"unnamed";return t.configProviders.push(...function(e,t,r,s){if(!r.configurations)return[];const{configurations:i}=r,a=[];return Object.keys(i).forEach((e=>{const r=i[e].token,o=s.configurations?.[e];if(!o)throw new Error(`Missing '${e}' configuration for '${t}' module`);a.push({...o,provide:r})})),Object.keys(s.configurations??{}).forEach((s=>{r.configurations?.[s]||e.error(`Unknown '${s}' configuration for '${t}' module will be unused`)})),a}(e,i,s,r)),s.api?.name&&t.modulesMetadata.set(s.api.name,s),t.modules.push(r.module),s.crons&&t.crons.push(...s.crons.map((e=>({...e,moduleName:i})))),s.handlers?.events&&t.eventHandlers.push(...Object.values(s.handlers.events).flatMap((e=>Object.values(e.events)))),s.stores&&t.stores.push(...s.stores),t.allDeclarations[i]=s,t}),{configProviders:new Array,modules:new Array,modulesMetadata:new Map,onFrameworkInits:new Array,crons:new Array,eventHandlers:new Array,stores:new Array,allDeclarations:(0,n.Ay)({})});var D=r(54452),N=r(16855),U=r(38144),F=r(15524),M=r(83081),L=r(69594),x=r(17321),k=r(65192);function G(e){const{parameterProvider:t,token:r}=e;switch(t.type){case x.j.CLASS_PROVIDER:return{provide:r,useClass:t.useClass};case x.j.VALUE_PROVIDER:return{provide:r,useValue:t.useValue};default:(0,u.U)(t)}}var V=r(56860),K=r(88802),j=r(99634),B=r(37920),W=r(31638),z=r(63364);class H extends z.fW{constructor(){super(h.E)}}const Q={sink:(0,W.z)(new class{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}),uncaughtErrorSource:(0,W.z)(new H)};var q=r(57924),Y=r(68475),$=r(43004);let X=class{constructor(e){this.logger=e}handle(e){const{error:t,fileLocation:r,lineNumber:s,origin:i}=e,[a,o]=t instanceof Y.c?[t.exception,t.useCaseStacktrace]:[t];return this.logger.captureException(a,{fileLocation:r,lineNumber:s,origin:i,useCaseStacktrace:o},$.w.CRITICAL)}};X=(0,K.__decorate)([(0,q.GS)(),(0,K.__metadata)("design:paramtypes",[B.v])],X);let Z=class{constructor(e,t,r,s){this.sink=e,this.lifeCycle=t,this.moduleRef=r,this.uncaughtErrorsSource=s}onFrameworkInit(){this.lifeCycle.addAppReadyHook((async()=>{const{stop:e}=await this.sink.start(),t=this.uncaughtErrorsSource.events$.subscribe(this.onUncaughtErrorEvent.bind(this));return()=>{t.unsubscribe(),e()}}))}onUncaughtErrorEvent(e){this.moduleRef.get(X).handle(e)}};Z=(0,K.__decorate)([(0,q.ar)(),(0,K.__metadata)("design:paramtypes",[z.qD,w.d,o.ModuleRef,z.fW])],Z);var J,ee=r(428);let te=J=class{static configure(e){return{module:J,configurations:{...Q,sink:e.sink,...e.uncaughtErrorSource?{uncaughtErrorSource:e.uncaughtErrorSource}:{}}}}};te=J=(0,K.__decorate)([(0,j.Y)({sharedModuleName:"exception-logging",providers:[B.v,{provide:o.APP_INTERCEPTOR,useClass:Y.x},ee.F,X],configurations:{sink:{token:z.qD},uncaughtErrorSource:{token:z.fW}},exports:[B.v,ee.F],onFrameworkInit:Z,requiredFeatureFlips:[]})],te);var re=r(43978),se=r(69885),ie=r(25313),ae=r(82567),oe=r(87065),ne=r(25029),ce=r(8987),le=r(94189);const de={tag:""};let ue=class{constructor(e,t,r){this.clients=e,this.config=t,this.introspection=r}intercept(e,t){const r=e.switchToHttp().getRequest(),{appDefinition:s}=this.config;if(r.type===v.Y.Cron)return this.checkCronActiveUser(t,r);if(!(r.module in s))return t.handle();const i=s[r.module].api;switch(r.type){case v.Y.Query:return this.checkQueryActiveUser(t,r,i);case v.Y.Command:return this.checkCommandActiveUser(t,r,i);case v.Y.Event:return this.checkEventActiveUser(t,r,i);default:(0,u.U)(r)}}checkCronActiveUser(e,t){const r=(this.introspection.modules[t.module].crons??[]).find((e=>e.name===t.name));if(!r)throw new Error("No such cron "+t.name);return r.scope===ne.F.Device?e.handle():this.checkActiveUserPromise(e,t.context,{noUserError:de,scope:ne.F.User},"Cron")}checkQueryActiveUser(e,t,r){const{queries:s}=r;if(t.name in s){const r=s[t.name],{metadata:i}=r;return this.checkActiveUserObservable(e,t.context,i,`Query ${t.module}.${t.name}`)}return e.handle()}checkCommandActiveUser(e,t,r){const{commands:s}=r;if(t.name in s){const r=s[t.name],{metadata:i}=r;return this.checkActiveUserPromise(e,t.context,i,`Command ${t.module}.${t.name}`)}return e.handle()}checkEventActiveUser(e,t,r){const{events:s}=r;if(t.name in s){const r=s[t.name],{metadata:i}=r;return this.checkActiveUserPromise(e,t.context,i,`Event ${t.module}.${t.name}`)}return e.handle()}checkActiveUserPromise(e,t,r,s){if(r.scope!==ne.F.User)return e.handle();const{noUserError:i}=r;return(0,m.D)(t.getOrAdd(y.l.UserName,(()=>this.queryUserName()))).pipe((0,re.w)((t=>{if(t)return e.handle();if(i)return(0,se.of)({result:(0,d.Rn)(i)});throw new Error(`Not logged in : ${s}`)})))}checkActiveUserObservable(e,t,r,s){if(r.scope!==ne.F.User)return e.handle();const{noUserError:i}=r;return(0,se.of)({result:i?this.createResultObservable(e,t,(()=>new p.X((0,d.Rn)(i)))):this.createResultObservable(e,t,(()=>(0,ie._)((()=>new Error(`Not logged in : ${s}`)))))})}createResultObservable(e,t,r){return this.queryUserName$().pipe((0,ae.b)((e=>{t.set(y.l.UserName,e)})),(0,re.w)((t=>t?e.handle().pipe((0,re.w)((({result:e})=>e))):r())))}queryUserName$(){return this.clients.getClient(ce.t$).queries.activeUser().pipe((0,oe.U)((e=>{if((0,d.d6)(e)&&(0,d.db)(e).userName)return e.data.userName})))}queryUserName(){return(0,a.z)(this.queryUserName$())}};ue=(0,K.__decorate)([(0,l.Injectable)(),(0,K.__metadata)("design:paramtypes",[le.m,N.$,O.Q1])],ue);class pe{constructor(e,t){this.storage=e,this.storageKey=`crons.${t}`}async setState(e){await this.storage.set(this.storageKey,JSON.stringify(e))}async getState(){const e=await this.storage.get(this.storageKey);if(!e)return{entries:[]};const t=JSON.parse(e);return(r=t)&&"object"==typeof r&&"entries"in r&&Array.isArray(r.entries)&&r.entries.every((e=>function(e){return!!e&&"object"==typeof e&&"dueTimestamp"in e&&"moduleName"in e&&"name"in e&&"string"==typeof e.name&&"string"==typeof e.moduleName&&"number"==typeof e.dueTimestamp}(e)))?t:{entries:[]};var r}}var he=r(34987);const me=6e4;function ge(e){return Math.ceil(e/me)*me}function ve(e){return Math.floor(e/me)*me}class ye{constructor(e,t){this.infra=e,this.definitions=t}async init(){const e=ge(this.infra.timers.time),t=await this.infra.repository.getState(),r=this.definitions.filter((e=>!t.entries.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),s={entries:[...t.entries.filter((e=>this.definitions.find((t=>t.name===e.name&&t.moduleName===e.moduleName)))),...r.map((t=>({...t,dueTimestamp:e+t.periodInMinutes*me})))]};await this.infra.repository.setState(s)}connect(e){const{infra:t,definitions:r}=this;return{start:async()=>{await this.init();const s=t.cronSource.alarm$.pipe((0,he.b)((async()=>{const s=await t.repository.getState(),i=ge(t.timers.time),a=ve(t.timers.time),o=s.entries.filter((e=>e.dueTimestamp<=i));await Promise.allSettled(o.map((i=>{const o=r.find((e=>e.moduleName===i.moduleName&&e.name===i.name));if(!o)throw new Error("we should have a declaration");return async function(r,s,i,a){let o=!1;try{o=await e(i.moduleName,i.name)}finally{o&&(i.dueTimestamp=ve(r+a.periodInMinutes*me),await t.repository.setState(s))}}(a,s,i,o)})))}))).subscribe();return{stop:()=>{s.unsubscribe()}}}}}}let _e=class{constructor(e,t){this.request=e,this.useCaseStacktraceRepo=t}intercept(e,t){return this.useCaseStacktraceRepo.append(this.request.name),t.handle()}};_e=(0,K.__decorate)([(0,l.Injectable)({scope:l.Scope.REQUEST}),(0,K.__param)(0,(0,l.Inject)(o.REQUEST)),(0,K.__metadata)("design:paramtypes",[Object,ee.F])],_e);class fe{constructor(e,t){this.client=e.getClient(t)}get commands(){return this.client.commands}get queries(){return this.client.queries}}var Se=r(69008),Ee=r(97631),be=r(33920);let we;function Ae(e){return function(e){return"module"in e}(e)?e:{module:e}}var Ce=r(73656);const Ie=[_e,ue],Te=async({appDefinition:e,channels:t,currentNode:r,implementations:l,otherModules:d=[],logger:u=new T.Mn,storeInfrastructureFactory:p=new M.N,channelsListener:h=D.y,timers:m=new T.mZ,keyValueStorageInfrastructure:g=new F.s,jsonFetcher:_=new T.kl,cronSource:f=new L._C(m),defaultDeviceStorageEncryptionCodec:S={type:x.j.CLASS_PROVIDER,useClass:s.E},defaultUserStorageEncryptionCodec:E={type:x.j.CLASS_PROVIDER,useClass:s.E},exceptionLogging:P=Q})=>{const K=()=>{throw new Error("Aborted")};Ce.abort=K,Ce.exit=K;const j=[...[te.configure(P)],...d,...Object.keys(l).map((e=>e)).map((e=>l[e]))].map(Ae),{configProviders:B,modules:W,modulesMetadata:z,onFrameworkInits:H,crons:Y,eventHandlers:$,stores:X,allDeclarations:Z}=R(u,j),J=new V.D;X.forEach((e=>{J.registerClass(e)})),((e,t,r)=>{const s=new Set([...r.keys()]),i=new Set(Object.values(e).filter((e=>e.main===t||e.queryOnly.includes(t))).map((e=>e.api.name))),a=[...i].filter((e=>!s.has(e))),o=[...s].filter((e=>!i.has(e)));if(a.length>0)throw new Error("These APIs are not implemented "+JSON.stringify(a));if(o.length>0)throw new Error("Some implementations do not have APIS "+JSON.stringify(o))})(e,r,z);const ee=(e=>[...e.entries()].reduce(((e,[t,r])=>{const s=r.handlers?.events??{};return e[t]=Object.values(s).reduce(((e,t)=>t.name?(e[t.name]=Object.keys(t.events),e):e),(0,n.Ay)({})),e}),(0,n.Ay)({})))(z),re=new N.$({appDefinition:e,channels:t,channelsListener:h,currentNode:r,subscriptions:ee}),se=new C.d(re),ie=new A.a(re),ae=new ye({cronSource:f,repository:new pe(g,r),timers:m},Y),oe=new b(se,ie,ae),ne=G({token:U.h,parameterProvider:S}),ce=G({token:U.s,parameterProvider:E}),de=new w.d,ue=new O.Q1(new Set($),Z),he=function(e){const t=[];return Object.values(e).forEach((e=>{const{api:r}=e,{ClientClass:s}=r;s&&((0,q.GS)()(s),t.push({provide:s,useFactory:e=>new fe(e,r),inject:[le.w]}))})),t}(e),me={useFactory:(e,t,r)=>{const s=e.get(y.l.UserName);if(s)return we&&we.status!==be.p.Closed||(we=new Ee.g(s,r,t)),Promise.resolve(we)},provide:Ee.g,inject:[y.f,Se.Q,w.d]},ge=c.b.create({nodeConfiguration:re,brokers:{cqrs:se,event:ie},modules:W,configProviders:B,logger:u,lifeCycle:de,storeInfrastructureFactory:p,timers:m,keyValueStorageInfrastructure:g,jsonFetcher:_,defaultDeviceStorageEncryptionCodecProvider:ne,defaultUserStorageEncryptionCodecProvider:ce,storeList:J,interceptors:Ie,introspection:ue,moduleClientsProviders:he,userUseCaseScopeProvider:me}),ve=await o.NestFactory.create(ge,oe,{logger:u}),_e=await ve.init();await async function(e,t){const r=Object.freeze({id:-1}),s=e.map((async e=>{const s={type:v.Y.Init,[k.REQUEST_CONTEXT_ID]:r};t.registerRequestByContextId(s,r);const i=await t.resolve(e,r,{strict:!1});await i.onFrameworkInit()}));await Promise.all(s)}(H,_e),ve.listen("");const Te=oe.isListening$.pipe((0,i.h)((e=>!!e)));return await(0,a.z)(Te),de.addShutdownHook((()=>ve.close())),await de.startup(),{stop:()=>de.shutDown(),createClient:()=>(0,I.R)(e,se),sendEvent:(e,t,r,s)=>ie.publishEvent(e,t,r,s??new y.f)}},Pe=e=>Te({...e,appDefinition:e.appDefinition,channels:{},currentNode:"node"})},42949:(e,t,r)=>{r.d(t,{d:()=>g});var s=r(162),i=r(60399),a=r(30523),o=r(87065),n=r(17350),c=r(95087),l=r(28489);const d=e=>"response"===e.type,u=(e,t,r,s)=>Object.keys(e).reduce(((i,a)=>{const{commandMailbox:o,queryMailbox:n}=(i=>{const{main:a,queryOnly:o}=e[i],n={type:"local",onMessage:s};if(a===t)return{commandMailbox:n,queryMailbox:n};const c={type:"remote",channel:r[a]};return{commandMailbox:c,queryMailbox:t&&o.includes(t)?n:c}})(a);return i[`command-${a}`]=o,i[`query-${a}`]=n,i}),(0,l.Ay)({}));var p=r(65488),h=r(21869);const m=()=>(0,s.D)([]);class g{constructor(e){this.config=e}async sendCommand(e,t,r,s){if(!this.broker)throw new Error("call connect() first");return await(0,i.z)(this.broker.sendMessage(`command-${e}`,{type:"command",module:e,commandName:String(t),command:r,context:s.toSerializable()}).pipe((0,a.h)(d),(0,o.U)((e=>e.response))))}sendQuery(e,t,r,s){if(!this.broker)throw new Error("call connect() first");return this.broker.sendMessage(`query-${e}`,{type:"query",module:e,queryName:String(t),query:r,context:s.toSerializable()}).pipe((0,a.h)(d),(0,o.U)((e=>e.response)))}connect(e){const t=e?(t,r,i)=>{switch(r.type){case"response":return n.E;case"command":return(0,s.D)(e.onCommand(r.module,r.commandName,r.command,h.f.fromSerializable(r.context),{isReminder:i.isReminder})).pipe((0,o.U)((e=>({type:"response",response:e}))));case"query":return(0,s.D)(e.onQuery(r.module,r.queryName,r.query,h.f.fromSerializable(r.context))).pipe((0,o.U)((e=>({type:"response",response:e}))))}(0,c.U)(r)}:m,r=u(this.config.appDefinition,this.config.currentNode,this.config.channels,t);return this.broker=new p.U(r),this.broker.connect(Object.values(this.config.channels),this.config.channelsListener)}}},94189:(e,t,r)=>{r.d(t,{m:()=>d,w:()=>l});var s=r(88802),i=r(57924),a=r(16855),o=r(42949),n=r(40945),c=r(21869);let l=class{constructor(e,t,r){this.broker=e,this.configuration=t,this.context=r}getClient(e){return(0,n.c)(this.configuration.appDefinition,this.broker,e.name,this.context)}};l=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.d,a.$,c.f])],l);let d=class{constructor(e,t){this.configuration=e,this.broker=t}getClient(e){return(0,n.c)(this.configuration.appDefinition,this.broker,e.name)}};d=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.$,o.d])],d)},40945:(e,t,r)=>{r.d(t,{R:()=>o,c:()=>a});var s=r(28489),i=r(21869);function a(e,t,r,a){return{commands:Object.keys(e[r].api.commands).reduce(((e,s)=>(e[s]=e=>{const o=a??new i.f;return t.sendCommand(r,s,e,o)},e)),(0,s.Ay)({})),queries:(()=>{const o=e[r].api.queries;return Object.keys(o).reduce(((e,s)=>(e[s]=e=>{const o=a??new i.f;return t.sendQuery(r,s,e,o)},e)),(0,s.Ay)({}))})()}}function o(e,t){return Object.keys(e).map((e=>e)).reduce(((r,s)=>(r[s]=a(e,t,s),r)),{})}},81459:(e,t,r)=>{r.d(t,{C:()=>d,f:()=>l});var s=r(88802),i=r(17988),a=r(57924),o=r(93417),n=r(96917),c=r(21869);let l=class{constructor(e,t,r){this.apiName=e,this.broker=t,this.context=r}sendEvent(e,t){return this.broker.publishEvent(this.apiName,e,t,this.context)}};l=(0,s.__decorate)([(0,a.GS)(),(0,s.__param)(0,(0,i.Inject)(o.r)),(0,s.__metadata)("design:paramtypes",[Object,n.a,c.f])],l);let d=class{constructor(e,t){this.apiName=e,this.broker=t}sendEvent(e,t,r){return this.broker.publishEvent(this.apiName,e,t,r??new c.f)}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__param)(0,(0,i.Inject)(o.r)),(0,s.__metadata)("design:paramtypes",[Object,n.a])],d)},96917:(e,t,r)=>{r.d(t,{a:()=>g});var s=r(88802),i=r(162),a=r(87065),o=r(17350),n=r(69885),c=r(65488),l=r(28489);const d={type:"ask"},u={type:"eventResponse"};var p=r(57924),h=r(16855),m=r(21869);let g=class{constructor(e){this.regenerateReverseSubscriptionMap=()=>{const{configuration:e,subscriberToEvent:t}=this,r=e.getModuleNames().reduce(((e,t)=>({...e,[t]:new Map})),{});return e.getNodeList().reduce(((e,r)=>{const s=t[r];return Object.entries(s).forEach((([t,s])=>{const i=e[t];s.forEach((e=>{const t=[...i.get(e)??[],r];i.set(e,t)}))})),e}),r)},this.configuration=e;const t=Object.entries(e.appDefinition).reduce(((e,[t,r])=>(e[t]=Object.keys(r.api.events),e)),{});this.subscriberToEvent=this.configuration.getNodeList().reduce(((e,r)=>(e[r]={...t},e)),{}),this.eventToSubscriber=this.regenerateReverseSubscriptionMap()}async publishEvent(e,t,r,s){const{broker:i,eventToSubscriber:a}=this;if(!i)throw new Error("Not started");const o=(a[e].get(t)??[]).map((i=>({type:"event",context:s.toSerializable(),event:r,eventName:t,moduleSource:e,nodeDestination:i})));await Promise.all(o.map((async e=>{await i.trySendMessage(`event-${e.nodeDestination}`,e)})))}connect(e){const{configuration:t}=this,r=Object.keys(t.subscriptions).reduce(((e,r)=>({...e,...t.subscriptions[r]})),(0,l.Ay)({})),s={type:"subscriptions",nodeName:t.currentNode,subscribesTo:r},p=((e,t)=>e.getNodeList().reduce(((r,s)=>(s===e.currentNode?r[`event-${s}`]={type:"local",onMessage:t}:r[`event-${s}`]={type:"remote",channel:e.channels[s]},r)),(0,l.Ay)({})))(this.configuration,((t,r,c)=>{switch(r.type){case"event":return(0,i.D)(e.onLocalEvent(r.moduleSource,r.nodeDestination,r.eventName,r.event,m.f.fromSerializable(r.context),c)).pipe((0,a.U)((()=>u)));case"eventResponse":return o.E;case"subscriptions":return this.subscriberToEvent[r.nodeName]=r.subscribesTo,this.eventToSubscriber=this.regenerateReverseSubscriptionMap(),(0,n.of)(u);case"ask":return(0,n.of)(s)}})),h=new c.U(p);return t.getNodeList().map((async e=>{await h.trySendMessage(`event-${e}`,s),await h.trySendMessage(`event-${e}`,d)})),this.broker=h,h.connect(Object.values(t.channels),t.channelsListener)}};g=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.$])],g)},63663:(e,t,r)=>{r.d(t,{W:()=>i});var s=r(57924);function i(e){const t=(0,s.GS)();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}},11053:(e,t,r)=>{r.d(t,{Tx:()=>u,b2:()=>d,u1:()=>p});var s=r(88802),i=r(6220),a=r(7074),o=r(58376),n=r(57924),c=r(21904),l=r(94189);function d(e){return e}class u{constructor(e,t,{args:r,commandName:s}){const o=t.commands[s];this.refreshObservable$=e.pipe((0,i.z)((async()=>{await o(r)})),(0,a.B)({}))}withRefresh(){return e=>new o.y((t=>{const r=this.refreshObservable$.subscribe();return r.add(e.subscribe(t)),r}))}}let p=class{constructor(e,t){this.timers=e,this.cqrsClient=t,this.map=new WeakMap}getRefresher(e){const t=this.map.get(e);if(t)return t;return new u(this.timers.createObservableTimer(e.period,e.period),this.cqrsClient.getClient(e.api),e)}};p=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[c.O,l.m])],p)},68307:(e,t,r)=>{r.d(t,{b:()=>i});var s=r(57924);function i(e){const t=(0,s.GS)();return r=>{if(Reflect.hasMetadata("dl-handlers",e)){const t=Reflect.getMetadata("dl-handlers",e);Reflect.defineMetadata("dl-handlers",[...t,r],e)}else Reflect.defineMetadata("dl-handlers",[r],e);t(r)}}},20754:(e,t,r)=>{r.d(t,{e:()=>i});var s=r(57924);function i(e){const t=(0,s.GS)();return r=>{Reflect.defineMetadata("dl-handler",r,e),t(r)}}},79063:(e,t,r)=>{r.d(t,{o:()=>s});const s="dl-module"},38679:(e,t,r)=>{r.d(t,{H:()=>c});var s=r(1484),i=r(78776),a=r(57924),o=r(64987),n=r(43866);const c=(e,t)=>{const r=t.token??(0,i.Z)();class c{constructor(){this.mutex=new o.WU}getOrCreate(e,t){return this.mutex.runExclusive((async()=>(this.instance||(t.addShutdownHook((()=>{this.invalidate()})),this.instance=await e()),this.instance)))}invalidate(){this.instance=void 0}}(0,a.GS)()(c);const l=c,d={token:e,inject:[c,n.d,s.ModuleRef,s.REQUEST],asyncFactory:(e,t,i,a)=>{const o=s.ContextIdFactory.getByRequest(a);return e.getOrCreate((()=>i.resolve(r,o)),t)}};return[{...t,token:r},l,d]}},57924:(e,t,r)=>{r.d(t,{GS:()=>a,ar:()=>o,xB:()=>i});var s=r(17988);function i(){return(0,s.Global)()}function a(e){return(0,s.Injectable)({scope:e?.neverReuseInstance?s.Scope.TRANSIENT:s.Scope.DEFAULT})}const o=()=>a()},99634:(e,t,r)=>{r.d(t,{Y:()=>_,g:()=>v});r(60171);var s=r(79063),i=r(17988),a=r(93417),o=r(88802),n=r(43702),c=r(23711),l=r(91199),d=r(21869);const u=new n.b,p=new c.z;let h=class{constructor(e,t,r){this.kv=e,this.prefix=`batch-storage.${r}.${t.get(d.l.UserName)}`}async getBatchState(e){const t=await this.kv.get(`${this.prefix}.${e}`);return t?this.stringToState(t):{queue:[]}}async setBatchState(e,t){const r=this.stateToString(t);return await this.kv.set(`${this.prefix}.${e}`,r)}stateToString(e){const t=u.encode(e);return p.encode(t)}stringToState(e){const t=p.decode(e);return u.decode(t)}};h=(0,o.__decorate)([(0,o.__param)(2,(0,i.Inject)(a.r)),(0,o.__metadata)("design:paramtypes",[l.QI,d.f,String])],h);class m{getProviders(e){if(!e.length)return[];return[...e.map((e=>({provide:e,inject:[h,e.Definition.chunkProcessor],useFactory:(t,r)=>new e(t,r)}))),...e.map((({Definition:{chunkProcessor:e}})=>e)),h]}}var g=r(5711);const v=(e,t)=>({[e.name]:{name:e.name,events:t}}),y=(e,t)=>{const{exports:r=[],imports:s=[],providers:i=[],onFrameworkInit:a=[],stores:o=[],crons:n=[]}=e,c=[a,t.onFrameworkInit??[]].flat();return{...e,exports:r.concat(t.exports??[]),imports:s.concat(t.imports??[]),providers:i.concat(t.providers??[]),onFrameworkInit:c,stores:o.concat(t.stores??[]),crons:n.concat(t.crons??[])}};function _(e){const{composes:t=[]}=e;e=t.reduce(((e,t)=>y(e,t)),e);const{exports:r=[],imports:o=[],handlers:n={commands:{},events:{},queries:{}},providers:c=[],onFrameworkInit:l=[],stores:d,batchExecutors:u,crons:p}=e,h=e.api?.name??e.sharedModuleName,v=h?(0,g.N)(...d??[]):[],_=h?(new m).getProviders(u??[]):[],f=[...c,...(p??[]).map((e=>e.handler)),...v,..._,...Object.values(n.commands),...Object.values(n.queries),...Object.values(n.events).map((e=>Object.values(e.events))).reduce(((e,t)=>[...e,...t]),new Array),...l instanceof Array?l:[l],{provide:a.r,useValue:h}],{asyncProviders:S,basicClassProviders:E}=f.reduce(((e,t)=>{return"object"==typeof(r=t)&&"token"in r&&"asyncFactory"in r&&"function"==typeof r.asyncFactory?{asyncProviders:[...e.asyncProviders,t],basicClassProviders:e.basicClassProviders}:{asyncProviders:e.asyncProviders,basicClassProviders:[...e.basicClassProviders,t]};var r}),{asyncProviders:new Array,basicClassProviders:new Array}),b=[...E,...S.map((e=>({provide:e.token,useFactory:e.asyncFactory,inject:e.inject})))],w=(0,i.Module)({exports:r,imports:o,providers:b});return t=>(Reflect.defineMetadata(s.o,e,t),w(t))}},93417:(e,t,r)=>{r.d(t,{r:()=>s});const s="frameworkModuleName"},22838:(e,t,r)=>{r.d(t,{Q1:()=>a,TB:()=>s,Vy:()=>i});const s={commands:{},events:{},queries:{}},i=e=>!(!e||"object"!=typeof e)&&(!(e.api&&!(e.api.commands&&e.api.events&&e.api.name&&e.api.queries&&e.handlers))&&(!(e.exports&&!Array.isArray(e.exports))&&(!(e.handlers&&!e.api)&&(!(e.imports&&!Array.isArray(e.imports))&&!(e.providers&&!Array.isArray(e.providers))))));class a{constructor(e,t){this.supportedEventHandlers=e,this.modules=t}}},31638:(e,t,r)=>{r.d(t,{$:()=>a,z:()=>i});var s=r(17321);function i(e){return{type:s.j.VALUE_PROVIDER,useValue:e}}function a(e){return{type:s.j.CLASS_PROVIDER,useClass:e}}},17321:(e,t,r)=>{var s;r.d(t,{j:()=>s}),function(e){e.VALUE_PROVIDER="value_provider",e.CLASS_PROVIDER="class_provider"}(s||(s={}))},63411:(e,t,r)=>{r.d(t,{B:()=>n});var s=r(25029),i=r(95087),a=r(38679),o=r(97956);const n=(e,t,r)=>{switch(e){case s.F.Device:return(0,a.H)(t,r);case s.F.User:return(0,o.M)(t,r);default:(0,i.U)(e)}}},97956:(e,t,r)=>{r.d(t,{M:()=>c});var s=r(1484),i=r(78776),a=r(64987),o=r(21869),n=r(97631);const c=(e,t)=>{const r=t.token??(0,i.Z)();class c{constructor(){this.instances=new Map,this.mutex=new a.WU}getOrCreate(e,t,r){return this.mutex.runExclusive((async()=>{const s=this.instances.get(e);if(s)return s;r.addCloseHook((()=>{this.invalidate(e)}));const i=await t();return this.instances.set(e,i),i}))}invalidate(e){this.instances.delete(e)}}const l=c,d={token:e,inject:[c,o.f,s.ModuleRef,s.REQUEST,n.g],asyncFactory:(t,i,a,n,c)=>{const l=s.ContextIdFactory.getByRequest(n),d=i.getOrDefault(o.l.UserName,"");if(""===d)throw new Error(`Provider ${e} is a user-scoped singleton but there is no user`);if(!c)throw new Error("No user scope available");return t.getOrCreate(d,(()=>a.resolve(r,l)),c)}};return[{token:r,asyncFactory:t.asyncFactory,inject:[...t.inject??[],o.f]},l,d]}},9671:(e,t,r)=>{r.d(t,{J:()=>S,f:()=>E});var s=r(88802),i=r(1484),a=r(17988),o=r(60399),n=r(87065),c=r(89618),l=r(37182),d=r(69885),u=r(70493),p=r(87279),h=r(10514),m=r(43004),g=r(37920),v=r(21869),y=r(68475),_=r(428),f=r(94189);let S=class{constructor(e,t,r,s){this.request=e,this.logger=t,this.useCaseStacktraceRepo=r,this.cqrsClient=s}async do(...e){return(await Promise.all(e.map((e=>this.doOne(e))))).every((e=>!!e))}async doOne(e,t="method"){try{const r=await e();if((0,p.AZ)(r)&&(0,p.hx)(r))throw new Error(`Allowed to fail ${t} has failed`);return!0}catch(e){const{request:t,useCaseStacktraceRepo:r}=this,[s,i]=e instanceof y.c?[e.exception,e.useCaseStacktrace]:[e,r.read()];try{await Promise.race([new Promise((e=>setTimeout(e,100))),this.logger.captureException(s,{moduleName:t?.module,useCaseId:t?.context.get(v.l.UseCaseId),useCaseName:t?.name,useCaseStacktrace:i,featureFlips:await this.getUserFeatureFlips()},m.w.WARNING)])}catch(e){}return!1}}async conditionallyAllowToFailOne(e,t){return t?this.doOne(e):(await e(),!0)}getUserFeatureFlips(){const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(u.cV);return(0,o.z)(e().pipe((0,n.U)((e=>(0,p.d6)(e)?(0,p.db)(e):{})),(0,c.V)(50),(0,l.K)((()=>(0,d.of)({})))))}};function E(){return new S(h.H,(0,g.G)(),_.U,{getClient:()=>({queries:{userFeatureFlips:()=>(0,d.of)((0,p.Vp)({}))}})})}S=(0,s.__decorate)([(0,s.__param)(0,(0,a.Inject)(i.REQUEST)),(0,s.__metadata)("design:paramtypes",[Object,g.v,_.F,f.w])],S)},73774:(e,t,r)=>{r.d(t,{e:()=>m});var s=r(88802),i=r(69885),a=r(34987),o=r(97280),n=r(48844),c=r(95087);class l{constructor(e,t){this.pipeline=this.initPipeline(e,this.dedupeInterceptorsById(t))}handle(e){return this.pipeline.handle(e)}dedupeInterceptorsById(e){const t=e.reduce(((e,t)=>(e.set(t.id,t),e)),new Map);return Array.from(t.values())}initPipeline(e,t){return t.reduceRight(((e,t)=>({handle:r=>t.intercept(r,e.handle.bind(e))})),e)}}var d=r(4043);class u{constructor(e){this.backend=e,this.interceptors=new Map}addInterceptor(e){this.interceptors.set(e.id,e)}request(...e){return this.makeRequest(...e)}delete(e,t){return this.makeRequest("DELETE",e,t)}get(e,t){return this.makeRequest("GET",e,t)}head(e,t){return this.makeRequest("HEAD",e,t)}options(e,t){return this.makeRequest("OPTIONS",e,t)}patch(e,t,r){return this.makeRequest("PATCH",e,{body:t,...r})}post(e,t,r){return this.makeRequest("POST",e,{body:t,...r})}put(e,t,r){return this.makeRequest("PUT",e,{body:t,...r})}makeRequest(...e){let t,r,s;if(1===e.length)t=e[0],r="response";else{const[i,a,o]=e;t=new d.a(i,a,void 0!==o.body?o.body:null,{headers:o.headers,params:o.params,responseType:o.responseType??"json",withCredentials:o.withCredentials}),r=o.observe??"body","json"===o.responseType&&"body"===o.observe&&(s=o.responseBodyDecoder)}const u=new l(this.backend,Array.from(this.interceptors.values())),p=(0,i.of)(this.addContentTypeRequestHeader(t)).pipe((0,a.b)((e=>u.handle(e))),(0,o.d)(1));switch(r){case"body":switch(t.responseType){case"arraybuffer":return p.pipe((0,n.Gx)((e=>e.arrayBuffer())));case"text":return p.pipe((0,n.Gx)((e=>e.text())));case"json":return p.pipe((0,n.Gx)((e=>e.json(s))));default:(0,c.U)(t.responseType)}break;case"response":return p;default:(0,c.U)(r)}}addContentTypeRequestHeader(e){if(!e.headers.has("content-type")){const t=e.detectContentTypeHeader();if(t)return e.clone({headers:e.headers.set("content-type",t)})}return e}}var p=r(22253),h=r(57924);let m=class extends u{constructor(e){super(e)}};m=(0,s.__decorate)([(0,h.GS)(),(0,s.__metadata)("design:paramtypes",[p.j])],m)},25504:(e,t,r)=>{r.d(t,{X:()=>d});var s,i=r(88802),a=r(1484),o=r(22253),n=r(73774),c=r(99634);const l=[];let d=s=class{static configure(e){return{module:s,configurations:{infrastructure:e}}}static addGlobalInterceptor(e){l.push(e)}};d=s=(0,i.__decorate)([(0,c.Y)({providers:[{asyncFactory:async(e,t)=>{const r=new n.e(e);return(await Promise.all(l.map((e=>t.create(e))))).forEach((e=>r.addInterceptor(e))),r},token:n.e,inject:[o.j,a.ModuleRef]}],configurations:{infrastructure:{token:o.j}},exports:[n.e],sharedModuleName:"http"})],d)},26092:(e,t,r)=>{r.r(t),r.d(t,{AcknowledgedChannel:()=>B.N,AllowedToFail:()=>Te.J,AppLifeCycle:()=>o.d,AppLogger:()=>i.V,AppTimers:()=>n.O,BadStatus:()=>P.R,BaseEventEmitter:()=>re.f,ChannelMessageBroker:()=>V.U,ChannelState:()=>K.D,CommandHandler:()=>H.W,CommandRefresherFactory:()=>Y.u1,ConcurrencyTestTimers:()=>m,ContextLessCqrsClient:()=>te.m,ContextlessBaseEventEmitter:()=>re.C,CqrsBroker:()=>$.d,CqrsClient:()=>te.w,CqrsCommandRefresher:()=>Y.Tx,CronLowLevelSource:()=>Ae.R_,DefaultEncryptionCodecForDeviceData:()=>ue.h,DefaultEncryptionCodecForUserData:()=>ue.s,DefaultLogger:()=>Oe.Mn,DefaultTimers:()=>Oe.mZ,EventHandler:()=>q.b,ExceptionCriticality:()=>L.w,ExceptionLogger:()=>k.v,ExceptionLoggingSink:()=>x.qD,FetchFailedError:()=>P.a,FrameworkInit:()=>_.ar,FrameworkRequestContextValues:()=>Pe.l,Global:()=>_.xB,HttpBackend:()=>w.j,HttpClient:()=>R.e,HttpHeaders:()=>A.W,HttpModule:()=>D.X,HttpParams:()=>C.L,HttpRequest:()=>I.a,HttpResponse:()=>O.Z,HttpStatusCode:()=>T.W,Injectable:()=>_.GS,JsonApplicationResourceFetcher:()=>Ce.X,JsonApplicationResourceLoader:()=>Ie.K,KeyValueStorageFactory:()=>de.u,KeyValueStorageInfrastructure:()=>le.QI,MV3ExtensionHttpInterceptor:()=>N.I,MV3ExtensionResilienceModule:()=>U.f,MV3LongRunningTaskInterceptor:()=>F.V,MV3ServiceWorkerExtenderBase:()=>M.g,ManualTriggeredTimers:()=>n.r,MemoryChannel:()=>K.q,MemoryKeyValueStorageInfrastructure:()=>pe.s,MemoryStoreInfrastructureFactory:()=>he.N,Module:()=>y.Y,NoDynamicChannels:()=>j.y,NodeConfiguration:()=>z.$,NodeEventBroker:()=>X.a,NodeModulesIntrospection:()=>f.Q1,NodeToModuleEventBroker:()=>J,NullCronTaskHandler:()=>Ae.ql,NullLogger:()=>i.W,NullStorage:()=>le.hL,ParameterProviderType:()=>g.j,QueryHandler:()=>Q.e,RequestContext:()=>Pe.f,RequestContextModule:()=>ce.q,SingleNodeAppBuilder:()=>a.u,Store:()=>_e.y,StoreCapacity:()=>ge.Y,StoreFlusher:()=>ye.X,StoreInfrastructureFactory:()=>he.G,TaskTrackingModule:()=>G.c,ThrowJsonFetcher:()=>Oe.kl,TimerBasedCronSource:()=>Ae._C,UncaughtErrorSource:()=>x.fW,VerboseLogger:()=>Oe.IO,createApplicationClient:()=>se,createCqrsClient:()=>ee.c,createCqrsClients:()=>ee.R,createNullAllowedToFail:()=>Te.f,createSingleChannelListener:()=>j.v,defineApplication:()=>a.t,defineBatchExecutor:()=>we,defineStore:()=>me.Q,deviceScopedSingletonProvider:()=>b.H,getQueryValue:()=>ne,getStoresProviders:()=>ve.N,isExceptionLogEntry:()=>L.h,isSendMessageRequest:()=>W.F,isVersionedData:()=>le.Ot,mockTimer:()=>h,provideClass:()=>v.$,provideValue:()=>v.z,refresherCreationToken:()=>Y.b2,scopedSingleton:()=>E.B,sendMessageRequest:()=>W.k,startApplicationNode:()=>s.u,startSingleApplicationNode:()=>s.W,useEventsOfModule:()=>y.g,userScopedSingletonProvider:()=>S.M});var s=r(9201),i=r(26457),a=r(96259),o=r(43866),n=r(21904),c=r(98187),l=r(83695),d=r(78263),u=r(87065),p=r(6220);function h(e,t,r,s){const i=[];if(t<r)return[];if(e<r){if(i.push(r),0===s)return i;let e=r+s;for(;e<=t;)i.push(e),e+=s;return i}if(s<=0)return[];let a=r+(Math.trunc((e-r)/s)+1)*s;for(;a<=t;)i.push(a),a+=s;return i}class m extends n.O{constructor(){super(...arguments),this.source$=new c.x,this.time=0}fireTimer(e=1){this.time=this.time+e,this.source$.next(this.time)}createObservableTimer(e,t){return this.source$.pipe((0,l.O)(0),(0,d.G)(),(0,u.U)((([r,s])=>h(r,s,e,t))),(0,p.z)((e=>e)))}}var g=r(17321),v=r(31638),y=r(99634),_=r(57924),f=r(22838),S=r(97956),E=r(63411),b=r(38679),w=r(22253),A=r(85260),C=r(61223),I=r(4043),T=r(25994),P=r(73155),O=r(12964),R=r(73774),D=r(25504),N=r(25123),U=r(54193),F=r(56656),M=r(95237),L=r(43004),x=r(63364),k=r(37920),G=r(7876),V=r(65488),K=r(15572),j=r(54452),B=r(58649),W=r(45244),z=r(16855),H=r(63663),Q=r(20754),q=r(68307),Y=r(11053),$=r(42949),X=r(96917),Z=r(28489);class J{constructor(e){this.publishEvent=(e,t,r,s)=>this.broker.publishEvent(e,t,r,s),this.broker=new X.a(e);const t=e.getModuleNames().reduce(((t,r)=>({...t,[r]:Object.keys(e.appDefinition[r].api.events).reduce(((e,t)=>(e[t]=[],e)),(0,Z.Ay)({}))})),(0,Z.Ay)({}));this.localSubscribersMap=Object.keys(e.subscriptions).map((e=>e)).reduce(((t,r)=>{const s=e.subscriptions[r];return Object.keys(s).map((e=>e)).forEach((e=>{const i=s[e]??[],a=t[e];i.forEach((e=>{a[e].push(r)}))})),t}),t)}connect(e){const{localSubscribersMap:t,broker:r}=this;return r.connect({onLocalEvent:async(r,s,i,a,o,n)=>{const c=t[r][i];await Promise.all(c.map((async t=>{await e.onEvent(r,t,i,a,o,n)})))}})}}var ee=r(40945),te=r(94189),re=r(81459);function se({appDefinition:e,channels:t,channelsListener:r}){const s=new z.$({appDefinition:e,channels:t,channelsListener:r,currentNode:null,subscriptions:{}}),i=new $.d(s),a=()=>{throw new Error("Unexpected request received by detached application client")},o=i.connect({onCommand:a,onQuery:a}).start();return{client:(0,ee.R)(e,i),stop:async()=>(await o).stop()}}var ie=r(27149),ae=r(60399),oe=r(89618);async function ne(e,t=1e4){if(!(0,ie.b)(e))throw new Error("Error in getQueryValue: the argument is not an observable");try{return await(0,ae.z)(e.pipe((0,oe.V)({first:t})))}catch(e){throw new Error("Error in getQueryValue: "+e)}}var ce=r(23370),le=r(91199),de=r(4603),ue=r(38144),pe=r(15524),he=r(83081),me=r(95681),ge=r(23347),ve=r(5711),ye=r(71949),_e=r(76072),fe=r(64987);const Se=16,Ee=.5,be=1.3;function we(e){var t;const{chunkControl:{decrement:r=Ee,increment:s=be,initialSize:i=Se}={decrement:Ee,increment:be,initialSize:Se}}=e;const a=new fe.WU;return(t=class{constructor(e,t){this.repository=e,this.processor=t}async dispatchBatch(e){await a.runExclusive((async()=>{const t=await this.pushItemsInQueue(e);for(;t.queue.length>0;)await this.processOneChunkFromQueue(t)}))}async pushItemsInQueue(t){const r=await this.repository.getBatchState(e.name),s=t.filter((e=>!r.queue.find((t=>t===e))));return s.length&&(r.queue.push(...s),await this.repository.setBatchState(e.name,r)),r}async processOneChunkFromQueue(t){const a=function(e){const{lastStartedChunkFirstId:t,lastStartedChunkSize:a=i}=e;if(!t)return i;const o=!e.queue.find((e=>e===t));return Math.max(1,o?Math.ceil(a*s):Math.floor(a*r))}(t),o=Math.min(a,t.queue.length);if(!o)throw new Error("Should have something to process");await this.repository.setBatchState(e.name,{...t,lastStartedChunkSize:o,lastStartedChunkFirstId:t.queue[0]});const n=t.queue.splice(0,o);await this.processor.processChunk(n),await this.repository.setBatchState(e.name,t)}}).Definition=e,t}var Ae=r(69594),Ce=r(75994),Ie=r(67978),Te=r(9671),Pe=r(21869),Oe=r(73018)},37920:(e,t,r)=>{r.d(t,{G:()=>l,v:()=>c});var s=r(88802),i=r(17988),a=r(26457),o=r(63364),n=r(43004);let c=class{constructor(e,t){this.sink=e,this.logger=t}captureException(e,t,r=n.w.CRITICAL){try{const s=e instanceof Error?e:new Error("Invalid exception type"),i=this.createExceptionLogEntry(t,s,r);return this.sink.logException(i)}catch(r){this.logger.error("Failed to capture exception",r,e,t)}return Promise.resolve()}createExceptionLogEntry(e,t,r){return{callStack:t.stack??"",criticality:r,featuresFlipped:this.mapFeatures(e.featureFlips??{}),fileLocation:e.fileLocation,lineNumber:e.lineNumber,message:t.message,moduleName:e.moduleName,origin:e.origin,timestamp:Date.now(),useCaseId:e.useCaseId,useCaseName:e.useCaseName,useCaseStacktrace:e.useCaseStacktrace}}mapFeatures(e){return Object.keys(e).reduce(((t,r)=>e[r]?[r,...t]:t),[])}};function l(){return new c(new o.p$,new a.W)}c=(0,s.__decorate)([(0,i.Injectable)(),(0,s.__metadata)("design:paramtypes",[o.qD,a.V])],c)},63364:(e,t,r)=>{r.d(t,{fW:()=>a,p$:()=>i,qD:()=>s});class s{}class i extends s{logException(){return Promise.resolve()}start(){return Promise.resolve({stop:()=>Promise.resolve()})}}class a{constructor(e){this.events$=e}}},68475:(e,t,r)=>{r.d(t,{c:()=>v,x:()=>y});var s=r(88802),i=r(17988),a=r(25313),o=r(60399),n=r(37182),c=r(87065),l=r(70493),d=r(69008),u=r(87279),p=r(21869),h=r(37920),m=r(428),g=r(94189);class v extends Error{constructor(e,t){super("ApplicationRequestError"),this.exception=e,this.useCaseStacktrace=t}}let y=class{constructor(e,t,r,s){this.logger=e,this.useCaseStacktraceRepo=t,this.cqrsClient=r,this.requestContextClient=s}intercept(e,t){const r=e.getArgByIndex(0);return t.handle().pipe((0,n.K)(this.handleException(r)))}handleException(e){const{useCaseStacktraceRepo:t}=this;return r=>{if(t.isInitialUseCase()){const[s,i]=r instanceof v?[r.exception,r.useCaseStacktrace]:[r,t.read()];return this.captureException(e,s,i),(0,a._)((()=>s))}const s=r instanceof v?r:new v(r,t.read());return(0,a._)((()=>s))}}async getUserFeatureFlips(){if(!await(0,o.z)(this.requestContextClient.queries.activeUser().pipe((0,c.U)((e=>(0,u.d6)(e)&&!!(0,u.db)(e).userName)))))return Promise.resolve({});const{queries:{userFeatureFlips:e}}=this.cqrsClient.getClient(l.cV);return await(0,o.z)(e().pipe((0,c.U)((e=>(0,u.d6)(e)?(0,u.db)(e):{}))))}async captureException(e,t,r){this.logger.captureException(t,{moduleName:e.module,useCaseName:e.name,useCaseId:e.context.get(p.l.UseCaseId),featureFlips:await this.getUserFeatureFlips(),useCaseStacktrace:r})}};y=(0,s.__decorate)([(0,i.Injectable)({scope:i.Scope.REQUEST}),(0,s.__metadata)("design:paramtypes",[h.v,m.F,g.w,d.Q])],y)},43004:(e,t,r)=>{var s;function i(e){return!(!e||"object"!=typeof e)&&("criticality"in e&&"timestamp"in e&&"message"in e&&"callStack"in e&&((e.criticality===s.CRITICAL||e.criticality===s.WARNING)&&"string"==typeof e.message&&"string"==typeof e.callStack))}r.d(t,{h:()=>i,w:()=>s}),function(e){e.WARNING="warning",e.CRITICAL="critical"}(s||(s={}))},428:(e,t,r)=>{r.d(t,{F:()=>n,U:()=>c});var s=r(88802),i=r(17988),a=r(21869);const o="USE_CASE_STACKTRACE";let n=class{constructor(e){this.requestContext=e}isInitialUseCase(){return(this.requestContext.get(o)??[]).length<=1}read(){return this.requestContext.getOrAddSync(o,(()=>[]))??[]}append(e){const{requestContext:t}=this,r=t.get(o)??[];t.set(o,[...r,e])}};n=(0,s.__decorate)([(0,i.Injectable)(),(0,s.__metadata)("design:paramtypes",[a.f])],n);const c=new n(new a.f)},7876:(e,t,r)=>{r.d(t,{c:()=>w});var s=r(88802),i=r(49329),a=r(99634),o=r(42339),n=r(87279),c=r(63663),l=r(25029),d=r(95681),u=r(23347);const p=e=>"object"==typeof e&&null!==e&&"swStartTime"in e&&"taskTrackingList"in e&&"string"==typeof e.swStartTime&&"object"==typeof e.taskTrackingList;class h extends((0,d.Q)({persist:!1,initialValue:{swStartTime:"",taskTrackingList:{}},scope:l.F.Device,storeName:"task-tracking",storeTypeGuard:p,capacity:u.Y._001KB})){}let m=class{constructor(e){this.store=e}async execute({body:e}){const t=(new Date).toISOString(),{taskName:r,feature:s,businessDomain:i}=e,a={taskName:r,feature:s,businessDomain:i,startTime:t,serviceWorkerInterruptionCount:0},o=await this.store.getState();return await this.store.set({...o,taskTrackingList:{...o.taskTrackingList,[t]:a}}),Promise.resolve((0,n.Vp)({id:t}))}};m=(0,s.__decorate)([(0,c.W)(o.g),(0,s.__metadata)("design:paramtypes",[h])],m);var g=r(86252),v=r(26897),y=r(43866),_=r(57924);let f=class{constructor(e,t,r){this.store=e,this.carbonLegacyClient=t,this.appLifecycle=r}onFrameworkInit(){this.appLifecycle.addAppReadyHook((async()=>{const e=await this.store.getState(),t={...e.taskTrackingList},r=Object.keys(e.taskTrackingList).map((async r=>{const{taskName:s,feature:i,businessDomain:a,startTime:o}=e.taskTrackingList[r],n=new v.UserMv3ExtensionTaskInterruptionEvent({businessDomain:a,feature:i,taskName:s,taskStartDateTime:o,serviceWorkerStartDateTime:e.swStartTime}),c=this.carbonLegacyClient;await c.commands.carbon({name:"logEvent",args:[{event:n}]}),delete t[r]}));await Promise.all(r),await this.store.set({swStartTime:(new Date).toISOString(),taskTrackingList:t})}))}};f=(0,s.__decorate)([(0,_.ar)(),(0,s.__metadata)("design:paramtypes",[h,g._,y.d])],f);var S=r(29876),E=r(26457);let b=class{constructor(e,t,r){this.store=e,this.carbonLegacyClient=t,this.logger=r}async execute({body:e}){const{taskTrackingId:t}=e,r=await this.store.getState(),s=r.taskTrackingList[t];if(!s)return this.logger.trace("Trying to track a task that does not exist"),(0,n.Vp)(void 0);const{taskName:i,feature:a,businessDomain:o,startTime:c,serviceWorkerInterruptionCount:l}=s,d=new v.UserMv3ExtensionTaskReportEvent({businessDomain:o,feature:a,serviceWorkerInterruptionCount:l,serviceWorkerStartDateTime:r.swStartTime,taskName:i,taskStartDateTime:c,taskEndDateTime:(new Date).toISOString()}),u=this.carbonLegacyClient;await u.commands.carbon({name:"logEvent",args:[{event:d}]});const p={...r.taskTrackingList};return delete p[t],await this.store.set({swStartTime:r.swStartTime,taskTrackingList:p}),(0,n.Vp)(void 0)}};b=(0,s.__decorate)([(0,c.W)(S.y),(0,s.__metadata)("design:paramtypes",[h,g._,E.V])],b);let w=class{};w=(0,s.__decorate)([(0,a.Y)({api:i.e,handlers:{commands:{startTaskTracking:m,terminateTaskTracking:b},events:{},queries:{}},stores:[h],onFrameworkInit:f,providers:[]})],w)},58649:(e,t,r)=>{r.d(t,{N:()=>_});var s=r(6136),i=r(98187),a=r(15023),o=r(30523),n=r(16433),c=r(89618),l=r(37182),d=r(17350),u=r(97280),p=r(42946),h=r(162),m=r(2049),g=r(6220),v=r(7074),y=r(78776);class _{constructor(e,t=3e4){const r=e.status$.pipe((0,s.x)());let _=!1;const f=new i.x,S=f.pipe((0,g.z)((async s=>{const i=(0,y.Z)();let g=!1;const v=e.messages$.pipe((0,a.o)((()=>!_)),(0,o.h)((e=>"acknowledgement"===e.type&&e.id===i)),(0,n.q)(1),(0,c.V)(t),(0,l.K)((()=>d.E)),(0,u.d)(1)),f=v.subscribe((()=>{g=!0,f.unsubscribe()})),S=r.pipe((0,a.o)((()=>!g&&!_)),(0,p.z)((()=>(0,h.D)(e.sendMessage({type:"send",id:i,message:s.message}))))).subscribe();try{await(0,m.n)(v),S.unsubscribe(),s.resolve()}catch(e){S.unsubscribe(),s.reject(e)}}))).subscribe();this.stop=()=>(_=!0,S.unsubscribe(),e.stop()),this.send=e=>new Promise(((t,r)=>{const s={message:e,resolve:t,reject:r};f.next(s)})),this.channelState$=e.status$,this.receivedMessages$=e.messages$.pipe((0,o.h)((e=>"send"===e.type)),(0,g.z)((async t=>{if("send"===t.type)return await e.sendMessage({type:"acknowledgement",id:t.id}),t.message})),(0,v.B)())}}},65488:(e,t,r)=>{r.d(t,{U:()=>w});var s=r(24966),i=r(2049),a=r(30523),o=r(6220),n=r(162),c=r(87065),l=r(37182),d=r(69885),u=r(64659);const p=e=>{if(!e||"object"!=typeof e)return!1;return"unSubscription"===e.type},h=(e,t,r)=>{const s=new Set(r),i=new Map,h=t.receivedMessages$.pipe((0,a.h)(p)).subscribe((e=>{const t=i.get(e.id);t?.unsubscribe(),i.delete(e.id)})),m=t.receivedMessages$.pipe((0,a.h)((e=>{return!(!(t=e)||"object"!=typeof t)&&"start"===t.type&&s.has(e.definition.destination)&&!i.has(e.definition.id);var t})),(0,o.z)((e=>(0,n.D)((async e=>(i.set(e.definition.id,{unsubscribe:()=>{}}),await t.send({type:"initial-acknowledgement",id:e.definition.id}),e))(e))))).subscribe((r=>{const s=r.definition.destination,a=e(s,r.definition.content,r.metadata),p={type:"end",id:r.definition.id},h=a.pipe((0,c.U)((e=>({id:r.definition.id,data:e,type:"data"}))),(0,l.K)((e=>{const t={id:r.definition.id,type:"error",errorMessage:e.message};return(0,d.of)(t)})),(0,u.l)(p),(0,o.z)((e=>(0,n.D)(t.send(e))))).subscribe();i.set(r.definition.id,{unsubscribe:()=>{h.unsubscribe()}})}));return{unsubscribe:()=>{m.unsubscribe(),h.unsubscribe();for(const e of i.values())e.unsubscribe()}}};var m=r(58376),g=r(85390),v=r(15023),y=r(6136),_=r(42946),f=r(60399),S=r(15572),E=r(78776);var b=r(28489);class w{constructor(e){this.stopped$=new s.X(!1);const t={routes:(0,b.Ay)({})};this.routes=(()=>{const{routes:r}=Object.keys(e).reduce(((t,r)=>{const s=e[r];if("local"===s.type&&(t.routes[r]={send:s.onMessage,trySend:async(...e)=>(await(0,i.n)(s.onMessage(...e)),!0)}),"remote"===s.type){const e=((e,t)=>{const r=(r,s,i)=>{const o={content:s,destination:String(r),id:(0,E.Z)()};return new m.y((r=>{let s={type:"start",definition:o,metadata:i};const l=(0,g.a)({message:e.receivedMessages$,stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,c.U)((({message:e})=>e))).subscribe((e=>{var t;(t=e)&&"object"==typeof t&&"initial-acknowledgement"===t.type&&e.id===o.id?s={...s,metadata:{...s.metadata,isReminder:!0}}:(e=>!(!e||"object"!=typeof e)&&"data"===e.type)(e)&&e.id===o.id?r.next(e.data):(e=>!(!e||"object"!=typeof e)&&"error"===e.type)(e)&&e.id===o.id?r.error(new Error(e.errorMessage)):(e=>!(!e||"object"!=typeof e)&&"end"===e.type)(e)&&e.id===o.id&&r.complete()})),d=(0,g.a)({sendTimes:e.channelState$.pipe((0,y.x)(),(0,a.h)((e=>e===S.D.Connected))),stopped:t}).pipe((0,v.o)((({stopped:e})=>!e)),(0,_.z)((()=>(0,n.D)(e.send(s))))).subscribe();return()=>{e.send({type:"unSubscription",id:o.id}),d.unsubscribe(),l.unsubscribe()}}))};return{send:r,trySend:async(t,s,a)=>await(0,f.z)(e.channelState$)===S.D.Connected&&(await(0,i.n)(r(t,s,a)),!0)}})(s.channel,this.stopped$);t.routes[r]=e}return t}),t);return r})()}connect(e,t){let r=!1;return{start:()=>{if(r)throw new Error("Already started");r=!0;const s=e=>h(((e,t,r)=>this.routes[e].send(e,t,r)),e,Object.keys(this.routes)),i=e.map(s),a=new Map,o=t.connectedChannels$.subscribe((e=>{const t=[...a.entries()].filter((([t])=>!(t in e))),r=Object.keys(e).filter((e=>!a.has(e)));t.forEach((([e,t])=>{a.delete(e),t.unsubscribe()})),r.forEach((t=>{const r=e[t],i=s(r);a.set(t,i)}))}));return Promise.resolve({stop:()=>([...i,o,...a.values()].forEach((e=>e.unsubscribe())),this.stopped$.next(!0),Promise.resolve())})}}}sendMessage(e,t){return this.routes[e].send(e,t,{isReminder:!1})}trySendMessage(e,t){return this.routes[e].trySend(e,t,{isReminder:!1})}}},15572:(e,t,r)=>{r.d(t,{D:()=>s,q:()=>o});var s,i=r(98187),a=r(24966);!function(e){e.Connected="Connected",e.Disconnected="Disconnected"}(s||(s={}));class o{constructor(){this.sentMessages$=new i.x,this.receivedMessagesSubject$=new i.x,this.channelStateSubject$=new a.X(s.Disconnected)}send(e){if(this.channelStateSubject$.value!==s.Connected)throw new Error("Channel is not connected");return this.sentMessages$.next(e),Promise.resolve()}get receivedMessages$(){return this.receivedMessagesSubject$}get channelState$(){return this.channelStateSubject$}stop(){this.receivedMessages$.complete()}connect(e){if(this.channelStateSubject$.value===s.Connected)return{disconnect:()=>{}};const t=this.sentMessages$.subscribe((t=>{e.receivedMessages$.next(t)}));return this.channelState$.next(s.Connected),{disconnect:()=>{this.channelState$.next(s.Disconnected),t.unsubscribe()}}}}},54452:(e,t,r)=>{r.d(t,{v:()=>a,y:()=>i});var s=r(24966);const i={connectedChannels$:new s.X({})},a=e=>({connectedChannels$:new s.X({channel:e})})},45244:(e,t,r)=>{r.d(t,{F:()=>i,k:()=>s});const s=({channelName:e,message:t})=>({channelName:e,message:t,type:"graphene-message"}),i=e=>{if(!e||"object"!=typeof e)return!1;return"graphene-message"===e.type}},16855:(e,t,r)=>{r.d(t,{$:()=>s});class s{constructor(e){this.appDefinition=e.appDefinition,this.currentNode=e.currentNode,this.channels=e.channels,this.subscriptions=e.subscriptions,this.channelsListener=e.channelsListener}getNodeList(){return this.currentNode?[...this.getRemoteNodeList(),this.currentNode]:this.getRemoteNodeList()}getRemoteNodeList(){return Object.keys(this.channels)}getModuleNames(){return Object.keys(this.appDefinition)}}},25123:(e,t,r)=>{r.d(t,{I:()=>u});var s=r(88802),i=r(97280),a=r(83896),o=r(16433),n=r(17988),c=r(21904),l=r(95237);const d=2e4;let u=class{constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t,this.id="MV3ExtensionHttpInterceptor"}intercept(e,t){if(e.timeout<3e4)return t(e);const r=t(e).pipe((0,i.d)(1));return this.timers.createObservableTimer(d,d).pipe((0,a.R)(r),(0,o.q)(Math.trunc(e.timeout/d))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),r}};u=(0,s.__decorate)([(0,n.Injectable)(),(0,s.__metadata)("design:paramtypes",[c.O,l.g])],u)},54193:(e,t,r)=>{r.d(t,{f:()=>u});var s,i=r(88802),a=r(25504),o=r(99634),n=r(25123),c=r(95237),l=r(56656),d=r(84065);let u=s=class{static configure(e){return a.X.addGlobalInterceptor(n.I),d.b.addGlobalNestInterceptor(l.V),{module:s,configurations:{mv3SwExtend:e}}}};u=s=(0,i.__decorate)([(0,o.Y)({sharedModuleName:"mv3ExtensionResilience",configurations:{mv3SwExtend:{token:c.g}},providers:[n.I,l.V],exports:[n.I,l.V]})],u)},56656:(e,t,r)=>{r.d(t,{V:()=>p});var s=r(88802),i=r(97280),a=r(83896),o=r(16433),n=r(17988),c=r(21904),l=r(95237),d=r(10514);const u=2e4;let p=class{constructor(e,t){this.timers=e,this.mv3ServiceWorkerExtender=t}intercept(e,t){const r=e.switchToHttp().getRequest();if(r.type===d.Y.Command||r.type===d.Y.Cron||r.type===d.Y.Event){const e=t.handle().pipe((0,i.d)(1));return this.timers.createObservableTimer(u,u).pipe((0,a.R)(e),(0,o.q)(Math.trunc(45))).subscribe((()=>this.mv3ServiceWorkerExtender.extendServiceWorkerLifetime())),e}return t.handle()}};p=(0,s.__decorate)([(0,n.Injectable)(),(0,s.__metadata)("design:paramtypes",[c.O,l.g])],p)},95237:(e,t,r)=>{r.d(t,{g:()=>s});class s{}},21869:(e,t,r)=>{r.d(t,{f:()=>i,l:()=>s});const s={UseCaseId:"USE_CASE_ID",UserName:"USER_NAME"};class i{constructor(){this.entries={}}get(e){return this.entries[e]}getOrDefault(e,t){return this.entries[e]??t}getOrFail(e,t){if(!this.has(e)){throw new Error(t?.errorMessage??`No ${e} in request context`)}return this.entries[e]}has(e){return e in this.entries}async getOrAdd(e,t){return this.has(e)||this.set(e,await t()),this.get(e)}getOrAddSync(e,t){return this.has(e)||this.set(e,t()),this.get(e)}set(e,t){this.entries[e]=t}toSerializable(){return this.entries}static fromSerializable(e){const t=new i;for(const[r,s]of Object.entries(e))t.entries[r]=s;return t}clone(){return i.fromSerializable(JSON.parse(JSON.stringify(this.toSerializable())))}withValue(e,t){return this.set(e,t),this}}},75994:(e,t,r)=>{r.d(t,{X:()=>s});class s{}},67978:(e,t,r)=>{r.d(t,{K:()=>c});var s=r(88802),i=r(162),a=r(25859),o=r(57924),n=r(75994);let c=class{constructor(e,t){this.url=e,this.fetcher=t,this.value$=(0,i.D)((0,a.P)((()=>this.get())))}async load(){await this.get()}async get(){const{value:e}=this;if(e)return e;const t=await this.fetcher.fetch(this.url),r=await this.loadResource(t);return this.value=r,r}};c=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[String,n.X])],c)},23370:(e,t,r)=>{r.d(t,{q:()=>E});var s=r(88802),i=r(87279),a=r(8987),o=r(87065),n=r(6136),c=r(25029),l=r(95681),d=r(23347);const u=e=>!(!e||"object"!=typeof e)&&"userName"in e;class p extends((0,l.Q)({initialValue:{userName:void 0},persist:!1,scope:c.F.Device,storeName:"active-user-store",storeTypeGuard:u,capacity:d.Y._001KB})){}var h=r(20754),m=r(63663),g=r(81459),v=r(57924);let y=class extends g.f{};y=(0,s.__decorate)([(0,v.GS)()],y);let _=class{constructor(e){this.activeUserStore=e}execute(){return this.activeUserStore.state$.pipe((0,o.U)((e=>e.userName)),(0,n.x)(),(0,o.U)((e=>(0,i.Vp)({userName:e}))))}};_=(0,s.__decorate)([(0,h.e)(a.p),(0,s.__metadata)("design:paramtypes",[p])],_);let f=class{constructor(e,t){this.activeUserStore=e,this.eventEmitter=t}async execute({body:{userName:e}}){return(await this.activeUserStore.getState()).userName===e||(await this.activeUserStore.set({userName:e}),e&&this.eventEmitter.sendEvent("activeUserSet",{userName:e})),(0,i.Vp)(void 0)}};f=(0,s.__decorate)([(0,m.W)(a.r$),(0,s.__metadata)("design:paramtypes",[p,y])],f);var S=r(99634);let E=class{};E=(0,s.__decorate)([(0,S.Y)({api:a.t$,handlers:{commands:{setActiveUser:f},events:{},queries:{activeUser:_}},stores:[p],providers:[y]})],E)},73018:(e,t,r)=>{r.d(t,{IO:()=>c,Mn:()=>n,kl:()=>d,mZ:()=>l});var s=r(90171),i=r(21904),a=r(26457),o=r(75994);class n extends a.V{log(){}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class c extends a.V{log(e,...t){return console.log(e,t)}warn(e,...t){return console.warn(e,t)}error(e,...t){return console.error(e,t)}trace(e,...t){return console.trace(e,t)}}class l extends i.O{get time(){return Date.now()}createObservableTimer(e,t){return(0,s.H)(e,t)}}class d extends o.X{fetch(){return Promise.reject(new Error("Please add a jsonFetcher to the application. Probably you are seing that in unit tests.\nIf this is the case, please mock whatever service is requiring to fetch the data"))}}},38144:(e,t,r)=>{r.d(t,{h:()=>a,s:()=>o});var s=r(88802),i=r(17988);let a=class{};a=(0,s.__decorate)([(0,i.Injectable)()],a);let o=class{};o=(0,s.__decorate)([(0,i.Injectable)()],o)},4603:(e,t,r)=>{r.d(t,{u:()=>i});class s{constructor(e,t,r){this.storage=e,this.baseKey=t,this.initialValueFactory=r}clear(){return this.storage.remove(this.baseKey)}async read(){const e=await this.storage.get(this.baseKey);return!e&&this.initialValueFactory?await this.initialValueFactory():e}async write(e){await this.storage.set(this.baseKey,e)}}class i{constructor(e){this.storage=e}createBackend(e,t,r,i){const a=r?`${e}.${t}.${r}`:`${e}.${t}`;return new s(this.storage,a,i)}}},15524:(e,t,r)=>{r.d(t,{s:()=>s});class s{constructor(){this.memory=new Map}set(e,t){return this.memory.set(e,t),Promise.resolve()}getAllKeys(){return Promise.resolve([...this.memory.keys()])}remove(e){return this.memory.get(e)?(this.memory.delete(e),Promise.resolve()):Promise.resolve()}get(e){return Promise.resolve(this.memory.get(e))}}},91199:(e,t,r)=>{function s(e){return null!==e&&"object"==typeof e&&"version"in e&&"number"==typeof e.version&&"content"in e}r.d(t,{Ot:()=>s,QI:()=>a,hL:()=>i});const i={read:()=>Promise.resolve(void 0),write:()=>Promise.resolve(),clear:()=>Promise.resolve()};class a{}},95681:(e,t,r)=>{r.d(t,{Q:()=>p});var s=r(57924),i=r(49499),a=r(10722),o=r(91199);class n{constructor(e,t,r,s,o){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=s,this.definition=o,this.codec=(0,i.x)(r,e,t);const n=new a.E;this.bypassedDecryptionDecoder=(0,i.x)(r,n,t)}async read(){const e=await this.backend.read();if(!e)return;const{decoded:t,hasBypassedDecryption:r}=await this.decodeData(e),{definition:s}=this,{storageName:i}=s;if(!(0,o.Ot)(t))throw new Error(`Unable to read storage data that isn't versioned (storage name: ${i}, data shape: ${this.printDataShapeInfo(t)})`);const{content:a}=t,n=t.version,c=s.schemaVersion;if(n<c){if(!s.migrateStorageSchema)throw r&&await this.rawWrite(t),new Error(`Missing storage schema migration function prevents from reading old version data (storage name: ${i})`);const e=s.migrateStorageSchema(t);if(!s.typeGuard(e))throw new Error(`Unable to migrate storage data due to typeguard failure (storage name: ${i}, data shape: ${this.printDataShapeInfo(e)})`);return await this.writeWithVersion(e),e}if(n>c)throw new Error(`Unable to read storage data with a more recent version than current schema (storage name: ${i})`);if(!s.typeGuard(a))throw new Error(`Unable to read storage data due to typeguard failure (storage name: ${i}, data shape: ${this.printDataShapeInfo(a)})`);return r&&await this.writeWithVersion(a),a}write(e){if(!this.definition.typeGuard(e)){const{storageName:t}=this.definition;throw new Error(`Failed to write storage data due to typeguard failure (storage name: ${t}, data shape: ${this.printDataShapeInfo(e)})`)}return this.writeWithVersion(e)}clear(){return this.backend.clear()}async writeWithVersion(e){const t={version:this.definition.schemaVersion,content:e};await this.rawWrite(t)}async rawWrite(e){const t=await this.codec.encode(e);await this.backend.write(t)}async decodeData(e){const{codec:t,bypassedDecryptionDecoder:r}=this;try{return{decoded:await t.decode(e),hasBypassedDecryption:!1}}catch(t){try{return{decoded:await r.decode(e),hasBypassedDecryption:!0}}catch{throw t}}}printDataShapeInfo(e){if(e&&"object"==typeof e){const t=e,r=Object.keys(t).reduce(((e,r)=>(e[r]=typeof t[r],e)),{});return JSON.stringify(r).substring(0,40)}return void 0===e?"undefined":null===e?"null":typeof e}}const c=e=>{var t;return(t=class extends n{constructor(t,r,s,i){super(t,r,s,i,e)}}).Definition=e,t};var l=r(23347),d=r(76072);const u=e=>e.persist?{persist:!0,codec:e.codec,scope:e.scope,storeName:e.storeName,storeTypeGuard:e.storeTypeGuard,isCache:e.isCache,storage:c({...e.storage,storageName:e.storeName}),capacity:(0,l.C)(e)?e.capacity:void 0}:{persist:!1,initialValue:e.initialValue,scope:e.scope,storeName:e.storeName,capacity:(0,l.C)(e)?e.capacity:void 0};function p(e){var t;const r=u(e),i=((t=class extends d.y{constructor(e,t,r,s,i,a,o){super(e,t,r,s,i,a,o)}}).Definition=r,t);return(0,s.GS)()(i),i}},23347:(e,t,r)=>{var s;function i(e){return"object"==typeof e&&null!==e&&"capacity"in e}r.d(t,{C:()=>i,Y:()=>s}),function(e){e._001KB="1KB",e._010KB="10KB",e._100KB="100KB",e.Unlimited="Unlimited"}(s||(s={}))},71949:(e,t,r)=>{r.d(t,{X:()=>n});var s=r(88802),i=r(17988),a=r(1484),o=r(56860);let n=class{constructor(e,t,r){this.moduleRef=e,this.request=t,this.storeList=r}async prepare(){const e=a.ContextIdFactory.getByRequest(this.request);this.storeList.instances=await Promise.all(this.storeList.classes.map((t=>this.moduleRef.resolve(t,e,{strict:!1}))))}async flush(){const{instances:e}=this.storeList;if(!e.length)throw new Error("Stores not instantiated");const t=e.map((e=>e.persist()));await Promise.all(t)}};n=(0,s.__decorate)([(0,i.Injectable)(),(0,s.__param)(1,(0,i.Inject)(a.REQUEST)),(0,s.__metadata)("design:paramtypes",[a.ModuleRef,Object,o.D])],n)},83081:(e,t,r)=>{r.d(t,{N:()=>o,G:()=>a});var s=r(24966);class i{constructor(e){this.initValue=e,this.getLimit=()=>Promise.resolve(void 0),this.state$=new s.X(e)}set(e){return this.state$.next(e),Promise.resolve()}init(e){return this.state$.next(e),Promise.resolve()}stop(){this.state$.complete()}getState(){return Promise.resolve(this.state$.value)}clear(){return this.state$.next(this.initValue),Promise.resolve()}clearStorage(){return Promise.resolve()}update(e){return this.set(e(this.state$.value)),Promise.resolve()}persist(){return Promise.resolve()}load(){return Promise.resolve()}}class a{}class o extends a{createUserScopedInfrastructure(){return new i({timestamp:void 0})}createDeviceScopedInfrastructure(){return new i({timestamp:void 0})}}},56860:(e,t,r)=>{r.d(t,{D:()=>s});class s{constructor(){this.registeredClasses=[],this.preparedInstances=[]}get classes(){return this.registeredClasses}get instances(){return this.preparedInstances}set instances(e){this.preparedInstances=e}registerClass(e){this.registeredClasses.push(e)}}},5711:(e,t,r)=>{r.d(t,{N:()=>f});var s=r(1484),i=r(78776),a=r(25029),o=r(43866),n=r(63411),c=r(83081),l=r(93417),d=r(43702),u=r(23711),p=r(38144),h=r(4603),m=r(21869);const g={[a.F.Device]:p.h,[a.F.User]:p.s};var v=r(9671),y=r(97631);function _(e){const t=e.Definition.persist?function(e,t,r){const{EncryptionCodec:s=g[t],SerializationCodec:o=d.b,TransportStorageCodec:c=u.z,initialValue:p,schemaVersion:v}=r.Definition;class y{constructor(e,t,r,s){this.encryptionCodec=e,this.serializationCodec=t,this.transportStorageCodec=r,this.backend=s}}class _ extends r{constructor(e){super(e.encryptionCodec,e.serializationCodec,e.transportStorageCodec,e.backend)}}const f={token:(0,i.Z)(),inject:[y],asyncFactory:e=>Promise.resolve(new _(e))};return[{token:y,inject:[l.r,s,o,c,h.u,...t===a.F.User?[m.f]:[]],asyncFactory:async(r,s,i,o,n,c)=>{const l=await n.createBackend(r,e,(t===a.F.User?c?.get(m.l.UserName):"")??"",(async()=>{const e={version:v,content:p},t=await i.encode(e),r=await s.encode(t);return await o.encode(r)}));return new y(s,i,o,l)}},...(0,n.B)(t,r,f)]}(e.Definition.storeName,e.Definition.scope,e.Definition.storage):[],r={token:(0,i.Z)(),inject:[l.r,o.d,c.G,e.Definition.scope===a.F.User?m.f:s.REQUEST,v.J,y.g,...e.Definition.persist?[e.Definition.storage,e.Definition.codec]:[]],asyncFactory:async(t,r,s,i,o,n,c,l)=>{const d=new e(t,e.Definition,s,(e.Definition.scope===a.F.User?i.get(m.l.UserName):"")??"",o,c,l),u=async()=>{await d.clear(),d.stop()};if(e.Definition.scope===a.F.User){if(!n)throw new Error("No user scope available");n.addCloseHook(u)}else r.addShutdownHook(u);return await d.load(),d}};return[...t,...(0,n.B)(e.Definition.scope,e,r)]}function f(...e){return e.flatMap((e=>_(e)))}},76072:(e,t,r)=>{r.d(t,{y:()=>p});var s=r(24966),i=r(85390),a=r(87065),o=r(6136),n=r(30523),c=r(60399),l=r(25029),d=r(23347);class u{constructor(e,t,r,s){switch(this.conf=t,this.set=async e=>{if(!await this.quickMemoryInfrastructure.getLimit()||this.conf.capacity!==d.Y.Unlimited||!this.conf.persist)return this.quickMemoryInfrastructure.set(e)},this.getState=()=>this.quickMemoryInfrastructure.getState(),this.init=e=>this.quickMemoryInfrastructure.init(e),this.update=async e=>this.set(e(await this.getState())),this.clearStorage=()=>this.quickMemoryInfrastructure.clearStorage(),this.clear=()=>this.quickMemoryInfrastructure.clear(),this.persist=()=>this.quickMemoryInfrastructure.persist(),this.load=()=>this.quickMemoryInfrastructure.load(),this.stop=()=>this.quickMemoryInfrastructure.stop(),this.getLimit=()=>Promise.reject(new Error("not implemented")),t.scope){case l.F.Device:this.quickMemoryInfrastructure=r.createDeviceScopedInfrastructure(e,t.storeName,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}`;break;case l.F.User:if(!s)throw new Error("Attempting to create a user-scoped store without a user");this.quickMemoryInfrastructure=r.createUserScopedInfrastructure(e,t.storeName,s,t.storeTypeGuard),this.key=`graphene.${e}.${t.storeName}.${s}`}this.state$=this.quickMemoryInfrastructure.state$}}class p{constructor(e,t,r,c,l,d,p){this.conf=t,this.allowedToFail=l,this.storage=d,this.codec=p,this.getLimit=()=>Promise.reject(new Error("not implemented")),this.infrastructure=new u(e,t,r,c),this.timeGetter=()=>Date.now(),this.localState$=new s.X({timestamp:void 0}),this.mergedState$=(0,i.a)({infra:this.infrastructure.state$,current:this.localState$}).pipe((0,a.U)((({current:e,infra:t})=>t.timestamp&&(!e.timestamp||t.timestamp>e.timestamp)?t:e)),(0,o.x)());const h=t.persist?void 0:t.initialValue;this.state$=this.mergedState$.pipe((0,n.h)((e=>!t.persist||!!e.timestamp)),(0,a.U)((e=>e.data??h)))}getState(){return(0,c.z)(this.state$)}async set(e){try{await this.setWithoutPersist(e)}finally{await this.persist()}}async setWithoutPersist(e){const t={data:e,timestamp:this.timeGetter()};let r;this.localState$.next(t);if(!await this.allowedToFail.doOne((()=>this.infrastructure.set(t).catch((e=>{throw r=new Error(`${this.conf.storeName}: ${e.message}`),r})))))return this.conf.persist?this.infrastructure.clear():Promise.reject(r)}init(e){const t={data:e,timestamp:0};return this.localState$.next(t),Promise.resolve()}async clear(){this.localState$.next({timestamp:void 0}),await this.infrastructure.clear()}async clearStorage(){if(!this.storage)throw new Error("Persisted stores should have storage");await this.storage.clear()}stop(){this.localState$.complete()}async update(e){const t=await this.getState();await this.set(e(t))}async load(){const e=await this.infrastructure.getState();if(e.timestamp)return void this.localState$.next(e);const{conf:t,codec:r,storage:s}=this;if(!t.persist)return;if(!r||!s)throw new Error("Persisted stores should have conf/storage");await this.allowedToFail.conditionallyAllowToFailOne((async()=>{const e=await s.read()??t.storage.Definition.initialValue,i=await r.decode(e);await this.setWithoutPersist(i)}),!!t.isCache)||await this.setWithoutPersist(await r.decode(t.storage.Definition.initialValue))}async persist(){const{conf:e,codec:t,storage:r}=this;if(!e.persist)return;if(!t||!r)throw new Error("Persisted stores should have conf/storage");const s=await this.getState(),i=await t.encode(s);await r.write(i)}}},69594:(e,t,r)=>{r.d(t,{R_:()=>i,_C:()=>a,ql:()=>s});class s{run(){return Promise.resolve()}isRunnable(){return!1}}class i{}class a extends i{constructor(e){super(),this.alarm$=e.createObservableTimer(6e4,6e4)}}},33920:(e,t,r)=>{r.d(t,{F:()=>i,p:()=>s});const s={Open:"open",Closed:"closed"};class i{constructor(e){this.lifecycle=e,this.status=s.Open,this.onAppShutdown=()=>this.close(),this.closeHooks=[],e.addShutdownHook(this.onAppShutdown)}async close(){for(;this.closeHooks.length>0;){const e=this.closeHooks.pop();e&&await e()}this.status=s.Closed,this.lifecycle.removeShutdownHook(this.onAppShutdown)}addCloseHook(e){this.closeHooks.push(e)}}},97631:(e,t,r)=>{r.d(t,{g:()=>p});var s=r(88802),i=r(78263),a=r(30523),o=r(16433),n=r(17988),c=r(87279),l=r(69008),d=r(33920),u=r(43866);let p=class extends d.F{constructor(e,t,r){super(t),this.requestContext=r,r.queries.activeUser().pipe((0,i.G)(),(0,a.h)(this.thisUserGotDeactivated(e)),(0,o.q)(1)).subscribe((()=>{this.close()}))}thisUserGotDeactivated(e){return([t,r])=>{if(!(0,c.d6)(t)||!(0,c.d6)(r))return!1;const s=(0,c.db)(t).userName,i=(0,c.db)(r).userName;return s===e&&void 0===i}}};p=(0,s.__decorate)([(0,n.Injectable)(),(0,s.__metadata)("design:paramtypes",[String,u.d,l.Q])],p)},89067:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AnalyticsClient=void 0;const s=r(23767),i=r(37204);class a extends((0,s.defineModuleClient)(i.analyticsApi)){}t.AnalyticsClient=a,(0,s.registerModuleClient)(i.analyticsApi,a)},37204:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.analyticsApi=t.TrackPageViewCommand=t.TrackEventCommand=void 0;const s=r(85888),i=r(70986);class a extends((0,i.defineCommand)({scope:i.UseCaseScope.Device})){}t.TrackEventCommand=a;class o extends((0,i.defineCommand)({scope:i.UseCaseScope.Device})){}t.TrackPageViewCommand=o,t.analyticsApi=(0,s.defineModuleApi)({commands:{TrackEventCommand:a,TrackPageViewCommand:o},events:{},name:"analytics",queries:{}})},7022:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},52389:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(37204),t),i(r(7022),t),i(r(89067),t)},67202:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},54072:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommandMessage=void 0;const s=r(98653);class i extends s.RequestMessage{constructor(e){super(),this.body=e}}t.CommandMessage=i},98653:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UseCaseScope=t.RequestMessage=void 0;t.RequestMessage=class{},function(e){e.User="user",e.Device="device"}(t.UseCaseScope||(t.UseCaseScope={}))},85088:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EMPTY_QUERY_RESULT=t.PAGINATION_START_PAGE_INDEX=t.FilterOperationName=void 0,function(e){e.Equals="equals",e.Differs="differs",e.Matches="matches",e.In="in",e.Contains="contains"}(t.FilterOperationName||(t.FilterOperationName={})),t.PAGINATION_START_PAGE_INDEX=1,t.EMPTY_QUERY_RESULT={items:[],itemCount:0,page:t.PAGINATION_START_PAGE_INDEX,pageCount:1}},77939:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineCarbonCommand=t.defineCommand=void 0;const s=r(54072),i=r(98653);t.defineCommand=(...[e={scope:i.UseCaseScope.User}])=>{var t;return(t=class extends s.CommandMessage{}).metadata=e,t};t.defineCarbonCommand=(e={scope:i.UseCaseScope.User})=>{var t;return(t=class extends s.CommandMessage{}).metadata=e,t}},1941:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineQuery=void 0;const s=r(70522),i=r(98653);t.defineQuery=(e={scope:i.UseCaseScope.User})=>{var t;return(t=class extends s.QueryMessage{}).metadata=e,t}},70986:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineQuery=t.defineCarbonCommand=t.defineCommand=t.UseCaseScope=t.FilterOperationName=t.EMPTY_QUERY_RESULT=t.QueryMessage=t.CommandMessage=void 0;var s=r(54072);Object.defineProperty(t,"CommandMessage",{enumerable:!0,get:function(){return s.CommandMessage}});var i=r(70522);Object.defineProperty(t,"QueryMessage",{enumerable:!0,get:function(){return i.QueryMessage}});var a=r(85088);Object.defineProperty(t,"EMPTY_QUERY_RESULT",{enumerable:!0,get:function(){return a.EMPTY_QUERY_RESULT}}),Object.defineProperty(t,"FilterOperationName",{enumerable:!0,get:function(){return a.FilterOperationName}});var o=r(98653);Object.defineProperty(t,"UseCaseScope",{enumerable:!0,get:function(){return o.UseCaseScope}});var n=r(77939);Object.defineProperty(t,"defineCommand",{enumerable:!0,get:function(){return n.defineCommand}}),Object.defineProperty(t,"defineCarbonCommand",{enumerable:!0,get:function(){return n.defineCarbonCommand}});var c=r(1941);Object.defineProperty(t,"defineQuery",{enumerable:!0,get:function(){return c.defineQuery}})},70522:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.QueryMessage=void 0;const s=r(98653);class i extends s.RequestMessage{constructor(e){super(),this.body=e}}t.QueryMessage=i},49631:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EventMessage=t.defineEvent=void 0;var s=r(84776);Object.defineProperty(t,"defineEvent",{enumerable:!0,get:function(){return s.defineEvent}}),Object.defineProperty(t,"EventMessage",{enumerable:!0,get:function(){return s.EventMessage}})},84776:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineEvent=t.EventMessage=void 0;const s=r(98653);class i{constructor(e){this.body=e}}t.EventMessage=i;t.defineEvent=(e={scope:s.UseCaseScope.User})=>{var t;return(t=class extends i{}).metadata=e,t}},90693:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(52389),t),i(r(70986),t),i(r(35079),t),i(r(85888),t),i(r(49631),t),i(r(67202),t),i(r(22396),t),i(r(28601),t)},35079:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(36518),t)},82397:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.taskTrackingApi=void 0;const s=r(85888),i=r(96609),a=r(7797);t.taskTrackingApi=(0,s.defineModuleApi)({name:"taskTracking",commands:{startTaskTracking:i.StartTaskTrackingCommand,terminateTaskTracking:a.TerminateTaskTrackingCommand},events:{},queries:{}})},39948:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(96609),t),i(r(7797),t)},96609:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StartTaskTrackingCommand=void 0;const s=r(70986);class i extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.StartTaskTrackingCommand=i},7797:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TerminateTaskTrackingCommand=void 0;const s=r(70986);class i extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.TerminateTaskTrackingCommand=i},36518:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.taskTrackingApi=void 0;var a=r(82397);Object.defineProperty(t,"taskTrackingApi",{enumerable:!0,get:function(){return a.taskTrackingApi}}),i(r(39948),t)},17286:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0})},24164:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.featureFlipsApi=t.ToggleLabCommand=t.RefreshAvailableLabsCommand=t.UserFeatureFlipQuery=t.UserAvailableLabsQuery=t.UserFeatureFlipsQuery=void 0;const s=r(70986),i=r(8369);class a extends((0,s.defineQuery)({scope:s.UseCaseScope.User})){}t.UserFeatureFlipsQuery=a;class o extends((0,s.defineQuery)({scope:s.UseCaseScope.User})){}t.UserAvailableLabsQuery=o;class n extends((0,s.defineQuery)({scope:s.UseCaseScope.User})){}t.UserFeatureFlipQuery=n;class c extends((0,s.defineCommand)({scope:s.UseCaseScope.User})){}t.RefreshAvailableLabsCommand=c;class l extends((0,s.defineCommand)({scope:s.UseCaseScope.User})){}t.ToggleLabCommand=l,t.featureFlipsApi=(0,i.defineModuleApi)({events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:a,UserFeatureFlipQuery:n,UserAvailableLabsQuery:o},commands:{RefreshAvailableLabsCommand:c,ToggleLabCommand:l}})},71057:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureFlipsClient=void 0;const s=r(23767),i=r(24164);class a extends((0,s.defineModuleClient)(i.featureFlipsApi)){}t.FeatureFlipsClient=a,(0,s.registerModuleClient)(i.featureFlipsApi,a)},85888:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(8369),t),i(r(21697),t),i(r(17286),t),i(r(6964),t),i(r(23767),t),i(r(24164),t),i(r(71057),t),i(r(27646),t)},23767:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.registerModuleClient=t.defineModuleClient=void 0,t.defineModuleClient=function(e){var t;return(t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}}).api=e,t},t.registerModuleClient=function(e,t){e.ClientClass=t}},8369:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defineModuleApi=void 0;const r=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=s,e)),{});t.defineModuleApi=e=>({name:e.name,commands:r(e.commands,"Command"),queries:r(e.queries,"Query"),events:r(e.events,"Event")})},6964:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.requestContextApi=t.ActiveUserSetEvent=t.SetActiveUserCommand=t.ActiveUserQuery=void 0;const s=r(70986),i=r(49631),a=r(8369);class o extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.ActiveUserQuery=o;class n extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.SetActiveUserCommand=n;class c extends((0,i.defineEvent)({scope:s.UseCaseScope.User})){}t.ActiveUserSetEvent=c,t.requestContextApi=(0,a.defineModuleApi)({commands:{SetActiveUserCommand:n},events:{activeUserSet:c},name:"requestContext",queries:{ActiveUserQuery:o}})},27646:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RequestContextClient=void 0;const s=r(23767),i=r(6964);class a extends((0,s.defineModuleClient)(i.requestContextApi)){}t.RequestContextClient=a,(0,s.registerModuleClient)(i.requestContextApi,a)},21697:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NullModuleApi=void 0,t.NullModuleApi={name:"api",commands:{},events:{},queries:{}}},48304:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.platformInfoApi=t.PlatformInfoQuery=void 0;const s=r(70986),i=r(85888);class a extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.PlatformInfoQuery=a,t.platformInfoApi=(0,i.defineModuleApi)({name:"platformInfo",commands:{},events:{},queries:{PlatformInfoQuery:a}})},24199:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PlatformInfoClient=void 0;const s=r(85888),i=r(48304);class a extends((0,s.defineModuleClient)(i.platformInfoApi)){}t.PlatformInfoClient=a,(0,s.registerModuleClient)(i.platformInfoApi,a)},22396:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(48304),t),i(r(24199),t),i(r(84289),t)},84289:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ApplicationBuildType=void 0,function(e){e.DEV="DEV",e.QA="QA",e.NIGHTLY="NIGHTLY",e.BETA="BETA",e.PRODUCTION="PRODUCTION"}(t.ApplicationBuildType||(t.ApplicationBuildType={}))},38783:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.webServicesApi=t.EditSettingsForStagingCommand=t.SettingsForStagingQuery=void 0;const s=r(70986),i=r(85888);class a extends((0,s.defineQuery)({scope:s.UseCaseScope.Device})){}t.SettingsForStagingQuery=a;class o extends((0,s.defineCommand)({scope:s.UseCaseScope.Device})){}t.EditSettingsForStagingCommand=o,t.webServicesApi=(0,i.defineModuleApi)({commands:{EditSettingsForStagingCommand:o},events:{},name:"webServices",queries:{SettingsForStagingQuery:a}})},56651:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WebServicesClient=void 0;const s=r(85888),i=r(38783);class a extends((0,s.defineModuleClient)(i.webServicesApi)){}t.WebServicesClient=a,(0,s.registerModuleClient)(i.webServicesApi,a)},28601:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(38783),t),i(r(56651),t)},20587:(e,t,r)=>{r.d(t,{L5:()=>o,Yu:()=>c,mf:()=>n});var s=r(86952),i=r(74354),a=r(25029);class o extends((0,i.g)({scope:a.F.Device})){}class n extends((0,i.g)({scope:a.F.Device})){}const c=(0,s.Q)({commands:{TrackEventCommand:o,TrackPageViewCommand:n},events:{},name:"analytics",queries:{}})},25029:(e,t,r)=>{r.d(t,{F:()=>i,z:()=>s});class s{}var i;!function(e){e.User="user",e.Device="device"}(i||(i={}))},74354:(e,t,r)=>{r.d(t,{A:()=>o,g:()=>a});var s=r(25029);class i extends s.z{constructor(e){super(),this.body=e}}const a=(...[e={scope:s.F.User}])=>{var t;return(t=class extends i{}).metadata=e,t},o=(e={scope:s.F.User})=>{var t;return(t=class extends i{}).metadata=e,t}},99059:(e,t,r)=>{r.d(t,{k:()=>a});var s=r(25029);class i extends s.z{constructor(e){super(),this.body=e}}const a=(e={scope:s.F.User})=>{var t;return(t=class extends i{}).metadata=e,t}},88885:(e,t,r)=>{r.d(t,{d:()=>a});var s=r(25029);class i{constructor(e){this.body=e}}const a=(e={scope:s.F.User})=>{var t;return(t=class extends i{}).metadata=e,t}},49329:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(86952),i=r(42339),a=r(29876);const o=(0,s.Q)({name:"taskTracking",commands:{startTaskTracking:i.g,terminateTaskTracking:a.y},events:{},queries:{}})},42339:(e,t,r)=>{r.d(t,{g:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},29876:(e,t,r)=>{r.d(t,{y:()=>a});var s=r(74354),i=r(25029);class a extends((0,s.g)({scope:i.F.Device})){}},70493:(e,t,r)=>{r.d(t,{YM:()=>u,_l:()=>c,_x:()=>d,cV:()=>p,fV:()=>l,r6:()=>n});var s=r(99059),i=r(25029),a=r(74354),o=r(86952);class n extends((0,s.k)({scope:i.F.User})){}class c extends((0,s.k)({scope:i.F.User})){}class l extends((0,s.k)({scope:i.F.User})){}class d extends((0,a.g)({scope:i.F.User})){}class u extends((0,a.g)({scope:i.F.User})){}const p=(0,o.Q)({events:{},name:"featureFlips",queries:{UserFeatureFlipsQuery:n,UserFeatureFlipQuery:l,UserAvailableLabsQuery:c},commands:{RefreshAvailableLabsCommand:d,ToggleLabCommand:u}})},21242:(e,t,r)=>{r.d(t,{P:()=>a});var s=r(67837),i=r(70493);class a extends((0,s.E)(i.cV)){}(0,s.K)(i.cV,a)},67837:(e,t,r)=>{function s(e){var t;return(t=class{get commands(){throw new Error("Not implemented")}get queries(){throw new Error("Not implemented")}}).api=e,t}function i(e,t){e.ClientClass=t}r.d(t,{E:()=>s,K:()=>i})},86952:(e,t,r)=>{r.d(t,{Q:()=>i});const s=(e,t)=>Object.entries(e).reduce(((e,[r,s])=>(e[((e,t)=>e.endsWith(t)?e.charAt(0).toLowerCase()+e.substring(1,e.length-t.length):e)(r,t)]=s,e)),{}),i=e=>({name:e.name,commands:s(e.commands,"Command"),queries:s(e.queries,"Query"),events:s(e.events,"Event")})},8987:(e,t,r)=>{r.d(t,{W_:()=>d,p:()=>c,r$:()=>l,t$:()=>u});var s=r(99059),i=r(25029),a=r(74354),o=r(88885),n=r(86952);class c extends((0,s.k)({scope:i.F.Device})){}class l extends((0,a.g)({scope:i.F.Device})){}class d extends((0,o.d)({scope:i.F.User})){}const u=(0,n.Q)({commands:{SetActiveUserCommand:l},events:{activeUserSet:d},name:"requestContext",queries:{ActiveUserQuery:c}})},69008:(e,t,r)=>{r.d(t,{Q:()=>a});var s=r(67837),i=r(8987);class a extends((0,s.E)(i.t$)){}(0,s.K)(i.t$,a)},50540:(e,t,r)=>{r.d(t,{J:()=>n,a:()=>o});var s=r(99059),i=r(25029),a=r(86952);class o extends((0,s.k)({scope:i.F.Device})){}const n=(0,a.Q)({name:"platformInfo",commands:{},events:{},queries:{PlatformInfoQuery:o}})},55300:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(67837),i=r(50540);class a extends((0,s.E)(i.J)){}(0,s.K)(i.J,a)},59894:(e,t,r)=>{var s;r.d(t,{P:()=>s}),function(e){e.DEV="DEV",e.QA="QA",e.NIGHTLY="NIGHTLY",e.BETA="BETA",e.PRODUCTION="PRODUCTION"}(s||(s={}))},97191:(e,t,r)=>{r.d(t,{Dm:()=>l,Lt:()=>n,bH:()=>c});var s=r(99059),i=r(25029),a=r(74354),o=r(86952);class n extends((0,s.k)({scope:i.F.Device})){}class c extends((0,a.g)({scope:i.F.Device})){}const l=(0,o.Q)({commands:{EditSettingsForStagingCommand:c},events:{},name:"webServices",queries:{SettingsForStagingQuery:n}})},1665:(e,t,r)=>{r.d(t,{I:()=>h});var s=r(88802),i=r(20587),a=r(99634),o=r(63663),n=r(87279),c=r(86252),l=r(57924);let d=class{constructor(e){this.carbonLegacyClient=e}async trackEvent(e){const{carbon:t}=this.carbonLegacyClient.commands,r=await t({name:"logEvent",args:[{event:e}]});if((0,n.hx)(r))throw new Error("TrackEvent from carbon failed")}async trackPageView(e,t){const{carbon:r}=this.carbonLegacyClient.commands,s=await r({name:"logPageView",args:[{pageView:e,browseComponent:t}]});if((0,n.hx)(s))throw new Error("TrackPageView from carbon failed")}};d=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[c._])],d);let u=class{constructor(e){this.analyticsService=e}async execute({body:{event:e}}){return await this.analyticsService.trackEvent(e),(0,n.Vp)(void 0)}};u=(0,s.__decorate)([(0,o.W)(i.L5),(0,s.__metadata)("design:paramtypes",[d])],u);let p=class{constructor(e){this.analyticsService=e}async execute({body:{pageView:e,browseComponent:t}}){return await this.analyticsService.trackPageView(e,t),(0,n.Vp)(void 0)}};p=(0,s.__decorate)([(0,o.W)(i.mf),(0,s.__metadata)("design:paramtypes",[d])],p);let h=class{};h=(0,s.__decorate)([(0,a.Y)({api:i.Yu,providers:[d],handlers:{commands:{trackEvent:u,trackPageView:p},events:{},queries:{}}})],h)},79256:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}async derive(e,t,r){const{deriveKeyArgon2d:s}=this.config.crypto;return await s(e,t,r)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},114:(e,t,r)=>{r.d(t,{i:()=>o});var s=r(88802),i=r(57924);const a={computeHash:()=>Promise.resolve(new ArrayBuffer(32)),decryptAes256:(e,t,r)=>Promise.resolve(r),deriveKeyArgon2d:()=>Promise.resolve(new ArrayBuffer(32)),deriveKeyPbkdf2:()=>Promise.resolve(new ArrayBuffer(32)),encryptAes256:(e,t,r)=>Promise.resolve(r),generateKeyAes256:()=>Promise.resolve(new ArrayBuffer(32)),generateKeyPairRsaOaep:()=>Promise.resolve({privateKey:new ArrayBuffer(32),publicKey:new ArrayBuffer(32)}),getRandomValues:e=>new Uint8Array(e),signHmacSha:()=>Promise.resolve(new ArrayBuffer(32)),unsafeComputeMd5Hash:()=>new ArrayBuffer(1),verifyHmacSha:()=>Promise.resolve(!0),decryptRsaOaep:function(e,t){return Promise.resolve(t)},encryptRsaOaep:function(e,t){return Promise.resolve(t)},signRsassaPkcs1:function(e,t){return Promise.resolve(t)}};let o=class{constructor(e){this.crypto=e}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[Object])],o);new o(a)},37935:(e,t,r)=>{r.d(t,{D:()=>Y});var s=r(88802),i=r(99634),a=r(79256),o=r(114),n=r(31186),c=r(25594),l=r(56268),d=r(31222),u=r(57924),p=r(74017);let h=class{constructor(e){this.config=e}async verify(e,t,r,s=p.x){const{verifyHmacSha:i}=this.config.crypto;return await i(e,t,r,s)}};h=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[o.i])],h);var m=r(92258),g=r(72580),v=r(83919),y=r(56130),_=r(65613),f=r(40369),S=r(12554),E=r(77970),b=r(40173),w=r(28008),A=r(22513),C=r(60733),I=r(19603),T=r(95087),P=r(89685);const O="flexible";var R=r(69591);const D="KWC3",N=0;var U=r(38291);const F=32,M=4;function L(e){const t=e.slice(F,F+M),r=(0,P.v)(t);var s;if(s=r,[D,U.PD].includes(s))return r}function x(e){const t=L(e);return t||(function(e){const t=new Uint8Array(e).slice(0,1);return(0,P.v)(t.buffer)===R.F}(e)?O:void 0)}var k=r(60745),G=r(82933),V=r(94805),K=r(16698);const j={type:D,derivation:V.Yi,cipher:K.No};function B(e){const t=function({transportableData:e,marker:t}){const{derivation:r,type:s}=t,{saltLength:i}=r,a=N+i+s.length;return{salt:e.slice(N,N+i),encipheredContents:e.slice(a)}}({transportableData:e,marker:j});return{salt:t.salt,type:D,encipheredContents:t.encipheredContents,derivationConfig:V.Yi,cipherConfig:K.No}}var W=r(12087);async function z(e,t,r,s){const i=B(s),{deriveKeyPbkdf2:a}=t,{derivationConfig:o,salt:n}=i,c=await(0,W.E)(a,r,o,e,n),{computeHash:l}=t,{cipherConfig:{ivLength:d,bytesToKey:{iterations:u,keyLength:p}}}=i,h=await async function(e,t,r,s,i,a){const o=(0,G.K)(t,a.slice(0,8));let n=o,c=new ArrayBuffer(0);for(let t=0;t<r;t++){const t=await e(n,"SHA-1");c=(0,G.K)(c,t),n=(0,G.K)(t,o)}const l=i+s;return Promise.resolve(c.slice(i,l))}(l,c,u,d,p,n),{decryptAes256:m}=t,{encipheredContents:g}=i;return m(c,h,g)}var H=r(7449);let Q=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return async function(e,t,r,s){const i=x(s);if(!i)throw new Error("Cannot find marker type");switch(i){case D:return await z(e,t,r,s);case U.PD:return await(0,H.I)(e,t,s);case O:return(0,k.F)(e,t,r,s);default:(0,T.U)(i)}}(e,this.config.crypto,this.derivationCache,t)}};Q=(0,s.__decorate)([(0,u.GS)(),(0,s.__metadata)("design:paramtypes",[o.i,n.E])],Q);var q=r(708);let Y=class{};Y=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"cryptography",configurations:{infrastructure:{token:o.i}},providers:[a.y,n.E,c.a,l._,q.y,d.q,h,m.c,g.$,v.o,y.k,_.n,f.F,I.Y,S.g,E.H,b.e,w.k,A.Z,Q,C.f],exports:[a.y,n.E,c.a,l._,q.y,d.q,h,m.c,g.$,v.o,y.k,_.n,f.F,I.Y,S.g,E.H,b.e,w.k,A.Z,Q,C.f]})],Y)},31186:(e,t,r)=>{r.d(t,{E:()=>c});var s=r(88802),i=r(57924),a=r(82933),o=r(10370);class n{constructor(){this.derivateKeyCache=new Map}getCacheKey(...e){const t=e.reduce(((e,t)=>(0,a.K)(e,t)),new ArrayBuffer(0));return(0,o.s)(t)}getCachedDerivation(e){return this.derivateKeyCache.get(e)}setCachedDerivation({cacheKey:e,data:t}){this.getCachedDerivation(e)||this.derivateKeyCache.set(e,t)}}let c=class extends n{};c=(0,s.__decorate)([(0,i.GS)()],c)},25594:(e,t,r)=>{r.d(t,{a:()=>c});var s=r(88802),i=r(57924),a=r(60745),o=r(114),n=r(31186);let c=class{constructor(e,t){this.config=e,this.derivationCache=t}decrypt(e,t){return(0,a.F)(e,this.config.crypto,this.derivationCache,t)}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.i,n.E])],c)},56268:(e,t,r)=>{r.d(t,{_:()=>f});var s=r(88802),i=r(57924),a=r(82933),o=r(95087),n=r(54066),c=r(69591),l=r(33055),d=r(94805);function u(e){const t=c.F+e.join(c.F)+c.F;return(0,n.u)(t)}function p({cipher:e,derivation:t}){const{algorithm:r}=t;switch(r){case"argon2d":return function({cipher:e,derivation:t}){const{count:r,index:s}=l.ARGON2D_MARKER_SCHEMA,i=new Array(r);return i[s.version]=c.g,i[s.derivation]=t.algorithm,i[s.saltLength]=t.saltLength,i[s.tCost]=t.tCost,i[s.mCost]=t.mCost,i[s.parallelism]=t.parallelism,i[s.cipher]=e.algorithm,i[s.mode]=e.mode,i[s.ivLength]=e.ivLength,u(i)}({cipher:e,derivation:t});case"pbkdf2":return function({cipher:e,derivation:t}){const{count:r,index:s}=l.PBKDF2_MARKER_SCHEMA,i=new Array(r);return i[s.version]=c.g,i[s.derivation]=t.algorithm,i[s.saltLength]=t.saltLength,i[s.iterations]=t.iterations,i[s.hashAlgorithm]=t.hashAlgorithm,i[s.cipher]=e.algorithm,i[s.mode]=e.mode,i[s.ivLength]=e.ivLength,u(i)}({cipher:e,derivation:t});case"noderivation":return function({cipher:e,derivation:t}){const{count:r,index:s}=l.NODERIVATION_MARKER_SCHEMA,i=new Array(r);return i[s.version]=c.g,i[s.derivation]=t.algorithm,i[s.cipher]=e.algorithm,i[s.mode]=e.mode,i[s.ivLength]=e.ivLength,u(i)}({cipher:e,derivation:t});default:(0,o.U)(r)}}var h=r(58396),m=r(6424),g=r(6752);async function v(e,t,r,s,i,o,n){const{algorithm:c}=r,l="pbkdf2"===c||"argon2d"===c;if(l&&!n?.salt)throw new Error("Need salt for derivation");const{deriveKeyArgon2d:u,deriveKeyPbkdf2:v}=t,y=l&&n?.salt?await(0,g.b)(e,n.salt,v,u,r,s):e,{mode:_}=i,{computeHash:f}=t,{encryptionKey:S,signatureKey:E}="cbchmac64"===_?await(0,h.U)(y):await(0,m.Y)(y,f),{getRandomValues:b}=t,w=b(i.ivLength),{encryptAes256:A}=t,C=await A(S,w,o),{signHmacSha:I}=t,T=(0,a.K)(w,C),P=await I(E,T);return function(e){const{encipheredContents:t,cipherConfig:r,derivationConfig:s,salt:i,signature:o,iv:n}=e;if((i?.byteLength??0)!==(0,d.m9)(s))throw new Error(`Salt length ${i?.byteLength??0} does not match derivation algorithm ${s.algorithm} expectation`);const c=p({cipher:r,derivation:s});return i&&"noderivation"!==s.algorithm?(0,a.K)(c,i,n,o,t):(0,a.K)(c,n,o,t)}({type:"flexible",version:1,derivationConfig:r,cipherConfig:i,salt:n?.salt,iv:w,signature:P,encipheredContents:C})}var y=r(114),_=r(31186);let f=class{constructor(e,t){this.config=e,this.derivationCache=t}async encrypt(e,t,r,s,i){return await v(e,this.config.crypto,r,this.derivationCache,s,t,i)}};f=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[y.i,_.E])],f)},708:(e,t,r)=>{r.d(t,{y:()=>c});var s=r(88802),i=r(57924),a=r(60745);var o=r(114),n=r(31186);let c=class{constructor(e,t){this.config=e,this.derivationCache=t}verifySignature(e,t){return async function(e,t,r,s){const{verifyHmacSha:i}=t,{signatureKey:o,signature:n,dataToSign:c}=await(0,a.V)(e,t,r,s);return i(o,n,c)}(e,this.config.crypto,this.derivationCache,t)}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.i,n.E])],c)},31222:(e,t,r)=>{r.d(t,{q:()=>n});var s=r(88802),i=r(57924),a=r(74017),o=r(114);let n=class{constructor(e){this.config=e}async sign(e,t,r=a.x){const{signHmacSha:s}=this.config.crypto;return await s(e,t,r)}};n=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.i])],n)},92258:(e,t,r)=>{r.d(t,{c:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}generate(){const{generateKeyAes256:e}=this.config.crypto;return e()}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},72580:(e,t,r)=>{r.d(t,{$:()=>n});var s=r(88802),i=r(57924),a=r(7449),o=r(114);let n=class{constructor(e){this.config=e}decrypt(e,t){return(0,a.I)(e,this.config.crypto,t)}};n=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.i])],n)},83919:(e,t,r)=>{r.d(t,{o:()=>h});var s=r(88802),i=r(57924),a=r(16698),o=r(82933),n=r(54066),c=r(38291);var l=r(6424);async function d(e,t,r,s,i,a){const{computeHash:d}=t,{encryptionKey:u,signatureKey:p}=await(0,l.Y)(e,d),{getRandomValues:h}=t,{ivLength:m}=s,g=h(m),{encryptAes256:v}=t,y=await v(u,g,i),{signHmacSha:_}=t,f=(0,o.K)(g,y),S={type:"KWC5",derivationConfig:r,cipherConfig:s,iv:g,signature:await _(p,f),encipheredContents:y},{padding:E}=a;return function({secureData:e,randomValues:t}){if(t.byteLength!==c.en)throw new Error("Encoding kwc5 requires 16 random bytes");const{encipheredContents:r,iv:s,type:i,signature:a}=e,l=(0,n.u)(i);return(0,o.K)(s,t,l,a,r)}({secureData:S,randomValues:E})}var u=r(94805),p=r(114);let h=class{constructor(e){this.config=e}encrypt(e,t){const{getRandomValues:r}=this.config.crypto,s={padding:r(a.BU.padding)};return d(e,this.config.crypto,u.oo,a.BU,t,s)}};h=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[p.i])],h)},55119:(e,t,r)=>{function s(){return new Uint32Array([57920321,977424202,1999259334,3390546403,3917439743,16505144,3027631148,3235565160,2643335823,1420105356,998514539,2704347781,1011257802,823882961,790991339,3929284516]).buffer}r.d(t,{S:()=>s})},56130:(e,t,r)=>{r.d(t,{k:()=>n});var s=r(88802),i=r(57924),a=r(25594),o=r(55119);let n=class{constructor(e){this.flexibleDecryptor=e}async decrypt(e){const t=(0,o.S)();return await this.flexibleDecryptor.decrypt(t,e)}};n=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.a])],n)},65613:(e,t,r)=>{r.d(t,{n:()=>c});var s=r(88802),i=r(57924),a=r(89685),o=r(56130),n=r(40369);let c=class{constructor(e,t){this.obfuscationKeyDecryptor=e,this.obfuscationKeyEncryptor=t}async encode(e){return await this.obfuscationKeyEncryptor.encrypt(e)}async decode(e){return(0,a.v)(e).startsWith("$1$noderivation$aes256$cbchmac64$16$")?await this.obfuscationKeyDecryptor.decrypt(e):e}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[o.k,n.F])],c)},40369:(e,t,r)=>{r.d(t,{F:()=>l});var s=r(88802),i=r(57924),a=r(94805),o=r(16698),n=r(56268),c=r(55119);let l=class{constructor(e){this.flexibleEncryptor=e}async encrypt(e){const t=(0,c.S)();return await this.flexibleEncryptor.encrypt(t,e,a.oo,o.gO)}};l=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[n._])],l)},19603:(e,t,r)=>{r.d(t,{Y:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}get(e){const{getRandomValues:t}=this.config.crypto;return t(e).buffer}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},12554:(e,t,r)=>{r.d(t,{g:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}decrypt(e,t,r="SHA-256"){const{decryptRsaOaep:s}=this.config.crypto;return s(e,t,r)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},77970:(e,t,r)=>{r.d(t,{H:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}encrypt(e,t,r="SHA-256"){const{encryptRsaOaep:s}=this.config.crypto;return s(e,t,r)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},40173:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}generate(e="SHA-256"){const{generateKeyPairRsaOaep:t}=this.config.crypto;return t(e)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},28008:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}async sign(e,t,r="SHA-256"){const{signRsassaPkcs1:s}=this.config.crypto;return await s(e,t,r)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},22513:(e,t,r)=>{r.d(t,{Z:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}async compute(e,t){const{computeHash:r}=this.config.crypto;return await r(e,t)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},60733:(e,t,r)=>{r.d(t,{f:()=>o});var s=r(88802),i=r(57924),a=r(114);let o=class{constructor(e){this.config=e}compute(e){const{unsafeComputeMd5Hash:t}=this.config.crypto;return t(e)}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.i])],o)},65255:(e,t,r)=>{r.d(t,{w:()=>s});const s={AuthsyncExtensionArkRelease:"authsync_extension_ark_release",B2CWebPostTrialBanner:"b2c_web_postTrialBanner",B2CRestrictPasswordFreePlanPhase1:"b2c_web_restrict_password_free_plan_phase1",B2CRestrictPasswordFreePlanPhase2:"b2c_web_restrict_password_free_plan_phase2",BBCOM238Duo:"BBCOM-238-duo",CollectionsPageEnabled:"vault_web_collectionpage_dev",SAEXSendSharing:"SAEXSendSharing",DwiMultipleDomainsProd:"dwi_multiple_domains_prod",DisableSecureNotes:"disableSecureNotes",EcommerceWebB2BDiscontinuationDev:"ecommerce_web_b2bDiscontinuation_dev",EcommerceWebIdPErrorsDev:"ecommerce_web_idp_errors_dev",EcommerceWebIdPErrorsPhase1:"ecommerce_web_idp_errors_phase1_prod",EcommerceWebIdPErrorsPhase2:"ecommerce_web_idp_errors_phase2_prod",EcommerceWebIdPErrorsPhase3:"ecommerce_web_idp_errors_phase3_prod",ImsWebWeakMpProd:"ims_web_weak_mp_prod",ItadminSAEXCryptoMigrationPhase3V1:"itadmin_SAEX_CryptoMigration_Phase3_v1",ItadminTacEncryptionserviceSSOmigrationReset:"itadmin_tac_encryptionservice_SSOmigration_reset",SaexSecureNoteAttachmentsForrelease:"saex_SecureNoteAttachments_forrelease",TechWeekWebDisplayLabs:"techWeek_web_displayLabs",TechweekWebAttachmentsForIdsV1:"techweek_web_attachmentsForIds_v1",TechweekWebExpiredLabelforIDDev:"techweek_web_expiredLabelforID_dev",WebplatformWebPrideColors:"webplatform_web_prideColors",WebproductExtensionActivateChangeMasterPasswordRelease:"webproduct_extension_ActivateChangeMasterPassword_release",WebproductExtensionShowUserConsentOptions:"webproduct_extension_ShowUserConsentOptions",SupportMarkdownInSecureNotes:"webproduct_extension_securenotesmarkdown_dev",SharingVaultOtpSetupDev:"sharingVault_web_otp_setup_dev",SecretManagementProd_1:"ace_secrets_vault_1"}},1777:(e,t,r)=>{r.d(t,{k:()=>$});var s=r(88802),i=r(99634),a=r(22838),o=r(70493),n=r(8987),c=r(93850),l=r(85390),d=r(16433),u=r(87065),p=r(30523),h=r(68307),m=r(9671),g=r(20754),v=r(63663),y=r(69008),_=r(87279),f=r(60399),S=r(57924),E=r(48844),b=r(87113);let w=class{constructor(e){this.serverApiClient=e}getFeatureFlipsForActiveUser(e){return(0,f.z)(this.serverApiClient.v1.features.getAndEvaluateForUser({features:e}).pipe((0,E.nb)({success:e=>e.data.enabledFeatures,failure:()=>{throw new Error("Unable to fetch enabled feature flips for the active user")}})))}getAvailableFeatureFlips(){return(0,f.z)(this.serverApiClient.v1.features.listAvailableFeatureFlips({}).pipe((0,E.nb)({success:e=>e.data.features.map((e=>e.name)),failure:()=>{throw new Error("Unable to fetch available feature flips")}})))}};w=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:paramtypes",[b.l])],w);var A=r(95681),C=r(23347),I=r(25029),T=r(10722);const P=e=>!(!e||"object"!=typeof e)&&"featureFlips"in e;class O extends((0,A.Q)({persist:!0,scope:I.F.Device,storeName:"feature-flip-store",capacity:C.Y._010KB,codec:T.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:P}})){}class R extends((0,A.Q)({persist:!0,scope:I.F.User,storeName:"feature-flip-store",capacity:C.Y._010KB,codec:T.E,storage:{initialValue:{featureFlips:{}},schemaVersion:1,typeGuard:P}})){}var D;!function(e){e.Success="Success",e.Pending="Pending",e.Loading="Loading",e.Cache="Cache"}(D||(D={}));class N extends((0,A.Q)({persist:!1,initialValue:{refreshStatus:D.Pending},scope:I.F.Device,storeName:"feature-flip-refresh-store",capacity:C.Y._001KB})){}function U(e,t){return!(!(0,_.d6)(e)||(0,_.db)(e).userName)||(!(0,_.d6)(e)||!(0,_.db)(e).userName||[D.Success,D.Cache].includes(t))}const F=(e,t)=>Object.keys(e).reduce(((r,s)=>{const i=t[s];return r[s]=void 0!==i?i.isActivated:e[s],r}),{});var M=r(28489);const L=e=>"object"==typeof e&&null!==e&&(0,M.l$)(e,"availableLabs")&&"object"==typeof e.availableLabs&&null!==e.availableLabs;class x extends((0,A.Q)({persist:!0,scope:I.F.User,storeName:"labs-store",capacity:C.Y._001KB,codec:T.E,storage:{initialValue:{availableLabs:{}},schemaVersion:1,typeGuard:L}})){}var k=r(96168);class G extends((0,k.Hu)("refresh_available_labs_failed","Unable to refresh available labs for the active user")){}class V extends((0,k.Hu)("fetch_available_labs_failed","Unable to fetch labs for the active user")){}let K=class{constructor(e,t,r,s){this.serverApiClient=e,this.introspection=t,this.featureFlipsStore=r,this.labsStore=s}async refreshAvailableLabs(){const e=await this.getAvailableLabs();if((0,_.hx)(e))return(0,_.Rn)(new G);const t=await this.labsStore.getState(),r=(0,_.db)(e).reduce(((e,r)=>(e[r.featureName]={...r,isActivated:!!t.availableLabs[r.featureName]?.isActivated},e)),{});return await this.labsStore.set({availableLabs:r}),(0,_.Vp)(void 0)}async getAvailableLabs(){const e=this.getRequiredFeatures(),{featureFlips:t}=await this.featureFlipsStore.getState();return(0,f.z)(this.serverApiClient.v1.features.listAvailableLabs({}).pipe((0,E.DZ)((()=>new V)),(0,E.lk)((r=>(0,_.Vp)(r.data.labs.filter((t=>e.has(t.featureName))).filter((e=>!1===t[e.featureName])))))))}getRequiredFeatures(){const e=this.introspection.modules;return Object.keys(e).reduce(((t,r)=>{const s=e[r];if(s.requiredFeatureFlips)for(const e of s.requiredFeatureFlips)t.add(e);return t}),new Set)}};K=(0,s.__decorate)([(0,S.GS)(),(0,s.__metadata)("design:paramtypes",[b.l,a.Q1,R,x])],K);let j=class{constructor(e,t,r,s,i,a,o){this.allowedToFailForGetAvailableFeatureFlips=e,this.allowedToFailForGetFeatureFlipsForActiveUser=t,this.allowedToFailForGetAvailableLabs=r,this.featureFlipsService=s,this.featureFlipsStore=i,this.featureFlipsRefreshStore=a,this.labsService=o}async handle({body:e}){if(!e.userName)return await this.featureFlipsRefreshStore.set({refreshStatus:D.Pending}),void await this.featureFlipsStore.set({featureFlips:{}});await this.featureFlipsRefreshStore.set({refreshStatus:D.Loading});const t=this.labsService.getRequiredFeatures(),r=Array.from(t);let s=[];await this.allowedToFailForGetAvailableFeatureFlips.doOne((()=>this.featureFlipsService.getAvailableFeatureFlips().then((e=>{s=e.filter((e=>t.has(e)))}))));const i=0===s.length?r:s;await this.allowedToFailForGetFeatureFlipsForActiveUser.doOne((async()=>{try{const e=await this.featureFlipsService.getFeatureFlipsForActiveUser(i),t=new Set(e),a=new Set(s),o=r.reduce(((e,r)=>(e[r]=t.has(r)||!a.has(r)&&void 0,e)),{});await this.featureFlipsStore.set({featureFlips:o}),await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),await this.featureFlipsRefreshStore.set({refreshStatus:D.Success})}catch(e){throw await this.featureFlipsRefreshStore.set({refreshStatus:D.Cache}),e}}))}};j=(0,s.__decorate)([(0,h.b)(n.W_),(0,s.__metadata)("design:paramtypes",[m.J,m.J,m.J,w,R,N,K])],j);let B=class{constructor(e,t,r,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r,this.labsStore=s}execute(){return(0,l.a)([this.requestContextClient.queries.activeUser().pipe((0,d.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,u.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,u.U)((e=>e.featureFlips))),this.labsStore.state$.pipe((0,u.U)((e=>e.availableLabs)))]).pipe((0,p.h)((([e,t])=>U(e,t))),(0,u.U)((([e,,t,r])=>{if((0,_.d6)(e)){if(!(0,_.db)(e).userName)return(0,_.Vp)({});const s=F(t,r);return(0,_.Vp)(s)}throw new Error("Cannot determine if user is logged in")})))}};B=(0,s.__decorate)([(0,g.e)(o.r6),(0,s.__metadata)("design:paramtypes",[R,N,y.Q,x])],B);let W=class{constructor(e,t,r,s){this.featureFlipsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r,this.labsStore=s}execute({body:e}){const{featureFlip:t}=e;return(0,l.a)([this.requestContextClient.queries.activeUser().pipe((0,d.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,u.U)((e=>e.refreshStatus))),this.featureFlipsStore.state$.pipe((0,u.U)((e=>e.featureFlips))),this.labsStore.state$.pipe((0,u.U)((e=>e.availableLabs)))]).pipe((0,p.h)((([e,t])=>U(e,t))),(0,u.U)((([e,,r,s])=>{if((0,_.d6)(e)){if(!(0,_.db)(e).userName)return(0,_.Vp)(void 0);const i=F(r,s);return(0,_.Vp)(i[t])}throw new Error("Cannot determine if user is logged in")})))}};W=(0,s.__decorate)([(0,g.e)(o.fV),(0,s.__metadata)("design:paramtypes",[R,N,y.Q,x])],W);let z=class{constructor(e,t,r){this.labsStore=e,this.featureFlipsRefreshStore=t,this.requestContextClient=r}execute(){return(0,l.a)([this.requestContextClient.queries.activeUser().pipe((0,d.q)(1)),this.featureFlipsRefreshStore.state$.pipe((0,u.U)((e=>e.refreshStatus))),this.labsStore.state$.pipe((0,u.U)((e=>e.availableLabs)))]).pipe((0,p.h)((([e,t])=>U(e,t))),(0,u.U)((([e,,t])=>{if((0,_.d6)(e))return(0,_.db)(e).userName?(0,_.Vp)(t):(0,_.Vp)({});throw new Error("Cannot determine if user is logged in")})))}};z=(0,s.__decorate)([(0,g.e)(o._l),(0,s.__metadata)("design:paramtypes",[x,N,y.Q])],z);let H=class{constructor(e,t){this.allowedToFailForGetAvailableLabs=e,this.labsService=t}async execute(){return await this.allowedToFailForGetAvailableLabs.doOne((async()=>{await this.labsService.refreshAvailableLabs()})),(0,_.Vp)(void 0)}};H=(0,s.__decorate)([(0,v.W)(o._x),(0,s.__metadata)("design:paramtypes",[m.J,K])],H);let Q=class{constructor(e){this.labsStore=e}async execute({body:e}){const{id:t,isActivated:r}=e,s=await this.labsStore.getState(),i={...s,availableLabs:{...s.availableLabs,[t]:{...s.availableLabs[t],isActivated:r}}};return await this.labsStore.set(i),(0,_.Vp)(void 0)}};Q=(0,s.__decorate)([(0,v.W)(o.YM),(0,s.__metadata)("design:paramtypes",[x])],Q);var q=r(65255);let Y=class{constructor(e){this.featureFlipsStoreLegacy=e}onFrameworkInit(){this.featureFlipsStoreLegacy.clearStorage()}};Y=(0,s.__decorate)([(0,S.ar)(),(0,s.__metadata)("design:paramtypes",[O])],Y);let $=class{};$=(0,s.__decorate)([(0,i.Y)({api:o.cV,providers:[w,K],imports:[c.n,a.Q1],exports:[w],handlers:{commands:{refreshAvailableLabs:H,toggleLab:Q},queries:{userFeatureFlips:B,userFeatureFlip:W,userAvailableLabs:z},events:{...(0,i.g)(n.t$,{activeUserSet:j})}},stores:[O,R,N,x],requiredFeatureFlips:Object.values(q.w),onFrameworkInit:Y})],$)},43673:(e,t,r)=>{r.d(t,{i:()=>p});var s=r(88802),i=r(50540),a=r(99634),o=r(58895),n=r(86252),c=r(20754),l=r(48844),d=r(87279);let u=class{constructor(e){this.carbon=e}execute(){return this.carbon.queries.getPlatformInfo().pipe((0,l.lk)((e=>(0,d.Vp)(e))))}};u=(0,s.__decorate)([(0,c.e)(i.a),(0,s.__metadata)("design:paramtypes",[n._])],u);let p=class{};p=(0,s.__decorate)([(0,a.Y)({api:i.J,providers:[o.t],exports:[o.t],handlers:{commands:{},events:{},queries:{platformInfo:u}}})],p)},58895:(e,t,r)=>{r.d(t,{t:()=>d});var s=r(88802),i=r(60399),a=r(57924),o=r(94189),n=r(48844),c=r(20195),l=r(6936);let d=class{constructor(e){this.client=e}getPlatformInfo(){return(0,i.z)(this.client.getClient(l.W).queries.getPlatformInfo().pipe((0,n.nb)({success:e=>e,failure:c.j})))}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[o.m])],d)},29659:(e,t,r)=>{r.d(t,{c:()=>d});var s=r(88802),i=r(57924),a=r(26457),o=r(87279),n=r(86252),c=r(26897),l=r(88268);let d=class extends l.tI{constructor(e,t){super(),this.carbonLegacyClient=e,this.appLogger=t}async decipher(e,t){const{carbon:r}=this.carbonLegacyClient.commands,s=await r({name:"decipherRemoteFile",args:[{cipheredFileContent:e,fileMetaData:t}]});if((0,o.hx)(s))return(0,o.Rn)(c.RemoteFileUpdateError.DecipherError);const{carbonResult:i}=(0,o.db)(s);return(e=>"object"==typeof e&&null!==e&&Object.entries(e).some((([e,t])=>"decipheredFile"===e&&t instanceof ArrayBuffer)))(i)?(0,o.Vp)(i.decipheredFile):(0,o.Rn)(c.RemoteFileUpdateError.DecipherError)}};d=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[n._,a.V])],d)},39995:(e,t,r)=>{r.d(t,{Q:()=>c});var s=r(88802),i=r(57924),a=r(7537),o=r(58376),n=r(60399);let c=class{constructor(){this.filesToCheck={},this.publishSubscriber=new a.t,this.updatedFileStream$=new o.y((e=>{this.publishSubscriber.next(e),this.publishSubscriber.complete()}))}publish(e){(0,n.z)(this.publishSubscriber).then((t=>t.next(e)))}fileSubscription(e){return this.filesToCheck={...this.filesToCheck,...e},this.updatedFileStream$}getFilesToCheck(){return this.filesToCheck}};c=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[])],c)},47190:(e,t,r)=>{r.d(t,{P:()=>_});var s=r(88802),i=r(87279),a=r(48844),o=r(18533),n=r(26897),c=r(57924),l=r(73774),d=r(69885),u=r(60399),p=r(87065),h=r(87113),m=r(88268),g=r(94143),v=r(25994);const y=e=>e[1].status===g.nQ;let _=class extends m.gG{constructor(e,t){super(),this.httpClient=e,this.serverApiClient=t}async downloadRemoteFileUpdate(e){if(0===Object.keys(e.files).length)return[];const t=await this._getFileMeta(e);return(0,i.hx)(t)?[(0,d.of)(t)]:this._retrieveFilesFromServer((0,i.db)(t))}_getFileMeta(e){return(0,u.z)(this.serverApiClient.v1.file.getFileMetaV2(e).pipe((0,p.U)((e=>{if((0,i.hx)(e))return(0,i.Rn)(n.RemoteFileUpdateError.ServerError);const t=(0,i.db)(e);return"fileInfos"in(r=t.data)&&Object.values(r.fileInfos).every((e=>"object"==typeof e&&null!==e&&"status"in e&&void 0!==e.status&&null!==e.status&&g.PQ.has(e.status)))?(0,i.Vp)(t.data.fileInfos):(0,i.Rn)(n.RemoteFileUpdateError.ServerError);var r}))))}_retrieveFilesFromServer(e){return Object.entries(e).filter(y).map((([e,t])=>this._getBufferFromURL(e,t)))}_getBufferFromURL(e,t){return this.httpClient.get(t.url,{observe:"body",responseType:"arraybuffer"}).pipe((0,a.Qn)(this._handleSuccess(e,t)),(0,a.DZ)(this._handleFailure))}_handleFailure(e){return(0,o.EQ)(e,{BadStatus:e=>e.response.status===v.W.NotModified?g.ek:n.RemoteFileUpdateError.DownloadError,FetchFailedError:()=>n.RemoteFileUpdateError.DownloadError})}_handleSuccess(e,t){return r=>({fileName:e,buffer:r,updatedFile:t})}};_=(0,s.__decorate)([(0,c.GS)(),(0,s.__metadata)("design:paramtypes",[l.e,h.l])],_)},88268:(e,t,r)=>{r.d(t,{gG:()=>s,pF:()=>a,tI:()=>i});class s{}class i{}class a{}},73881:(e,t,r)=>{r.d(t,{Q:()=>y});var s=r(88802),i=r(99634),a=r(25504),o=r(25029),n=r(47190),c=r(1777),l=r(57924),d=r(39995),u=r(88268);let p=class{constructor(e,t){this.remoteFileUpdateService=e,this.dispatcherService=t}run(){const e=this.dispatcherService.getFilesToCheck();this.remoteFileUpdateService.observeRemoteFileUpdates(e).subscribe((e=>{this.dispatcherService.publish(e)})),this.remoteFileUpdateService.downloadAndDecipherRemoteFiles()}};p=(0,s.__decorate)([(0,l.GS)(),(0,s.__metadata)("design:paramtypes",[u.pF,d.Q])],p);var h=r(93850),m=r(29659),g=r(83958),v=r(1665);let y=class{};y=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"RemoteFileUpdateModule",configurations:{remoteFileUpdateInfrastructure:{token:u.pF},remoteFileUpdateDownloaderInfrastructure:{token:u.gG},decipherInfrastructure:{token:u.tI}},crons:[{handler:p,periodInMinutes:30,name:"RFUCron",scope:o.F.User}],providers:[g.U,m.c,n.P,d.Q],imports:[c.k,a.X,h.n,v.I],exports:[g.U,m.c,n.P,d.Q]})],y)},83958:(e,t,r)=>{r.d(t,{U:()=>S});var s=r(88802),i=r(57924),a=r(26457),o=r(94189),n=r(87279),c=r(7537),l=r(58376),d=r(91501),u=r(6220),p=r(87065),h=r(60399),m=r(20587),g=r(29659),v=r(47190),y=r(88268),_=r(94143),f=r(26897);let S=class extends y.pF{constructor(e,t,r,s){super(),this.appLogger=e,this.rfuDownloaderService=t,this.rfuDecipheringService=r,this.cqrsClient=s,this._filesToCheck={files:{}},this._emitDownloadedFilesUpdate$=new c.t,this._downloadedFileStream$=new l.y((e=>{this._emitDownloadedFilesUpdate$.next((t=>{e.next(t)})),this._emitDownloadedFilesUpdate$.complete()}))}observeRemoteFileUpdates(e){return this._filesToCheck={files:{...this._filesToCheck.files,...e}},this._downloadedFileStream$}async downloadAndDecipherRemoteFiles(){const e=(await this.rfuDownloaderService.downloadRemoteFileUpdate(this._filesToCheck)).map((e=>this._downloadAndDecipherSingleFile(e)));(0,d.D)(e).subscribe((e=>{const t=e.reduce(((e,t)=>{if((0,n.hx)(t)){const r=(0,n.Yv)(t);return r===_.ek||this.sendRFUEvents(f.FlowStep.Error,r),e}const r=(0,n.db)(t);return this.sendRFUEvents(f.FlowStep.Complete),{...e,[r.fileName]:r}}),{});this._callEmitDownloadedFilesUpdate(t)}))}async _applyDecipheringStep(e){const t=e.updatedFile.key?await this.rfuDecipheringService.decipher(e.buffer,e.updatedFile):(0,n.Vp)(e.buffer);return(0,n.d6)(t)?(0,n.Vp)({...e,buffer:(0,n.db)(t)}):t}_downloadAndDecipherSingleFile(e){return e.pipe((0,u.z)((e=>(0,n.d6)(e)?this._applyDecipheringStep((0,n.db)(e)):Promise.resolve(e))),(0,p.U)((e=>{if((0,n.hx)(e))return e;const{fileName:t,updatedFile:r,buffer:s}=(0,n.db)(e);return(0,n.Vp)({fileName:t,revision:r.revision,buffer:s,lastDownloadTimestamp:Date.now()})})))}_callEmitDownloadedFilesUpdate(e){return(0,h.z)(this._emitDownloadedFilesUpdate$).then((t=>{t(e)}))}sendRFUEvents(e,t=undefined){const{trackEvent:r}=this.cqrsClient.getClient(m.Yu).commands;r({event:new f.UserReceiveRemoteFileUpdateEvent({flowStep:e,remoteFileUpdateError:t,packageSource:f.PackageSource.Graphene})})}};S=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.V,v.P,g.c,o.w])],S)},94143:(e,t,r)=>{r.d(t,{PQ:()=>i,ek:()=>a,nQ:()=>s});const s="update_available",i=new Set([s,"not_updated","not_found","error_server"]),a="not_modified"},16988:(e,t,r)=>{r.d(t,{L:()=>s});class s{}},32697:(e,t,r)=>{r.d(t,{u:()=>N});var s=r(88802),i=r(24966),a=r(60399),o=r(30523),n=r(87065),c=r(6136),l=r(34987),d=r(14888),u=r(43004),p=r(57924),h=r(73774),m=r(91199),g=r(26457),v=r(43702);var y,_=r(23711),f=r(49499),S=r(87279),E=r(58895),b=r(16988),w=r(61223);function A(e){switch(e){case u.w.CRITICAL:return y.ERROR;case u.w.WARNING:return y.WARNING}}!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.WARNING=1]="WARNING",e[e.ERROR=2]="ERROR"}(y||(y={}));const C=(e,t)=>({action:"logOnline",code:A(t.criticality),type:e.platformName,version:e.appVersion,additionalInfo:JSON.stringify({manifestVersion:e.manifestVersion,buildType:e.buildType,...t.origin?{origin:t.origin}:{}}),browser:e.browser,browserVersion:e.browserVersion,exceptiontype:t.domainName??"grapheneException",message:t.message,os:e.os,osVersion:e.osVersion,sessionId:t.sessionId,stack:t.callStack,initialUseCaseModule:t.moduleName,initialUseCaseName:t.useCaseName,errorCount:1,featureFlips:(t.featuresFlipped??[]).join(","),line:t.lineNumber,file:t.fileLocation});function I(e,t){return new w.L("string"==typeof(r=C(e,t))?r:Object.keys(r).reduce(((e,t)=>{const s=r[t];return void 0===s||(e[t]="string"==typeof s?s:JSON.stringify(s)),e}),{}));var r}const T={"Content-Type":"application/x-www-form-urlencoded"},P=".graphene.exceptionLogs",O=new v.b,R=new class{constructor(e){this.typeGuard=e}decode(e){if(this.typeGuard(e))return e;throw new Error("Bad type")}encode(e){return e}}((e=>!(!e||"object"!=typeof e)&&(0===Object.keys(e).length||Object.keys(e).every((e=>"string"==typeof e))&&Object.values(e).every((e=>{return!!((t=e)&&"object"==typeof t&&"entry"in t&&"id"in t&&"date"in t)&&"string"==typeof t.id&&"number"==typeof t.date&&(0,u.h)(t.entry);var t}))))),D=new _.z;let N=class{constructor(e,t,r,s,a){this.httpClient=e,this.kvStore=t,this.logger=r,this.settings=s,this.platformInfoService=a,this.queue$=new i.X({}),this.logExceptionsCount={},this.platformInfo=null,this.url=`${this.settings.serverEndpoint??"https://kck3hlb9.dashlane.com"}/1/softwarelog/create`,this.codec=(0,f.x)(D,O,R)}async logException(e){console.error(e);const t=this.settings.maxExceptionCountPerSession??10,r=e.message.length?e.message:"UNKNOWN_EXCEPTION";if(r in this.logExceptionsCount){const e=this.logExceptionsCount[r];if(e===t)return Promise.resolve();this.logExceptionsCount[r]=e+1}else this.logExceptionsCount[r]=1;const s=await this.enqueue(e);await(0,a.z)(this.queue$.pipe((0,o.h)((e=>!(s in e)||!!e[s].error))))}async start(){this.platformInfo=await this.platformInfoService.getPlatformInfo(),await this.loadQueue();const e=this.settings.retryDelay??6e4,t=this.queue$.pipe((0,n.U)((e=>Object.keys(e))),(0,c.x)(((e,t)=>t.every((t=>e.includes(t))))),(0,l.b)((()=>this.processQueue())),(0,d.X)({delay:e})).subscribe();return{stop:async()=>{t.unsubscribe(),await this.saveQueue()}}}async ignoreError(e){try{return await e(),!0}catch(e){return this.logger.error("failed to send error log",e),!1}}async saveQueue(){await this.ignoreError((async()=>{const e=await this.codec.encode(this.queue$.value);await this.kvStore.set(P,e)}))}async loadQueue(){await this.ignoreError((async()=>{const e=await this.kvStore.get(P);if(!e||""===e)return void this.queue$.next({});const t=await this.codec.decode(e),r=Date.now()-(this.settings.durationInQueue??864e5);for(const e of Object.keys(t))t[e].date<r&&delete t[e];this.queue$.next(t)}))}async enqueue(e){const t={date:Date.now(),entry:e,id:`${Date.now()}-${Math.random()}`};return this.queue$.value[t.id]=t,await this.saveQueue(),this.queue$.next(this.queue$.value),t.id}async processQueue(){const e=this.platformInfo;if(!e)throw new Error("No platform info");for(;Object.keys(this.queue$.value).length>0;){const t=Object.keys(this.queue$.value)[0],r=this.queue$.value[t];if(!await this.ignoreError((async()=>{const t=await(0,a.z)(this.httpClient.post(this.url,I(e,r.entry),{headers:{...T,"Client-Agent":(s=e,`version:${s.appVersion},platform:${s.platformName}}`)},observe:"response"}));var s;if(!(0,S.d6)(t))throw new Error("Failed to send log")})))throw this.queue$.value[t].error=!0,this.queue$.next(this.queue$.value),new Error("failed to send an item from the queue");delete this.queue$.value[t],await this.saveQueue()}this.queue$.next(this.queue$.value)}};N=(0,s.__decorate)([(0,p.GS)(),(0,s.__metadata)("design:paramtypes",[h.e,m.QI,g.V,b.L,E.t])],N)},64555:(e,t,r)=>{r.d(t,{F:()=>l});var s=r(88802),i=r(99634),a=r(25504),o=r(43673),n=r(32697),c=r(16988);let l=class{};l=(0,s.__decorate)([(0,i.Y)({sharedModuleName:"software-exception-sink",imports:[a.X,o.i],providers:[n.u],exports:[n.u],configurations:{settings:{token:c.L}}})],l)},71993:(e,t,r)=>{r.d(t,{t:()=>l});var s=r(10722),i=r(25029),a=r(95681),o=r(23347);const n={drift:null},c=e=>!(!e||"object"!=typeof e||!("drift"in e))&&(null===e.drift||"number"==typeof e.drift);class l extends((0,a.Q)({storeTypeGuard:c,storeName:"clocksync",storage:{initialValue:n,schemaVersion:1,typeGuard:c},scope:i.F.Device,isCache:!0,persist:!0,capacity:o.Y._001KB,codec:s.E})){}},68259:(e,t,r)=>{r.d(t,{E:()=>k,F:()=>G});var s=r(88802),i=r(60399),a=r(89618),o=r(57924),n=r(73774),c=r(9671),l=r(71937),d=r(58895);class u{constructor(e){this.store=e}async getServerToClientClockDrift(){const{drift:e}=await this.store.getState();return e}storeServerToClientClockDrift(e){return this.store.update((()=>({drift:e})))}}var p=r(18590),h=r(71993),m=r(54404),g=r(77837),v=r(33027),y=r(9536),_=r(69865),f=r(99082),S=r(62361),E=r(4119),b=r(59091),w=r(52839),A=r(55127),C=r(7181),I=r(91406),T=r(73873),P=r(84626),O=r(42882),R=r(32739);const D={v1:{account:m.m,accountrecovery:g.u,authentication:v.V,darkwebmonitoring:y.D,features:_.A,feedback:f.x,file:S.$,invitation:E.R,payments:b.H,pwleak:w.J,sharingUserdevice:A.b,secretTransfer:C.V,teams:I.p,time:T.q,useractivity:P.V,userconsents:O.G,vpn:R.V}};var N=r(31222),U=r(22513);const F="CF-Access-Client-Id",M="CF-Access-Client-Secret";class L{constructor(e){this.cloudflareKeys=e,this.id="ServerApiForStagingInterceptor"}intercept(e,t){if(e.url.startsWith("https://api.dashlane.com/")||!this.cloudflareKeys)return t(e);if(!e.headers.has(F)&&!e.headers.has(M)){const{cloudflareAccessKey:r,cloudflareSecretKey:s}=this.cloudflareKeys;return t(e.clone({headers:e.headers.set(F,r).set(M,s)}))}return t(e)}}var x=r(86758);let k=class{constructor(e,t,r,s,i,a,o,n){this.serverApiConfig=e,this.httpClient=t,this.clockDriftStore=r,this.hmacSigner=s,this.secureHasher=i,this.platformInfoService=a,this.allowedToFail=o,this.settingsForStagingStore=n}async init(){const{clockDriftStore:e,serverApiConfig:t,secureHasher:r,httpClient:s,hmacSigner:i}=this,a=new u(e),o=await this.platformInfoService.getPlatformInfo(),{appKeys:n}=t,c=await this.settingsForStagingStore.getState();this.baseUrl=this.initBaseUrl(c,t);const d=this.initCloudflareKeys(c,t);s.addInterceptor(new L(d));const p=(0,l.d)({secureHasher:r,httpClient:s,timeSyncStore:a,hmacSigner:i,apis:D,config:{appKeys:n,baseUrl:this.baseUrl,platformInfo:{platformName:o.platformName,version:o.appVersion||"unknown",osversion:o.osVersion||"unknown",language:o.lang||"unknown"}}});await this.initClockDrift(p),this.rawSdk=p}get sdk(){if(!this.rawSdk)throw new Error("ConfiguredServerSdk not initialized");return this.rawSdk}get url(){if(!this.baseUrl)throw new Error("ConfiguredServerSdk base url not found");return this.baseUrl}initBaseUrl(e,t){const r=e.api;return r.override?r.baseUrlOverride:t.baseUrl}initCloudflareKeys(e,t){const r=e.api;return r.override?{cloudflareAccessKey:r.cloudflareAccessKeyOverride,cloudflareSecretKey:r.cloudflareSecretKeyOverride}:t.cloudflareKeys}async initClockDrift(e){await this.allowedToFail.doOne((async()=>{const{drift:t}=await this.clockDriftStore.getState();null===t&&await(0,i.z)(e.refreshClockDrift().pipe((0,a.V)({first:5e3})))}))}};function G(){return{token:k,asyncFactory:async(e,t,r,s,i,a,o,n)=>{const c=new k(e,t,r,s,i,a,o,n);return await c.init(),c},inject:[p.$y,n.e,h.t,N.q,U.Z,d.t,c.J,x.L]}}k=(0,s.__decorate)([(0,o.GS)(),(0,s.__metadata)("design:paramtypes",[p.$y,n.e,h.t,N.q,U.Z,d.t,c.J,x.L])],k)},63281:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(88802),i=r(57924),a=r(68259);let o=class{constructor(e){this.configuredServerSdk=e}get v1(){return this.configuredServerSdk.sdk.v1}};o=(0,s.__decorate)([(0,i.GS)(),(0,s.__metadata)("design:paramtypes",[a.E])],o)},87113:(e,t,r)=>{r.d(t,{l:()=>d});var s=r(88802),i=r(34987),a=r(57924),o=r(64839),n=r(62694),c=r(68259),l=r(21534);let d=class{constructor(e,t){this.appliedV1Services=this.buildInjectedServices("v1",e.sdk),this.credentialsService=t,this._baseUrl=e.url}get baseUrl(){return this._baseUrl}get v1(){return this.appliedV1Services}buildInjectedServices(e,t){return Object.keys(t[e]).reduce(((r,s)=>({...r,[s]:this.buildInjectedApiServices(e,t,s)})),{})}buildInjectedApiServices(e,t,r){return Object.getOwnPropertyNames(Object.getPrototypeOf(t.v1[r])).filter((e=>"constructor"!==e)).reduce(((s,i)=>({...s,[i]:this.buildInjectedRouteService(t,e,r,i)})),{})}buildInjectedRouteService(e,t,r,s){const a=n.t[r][s];if(!a)throw new Error("Unable to find endpoint descriptor");const{authType:c}=a;return(...a)=>{const n=e[t][r],l=n[s].bind(n);if(c===o.d.USER_DEVICE)return this.credentialsService.getActiveUserDeviceCredentials().pipe((0,i.b)((e=>l(e,...a))));if([o.d.NONE,o.d.APP].includes(c))return l(...a);throw new Error("Not supported")}}};d=(0,s.__decorate)([(0,a.GS)(),(0,s.__metadata)("design:paramtypes",[c.E,l.n])],d)},21534:(e,t,r)=>{r.d(t,{n:()=>u});var s=r(88802),i=r(87065),a=r(34987),o=r(87279),n=r(57924),c=r(94189),l=r(18590),d=r(8987);let u=class{constructor(e,t){this.cqrsClient=e,this.infra=t}getActiveUserDeviceCredentials(){const{queries:{activeUser:e}}=this.cqrsClient.getClient(d.t$);return e().pipe((0,i.U)((e=>{if((0,o.d6)(e))return(0,o.db)(e);throw new Error("Failed to get active user")})),(0,a.b)((({userName:e})=>{if(!e)throw new Error("No active user available");return this.infra.getDeviceCredentialsForUser(e)})))}};u=(0,s.__decorate)([(0,n.GS)(),(0,s.__metadata)("design:paramtypes",[c.w,l.se])],u)},18590:(e,t,r)=>{r.d(t,{$y:()=>s,se:()=>i});class s{constructor(e){this.baseUrl=e.baseUrl,this.appKeys=e.appKeys,this.cloudflareKeys=e.cloudflareKeys}}class i{}new class extends i{getDeviceCredentialsForUser(e){return Promise.resolve({deviceAccessKey:"",deviceSecretKey:"",login:e})}}},93850:(e,t,r)=>{r.d(t,{n:()=>b});var s=r(88802),i=r(99634),a=r(25504),o=r(97191),n=r(43673),c=r(87113),l=r(63281),d=r(18590),u=r(71993),p=r(21534),h=r(68259),m=r(37935),g=r(86758),v=r(87279),y=r(63663);let _=class{constructor(e){this.store=e}async execute(e){const t=await this.store.getState();return await this.store.set({...t,...e.body}),(0,v.Vp)(void 0)}};_=(0,s.__decorate)([(0,y.W)(o.bH),(0,s.__metadata)("design:paramtypes",[g.L])],_);var f=r(87065),S=r(20754);let E=class{constructor(e){this.store=e}execute(){return this.store.state$.pipe((0,f.U)((e=>(0,v.Vp)(e))))}};E=(0,s.__decorate)([(0,S.e)(o.Lt),(0,s.__metadata)("design:paramtypes",[g.L])],E);let b=class{};b=(0,s.__decorate)([(0,i.Y)({api:o.Dm,handlers:{commands:{editSettingsForStaging:_},queries:{settingsForStaging:E},events:{}},providers:[l.B,c.l,p.n,(0,h.F)()],exports:[l.B,c.l],configurations:{serverApi:{token:d.$y},serverApiInfrastructure:{token:d.se}},stores:[u.t,g.L],imports:[m.D,a.X,n.i]})],b)},86758:(e,t,r)=>{r.d(t,{L:()=>c});var s=r(10722),i=r(25029),a=r(95681),o=r(23347);const n={api:{override:!1},nitro:{override:!1}};class c extends((0,a.Q)({storeTypeGuard:e=>!0,storeName:"webServicesSettingsForStaging",storage:{initialValue:n,schemaVersion:1,typeGuard:e=>!0},scope:i.F.Device,persist:!0,isCache:!1,capacity:o.Y._001KB,codec:s.E})){}},10370:(e,t,r)=>{r.d(t,{s:()=>a});var s=r(46041);function i(e){const t=e.length,r=[];for(let i=0;i<t;i+=3)r.push(s.T[e[i]>>2]),r.push(s.T[(3&e[i])<<4|e[i+1]>>4]),r.push(s.T[(15&e[i+1])<<2|e[i+2]>>6]),r.push(s.T[63&e[i+2]]);return r.join("")}function a(e,t=s.V){const r=new Uint8Array(e),a=r.length,o=t%3,n=0===o?t:t+(3-o),c=Math.ceil(a/n);let l="",d=-1;for(;d++<c;){const e=d*n,t=d===c-1?a:(d+1)*n,s=i(r.slice(e,t));l=l.concat(s)}return a%3==2?l.substring(0,l.length-1)+"=":a%3==1?l.substring(0,l.length-2)+"==":l}},89685:(e,t,r)=>{r.d(t,{v:()=>i});const s=Math.pow(2,14)-1;function i(e){const t=new Uint8Array(e),r=t.length;let i="",a=s;for(let e=0;e<r;e+=a){e+a>r&&(a=r-e);const s=t.subarray(e,e+a);i+=String.fromCharCode(...s)}return i}},68376:(e,t,r)=>{r.d(t,{L:()=>i});var s=r(46803);function i(e){const t=new Uint8Array(e),r=[];for(let e=0;e<t.byteLength;e++)r[e>>>2]|=t[e]<<24-e%4*8;return s.lib.WordArray.create(r,t.byteLength)}},66122:(e,t,r)=>{r.d(t,{R:()=>a});var s=r(46041);const i=new Uint8Array(256);for(let e=0;e<s.T.length;e++)i[s.T.charCodeAt(e)]=e;function a(e){let t=.75*e.length;const r=e.length;let s,a,o,n,c,l=0;e.endsWith("=")&&(t--,"="===e[e.length-2]&&t--);const d=new ArrayBuffer(t),u=new Uint8Array(d);for(s=0;s<r;s+=4)a=i[e.charCodeAt(s)],o=i[e.charCodeAt(s+1)],n=i[e.charCodeAt(s+2)],c=i[e.charCodeAt(s+3)],u[l++]=a<<2|o>>4,u[l++]=(15&o)<<4|n>>2,u[l++]=(3&n)<<6|63&c;return d}},96303:(e,t,r)=>{function s(e){return Array.prototype.map.call(new Uint8Array(e),(e=>("00"+e.toString(16)).slice(-2))).join("")}r.d(t,{k:()=>s})},21131:(e,t,r)=>{r.d(t,{n:()=>o});var s=r(93347),i=r.n(s),a=r(82933);function o(e){const t=new Uint8Array([0,0,0,0]).buffer,r=new Uint8Array(e),s=i().deflate(r,{level:7}).buffer;return(0,a.K)(t,s)}},82933:(e,t,r)=>{function s(...e){const t=e.reduce(((e,t)=>e+t.byteLength),0),r=new Uint8Array(t);return e.reduce(((e,t)=>(r.set(new Uint8Array(t),e),e+t.byteLength)),0),r.buffer}r.d(t,{K:()=>s})},46041:(e,t,r)=>{r.d(t,{T:()=>i,V:()=>s});const s=Math.pow(10,6),i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"},58859:(e,t,r)=>{function s(e){return e.replace(/(?:\\[r]|[\r\n]+)+/g,"\n")}r.d(t,{Y:()=>s})},83168:(e,t,r)=>{r.d(t,{B:()=>o});var s=r(3417),i=r.n(s),a=r(54066);function o(e){const{asn1:t,pki:r}=i(),s=r.privateKeyFromPem(e),o=r.privateKeyToAsn1(s),n=r.wrapRsaPrivateKey(o),c=t.toDer(n).getBytes();return(0,a.u)(c)}},86286:(e,t,r)=>{r.d(t,{R:()=>o});var s=r(3417),i=r.n(s),a=r(58859);function o(e){const{asn1:t,pki:r,util:s}=i(),o=s.createBuffer(e),n=t.fromDer(o),c=r.privateKeyFromAsn1(n),l=r.privateKeyToPem(c);return(0,a.Y)(l)}},9034:(e,t,r)=>{r.d(t,{y:()=>o});var s=r(3417),i=r.n(s),a=r(58859);function o(e){const{asn1:t,pki:r,util:s}=i(),o=s.createBuffer(e),n=t.fromDer(o),c=r.publicKeyFromAsn1(n),l=r.publicKeyToRSAPublicKeyPem(c);return(0,a.Y)(l)}},54066:(e,t,r)=>{function s(e){const t=new ArrayBuffer(e.length),r=new Uint8Array(t);for(let t=0;t<e.length;++t)r[t]=e.charCodeAt(t);return t}r.d(t,{u:()=>s})},43293:(e,t,r)=>{r.d(t,{N:()=>a});var s=r(30543),i=r(46041);function a(e,t=i.V){const r=e.length;if(0===r)return"";let a="",o=0,n=Math.min(o+t,r);for(;n<=r;){const i=e.charCodeAt(n-1);if(i>=55296&&i<=56319){if(n++,n>r)throw new Error("Invalid string provided to utf8ChunkEncode");continue}const c=e.slice(o,n),l=s.encode(c);if(a=a.concat(l),n===r)break;o=n,n=Math.min(o+t,r)}return a}},69806:(e,t,r)=>{function s(e){const{sigBytes:t,words:r}=e,s=new Uint8Array(t);let i=0,a=0;for(;i!==t;){const e=r[a++];if(s[i++]=(4278190080&e)>>>24,i===t)break;if(s[i++]=(16711680&e)>>>16,i===t)break;if(s[i++]=(65280&e)>>>8,i===t)break;s[i++]=255&e}return s.buffer}r.d(t,{o:()=>s})},84473:(e,t,r)=>{r.d(t,{W:()=>a});var s=r(75994),i=r(92204);class a extends s.X{async fetch(e){const t=(0,i.A)(e);return(await fetch(t)).json()}}},37298:(e,t,r)=>{r.d(t,{j:()=>i});var s=r(58376);class i{constructor(e,t){this.source=e,this.filter=t;let r=[];const i=new Set;this.listener=(e,t)=>{if(!this.filter(e,t))return!1;i.size?i.forEach((r=>r.next([e,t]))):r.push([e,t])},this.events$=new s.y((e=>(i.size||(r.forEach((t=>e.next(t))),r=[]),i.add(e),()=>{i.delete(e)}))),this.source.addListener(this.listener)}stop(){this.source.removeListener(this.listener)}}},28849:(e,t,r)=>{var s;r.d(t,{PortNames:()=>s}),function(e){e.PopupCarbon="Popup",e.PopupCarbonLoader="PopupCarbonLoader",e.OptionsCarbon="OptionsCarbon",e.WebappCarbon="leeloo"}(s||(s={}))},37572:(e,t,r)=>{r.d(t,{P:()=>a,y:()=>i});var s=r(30504);class i extends s.GenericChannel{constructor(){super(...arguments),this.isConnected=!1,this.onMessage=null}connect(e){this.onMessage=t=>{e.receive(t)},this.isConnected=!0,this._connected()}receive(e){this._messageReceived(e)}send(e){if(!this.isConnected)throw new Error("Channel not connected");if(!this.onMessage)throw new Error("onMessage handler not set");this.onMessage(e)}}const a=(e,t)=>{e.connect(t),t.connect(e)}},79952:(e,t,r)=>{r.d(t,{Y:()=>o});var s=r(30504),i=r(37101),a=r(20500);class o extends s.GenericChannel{constructor(e,t=5e3){super(t),this.onConnectListener=e=>{if(e.name.startsWith(this.name)){if(this.currentPorts.has(e.name))throw new Error("Port already connected");if(!(0,i.k)(e))throw new Error("Sender origin not trusted");this.setup(e)}},this.onDisconnectListener=e=>{const t=this.currentPorts.get(e.name);if(t&&(t.onMessage.removeListener(this.onMessageListener),t.onDisconnect.removeListener(this.onDisconnectListener),this.currentPorts.delete(e.name)),this._disconnected(),chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(e)}},this.onMessageListener=e=>{this._messageReceived(e)},this.name=e,this.currentPorts=new Map}listen(){a.b.addListener(this.onConnectListener)}send(e){if(!this.currentPorts.size)throw new Error("No port to send message");this.currentPorts.forEach((t=>t.postMessage(e)))}setup(e){const t=this.currentPorts.get(e.name);t&&(t.disconnect(),this.onDisconnectListener(t)),e.onMessage.addListener(this.onMessageListener),e.onDisconnect.addListener(this.onDisconnectListener),this.currentPorts.set(e.name,e),this._connected()}}},4792:(e,t,r)=>{r.d(t,{s:()=>o});var s=r(30504),i=r(37101),a=r(20500);class o extends s.GenericChannel{constructor(e,t=5e3){super(t),this.onConnectListener=e=>{if(e.name===this.name){if(!(0,i.k)(e))throw new Error("Sender origin not trusted");this.setup(e)}},this.onDisconnectListener=()=>{if(this.port&&(this.port.onMessage.removeListener(this.onMessageListener),this.port.onDisconnect.removeListener(this.onDisconnectListener),this.port=void 0),this._disconnected(),chrome.runtime.lastError){const e=chrome.runtime.lastError.message??"Unknown chrome.runtime.lastError";throw new Error(e)}},this.onMessageListener=e=>{this._messageReceived(e)},this.name=e}listen(){this.port&&(this.port.disconnect(),this.onDisconnectListener()),a.b.addListener(this.onConnectListener)}send(e){if(!this.port)throw new Error("No port to send message");this.port.postMessage(e)}setup(e){this.port=e,this.port.onMessage.addListener(this.onMessageListener),this.port.onDisconnect.addListener(this.onDisconnectListener),this._connected()}}},37101:(e,t,r)=>{r.d(t,{k:()=>o});var s=r(92204),i=r(48593);function a(e){const t=function(e){return e.sender?.origin??new URL(e.sender?.url??e.sender?.tab?.url??"").origin}(e);return new URL((0,s.A)("")).origin===t}function o(e){return!!function(e){return(e.sender?.id??"")===(0,i.z)()}(e)||!!a(e)}},64391:(e,t,r)=>{r.d(t,{O:()=>c,x:()=>n});var s=r(5900),i=r.n(s),a=r(68376),o=r(69806);function n(e,t){if(self.crypto.subtle)return self.crypto.subtle.digest({name:t},e);if("SHA-1"===t){const t=(0,a.L)(e),r=(0,o.o)(i()(t));return Promise.resolve(r)}return Promise.reject(new Error("Unsupported hash method"))}function c(e,t){if("SHA-1"===t){const t=(0,a.L)(e);return(0,o.o)(i()(t))}throw new Error("Unsupported hash method")}},86381:(e,t,r)=>{r.d(t,{$:()=>a});var s=r(22609),i=r(83961);async function a(e,t,r){const a=await(0,i.Y)(e);return self.crypto.subtle.decrypt({name:s.z,iv:t},a,r)}},39560:(e,t,r)=>{r.d(t,{G:()=>i});var s=r(83407);async function i(e,t,r){const i={name:s.$,hash:{name:r}},a=await self.crypto.subtle.importKey("pkcs8",e,i,!1,["decrypt"]);return self.crypto.subtle.decrypt(i,a,t)}},76254:(e,t,r)=>{r.d(t,{f:()=>a});var s=r(35558),i=r.n(s);async function a(e,t,r){const{tCost:a,mCost:o,parallelism:n}=r,{hash:c}=await i().hash({pass:new Uint8Array(e),salt:new Uint8Array(t),time:a,mem:o,hashLen:32,parallelism:n,type:s.ArgonType.Argon2d});return c.buffer}},80954:(e,t,r)=>{r.d(t,{x:()=>i});var s=r(22609);async function i(e,t,r){const i=await self.crypto.subtle.importKey("raw",e,"PBKDF2",!1,["deriveKey"]),a={name:s.z,length:256},{iterations:o,hashType:n}=r,c={name:"PBKDF2",salt:t,iterations:o,hash:{name:n}},l=await self.crypto.subtle.deriveKey(c,i,a,!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",l)}},48264:(e,t,r)=>{r.d(t,{P:()=>a});var s=r(22609),i=r(83961);async function a(e,t,r){const a=await(0,i.Y)(e);return self.crypto.subtle.encrypt({name:s.z,iv:t},a,r)}},64396:(e,t,r)=>{r.d(t,{b:()=>i});var s=r(83407);async function i(e,t,r){const i={name:s.$,hash:{name:r}},a=await self.crypto.subtle.importKey("spki",e,i,!1,["encrypt"]);return self.crypto.subtle.encrypt(i,a,t)}},420:(e,t,r)=>{r.d(t,{o:()=>i});var s=r(22609);async function i(){const e=await self.crypto.subtle.generateKey({name:s.z,length:s.N},!0,["encrypt","decrypt"]);return self.crypto.subtle.exportKey("raw",e)}},26857:(e,t,r)=>{r.d(t,{Y:()=>a});var s=r(83407);const i=new Uint8Array([1,0,1]);async function a(e){const t=await self.crypto.subtle.generateKey({name:s.$,modulusLength:2048,publicExponent:i,hash:{name:e}},!0,["encrypt","decrypt"]),{privateKey:r,publicKey:a}=t;return{privateKey:await self.crypto.subtle.exportKey("pkcs8",r),publicKey:await self.crypto.subtle.exportKey("spki",a)}}},39911:(e,t,r)=>{function s(e){const t=new Uint8Array(e);return self.crypto.getRandomValues(t)}r.d(t,{P:()=>s})},83961:(e,t,r)=>{r.d(t,{Y:()=>i});var s=r(22609);function i(e){return self.crypto.subtle.importKey("raw",e,s.z,!1,["encrypt","decrypt"])}},48297:(e,t,r)=>{function s(e,t){return self.crypto.subtle.importKey("raw",e,{name:"HMAC",hash:{name:t}},!0,["sign","verify"])}r.d(t,{r:()=>s})},43838:(e,t,r)=>{r.d(t,{n:()=>a});var s=r(74017),i=r(48297);async function a(e,t,r=s.x){const a=await(0,i.r)(e,r);return self.crypto.subtle.sign({name:"HMAC",hash:{name:r}},a,t)}},39387:(e,t,r)=>{r.d(t,{f:()=>i});var s=r(83407);async function i(e,t,r){const i={name:s.x,hash:{name:r}},a=await self.crypto.subtle.importKey("pkcs8",e,i,!1,["sign"]);return self.crypto.subtle.sign(i,a,t)}},396:(e,t,r)=>{r.d(t,{H:()=>n});var s=r(90278),i=r.n(s),a=r(68376),o=r(69806);function n(e){const t=(0,a.L)(e);return(0,o.o)(i()(t))}},57487:(e,t,r)=>{r.d(t,{o:()=>a});var s=r(74017),i=r(48297);async function a(e,t,r,a=s.x){const o=await(0,i.r)(e,a);return self.crypto.subtle.verify({name:"HMAC",hash:{name:a}},o,t,r)}},8434:(e,t,r)=>{r.d(t,{Y:()=>i});var s=r(84318);function i(){return"undefined"!=typeof chrome&&void 0!==chrome.runtime&&void 0!==chrome.runtime.getManifest&&3===(0,s.W)().manifest_version}},83074:(e,t,r)=>{r.d(t,{A:()=>m});var s=r(87065),i=r(93192),a=r(90171),o=r(47968),n=r(37182),c=r(69885),l=r(51992),d=r(73155),u=r(12964),p=r(85260),h=r(87279);class m{constructor(){this.toHttpResult=e=>e instanceof d.a?(0,h.Rn)(e):e.ok?(0,h.Vp)(e):(0,h.Rn)(new d.R(e)),this.toHttpResponse=e=>e instanceof d.a?e:new u.Z({body:e.body,url:e.url,status:e.status,statusText:e.statusText,headers:this.mapToHttpHeaders(e.headers)})}handle(e){const t=this.getTimeout$(e.timeout),r=this.doFetch(e).pipe((0,s.U)(this.toHttpResponse),(0,s.U)(this.toHttpResult));return(0,i.S)(t,r)}getTimeout$(e){return e?(0,a.H)(e).pipe((0,s.U)((()=>(0,h.Rn)(new d.a)))):o.C}doFetch(e){return(0,l.U)(e.url,{method:e.method,body:e.serializeBody(),headers:this.getHeaders(e),credentials:e.withCredentials?"include":"omit",mode:e.mode}).pipe((0,n.K)((e=>{if(!(e instanceof TypeError))throw e;return(0,c.of)(new d.a)})))}mapToHttpHeaders(e){const t=new p.W;return e.forEach(((e,r)=>t.set(r,e))),t}getHeaders(e){return e.headers.keys().reduce(((t,r)=>({...t,[r]:e.headers.get(r)})),{})}}},26233:(e,t,r)=>{r.r(t),r.d(t,{BrowserCronSource:()=>ve,BrowserPortConnector:()=>Oe,BrowserPortListener:()=>Ae.P,BrowserPortListenerChannel:()=>Ue,BufferedEventStream:()=>o.j,ExtensionCronSource:()=>ye.y,ExtensionLocalStorageInfrastructure:()=>ce.e,HttpFetchBackend:()=>F.A,IndexDbKeyValueStorage:()=>he,IndexDbStorage:()=>pe,JsonExtensionResourceFetcher:()=>a.W,JsonWebAppResourceFetcher:()=>i,LocalChannel:()=>c.y,MV3ServiceWorkerExtender:()=>Fe.D,PageToWorkerChannel:()=>we,PortNames:()=>n.PortNames,RuntimeConnectSingle:()=>h,RuntimeOnConnectMultiple:()=>l.Y,RuntimeOnConnectSingle:()=>d.s,computeHash:()=>m.x,computeHashSynchronous:()=>m.O,connectLocalChannels:()=>c.P,cookieRemoveByDomain:()=>B.$,decryptAes256:()=>g.$,decryptAesEcb256:()=>f,decryptRsaOaep:()=>S.G,deriveKeyArgon2d:()=>E.f,deriveKeyPbkdf2:()=>b.x,disableBrowserNativeAutofill:()=>V.D,enablePrivacyService:()=>K.I,encryptAes256:()=>w.P,encryptRsaOaep:()=>A.b,generateKeyAes256:()=>C.o,generateKeyPairRsaOaep:()=>I.Y,getLanguage:()=>G,getRandomValues:()=>T.P,getShortcutValues:()=>ee,isMv3Environment:()=>_e.Y,makeStoreInfrastructure:()=>ne.e,signHmacSha:()=>P.n,signRsassaPkcs1:()=>O.f,storageLocalItemExists:()=>te.j,unsafeComputeMd5Hash:()=>R.H,updateToolbarIcon:()=>j.F,verifyHmacSha:()=>D.o,verifyRsassaPkcs1:()=>U,webappClose:()=>oe,webappOpen:()=>re.b});var s=r(75994);class i extends s.X{constructor(e){super(),this.publicPath=e}async fetch(e){return(await fetch(new URL(e.replace(/^\/*/,""),this.publicPath).href)).json()}}var a=r(84473),o=r(37298),n=r(28849),c=r(37572),l=r(79952),d=r(4792),u=r(5441),p=r(30504);class h extends p.GenericChannel{constructor(e){super(),this.onMessageListener=e=>{this._messageReceived(e)},this.onDisconnectListener=()=>{this.port&&(this.port.onMessage.removeListener(this.onMessageListener),this.port.onDisconnect.removeListener(this.onDisconnectListener),this.port=void 0),this._disconnected()},this.name=e}connect(){self.chrome&&this.setup(this.name)}autoReconnect(){this.connect()}send(e){if(!this.port)throw new Error("No port to send message");this.port.postMessage(e)}setup(e){this.port&&this.onDisconnectListener(),this.port=(0,u.$)({name:e}),this.port.onMessage.addListener(this.onMessageListener),this.port.onDisconnect.addListener(this.onDisconnectListener),this._connected()}}var m=r(64391),g=r(86381),v=r(89685),y=r(68376),_=r(69806);function f(e,t){const r=(0,v.v)(t),s=(0,y.L)(e);return(0,_.o)(CryptoJS.AES.decrypt(r,s,{mode:CryptoJS.mode.ECB}))}var S=r(39560),E=r(76254),b=r(80954),w=r(48264),A=r(64396),C=r(420),I=r(26857),T=r(39911),P=r(43838),O=r(39387),R=r(396),D=r(57487),N=r(83407);async function U(e,t,r,s){const i={name:N.x,hash:{name:s}},a=await self.crypto.subtle.importKey("spki",e,i,!1,["verify"]);return self.crypto.subtle.verify(i,a,t,r)}var F=r(83074);const M=new Set(["en","fr","es","ja","de","pt","it","ko","zh","nl","sv"]),L="en";function x(e){return e.substr(0,2)}function k(e){const t=x(e);return M.has(t)}function G(){const e=[navigator.language].concat(navigator.languages).find(k);if(!e)return L;if(!e.includes("-"))return e;return x(e)}var V=r(4086),K=r(1979),j=r(26662),B=r(15348),W=r(28509),z=r(90123);const H=/^_execute(_browser){0,1}_action$/,Q="+";var q;function Y(e){return H.test(e.name??"")}function $(e){const t=e.toUpperCase();switch(t){case"⌃":case"CTRL":return W.isMacOS()?q.Command:q.Ctrl;case"SHIFT":case"⇧":return q.Shift;case"COMMAND":case"⌘":return q.Command;case"MACCTRL":return q.MacCtrl;default:return t}}function X(e){const t=Object.values(q),r=t.indexOf(e);return-1===r?t.length:r}function Z(e,t){return X(e)-X(t)}function J(e){switch(e){case q.Ctrl:case q.MacCtrl:return"Ctrl";case q.Shift:return"⇧";case q.Command:return"⌘";default:return e}}async function ee(){const e=await(0,z.g)(),t=e.find(Y)?.shortcut;if(!t)return;const r=function(e){return e.split(e.includes(Q)?Q:"")}(t);return r.map($).sort(Z).map(J)}!function(e){e.Command="Command",e.Ctrl="Ctrl",e.MacCtrl="MacCtrl",e.Shift="Shift"}(q||(q={}));var te=r(65124),re=r(93281),se=r(15904),ie=r(49259),ae=r(33871);async function oe(){const e=await(0,ae.c)();if(!e.length)return;const t=(0,se.a)(),r=e.map((e=>e.id)).filter((e=>"number"==typeof e&&e!==t));await(0,ie.O)(r)}var ne=r(10026),ce=r(62853),le=r(96168),de=r(87279);class ue extends((0,le.Hu)("NotSupported","Index DB is not supported in this environment")){}class pe{constructor(e,t,r){this.DB_STORE_NAME=e,this.DB_VERSION=t,this.DB_OBJECT_STORE_NAME=r}getIndexedDB(){return new Promise(((e,t)=>{const r=self.indexedDB;if(!r)return t(new Error("indexedDB is not supported in this environment"));const s=r.open(this.DB_STORE_NAME,this.DB_VERSION);s.onerror=function(){"InvalidStateError"===s.error?.name&&e((0,de.Rn)(new ue)),t(s.error)},s.onupgradeneeded=()=>{s.result.objectStoreNames.contains(this.DB_OBJECT_STORE_NAME)||s.result.createObjectStore(this.DB_OBJECT_STORE_NAME)},s.onsuccess=function(){s.onsuccess=null,e((0,de.Vp)(s.result))}}))}async isSupported(){return(0,de.d6)(await this.getIndexedDB())}async getStore(e="readwrite"){const t=await this.getIndexedDB();if(!(0,de.d6)(t))throw new Error("Failed to get db");return t.data.transaction([this.DB_OBJECT_STORE_NAME],e).objectStore(this.DB_OBJECT_STORE_NAME)}async readItem(e){const t=await this.getStore("readonly");return new Promise((r=>{const s=t.get(e);s.onsuccess=()=>{s.onsuccess=null,r(s.result)}}))}async getAllKeys(){const e=await this.getStore("readonly");return new Promise((t=>{const r=e.getAllKeys();r.onsuccess=()=>{t(r.result.map((e=>String(e))))}}))}async removeItem(e){const t=await this.getStore("readwrite");return new Promise((r=>{const s=t.delete(e);s.onsuccess=()=>{s.onsuccess=null,r()}}))}async writeItem(e,t){const r=await this.getStore("readwrite");return new Promise((s=>{const i=r.put(t,e);i.onsuccess=()=>{i.onsuccess=null,s()}}))}async itemExists(e){const t=await this.readItem(e);return null!=t}}class he{constructor(){this.storageLayer=new pe("dashlane-ng",1,"module-data")}isSupported(){return this.storageLayer.isSupported()}getAllKeys(){return this.storageLayer.getAllKeys()}async set(e,t){return await this.storageLayer.writeItem(e,t)}remove(e){return this.storageLayer.removeItem(e)}async get(e){return await this.storageLayer.readItem(e)??void 0}}var me=r(69594),ge=r(58376);class ve extends me.R_{constructor(){super(...arguments),this.alarm$=new ge.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}))}}var ye=r(3460),_e=r(8434),fe=r(15572),Se=r(45244),Ee=r(69885),be=r(7074);class we{constructor(e,t){this.worker=e,this.channelName=t,this.status$=(0,Ee.of)(fe.D.Connected),this.messages$=new ge.y((t=>{const r=e=>{(0,Se.F)(e.data)&&!e.origin&&t.next(e.data.message)};return e.addEventListener("message",r),()=>{e.removeEventListener("message",r)}})).pipe((0,be.B)())}async sendMessage(e){this.worker.postMessage((0,Se.k)({channelName:this.channelName,message:e}))}stop(){return Promise.resolve()}}var Ae=r(66917),Ce=r(24966),Ie=r(97280),Te=r(6220),Pe=r(60399);class Oe{constructor(e){this.status$=new Ce.X(fe.D.Connected),this.port$=new ge.y((t=>{let r;const s=this.status$;function i(){r?.onDisconnect.removeListener(i);const a=(0,u.$)({name:e});s.next(fe.D.Disconnected),a.onDisconnect.addListener(i),t.next(a),s.next(fe.D.Connected),r=a}return i(),()=>{r?.onDisconnect.removeListener(i),r?.disconnect()}})).pipe((0,Ie.d)(1)),this.portSubscription=this.port$.subscribe(),this.messages$=this.port$.pipe((0,Te.z)((t=>new ge.y((r=>{const s=t=>{(0,Se.F)(t)&&t.channelName===e&&r.next(t.message)};return t.onMessage.addListener(s),()=>{t.onMessage.removeListener(s)}})))))}async sendMessage(e){const t=await(0,Pe.z)(this.port$);t.postMessage((0,Se.k)({channelName:t.name,message:e}))}stop(){return this.portSubscription.unsubscribe(),this.status$.next(fe.D.Disconnected),Promise.resolve()}}var Re=r(87065),De=r(43978),Ne=r(17350);class Ue{constructor(e){this.listener=new Ae.P(e),this.channel$=this.listener.connectedChannels$.pipe((0,Re.U)((e=>{const t=Object.values(e);if(t.length)return t[0]})),(0,Ie.d)(1)),this.receivedMessages$=this.channel$.pipe((0,De.w)((e=>e?e.receivedMessages$:Ne.E))),this.channelState$=this.channel$.pipe((0,Re.U)((e=>e?fe.D.Connected:fe.D.Disconnected)))}async send(e){const t=await(0,Pe.z)(this.channel$);if(!t)throw new Error("Channel is not connected");await t.send(e)}stop(){this.listener.stop()}}var Fe=r(40532)},40532:(e,t,r)=>{r.d(t,{D:()=>a});var s=r(9244),i=r(95237);class a extends i.g{extendServiceWorkerLifetime(){(0,s.t)({"last-heartbeat":(new Date).getTime()})}}},4086:(e,t,r)=>{r.d(t,{D:()=>i});var s=r(1979);async function i(){const e=["autofillAddressEnabled","autofillCreditCardEnabled","passwordSavingEnabled"].map((e=>(0,s.I)(e,!1)));await Promise.allSettled(e)}},1979:(e,t,r)=>{r.d(t,{I:()=>n});var s=r(30754),i=r(82324),a=r(81805);const o=" ";async function n(e,t){try{const{levelOfControl:t}=await(0,s.U)(e);if("controllable_by_this_extension"!==t&&"controlled_by_this_extension"!==t){const r=[`Impossible to change browser setting: ${e}.`,`Extension prevented from changing: ${t}`].join(o);throw new Error(r)}}catch(t){if((0,i.b)(t)){throw new Error(`Browser setting not supported: ${e}`)}if((0,i.I)(t))throw t.runtimeError;throw t}try{await(0,a.t)(e,t)}catch(e){throw(0,i.I)(e)?e.runtimeError:e}}},26662:(e,t,r)=>{r.d(t,{F:()=>n});var s=r(84318),i=r(16241);const a={beta:"icon_beta_auth",mv2:"icon_auth",nightly:"icon_nightly_auth"},o="icon_not_auth";async function n({isUserAuthenticated:e}){const t=`icons/action/${e?function(){const e=(0,s.W)();return e.name.includes("Nightly")?a.nightly:e.name.includes("Beta")?a.beta:a.mv2}():o}`,r={16:`${t}.png`,32:`${t}@2x.png`};await(0,i.B)(r)}},15348:(e,t,r)=>{r.d(t,{$:()=>o});var s=r(329),i=r(98641);function a(e){return`${"http"+(e.secure?"s":"")}://${e.domain.startsWith(".")?e.domain.substring(1):e.domain}${e.path}`}async function o(e){const t=await(0,s.g)({domain:e});return Promise.all(t.map((e=>(0,i.O)({url:a(e),name:e.name}))))}},65124:(e,t,r)=>{r.d(t,{j:()=>a});var s=r(39680),i=r(41808);async function a(e){if((0,s.G)()){return await(0,s.y)(e)>0}const t=await(0,i.U)(e),r=void 0===t[e],a=null===t[e];return!r&&!a}},33871:(e,t,r)=>{r.d(t,{c:()=>a});var s=r(61222),i=r(92204);async function a(){const e=await(0,s.I)({}),t=(0,i.A)("");return e.filter((e=>"string"==typeof e.url&&e.url.startsWith(t))).filter((e=>""!==e.url))}},93281:(e,t,r)=>{r.d(t,{b:()=>p});var s=r(92204),i=r(24715),a=r(72733),o=r(57306),n=r(31460),c=r(33871);const l="index.html";function d(){return`${(0,s.A)("")}${l}`}function u({identifier:e,queryInfo:t,name:r}){const s=d();if(!r)return s;const i=e?`#${r}/${e}`:`#${r}`,a=t?`?${function(e){return Object.keys(e).map((t=>`${t}=${e[t]}`)).join("&")}(t)}`:"";return encodeURI(`${s}${i}${a}`)}async function p({id:e,query:t,route:r}){const s=u({identifier:e,queryInfo:t,name:r}),l=await(0,c.c)();l.length?await async function({path:e,tabs:t}){const r=await(0,a.T)(),s=function({existingTabs:e,focusedWindow:t}){const r=e.filter((e=>e.active)),s=r.find((e=>e.windowId===t.id)),i=r.pop(),a=e.pop();return s??i??a}({existingTabs:t,focusedWindow:r});if(!s)return;if(s.windowId!==r.id&&(0,o.V)(s.windowId,{focused:!0}),!s.id)return;const i={active:!0,...e===d()?{}:{url:e}};await(0,n.V)(s.id,i)}({path:s,tabs:l}):await async function(e){const t={url:e};await(0,i.U)(t)}(s)}},10026:(e,t,r)=>{r.d(t,{e:()=>f});var s=r(83081),i=r(32012),a=r(58376),o=r(7074),n=r(24966),c=r(85390),l=r(15023),d=r(87065),u=r(26603),p=r(56847),h=r(52477),m=r(15026);function g(e){return JSON.parse(JSON.stringify(e))}class v{constructor(){this.events$=new a.y((e=>{const t=t=>{e.next(t)};return u.r.addListener(t),()=>u.r.removeListener(t)})).pipe((0,o.B)())}}class y{constructor(e,t,r){this.stopped$=new n.X(!1),this.key=t,this.typeGuard=r??(e=>!0);const s=new a.y((r=>{this.getState().then((e=>{r.next(e)}));const s=e.events$.subscribe((e=>{if(t in e){const{newValue:s}=e[t];return r.next(this.asDataWithTimestamp(s))}}));return()=>s.unsubscribe()}));this.state$=(0,c.a)({state:s,isStopped:this.stopped$}).pipe((0,l.o)((({isStopped:e})=>!e),!1),(0,d.U)((({state:e})=>e)))}async update(e){return this.set(e(await this.getState()))}persist(){return Promise.resolve()}load(){return Promise.resolve()}set(e){return(0,p.t)(g({[this.key]:e}))}init(e){return(0,p.t)(g({[this.key]:e}))}clear(){return(0,h.O)(this.key)}clearStorage(){return Promise.resolve()}stop(){this.stopped$.next(!0)}getLimit(){return Promise.resolve(9e6)}async getState(){const e=(await(0,m.U)(this.key))[this.key];return this.asDataWithTimestamp(e)}asDataWithTimestamp(e){return e&&"object"==typeof e&&"timestamp"in e&&"number"==typeof e.timestamp&&e.timestamp&&"data"in e&&this.typeGuard(e.data)?{timestamp:e.timestamp,data:e.data}:{timestamp:void 0}}}class _ extends s.G{constructor(){super(...arguments),this.source=new v}createUserScopedInfrastructure(e,t,r,s){const i=`graphene.${e}.${t}.${r}`;return new y(this.source,i,s)}createDeviceScopedInfrastructure(e,t,r){const s=`graphene.${e}.${t}`;return new y(this.source,s,r)}}function f(){return(0,i.G)()?new _:new s.N}},62853:(e,t,r)=>{r.d(t,{e:()=>o});var s=r(41808),i=r(9244),a=r(45441);class o{async getAllKeys(){return Object.keys(await(0,s.U)(null))}async get(e){const t=(await(0,s.U)([e]))[e];if(t){if("string"!=typeof t)throw new Error(`[ChromeLocalStorage] - cannot read content of ${e} properly. Type is\n        ${typeof t} but should be 'string'`);return t}}async set(e,t){await(0,i.t)({[e]:t})}async remove(e){await(0,a.O)([e])}}},3460:(e,t,r)=>{r.d(t,{y:()=>u});var s=r(69594),i=r(58376),a=r(97280),o=r(31034),n=r(18477),c=r(65496);const l="cron-source",d=()=>(0,c.G)()?new i.y((e=>{const t=t=>{t.name===l&&e.next()};return(0,o.U)(l,{delayInMinutes:1,periodInMinutes:1}),n.i.addListener(t),()=>{n.i.removeListener(t)}})):new i.y((e=>{const t=self.setInterval((()=>{e.next()}),6e4);return()=>{self.clearInterval(t)}}));class u extends s.R_{constructor(){super(...arguments),this.alarm$=d().pipe((0,a.d)(1)),this.subscription=this.alarm$.subscribe()}stop(){this.subscription.unsubscribe()}}},66917:(e,t,r)=>{r.d(t,{P:()=>p});var s=r(78776),i=r(24966),a=r(58376),o=r(87065),n=r(45244),c=r(15572),l=r(58649),d=r(20500),u=r(37298);class p{constructor(e){this.connectedChannels$=new i.X({});const t=new a.y((t=>{const r={},a=a=>{const d=(0,s.Z)();if(a.name!==e)return;const p=new u.j({addListener:e=>a.onMessage.addListener(e),removeListener:e=>a.onMessage.removeListener(e)},(t=>(0,n.F)(t)&&t.channelName===e)),h=new Promise((e=>{const t=()=>{a.onDisconnect.removeListener(t),e(null)};a.onDisconnect.addListener(t)})),m=new i.X(c.D.Connected);h.then((()=>{p.stop(),m.next(c.D.Disconnected),delete r[d],t.next(r)}));const g={messages$:p.events$.pipe((0,o.U)((([e])=>e.message))),sendMessage:t=>(a.postMessage((0,n.k)({channelName:e,message:t})),Promise.resolve()),stop:()=>(a.disconnect(),Promise.resolve()),status$:m},v=new l.N(g);r[d]=v,t.next(r)};return d.b.addListener(a),()=>{d.b.removeListener(a)}}));this.subscription=t.subscribe((e=>this.connectedChannels$.next(e)))}stop(){this.subscription.unsubscribe()}}},23711:(e,t,r)=>{r.d(t,{z:()=>a});var s=r(66122),i=r(10370);class a{decode(e){return(0,s.R)(e)}encode(e){return(0,i.s)(e)}}},49499:(e,t,r)=>{function s(...e){const t=[...e].reverse();return{decode:async t=>{for(const r of e)t=await r.decode(t);return t},encode:async e=>{for(const r of t)e=await r.encode(e);return e}}}r.d(t,{x:()=>s})},43702:(e,t,r)=>{r.d(t,{b:()=>s});class s{decode(e){return JSON.parse((new TextDecoder).decode(e))}encode(e){return(new TextEncoder).encode(JSON.stringify(e))}}},10722:(e,t,r)=>{r.d(t,{E:()=>i});const s=e=>e;class i{constructor(){this.encode=s,this.decode=s}}},16698:(e,t,r)=>{r.d(t,{BU:()=>a,No:()=>o,Nw:()=>s,gO:()=>i});const s={algorithm:"aes256",mode:"cbchmac",ivLength:16},i={algorithm:"aes256",mode:"cbchmac64",ivLength:16},a={algorithm:"aes256",mode:"cbchmac",ivLength:16,padding:16,bytesToKey:0,reuseSalt:!1},o={algorithm:"aes256",mode:"cbc",ivLength:16,saltLength:32,padding:0,bytesToKey:{algorithm:"sha1",iterations:3,keyLength:32}}},94805:(e,t,r)=>{r.d(t,{E1:()=>a,Yi:()=>n,b9:()=>c,m9:()=>l,mr:()=>i,oo:()=>o});var s=r(95087);const i={algorithm:"argon2d",saltLength:16,tCost:3,mCost:32768,parallelism:2},a={algorithm:"pbkdf2",saltLength:16,iterations:2e5,hashAlgorithm:"sha256"},o={algorithm:"noderivation"},n={algorithm:"pbkdf2",saltLength:32,iterations:10204,hashAlgorithm:"sha1"};function c(e){return["argon2d","pbkdf2","noderivation"].some((t=>t===e))}function l(e){switch(e.algorithm){case"argon2d":case"pbkdf2":return e.saltLength;case"noderivation":return 0;default:(0,s.U)(e)}}},69591:(e,t,r)=>{r.d(t,{F:()=>s,g:()=>i});const s="$",i=1},33055:(e,t,r)=>{r.d(t,{ARGON2D_MARKER_SCHEMA:()=>s,NODERIVATION_MARKER_SCHEMA:()=>a,PBKDF2_MARKER_SCHEMA:()=>i});const s={count:9,index:{version:0,derivation:1,saltLength:2,tCost:3,mCost:4,parallelism:5,cipher:6,mode:7,ivLength:8}},i={count:8,index:{version:0,derivation:1,saltLength:2,iterations:3,hashAlgorithm:4,cipher:5,mode:6,ivLength:7}},a={count:5,index:{version:0,derivation:1,cipher:2,mode:3,ivLength:4}}},38291:(e,t,r)=>{r.d(t,{PD:()=>s,RB:()=>o,en:()=>i,jK:()=>a});const s="KWC5",i=16,a=32,o=0},6752:(e,t,r)=>{r.d(t,{b:()=>a});var s=r(54066);var i=r(12087);function a(e,t,r,a,o,n){if(0===e.byteLength)throw new Error("Attempting to derivate a key from an empty input");return"pbkdf2"===o.algorithm?(0,i.E)(r,n,o,e,t):async function(e,t,r,i,a){const{tCost:o,mCost:n,parallelism:c}=r,l=(0,s.u)(Object.values(r).join("")),d=t.getCacheKey(i,a,l),u=t.getCachedDerivation(d);if(u)return u;const p={tCost:o,mCost:n,parallelism:c},h=await e(i,a,p);return t.setCachedDerivation({cacheKey:d,data:h}),h}(a,n,o,e,t)}},12087:(e,t,r)=>{r.d(t,{E:()=>a});var s=r(54066),i=r(95087);async function a(e,t,r,a,o){const n=(0,s.u)(Object.values(r).join("")),c=t.getCacheKey(a,o,n),l=t.getCachedDerivation(c);if(l)return l;const d=function(e){switch(e){case"sha1":return"SHA-1";case"sha256":return"SHA-256";case"sha384":return"SHA-384";case"sha512":return"SHA-512";default:(0,i.U)(e)}}(r.hashAlgorithm),u=await e(a,o,{iterations:r.iterations,hashType:d});return t.setCachedDerivation({cacheKey:c,data:u}),u}},60745:(e,t,r)=>{r.d(t,{F:()=>G,V:()=>k});var s=r(82933),i=r(89685),a=r(95087),o=r(94805);function n({transportableData:e,marker:t,metadata:r}){const s=t.length+r.length;return e.substring(s)}var c=r(54066);function l({encipheredContents:e,marker:t,metadata:r}){const{derivation:s,cipher:i,type:a,version:o}=t,{iv:n,salt:l,signature:d}=r;return{type:a,version:o,derivationConfig:s,cipherConfig:i,salt:(0,c.u)(l),signature:(0,c.u)(d),iv:(0,c.u)(n),encipheredContents:(0,c.u)(e)}}function d({str:e,substr:t,occurrence:r}){if(r<1)return-1;let s=0,i=-1;for(;s<r;){if(i=e.indexOf(t,i+1),i<0)return i;s++}return i}var u=r(69591);function p({transportableData:e,makeMarker:t,schema:r}){const s=r.count+1,i=d({str:e,substr:u.F,occurrence:s}),a=e.substring(1,i).split(u.F);if(a.length!==r.count)throw new Error("Marker and schema length mismatch");return t({bytes:i+1,markerSchema:r,values:a})}var h=r(7165);const m=h.z.object({algorithm:h.z.literal("aes256"),mode:h.z.literal("cbchmac"),ivLength:h.z.literal(16)}),g=h.z.object({algorithm:h.z.literal("aes256"),mode:h.z.literal("cbchmac64"),ivLength:h.z.literal(16)}),v=h.z.union([m,g]),y=h.z.object({algorithm:h.z.literal("argon2d"),saltLength:h.z.literal(16),tCost:h.z.number(),mCost:h.z.number(),parallelism:h.z.number()}),_=h.z.object({algorithm:h.z.literal("pbkdf2"),saltLength:h.z.union([h.z.literal(16),h.z.literal(32)]),iterations:h.z.number(),hashAlgorithm:h.z.enum(["sha1","sha256"])}),f=h.z.object({algorithm:h.z.literal("noderivation")}),S=h.z.literal("flexible"),E=h.z.object({version:h.z.literal(1),type:S,length:h.z.number(),derivation:y,cipher:m});function b({bytes:e,markerSchema:t,values:r}){const{version:s,derivation:i,saltLength:a,tCost:o,mCost:n,parallelism:c,cipher:l,mode:d,ivLength:u}=t.index,p=E.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:r[i],saltLength:Number(r[a]),tCost:Number(r[o]),mCost:Number(r[n]),parallelism:Number(r[c])},cipher:{algorithm:r[l],mode:r[d],ivLength:Number(r[u])}});if(!p.success)throw new Error(p.error.message);return p.data}var w=r(33055);const A=32;function C({transportableData:e,marker:t}){const{length:r,derivation:s,cipher:i}=t,a=s.saltLength,{ivLength:o}=i,n=r+0,c=n+a,l=c+o;return{iv:e.substring(c,c+o),length:a+o+A,salt:e.substring(n,n+a),signature:e.substring(l,l+A)}}const I=h.z.object({version:h.z.literal(1),type:S,length:h.z.number(),derivation:f,cipher:v});function T({bytes:e,markerSchema:t,values:r}){const{version:s,cipher:i,mode:a,ivLength:o}=t.index,n=I.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:"noderivation"},cipher:{algorithm:r[i],mode:r[a],ivLength:Number(r[o])}});if(!n.success)throw new Error(n.error.message);return n.data}function P(){return e=>{const t=p({transportableData:e,makeMarker:T,schema:w.NODERIVATION_MARKER_SCHEMA}),r=function({transportableData:e,marker:t}){const{length:r,cipher:s}=t,{ivLength:i}=s,a=r+0,o=a+i;return{iv:e.substring(a,a+i),length:i+A,signature:e.substring(o,o+A)}}({transportableData:e,marker:t});return function({encipheredContents:e,marker:t,metadata:r}){const{derivation:s,cipher:i,type:a,version:o}=t,{iv:n,signature:l}=r;return{type:a,version:o,derivationConfig:s,cipherConfig:i,signature:(0,c.u)(l),iv:(0,c.u)(n),encipheredContents:(0,c.u)(e)}}({encipheredContents:n({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})}}const O=h.z.object({version:h.z.literal(1),type:S,length:h.z.number(),derivation:_,cipher:m});function R({bytes:e,markerSchema:t,values:r}){const{version:s,derivation:i,saltLength:a,iterations:o,hashAlgorithm:n,cipher:c,mode:l,ivLength:d}=t.index,u=O.safeParse({version:Number(r[s]),type:"flexible",length:e,derivation:{algorithm:r[i],saltLength:Number(r[a]),iterations:Number(r[o]),hashAlgorithm:r[n]},cipher:{algorithm:r[c],mode:r[l],ivLength:Number(r[d])}});if(!u.success)throw new Error(u.error.message);return u.data}function D({transportableData:e,index:t}){const r=t+1,s=d({str:e,substr:u.F,occurrence:r}),i=d({str:e,substr:u.F,occurrence:r+1});if(-1===s||-1===i)throw new Error("Marker info indices not found");return e.substring(s+1,i)}const N=0,U=1;function F(e){switch(e){case"argon2d":return e=>{const t=p({transportableData:e,makeMarker:b,schema:w.ARGON2D_MARKER_SCHEMA}),r=C({transportableData:e,marker:t});return l({encipheredContents:n({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"pbkdf2":return e=>{const t=p({transportableData:e,makeMarker:R,schema:w.PBKDF2_MARKER_SCHEMA}),r=C({transportableData:e,marker:t});return l({encipheredContents:n({transportableData:e,marker:t,metadata:r}),marker:t,metadata:r})};case"noderivation":return P();default:(0,a.U)(e)}}var M=r(6424),L=r(58396),x=r(6752);async function k(e,t,r,a){const n=function(e){const t=(0,i.v)(e),r=D({transportableData:t,index:N});if(Number(r)!==u.g)throw new Error("Marker version not supported");const s=D({transportableData:t,index:U});if(!(0,o.b9)(s))throw new Error("Derivation algorithm not supported");return F(s)(t)}(a),{deriveKeyArgon2d:c,deriveKeyPbkdf2:l}=t,{derivationConfig:d,salt:p}=n,{algorithm:h}=d,m="pbkdf2"===h||"argon2d"===h;if(m&&!p)throw new Error("Need salt for derivation");const g=m&&p?await(0,x.b)(e,p,l,c,d,r):e,{mode:v}=n.cipherConfig,{computeHash:y}=t,{encryptionKey:_,signatureKey:f}="cbchmac64"===v?await(0,L.U)(g):await(0,M.Y)(g,y),{iv:S,encipheredContents:E}=n,b=(0,s.K)(S,E),{signature:w}=n;return{signatureKey:f,signature:w,dataToSign:b,encryptionKey:_,iv:S,encipheredContents:E}}async function G(e,t,r,s){const{verifyHmacSha:i}=t,{signatureKey:a,signature:o,dataToSign:n,encryptionKey:c,iv:l,encipheredContents:d}=await k(e,t,r,s);if(!await i(a,o,n))throw new Error("Signature cannot be verified");const{decryptAes256:u}=t;return u(c,l,d)}},7449:(e,t,r)=>{r.d(t,{I:()=>d});var s=r(82933),i=r(94805),a=r(16698),o=r(38291);const n={type:"KWC5",derivation:i.oo,cipher:a.BU};function c(e){const t=function({transportableData:e,marker:t}){const{cipher:r,type:s}=t,{ivLength:i}=r,a=o.RB+i+o.en+s.length,n=a+o.jK;return{iv:e.slice(o.RB,o.RB+i),signature:e.slice(a,a+o.jK),encipheredContents:e.slice(n)}}({transportableData:e,marker:n});return{iv:t.iv,type:o.PD,signature:t.signature,encipheredContents:t.encipheredContents,derivationConfig:i.oo,cipherConfig:a.BU}}var l=r(6424);async function d(e,t,r){const i=c(r),{computeHash:a}=t,{encryptionKey:o,signatureKey:n}=await(0,l.Y)(e,a),{iv:d,encipheredContents:u}=i,p=(0,s.K)(d,u),{verifyHmacSha:h}=t,{signature:m}=i;if(!await h(n,m,p))throw new Error("Signature cannot be verified");const{decryptAes256:g}=t;return g(o,d,u)}},58396:(e,t,r)=>{function s(e){const t=new Uint8Array(e),r=e.byteLength/2,s=t.slice(0,r),i=t.slice(r);return Promise.resolve({encryptionKey:s.buffer,signatureKey:i.buffer})}r.d(t,{U:()=>s})},6424:(e,t,r)=>{r.d(t,{Y:()=>i});const s="SHA-512";async function i(e,t){const r=await t(e,s),i=new Uint8Array(r),a=r.byteLength/2,o=i.slice(0,a),n=i.slice(a,r.byteLength);return{encryptionKey:o.buffer,signatureKey:n.buffer}}},22609:(e,t,r)=>{r.d(t,{N:()=>i,z:()=>s});const s="AES-CBC",i=256},74017:(e,t,r)=>{r.d(t,{x:()=>s});const s="SHA-256"},83407:(e,t,r)=>{r.d(t,{$:()=>s,x:()=>i});const s="RSA-OAEP",i="RSASSA-PKCS1-v1_5"},22253:(e,t,r)=>{r.d(t,{j:()=>s});class s{}},85260:(e,t,r)=>{var s;r.d(t,{W:()=>i}),function(e){e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE",e[e.DELETE_MULTIPLE=3]="DELETE_MULTIPLE"}(s||(s={}));class i{constructor(e){this.headers=new Map,this.normalizedNames=new Map,"string"==typeof e?this.initFromString(e):e&&this.initFromObject(e)}has(e){return this.headers.has(e.toLowerCase())}get(e){const t=this.headers.get(e.toLowerCase());return t?.[0]??null}keys(){return Array.from(this.normalizedNames.values())}getAll(e){return this.headers.get(e.toLowerCase())??null}append(e,t){return this.clone({name:e,value:t,op:s.APPEND})}set(e,t){return this.clone({name:e,value:t,op:s.SET})}delete(e,t){return this.clone({name:e,value:t,op:s.DELETE})}deleteMultiple(e){return this.clone({names:e,op:s.DELETE_MULTIPLE})}toObject(){return Object.fromEntries(this.headers)}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}clone(e){const t=new i;return t.initFromOther(this),t.applyUpdate(e),t}applyUpdate(e){switch(e.op){case s.APPEND:case s.SET:{const t=e.name.toLowerCase();let r=e.value;if("string"==typeof r&&(r=[r]),0===r.length)return;this.maybeSetNormalizedName(e.name,t);const i=(e.op===s.APPEND?this.headers.get(t):void 0)??[];i.push(...r),this.headers.set(t,i)}break;case s.DELETE:{const t=e.name.toLowerCase(),r=e.value;if(r){let e=this.headers.get(t);if(!e)return;const s=Array.isArray(r)?r:[r];e=e.filter((e=>!s.includes(e))),0===e.length?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,e)}else this.headers.delete(t),this.normalizedNames.delete(t)}break;case s.DELETE_MULTIPLE:e.names.forEach((e=>{const t=e.toLowerCase();this.headers.delete(t),this.normalizedNames.delete(t)}))}}initFromOther(e){Array.from(e.headers.keys()).forEach((t=>{this.headers.set(t,[...e.headers.get(t)]),this.normalizedNames.set(t,e.normalizedNames.get(t))}))}initFromObject(e){Object.keys(e).forEach((t=>{let r=e[t];const s=t.toLowerCase();"string"==typeof r&&(r=[r]),r.length>0&&(this.headers.set(s,r),this.maybeSetNormalizedName(t,s))}))}initFromString(e){e.split("\n").forEach((e=>{const t=e.indexOf(":");if(t>0){const r=e.slice(0,t),s=r.toLowerCase(),i=e.slice(t+1).trim();this.maybeSetNormalizedName(r,s),this.headers.has(s)?this.headers.get(s).push(i):this.headers.set(s,[i])}}))}}},61223:(e,t,r)=>{r.d(t,{L:()=>a});class s{encodeKey(e){return this.standardEncoding(e)}encodeValue(e){return this.standardEncoding(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}standardEncoding(e){return encodeURIComponent(e).replace(s.STANDARD_ENCODING_REGEX,((e,t)=>s.STANDARD_ENCODING_REPLACEMENTS[t]??e))}}var i;s.STANDARD_ENCODING_REGEX=/%(\d[a-f0-9])/gi,s.STANDARD_ENCODING_REPLACEMENTS={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"},function(e){e[e.APPEND=0]="APPEND",e[e.SET=1]="SET",e[e.DELETE=2]="DELETE"}(i||(i={}));class a{constructor(e={},t={}){this.map=new Map,this.encoder=t.encoder??new s,"string"==typeof e?this.initFromString(e):this.initFromObject(e)}has(e){return this.map.has(e)}get(e){const t=this.map.get(e);return t?.[0]??null}getAll(e){return this.map.get(e)??null}keys(){return Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:i.APPEND})}appendAll(e){const t=[];return Object.keys(e).forEach((r=>{const s=e[r];Array.isArray(s)?s.forEach((e=>{t.push({param:r,value:e,op:i.APPEND})})):t.push({param:r,value:s,op:i.APPEND})})),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:i.SET})}delete(e,t){return this.clone({param:e,value:t,op:i.DELETE})}toString(){return this.keys().map((e=>{const t=this.encoder.encodeKey(e);return this.map.get(e).map((e=>t+"="+this.encoder.encodeValue(e))).join("&")})).filter((e=>""!==e)).join("&")}clone(e){const t=new a({},{encoder:this.encoder});return t.initFromOther(this),t.applyUpdates(Array.isArray(e)?e:[e]),t}initFromOther(e){e.keys().forEach((t=>this.map.set(t,[...e.map.get(t)])))}initFromObject(e){Object.keys(e).forEach((t=>{const r=e[t],s=a.isValueArray(r)?r.map(a.valueToString):[a.valueToString(r)];this.map.set(t,s)}))}initFromString(e){const{encoder:t}=this;if(e.length>0){e.replace(/^\?/,"").split("&").forEach((e=>{const r=e.indexOf("="),[s,i]=-1===r?[t.decodeKey(e),""]:[t.decodeKey(e.slice(0,r)),t.decodeValue(e.slice(r+1))],a=this.map.get(s)??[];a.push(i),this.map.set(s,a)}))}}applyUpdates(e){e.forEach((e=>{switch(e.op){case i.APPEND:case i.SET:{const t=(e.op===i.APPEND?this.map.get(e.param):void 0)??[];t.push(a.valueToString(e.value)),this.map.set(e.param,t);break}case i.DELETE:if(void 0===e.value){this.map.delete(e.param);break}{const t=this.map.get(e.param)??[],r=t.indexOf(a.valueToString(e.value));-1!==r&&t.splice(r,1),t.length>0?this.map.set(e.param,t):this.map.delete(e.param)}}}))}static valueToString(e){return`${e}`}static isValueArray(e){return Array.isArray(e)}}},4043:(e,t,r)=>{r.d(t,{a:()=>a});var s=r(85260),i=r(61223);class a{constructor(e,t,r,o){this.body=null,this.headers=new s.W,this.withCredentials=!1,this.timeout=6e4,this.responseType="json",this.params=new i.L({}),this.url=t,this.method=e,a.mightHaveBody(this.method)&&(this.body=r??null),o&&(this.withCredentials=Boolean(o.withCredentials),o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=this.getHeadersFromOptions(o.headers)),o.params&&(this.params=this.getParamsFromOptions(o.params)),o.timeout&&o.timeout>0&&(this.timeout=o.timeout),o.mode&&(this.mode=o.mode)),this.urlWithParams=this.initUrlWithParams()}serializeBody(){return null===this.body?null:a.isArrayBuffer(this.body)||"string"==typeof this.body?this.body:this.body instanceof i.L?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||a.isArrayBuffer(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof i.L?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){const t=e.method??this.method,r=e.url??this.url,s=e.responseType??this.responseType,i=void 0!==e.body?e.body:this.body,o=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,n=void 0!==e.timeout?e.timeout:this.timeout,c=e.mode??this.mode;let l=e.headers?this.getHeadersFromOptions(e.headers):this.headers,d=e.params?this.getParamsFromOptions(e.params):this.params;const u=e.setHeaders;u&&(l=Object.keys(u).reduce(((e,t)=>e.set(t,u[t])),l));const p=e.setParams;return p&&(d=Object.keys(p).reduce(((e,t)=>e.set(t,p[t])),d)),new a(t,r,i,{params:d,headers:l,responseType:s,withCredentials:o,timeout:n,mode:c})}getHeadersFromOptions(e){return e instanceof s.W?e:new s.W(e)}getParamsFromOptions(e){return e instanceof i.L?e:new i.L(e)}initUrlWithParams(){const e=this.params.toString();if(0===e.length)return this.url;const t=this.url.indexOf("?"),r=-1===t?"?":t<this.url.length-1?"&":"";return this.url+r+e}static mightHaveBody(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":return!1;default:return!0}}static isArrayBuffer(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}}},12964:(e,t,r)=>{r.d(t,{Z:()=>c});var s=r(91174),i=r(85260),a=r(25994);async function o(e){const t=e.getReader();let r=new Uint8Array(0),s=await t.read();for(;!s.done;){const e=new Uint8Array(r.byteLength+s.value.byteLength);e.set(r,0),e.set(s.value,r.byteLength),r=e,s=await t.read()}return r}class n{constructor(e){this.bytesRead=0,this.data=e}pull(e){const{bytesRead:t,data:r}=this;if(t>=r.byteLength)return void e.close();const s=Math.min(r.byteLength-t,e.desiredSize??1/0);if(s>0){const i=new Uint8Array(r,t,s);e.enqueue(i),this.bytesRead+=s}t>=r.byteLength&&e.close()}}class c{constructor(e={},t=a.W.Ok,r="OK"){this.headers=e.headers instanceof i.W?e.headers:new i.W(e.headers),this.status=void 0!==e.status?e.status:t,this.statusText=e.statusText??r,this.url=e.url??null,this.ok=this.status>=200&&this.status<300,this.body=void 0!==e.body?e.body:null}clone(e={}){return new c({body:void 0!==e.body?e.body:null===this.body?null:this.body instanceof s.Pz?this.body.tee()[0]:this.body,headers:e.headers??this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText??this.statusText,url:e.url??this.url??void 0})}isBodyReadableStream(){return!!this.body&&"object"==typeof this.body&&"ReadableStream"===this.body.constructor.name}async arrayBuffer(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){return(await o(this.body)).buffer}if(!(this.body instanceof ArrayBuffer))throw new Error("Unexpected body type, not an ArrayBuffer");return this.body}async text(){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const e=await o(this.body);return(new TextDecoder).decode(e.buffer)}if("string"!=typeof this.body)throw new Error("Unexpected body type, not a string");return this.body}async json(e){if(null===this.body)throw new Error("Empty response body");if(this.isBodyReadableStream()){const t=await o(this.body),r=(new TextDecoder).decode(t.buffer);try{const t=JSON.parse(r);return e.decode(t)}catch(e){throw new Error("Failed to parse response body JSON")}}if(this.body instanceof ArrayBuffer||"string"==typeof this.body)throw new Error("Unexpected body type");return e.decode(this.body)}bodyStream(){if(null===this.body)throw new Error("Empty response body");if("object"==typeof this.body&&"ReadableStream"===this.body.constructor.name)return this.body;const e=new TextEncoder;if("string"==typeof this.body)return new s.Pz(new n(e.encode(this.body).buffer));if(this.body instanceof ArrayBuffer)return new s.Pz(new n(this.body));const t=JSON.stringify(this.body);return new s.Pz(new n(e.encode(t).buffer))}}},25994:(e,t,r)=>{var s;r.d(t,{W:()=>s}),function(e){e[e.Continue=100]="Continue",e[e.SwitchingProtocols=101]="SwitchingProtocols",e[e.Processing=102]="Processing",e[e.EarlyHints=103]="EarlyHints",e[e.Ok=200]="Ok",e[e.Created=201]="Created",e[e.Accepted=202]="Accepted",e[e.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",e[e.NoContent=204]="NoContent",e[e.ResetContent=205]="ResetContent",e[e.PartialContent=206]="PartialContent",e[e.MultiStatus=207]="MultiStatus",e[e.AlreadyReported=208]="AlreadyReported",e[e.ImUsed=226]="ImUsed",e[e.MultipleChoices=300]="MultipleChoices",e[e.MovedPermanently=301]="MovedPermanently",e[e.Found=302]="Found",e[e.SeeOther=303]="SeeOther",e[e.NotModified=304]="NotModified",e[e.UseProxy=305]="UseProxy",e[e.Unused=306]="Unused",e[e.TemporaryRedirect=307]="TemporaryRedirect",e[e.PermanentRedirect=308]="PermanentRedirect",e[e.BadRequest=400]="BadRequest",e[e.Unauthorized=401]="Unauthorized",e[e.PaymentRequired=402]="PaymentRequired",e[e.Forbidden=403]="Forbidden",e[e.NotFound=404]="NotFound",e[e.MethodNotAllowed=405]="MethodNotAllowed",e[e.NotAcceptable=406]="NotAcceptable",e[e.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",e[e.RequestTimeout=408]="RequestTimeout",e[e.Conflict=409]="Conflict",e[e.Gone=410]="Gone",e[e.LengthRequired=411]="LengthRequired",e[e.PreconditionFailed=412]="PreconditionFailed",e[e.PayloadTooLarge=413]="PayloadTooLarge",e[e.UriTooLong=414]="UriTooLong",e[e.UnsupportedMediaType=415]="UnsupportedMediaType",e[e.RangeNotSatisfiable=416]="RangeNotSatisfiable",e[e.ExpectationFailed=417]="ExpectationFailed",e[e.ImATeapot=418]="ImATeapot",e[e.MisdirectedRequest=421]="MisdirectedRequest",e[e.UnprocessableEntity=422]="UnprocessableEntity",e[e.Locked=423]="Locked",e[e.FailedDependency=424]="FailedDependency",e[e.TooEarly=425]="TooEarly",e[e.UpgradeRequired=426]="UpgradeRequired",e[e.PreconditionRequired=428]="PreconditionRequired",e[e.TooManyRequests=429]="TooManyRequests",e[e.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",e[e.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",e[e.InternalServerError=500]="InternalServerError",e[e.NotImplemented=501]="NotImplemented",e[e.BadGateway=502]="BadGateway",e[e.ServiceUnavailable=503]="ServiceUnavailable",e[e.GatewayTimeout=504]="GatewayTimeout",e[e.HttpVersionNotSupported=505]="HttpVersionNotSupported",e[e.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",e[e.InsufficientStorage=507]="InsufficientStorage",e[e.LoopDetected=508]="LoopDetected",e[e.NotExtended=510]="NotExtended",e[e.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired"}(s||(s={}))},73155:(e,t,r)=>{r.d(t,{R:()=>i,a:()=>a});var s=r(96168);class i extends((0,s.Hu)("BadStatus","The HTTP response has a non-successful status code (not 2XX)")){constructor(e){super(),this.response=e}}class a extends((0,s.Hu)("FetchFailedError","Something happened while communicating to the server")){}},10493:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toFunctionalErrorCode=t.isFunctionalErrorOfType=t.FunctionalError=t.defineFunctionalError=void 0;t.defineFunctionalError=(e,t="")=>()=>({tag:e,message:t});t.FunctionalError=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}},t.isFunctionalErrorOfType=function(e,t){return t.includes(e.tag)};t.toFunctionalErrorCode=e=>e.tag},6689:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.panic=t.toFunctionalErrorCode=t.isFunctionalErrorOfType=t.FunctionalError=t.defineFunctionalError=void 0;var s=r(10493);Object.defineProperty(t,"defineFunctionalError",{enumerable:!0,get:function(){return s.defineFunctionalError}}),Object.defineProperty(t,"FunctionalError",{enumerable:!0,get:function(){return s.FunctionalError}}),Object.defineProperty(t,"isFunctionalErrorOfType",{enumerable:!0,get:function(){return s.isFunctionalErrorOfType}}),Object.defineProperty(t,"toFunctionalErrorCode",{enumerable:!0,get:function(){return s.toFunctionalErrorCode}});var i=r(85400);Object.defineProperty(t,"panic",{enumerable:!0,get:function(){return i.panic}})},85400:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.panic=void 0,t.panic=function(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}},45051:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(6689),t),i(r(73637),t),i(r(40965),t)},78057:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.assertUnreachable=void 0,t.assertUnreachable=function(e,t){throw new Error(t??`Unreachable code detected (${e})`)}},73637:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchMap=t.switchMatchResult=t.switchMapSuccess=t.switchMapFailure=t.matchResultObservable=t.mapSuccessResultObservable=t.mapResultObservable=t.mapSuccessObservable=t.mapFailureObservable=t.concatMatchResult=t.concatMapSuccess=t.concatMapFailure=t.isResult=t.matchResult=t.mapSuccess=t.mapFailure=t.success=t.getSuccess=t.getFailure=t.failure=t.isSuccess=t.isFailure=t.isMatchable=t.match=t.createMatchable=t.assertUnreachable=void 0;var s=r(78057);Object.defineProperty(t,"assertUnreachable",{enumerable:!0,get:function(){return s.assertUnreachable}});var i=r(13757);Object.defineProperty(t,"createMatchable",{enumerable:!0,get:function(){return i.createMatchable}}),Object.defineProperty(t,"match",{enumerable:!0,get:function(){return i.match}}),Object.defineProperty(t,"isMatchable",{enumerable:!0,get:function(){return i.isMatchable}});var a=r(4964);Object.defineProperty(t,"isFailure",{enumerable:!0,get:function(){return a.isFailure}}),Object.defineProperty(t,"isSuccess",{enumerable:!0,get:function(){return a.isSuccess}}),Object.defineProperty(t,"failure",{enumerable:!0,get:function(){return a.failure}}),Object.defineProperty(t,"getFailure",{enumerable:!0,get:function(){return a.getFailure}}),Object.defineProperty(t,"getSuccess",{enumerable:!0,get:function(){return a.getSuccess}}),Object.defineProperty(t,"success",{enumerable:!0,get:function(){return a.success}}),Object.defineProperty(t,"mapFailure",{enumerable:!0,get:function(){return a.mapFailure}}),Object.defineProperty(t,"mapSuccess",{enumerable:!0,get:function(){return a.mapSuccess}}),Object.defineProperty(t,"matchResult",{enumerable:!0,get:function(){return a.matchResult}}),Object.defineProperty(t,"isResult",{enumerable:!0,get:function(){return a.isResult}});var o=r(26047);Object.defineProperty(t,"concatMapFailure",{enumerable:!0,get:function(){return o.concatMapFailure}}),Object.defineProperty(t,"concatMapSuccess",{enumerable:!0,get:function(){return o.concatMapSuccess}}),Object.defineProperty(t,"concatMatchResult",{enumerable:!0,get:function(){return o.concatMatchResult}}),Object.defineProperty(t,"mapFailureObservable",{enumerable:!0,get:function(){return o.mapFailureObservable}}),Object.defineProperty(t,"mapSuccessObservable",{enumerable:!0,get:function(){return o.mapSuccessObservable}}),Object.defineProperty(t,"mapResultObservable",{enumerable:!0,get:function(){return o.mapResultObservable}}),Object.defineProperty(t,"mapSuccessResultObservable",{enumerable:!0,get:function(){return o.mapSuccessResultObservable}}),Object.defineProperty(t,"matchResultObservable",{enumerable:!0,get:function(){return o.matchResultObservable}}),Object.defineProperty(t,"switchMapFailure",{enumerable:!0,get:function(){return o.switchMapFailure}}),Object.defineProperty(t,"switchMapSuccess",{enumerable:!0,get:function(){return o.switchMapSuccess}}),Object.defineProperty(t,"switchMatchResult",{enumerable:!0,get:function(){return o.switchMatchResult}});var n=r(79020);Object.defineProperty(t,"matchMap",{enumerable:!0,get:function(){return n.matchMap}})},79020:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.matchMap=void 0;t.matchMap=(e,t)=>t[e]()},13757:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isMatchable=t.match=t.createMatchable=void 0;t.createMatchable=(e,t)=>({tag:e,...t});t.match=(e,t)=>{const r=e.tag,s=r in t?t[r]:null;if(!s)throw new Error("Unmatchable case");return s(e)};t.isMatchable=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},26047:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.switchMatchResult=t.switchMapFailure=t.switchMapSuccess=t.concatMatchResult=t.concatMapFailure=t.concatMapSuccess=t.mapSuccessResultObservable=t.mapResultObservable=t.mapFailureObservable=t.mapSuccessObservable=t.matchResultObservable=void 0;const s=r(18948),i=r(4964),a=r(13757);t.matchResultObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,a.match)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))},t.mapSuccessObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,i.isFailure)(t)?t:(0,i.success)(e(t.data)))))},t.mapFailureObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,i.isSuccess)(t)?t:(0,i.failure)(e(t.error)))))},t.mapResultObservable=function(e,t){return r=>r.pipe((0,s.map)((r=>(0,i.isFailure)(r)?t?t(r.error):r:e(r.data))))},t.mapSuccessResultObservable=function(e){return t=>t.pipe((0,s.map)((t=>(0,i.isFailure)(t)?t:e(t.data))))},t.concatMapSuccess=function(e){return t=>t.pipe((0,s.concatMap)((async t=>(0,i.isFailure)(t)?t:(0,i.success)(await e(t.data)))))},t.concatMapFailure=function(e){return t=>t.pipe((0,s.concatMap)((async t=>(0,i.isSuccess)(t)?t:(0,i.failure)(await e(t.error)))))},t.concatMatchResult=function(e){return t=>t.pipe((0,s.concatMap)((t=>(0,i.matchResult)(t,e))))},t.switchMapSuccess=function(e){return t=>t.pipe((0,s.switchMap)((async t=>(0,i.isFailure)(t)?t:(0,i.success)(await e(t.data)))))},t.switchMapFailure=function(e){return t=>t.pipe((0,s.switchMap)((async t=>(0,i.isSuccess)(t)?t:(0,i.failure)(await e(t.error)))))},t.switchMatchResult=function(e){return t=>t.pipe((0,s.switchMap)((t=>(0,i.matchResult)(t,e))))}},4964:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mapFailure=t.mapSuccess=t.getFailure=t.getSuccess=t.isResult=t.isFailure=t.isSuccess=t.matchResult=t.failure=t.success=void 0;const s=r(13757),i=r(38307);t.success=e=>(0,s.createMatchable)("success",{data:e});t.failure=e=>(0,s.createMatchable)("failure",{error:e});t.matchResult=(e,t)=>(0,s.match)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)});t.isSuccess=e=>e.tag===i.SuccessTag;t.isFailure=e=>e.tag===i.FailureTag;t.isResult=e=>(0,s.isMatchable)(e,i.SuccessTag,i.FailureTag);t.getSuccess=e=>e.data;t.getFailure=e=>e.error;t.mapSuccess=(e,r)=>(0,t.isFailure)(e)?e:(0,t.success)(r(e.data));t.mapFailure=(e,r)=>(0,t.isSuccess)(e)?e:(0,t.failure)(r(e.error))},38307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FailureTag=t.SuccessTag=void 0,t.SuccessTag="success",t.FailureTag="failure"},40965:function(e,t,r){var s=this&&this.__createBinding||(Object.create?function(e,t,r,s){void 0===s&&(s=r);var i=Object.getOwnPropertyDescriptor(t,r);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,s,i)}:function(e,t,r,s){void 0===s&&(s=r),e[s]=t[r]}),i=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||s(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),i(r(97622),t)},97622:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasProperty=t.safeCast=t.getBrander=void 0;t.getBrander=e=>t=>Object.assign(t,{brand:e});t.safeCast=e=>e,t.hasProperty=function(e,t){return t in e}},96168:(e,t,r)=>{r.d(t,{Hu:()=>i,Vj:()=>s});const s=(e,t="")=>()=>({tag:e,message:t}),i=(e,t)=>class extends Error{constructor(){super(t),this.tag=e}}},20195:(e,t,r)=>{function s(e){if(e instanceof Error)throw e;if("string"==typeof e)throw new Error(e);throw new Error(e.tag)}r.d(t,{j:()=>s})},95087:(e,t,r)=>{function s(e,t){throw new Error(t??`Unreachable code detected (${e})`)}r.d(t,{U:()=>s})},18533:(e,t,r)=>{r.d(t,{EQ:()=>i,H6:()=>s,cw:()=>a});const s=(e,t)=>({tag:e,...t}),i=(e,t)=>{const r=e.tag,s=r in t?t[r]:null;if(!s)throw new Error("Unmatchable case");return s(e)},a=(e,...t)=>{if("object"!=typeof e||!e)return!1;return"tag"in e&&t.includes(e.tag)}},48844:(e,t,r)=>{r.d(t,{DZ:()=>l,Gx:()=>u,Qn:()=>c,RW:()=>p,lk:()=>d,nb:()=>n});var s=r(87065),i=r(34987),a=r(87279),o=r(18533);function n(e){return t=>t.pipe((0,s.U)((t=>(0,o.EQ)(t,{success:({data:t})=>e.success(t),failure:({error:t})=>e.failure(t)}))))}function c(e){return t=>t.pipe((0,s.U)((t=>(0,a.hx)(t)?t:(0,a.Vp)(e(t.data)))))}function l(e){return t=>t.pipe((0,s.U)((t=>(0,a.d6)(t)?t:(0,a.Rn)(e(t.error)))))}function d(e){return t=>t.pipe((0,s.U)((t=>(0,a.hx)(t)?t:e(t.data))))}function u(e){return t=>t.pipe((0,i.b)((async t=>(0,a.hx)(t)?t:(0,a.Vp)(await e(t.data)))))}function p(e){return t=>t.pipe((0,i.b)((t=>(0,a.f2)(t,e))))}},87279:(e,t,r)=>{r.d(t,{Rn:()=>n,Yv:()=>h,db:()=>p,hx:()=>d,AZ:()=>u,d6:()=>l,ty:()=>m,f2:()=>c,Vp:()=>o});var s=r(18533);const i="success",a="failure",o=e=>(0,s.H6)("success",{data:e}),n=e=>(0,s.H6)("failure",{error:e}),c=(e,t)=>(0,s.EQ)(e,{success:({data:e})=>t.success(e),failure:({error:e})=>t.failure(e)}),l=e=>e.tag===i,d=e=>e.tag===a,u=e=>(0,s.cw)(e,i,a),p=e=>e.data,h=e=>e.error,m=(e,t)=>d(e)?e:o(t(e.data))},28489:(e,t,r)=>{r.d(t,{Ay:()=>s,l$:()=>i});const s=e=>e;function i(e,t){return t in e}}}]);