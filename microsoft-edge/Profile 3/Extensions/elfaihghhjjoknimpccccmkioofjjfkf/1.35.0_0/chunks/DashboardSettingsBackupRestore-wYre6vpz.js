import{o as m,g as C,i as l,ah as ce,aR as q,c2 as ue,c3 as u,c4 as A,a9 as B,b0 as N,c5 as h,c6 as O,c7 as M,c8 as y,c9 as p,ca as g,cb as W,aX as me,cc as le,cd as de,ce as fe,cf as he,cg as ye,a7 as pe,a$ as ge,ch as we,aB as Se,a as be,aJ as Te,aH as w,ci as S,cj as _e,ck as Ce,af as E,c as b,cl as n,f as De,Y as ke,n as Re,q as ve,w as Oe,k as x,j as G}from"./defineAppConfig-bSouF0-Z.js";import{d as We}from"./define-preference-list-pngV4kd8.js";import{o as Ee,t as c}from"./useAddAppToIgnoreListDialogStore-3TvFnIDf.js";import{u as o}from"./useRequireSecurity-QcrLk1hI.js";import{r as T}from"./min-search-date-Te936Y1o.js";import{_ as xe}from"./SettingsBreadcrumbs.vue_vue_type_script_setup_true_lang-FrNXn1T7.js";import"./DurationPreference.vue_vue_type_script_setup_true_lang-7YqzPxZB.js";import"./recent-apps-provider-So7C9hQg.js";import"./new-tab-light-H2_I1S9N.js";import"./menu-right-4SQh6tsF.js";const Ge={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Pe=l("path",{fill:"currentColor",d:"M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48q1.18-1.53 3.08-1.95q.58-2.02 2.14-3.4Q8.95 4.38 11 4.08v8.07L9.4 10.6L8 12l4 4l4-4l-1.4-1.4l-1.6 1.55V4.08q2.58.35 4.29 2.31T19 11q1.73.2 2.86 1.5q1.14 1.28 1.14 3q0 1.88-1.31 3.19T18.5 20Z"},null,-1),Le=[Pe];function Fe(e,s){return m(),C("svg",Ge,Le)}const P={name:"mdi-cloud-download",render:Fe},Ie={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},qe=l("path",{fill:"currentColor",d:"M11 20H6.5q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48q1.18-1.53 3.08-1.95q.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5q1.14 1.28 1.14 3q0 1.88-1.31 3.19T18.5 20H13v-7.15l1.6 1.55L16 13l-4-4l-4 4l1.4 1.4l1.6-1.55Z"},null,-1),Ae=[qe];function Be(e,s){return m(),C("svg",Ie,Ae)}const L={name:"mdi-cloud-upload",render:Be},Ne={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Me=l("path",{fill:"currentColor",d:"M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12Z"},null,-1),$e=[Me];function He(e,s){return m(),C("svg",Ne,$e)}const _={name:"mdi-delete",render:He},F=".usage_backup",$="generated-history-count";function Ue(e=q()){return ce([$],e.generatedHistoryCount)}const I=ue({theme:u(A),startWeekOn:u(B),timeFormat:u(N),dailyResetTime:h().int().nonnegative(),trackTabs:O(),dailySummary:O(),sendDailySummary:h().int().nonnegative(),popupPosition:u(M),ignoreWebsites:y(p()),focusWebsites:y(p()),focusSchedules:g(W),websiteLimits:g(me),limitsOnTheGoWebsites:y(p()),limitsOnTheGoSchedules:g(W),limitsOnTheGoCoolDown:h().int().nonnegative()}),Qe=We(e=>{const{t:s}=e,{state:D}=le(),{state:k}=de(),{state:d}=fe(),{state:H}=he(),{state:U}=ye(),{state:Q}=pe(),{state:j}=ge(),{state:V}=we(),K=Ee(),f=Se(),i=q(),R=be("ExportHistory"),Y=Te(),{data:J}=Ue(),Z=o(async()=>{const t=await i.exportUsageBackup(),a=document.createElement("a");a.href=`data:*/*;base64,${t}`,a.download=`StayFree ${new Date().toISOString()}${F}`,a.click()}),X=o(async t=>{try{e.showLoading(),await i.importUsageBackup(t),await T(i,f),e.hideLoading(),e.showAlert(e.t("preferences.importSuccess"))}catch(a){e.showAlert(e.t("genericErrorWithMessage",{message:c(a)}))}}),z=o(()=>{e.confirmDestroy({title:s("preferences.resetConfirmTitle"),message:s("preferences.resetConfirmMessage"),onConfirm(){ee().catch(t=>w("[main-preferences] Failed to reset history",t))}})});async function ee(){var t;try{e.showLoading();const a=((t=K.deviceGroup)==null?void 0:t.key)??"";await i.resetDatabase(a),await T(i,f);const r=s("preferences.resetSuccess");S({message:r}),e.hideLoading(),e.showAlert(r)}catch(a){e.showAlert(s("genericErrorWithMessage",{message:c(a)}))}}const te=o(()=>{e.confirmDestroy({title:s("preferences.generatedResetConfirmTitle"),message:s("preferences.generatedResetConfirmMessage"),onConfirm(){se().catch(t=>w("[main-preferences] Failed to reset generated history",t))}})});async function se(){try{e.showLoading(),await i.resetGeneratedDatabase(),await T(i,f);const t=s("preferences.generatedResetSuccess");S({message:t}),e.hideLoading(),e.showAlert(t),Y.invalidateQueries({queryKey:$})}catch(t){e.showAlert(s("genericErrorWithMessage",{message:c(t)}))}}async function ae(){const t={theme:U.value,startWeekOn:Q.value,timeFormat:j.value,dailyResetTime:d.value,trackTabs:H.value,dailySummary:k.value,sendDailySummary:D.value,popupPosition:V.value,ignoreWebsites:await e.prefs.getIgnoredWebsites(),focusWebsites:await e.prefs.getFocusWebsites(),focusSchedules:await e.prefs.getFocusSchedules(),websiteLimits:await e.prefs.getUsageLimitsMap(),limitsOnTheGoWebsites:await e.prefs.getLimitsOnTheGoWebsites(),limitsOnTheGoSchedules:await e.prefs.getLimitsOnTheGoSchedules(),limitsOnTheGoCoolDown:await e.prefs.getLotgCoolDownPeriod()};return I.parse(t)}async function v(t){await e.prefs.setTheme(t.theme),await e.prefs.setStartWeekOn(t.startWeekOn),await e.prefs.setTimeFormat(t.timeFormat),await e.prefs.setDailyResetTime(t.dailyResetTime),await e.prefs.setIsTabActiveWhenPlayingAudio(t.trackTabs),await e.prefs.setIsDailySummaryNotificationEnabled(t.dailySummary),await e.prefs.setDailySummaryNotificationTime(t.sendDailySummary),await e.prefs.setPopupPosition(t.popupPosition),await e.prefs.setIgnoredWebsites(t.ignoreWebsites),await e.prefs.setFocusWebsites(t.focusWebsites),await e.prefs.setFocusSchedules(t.focusSchedules),await e.prefs.setUsageLimitsMap(t.websiteLimits),await e.prefs.setLimitsOnTheGoWebsites(t.limitsOnTheGoWebsites),await e.prefs.setLimitsOnTheGoSchedules(t.limitsOnTheGoSchedules),await e.prefs.setLotgCoolDownPeriod(t.limitsOnTheGoCoolDown)}const ie=o(async()=>{const t=await ae(),a=document.createElement("a"),r=new Blob([JSON.stringify(t)],{type:"application/json"});a.href=URL.createObjectURL(r),a.download=`StayFree Settings ${new Date().toISOString()}.json`,a.click()}),ne=o(async t=>{try{if(!_e(t))throw Error("Invalid base64 encoding");const a=Ce(t),r=I.parse(JSON.parse(a));await v(r),e.showAlert(e.t("preferences.importSuccess"))}catch(a){e.showAlert(e.t("genericErrorWithMessage",{message:c(a)}))}}),oe=o(()=>{e.confirmDestroy({title:s("preferences.factoryResetConfirmTitle"),message:s("preferences.factoryResetConfirmMessage"),onConfirm(){re().catch(t=>w("[main-preferences] Failed to reset factory",t))}})});async function re(){try{const t={theme:A.Auto,startWeekOn:B.Sunday,timeFormat:N.Hour12,dailyResetTime:E*3,trackTabs:!0,dailySummary:!0,sendDailySummary:E*21,popupPosition:M.Center,appGroups:!0,ignoreWebsites:[],focusWebsites:[],focusSchedules:{},websiteLimits:{},limitsOnTheGoWebsites:[],limitsOnTheGoSchedules:{},limitsOnTheGoCoolDown:0};await v(t);const a=s("preferences.factoryResetSuccess");S({message:a}),e.showAlert(a)}catch(t){e.showAlert(s("genericErrorWithMessage",{message:c(t)}))}}return[{type:"group",name:s("preferences.historyGroup"),preferences:[{when:b(()=>R),id:n.ExportData,name:s("preferences.exportName"),description:s("preferences.exportDescription"),icon:P,type:"button",buttonText:s("preferences.exportButton"),onClick:Z},{when:b(()=>R),id:n.ImportData,name:s("preferences.importName"),description:s("preferences.importDescription"),icon:L,type:"file-upload",acceptExtensions:[F],onFileContents:X},{id:n.Reset,name:s("preferences.resetName"),description:s("preferences.resetDescription"),icon:_,type:"button",buttonText:s("preferences.resetButton"),onClick:z},{when:b(()=>(J.value??0)>0),id:n.Reset,name:s("preferences.generatedResetName"),description:s("preferences.generatedResetDescription"),icon:_,type:"button",buttonText:s("preferences.generatedResetButton"),onClick:te}]},{type:"group",name:s("preferences.settingsGroup"),preferences:[{id:n.ExportSettings,name:s("preferences.exportSettings"),description:s("preferences.exportSettingsDescription"),icon:P,type:"button",buttonText:s("preferences.exportButton"),onClick:ie},{id:n.ImportSettings,name:s("preferences.importSettings"),description:s("preferences.importSettingsDescription"),icon:L,type:"file-upload",acceptExtensions:["json"],onFileContents:ne},{id:n.FactoryReset,name:s("preferences.factoryResetName"),description:s("preferences.factoryResetDescription"),icon:_,type:"button",buttonText:s("preferences.factoryResetButton"),onClick:oe}]}]}),je={class:"section section-sticky"},at=De({name:"DashboardSettingsBackupRestore",__name:"DashboardSettingsBackupRestore",setup(e){const{t:s}=ke();return(D,k)=>{const d=Re("page-layout-content-container");return m(),ve(d,null,{default:Oe(()=>[l("section",je,[x(xe,{title:G(s)("backupRestore.title")},null,8,["title"])]),x(G(Qe))]),_:1})}}});export{at as default};
