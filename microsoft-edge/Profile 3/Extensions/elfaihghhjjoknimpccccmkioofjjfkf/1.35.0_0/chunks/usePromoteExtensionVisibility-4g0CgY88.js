import{aO as E,c as n,aj as U,I as k,bW as $,bl as R,f as L,o as y,g as C,l as x,F as S,i as j,ay as O,Y as B,aS as q,bI as _,ap as H,T as M,V as N,q as D,w as F,j as u,k as T,U as Q,aJ as W,aC as K,t as Y,N as J,bd as X,bX as Z,r as z,b as ee,a as te}from"./defineAppConfig-bSouF0-Z.js";import{I as se}from"./new-tab-light-H2_I1S9N.js";import{u as ie}from"./useGetSessionSummaries-EN2wQhyL.js";import{I as ae}from"./pencil-outline-vSGnzihw.js";import{a as oe,I as ne}from"./plus-1Lu360WS.js";import{o as V,q as re,j as le,i as ue,O as me,P as ce}from"./useAddAppToIgnoreListDialogStore-3TvFnIDf.js";import{_ as P,u as pe}from"./AppListItem.vue_vue_type_script_setup_true_lang-oxAodo1O.js";import{l as de,m as fe,j as ge,k as ye,h as Ie}from"./recent-apps-provider-So7C9hQg.js";import{u as h}from"./useRequireSecurity-QcrLk1hI.js";function ve(){const{deviceGroup:i}=E(V());return n(()=>!!i.value)}function be(){return U(k.RelatedAppsPlatform)}function we(i){const o=ve(),s=be();return n(()=>$(R(i),o.value,s))}const Te=j("p",null,"TODO",-1),A=L({__name:"CategoryListItem",props:{appId:{},subtitle:{},platform:{},disableAppGroups:{type:Boolean},limit:{},usage:{}},setup(i){return(o,s)=>(y(),C(S,null,[x(" eslint-disable-next-line @intlify/vue-i18n/no-raw-text "),Te],2112))}}),Le=L({components:{AppListItem:P,CategoryListItem:A},render(){const i=this.$props.platform==="category"?A:P;return O(i,this.$props,this.$slots.default)}}),Ce=L({name:"UsageLimitListItem",__name:"UsageLimitListItem",props:{limit:{}},emits:["edit","delete"],setup(i,{emit:o}){const s=i,{t:r}=B(),I=n(()=>{if(s.limit.duration===0)return r("dashboard.completelyBlockedSection");const t=q(s.limit.duration,{excludeTrailingZeros:!0}),a=r(`enums.WarningType.${s.limit.warningType}Action`);return r("dashboard.websiteLimitSubtitle",{duration:t,warningTypeAction:a})}),m=n(()=>s.limit.appId),p=n(()=>_(s.limit.limitType)),v=pe(m,p),d=H(),c=M(),b=c+Q,f=we(v),g=n(()=>({startDate:c,endDate:b,appIds:f.value.length===0?[m.value]:f.value.map(t=>t.id),installIds:s.limit.isCrossPlatform?void 0:[d.value],myInstallId:d.value})),{data:e}=ie(N.UsageTime,g),l=n(()=>{var t,a;return((a=(t=e==null?void 0:e.value)==null?void 0:t[0])==null?void 0:a.primaryMetricValue)??0});return(t,a)=>(y(),D(u(Le),{"data-testid":`usage-limit-${t.limit.appId}`,"app-id":t.limit.appId,subtitle:u(I),platform:u(p),limit:t.limit.duration,usage:u(l)},{default:F(()=>[T(u(ae),{class:"icon-button text-neutral-content text-opacity-icon",onClick:a[0]||(a[0]=w=>o("edit",t.limit))}),T(u(oe),{"data-testid":`delete-usage-limit-${t.limit.appId}`,class:"icon-button text-neutral-content text-opacity-icon",onClick:a[1]||(a[1]=w=>o("delete",t.limit))},null,8,["data-testid"])]),_:1},8,["data-testid","app-id","subtitle","platform","limit","usage"]))}});function De(){const i=re(),o=W();return K(async({limitId:s,isCrossPlatform:r})=>await i.removeUsageLimit(s,r),{onSuccess:()=>{o.invalidateQueries(de)}})}const Ve=L({name:"UsageLimitList",__name:"UsageLimitList",props:{items:{},showInlineButton:{type:Boolean},editDefaults:{}},setup(i){const o=i,{t:s}=B(),r=le(),I=fe(),m=ge(),{reportEvent:p}=Y(),{mutateAsync:v}=De(),d=h(e=>{I.show({title:s("genericConfirmation"),positiveButtonText:s("delete"),negativeButtonText:s("cancel"),async onClickPositive(){const l=_(e.limitType);p("DELETE_USAGE_LIMIT",{...e,limitPlatform:l});try{await v({limitId:e.id,isCrossPlatform:e.isCrossPlatform})}catch(t){Z(t),r.show({message:s("genericError")})}return!0}})}),c=ue(),b=h(e=>{var t;const l=[...((t=o.editDefaults)==null?void 0:t.allowedHostnames)??[e.appId]];l.sort(),m.show({warningType:e.warningType,duration:e.duration,id:e.id,appId:e.appId,allowedHostnames:l,limitType:c,isCrossPlatform:e.isCrossPlatform})}),f=ye();function g(){var e;m.show({allowedHostnames:(e=o.editDefaults)==null?void 0:e.allowedHostnames,warningType:f,limitType:c})}return(e,l)=>(y(),D(X,{tag:"ul",name:"fade",class:"grid grid-flow-row gap-4 sm:grid-cols-2",duration:300},{default:F(()=>[(y(!0),C(S,null,J(e.items,t=>(y(),D(Ce,{key:t.id,limit:t,onDelete:u(d),onEdit:u(b)},null,8,["limit","onDelete","onEdit"]))),128)),e.showInlineButton?(y(),C("button",{key:0,"data-testid":"add-limit-website",class:"h-14 flex items-center justify-center space-x-2 rounded-lg ring-1 ring-base-content ring-opacity-divider ring-inset clickable",onClick:g},[T(u(ne),{class:"icon text-base-content text-opacity-secondary"}),T(se,{tag:"p",keypath:"newLimit"})])):x("v-if",!0)]),_:1}))}});function Ge(i){const o=z(!1);ee(()=>{o.value=!0},(i==null?void 0:i.autoShowTimeout)??1e3);const s=te("PromoteExtension"),{state:r,mutateAsync:I}=me(),m=n(()=>o.value&&r.value&&s&&!e.value);function p(){return I(!1)}const{state:v,mutateAsync:d}=ce(),c=V(),{deviceGroup:b}=E(c),{data:f}=Ie(b);function g(a){return["chrome","firefox","safari"].some(G=>a.toLowerCase().includes(G))}const e=n(()=>{var a;return((a=f.value)==null?void 0:a.find(w=>g(w.name)))!=null});function l(a){return n(()=>!e.value&&g(a.value)&&v.value&&s)}function t(){return d(!1)}return{isPromoteExtensionForLimitsVisible:m,isPromoteExtensionForBrowserDetailsVisible:l,dismissPromoteExtensionForLimits:p,dismissPromoteExtensionForBrowserDetails:t}}export{Ve as _,be as a,we as b,Ge as c,ve as u};
