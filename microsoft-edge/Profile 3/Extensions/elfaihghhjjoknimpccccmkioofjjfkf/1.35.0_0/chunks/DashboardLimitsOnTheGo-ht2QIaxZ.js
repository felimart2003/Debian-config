import{I as Y}from"./timer-Q3fuddn_.js";import{I as D}from"./new-tab-light-H2_I1S9N.js";import{b4 as M,cv as ne,f as K,aO as A,Y as Q,as as B,a$ as H,c as l,b0 as $,o as _,q as E,w as P,g as F,N as ce,F as le,k as m,j as t,bd as re,bX as de,z as X,bU as z,cw as ue,ax as J,b1 as Z,cx as R,cy as j,cz as me,cA as he,cB as pe,aH as U,aj as fe,I as ve,t as ge,af as w,cl as be,i as r,Q as I,l as _e,P as Te}from"./defineAppConfig-bSouF0-Z.js";import{I as ye}from"./plus-1Lu360WS.js";import{j as Oe,b as ee,C as te,s as Le}from"./useAddAppToIgnoreListDialogStore-3TvFnIDf.js";import{m as Se,n as Ge,o as we}from"./recent-apps-provider-So7C9hQg.js";import{_ as De}from"./ScheduleEntry.vue_vue_type_script_setup_true_lang-za58xXGl.js";import{u as C}from"./useRequireSecurity-QcrLk1hI.js";import{_ as Ae}from"./SfOptionsButton.vue_vue_type_script_setup_true_lang-nwfY29cQ.js";import{_ as Ee}from"./AppList.vue_vue_type_script_setup_true_lang-eIwO1WOM.js";import{_ as xe}from"./SidebarContentContainer.vue_vue_type_script_setup_true_lang-krO4Fast.js";import{i as ke,b as Ie,c as Ne,a as Ue}from"./schedules-I-CqJJm9.js";import{u as Pe}from"./useWalkthrough-P3Hrl8Zz.js";import{_ as Fe}from"./DurationPreference.vue_vue_type_script_setup_true_lang-7YqzPxZB.js";import"./pencil-outline-vSGnzihw.js";import"./chevron-down-4XWJauDH.js";import"./AppListItem.vue_vue_type_script_setup_true_lang-oxAodo1O.js";import"./useGetAppMetadataQuery-50d_JU5K.js";import"./useVibrantColor-lZfnBXxU.js";import"./sleep-9Kq7Tjeg.js";import"./useIsNewTabPage-fPhgc3yk.js";const W=M("website-limits-on-the-go",()=>{const{state:s}=ne();return{hostnames:s}}),Ce=K({name:"FocusScheduleList",__name:"LotgScheduleList",props:{schedules:{},activeSchedules:{}},setup(s){const n=s,{hostnames:T}=A(W()),{t:c}=Q(),g=Oe(),e=Se(),h=B(),i=ee(),{state:b}=H(),p=Ge(),d=l(()=>b.value==$.Hour24);function L(u,y,a,G){const x=G.map(k=>k.charAt(0).toUpperCase()).join("");return u?x+" - "+c("schedules.allDay"):x+` - ${z(y,{is24HourFormat:d.value})} - ${z(a,{is24HourFormat:d.value})}`}function f(){p.show({onSubmit:O})}const v=C(u=>{p.show({schedule:u,onSubmit:O})});function O(u){h.addLimitsOnTheGoSchedule(u),T.value.length||N()}const S=C(u=>{e.show({title:c("genericConfirmation"),positiveButtonText:c("delete"),negativeButtonText:c("cancel"),destructive:!0,async onClickPositive(){try{await h.removeLimitsOnTheGoSchedule(u)}catch(y){de(y),g.show({message:c("genericError")})}return!0}})});function N(){i.show(X.LimitsOnTheGoRequiredSitesWarning)}return(u,y)=>(_(),E(re,{tag:"ul",name:"fade",class:"grid grid-flow-row gap-4 sm:grid-cols-2",duration:300},{default:P(()=>[(_(!0),F(le,null,ce(n.schedules,a=>(_(),E(De,{key:a.id,id:a.id,"schedule-name":a.name,"schedule-time":L(a.allDay,a.startTime,a.endTime,a.days),"is-active":n.activeSchedules.includes(a.id),onEdit:G=>t(v)(a),onDelete:G=>t(S)(a.id)},null,8,["id","schedule-name","schedule-time","is-active","onEdit","onDelete"]))),128)),(_(),F("button",{class:"h-14 flex items-center justify-center space-x-2 rounded-lg ring-1 ring-base-content ring-opacity-divider ring-inset clickable","data-testid":"add-schedule",key:t(c)("schedules.addSchedule"),onClick:f},[m(t(ye),{class:"icon text-base-content text-opacity-secondary"}),m(D,{tag:"p",keypath:"schedules.addSchedule"})]))]),_:1}))}}),We=M("lotg-schedule",()=>{const{state:s}=ue(),n=te({interval:J}),{state:T}=H(),c=l(()=>ke(n.value,s.value)),g=l(()=>Ie(n.value,s.value)),e=l(()=>g.value==null?[0,0]:Ne(n.value,g.value)),h=l(()=>Z(e.value[1],{is24HourFormat:T.value==$.Hour24})),i=l(()=>Ue(n.value,s.value)),b=l(()=>i.value.map(p=>p.id));return{schedules:s,activeScheduleIds:b,anyScheduleActive:c,displayEnabledUntil:h}});function Me(s,n){return s===R?!1:s===j?!0:n<s}const Be=M("lotg",()=>{const{state:s,mutateAsync:n}=me(),{state:T,mutateAsync:c}=he(),{state:g}=H(),{mutateAsync:e}=pe(),h=te({interval:J}),i=l(()=>Me(s.value,h.value)),b=l(()=>Z(s.value,{is24HourFormat:g.value==$.Hour24}));async function p(){return await e(!0),n(j).catch(v=>{U("Failed to enable limits-on-the-go indefinitely",v)})}const d=B();async function L(v,O){return O?await d.setUserActivatedLotg(!1):await d.setUserActivatedLotg(!0),d.setLotgEnabledUntil(Date.now()+v).catch(S=>{U("Failed to enable lotg for a duration",S)})}async function f(){return await d.setUserActivatedLotg(!1),d.setLotgEnabledUntil(R).catch(v=>{U("Failed to disable lotg",v)})}return{isEnabled:i,enabledUntil:s,displayEnabledUntil:b,coolDownPeriod:T,enableIndefinitely:p,enableFor:L,disable:f,setCoolDownPeriod:c}});function He(){Pe("LOTG","lotg",[{stepName:"limitsOnTheGoEnableManually",selector:"#activate-lotg-button",eventName:"LOTG_ENABLE_MANUALLY",popoverOptions:{side:"left"}},{stepName:"limitsOnTheGoSchedule",selector:'[data-testid="add-schedule"]',eventName:"LOTG_SCHEDULE"},{stepName:"limitsOnTheGoAddWebsites",selector:'[data-testid="add-website"]',eventName:"LOTG_ADD_WEBSITES"}])}function $e(){return fe(ve.LotgSessionManager)}const Re={"data-testid":"lotg-mode",class:"section section-sticky"},je={class:"GenericPref flex space-x-4 py-4 pl-2 items-center"},qe={class:"flex flex-col flex-1 space-y-1"},Ve={class:"text-base-content text-opacity-primary text-lg"},Ye={class:"text-base-content text-opacity-secondary pr-8"},ze={class:"flex-shrink-0 pr-4 items-center content-center"},Ke={key:1},Qe=r("div",{class:"w-1 h-1 overflow-visible relative"},null,-1),Xe={class:"section"},Je={class:"section"},Ze={class:"section"},yt=K({name:"DashboardLimitsOnTheGo",__name:"DashboardLimitsOnTheGo",setup(s){const{schedules:n,activeScheduleIds:T,anyScheduleActive:c,displayEnabledUntil:g}=A(We()),{t:e}=Q(),h=B(),i=Be(),{isEnabled:b,coolDownPeriod:p}=A(i),{hostnames:d}=A(W()),L=ee(),{reportEvent:f}=ge(),v=$e(),O=[{display:e("limitsOnTheGo.option1"),value:1*w},{display:e("limitsOnTheGo.option2"),value:2*w},{display:e("limitsOnTheGo.option3"),value:3*w}],S={id:be.LotgCoolDownPeriod,type:"duration",name:e("limitsOnTheGo.coolDownPeriodTitle"),description:e("limitsOnTheGo.coolDownPeriodDescription"),requirePin:!0,icon:Y,useValue:()=>l({get:()=>p.value,set:async o=>{o!==p.value&&(await i.setCoolDownPeriod(o),o==0?f("LOTG_UNSET_COOLDOWN"):f("LOTG_SET_COOLDOWN",{durationInHours:o/w}))}})};async function N(){f("ENABLED_LOTG_INDEFINITELY"),await i.enableIndefinitely(),k.value&&q()}function u(o){f("ENABLED_LOTG_FOR_DURATION",{durationInHours:o/w}),i.enableFor(o).then(()=>{k.value&&q()})}const y=C(async()=>{await i.disable(),f("LOTG_DISABLE_MANUALLY")}),a=l(()=>c.value?e("limitsOnTheGo.activeUntilMessage",{timeOfDay:g.value}):i.enabledUntil==R?e("limitsOnTheGo.disableMessage"):i.enabledUntil==j?e("limitsOnTheGo.activeMessage"):i.isEnabled?e("limitsOnTheGo.activeUntilMessage",{timeOfDay:i.displayEnabledUntil}):e("limitsOnTheGo.disableMessage"));async function G(o){await h.addLimitsOnTheGoWebsite(o)}async function x(o){await h.removeLimitsOnTheGoWebsite(o),await v.deleteSession(o)}const k=l(()=>b.value&&!d.value.length);function q(){L.show(X.LimitsOnTheGoRequiredSitesWarning)}He();const{hostnames:se}=A(W()),ie=we(),oe=l(()=>se.value.map(o=>({appId:o,platform:ie,disableAppGroups:!0})));return(o,V)=>(_(),E(xe,null,{default:P(()=>[r("section",Re,[m(D,{tag:"h1",class:"dashboard-page-title",keypath:"limitsOnTheGo.title"})]),r("div",je,[r("div",qe,[r("p",Ve,I(t(e)("limitsOnTheGo.activateLimitsOnTheGo")),1),r("p",Ye,I(t(e)("limitsOnTheGo.description")),1)]),r("div",ze,[t(c)?(_(),E(t(Y),{key:0,class:"icon-lg text-primary"})):t(b)?(_(),F("div",Ke,[r("button",{"data-testid":"disable-button",class:"btn btn-neutral",onClick:V[0]||(V[0]=(...ae)=>t(y)&&t(y)(...ae))},I(t(e)("limitsOnTheGo.disable")),1),_e(" This line has been added to make it the same size as the options button. "),Qe])):(_(),E(Ae,{key:2,id:"activate-lotg-button","button-text":t(e)("limitsOnTheGo.activate"),"dropdown-title":t(e)("limitsOnTheGo.optionTitle"),items:O,onClick:N,onClickOption:u},null,8,["button-text","dropdown-title"]))])]),m(Le,{type:"info"},{default:P(()=>[Te(I(t(a)),1)]),_:1}),r("section",Xe,[m(D,{tag:"h2",keypath:"schedules.schedules",class:"section-title"}),m(Ce,{schedules:t(n),"active-schedules":t(T)},null,8,["schedules","active-schedules"])]),r("section",Je,[m(D,{tag:"h2",keypath:"limitsOnTheGo.blockedWebsites",class:"section-title"}),m(Ee,{apps:t(oe),"show-add-button":"","add-app-description":t(e)("limitsOnTheGo.addWebsiteDescription"),onAdd:G,onRemove:x},null,8,["apps","add-app-description"])]),r("section",Ze,[m(D,{tag:"h2",keypath:"settings",class:"section-title"}),m(Fe,{pref:S,"data-testid":"edit-cooldown-button"})])]),_:1}))}});export{yt as default};
