import{getFenElement,debounce}from"../utils.js";!function(){const e=()=>{const e=document.querySelector("span.share");if(null===e)return null;const t=document.querySelector(".study__buttons span.active"),n=(window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft)-(document.clientLeft||0),o=(window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop)-(document.clientTop||0);e.dispatchEvent(new Event("mousedown"));const s=[...document.querySelector(".study__share").querySelectorAll(".form-label")].find((e=>"FEN"===e.textContent))?.nextElementSibling,c=s?.value||null;return t.dispatchEvent(new Event("mousedown")),t.classList.contains("comments")&&window.requestAnimationFrame((()=>{document.activeElement.blur(),window.scroll(n,o)})),c},t=getFenElement();t.setAttribute("fen",e());const n=debounce((()=>{const n=e();n!==t.getAttribute("fen")&&t.setAttribute("fen",n)}),100),o="analyse__tools",s=".analyse__moves",c={childList:!0,attributes:!0,subtree:!0},l=new MutationObserver(((e,t)=>{e.some((e=>"comment"===e.target?.nodeName?.toLowerCase()))||n()})),r=document.querySelector("main.analyse"),u=new MutationObserver(((n,r)=>{n.forEach((n=>{n.removedNodes.forEach((e=>{e.classList.contains(o)&&null===document.querySelector("span.share")&&t.setAttribute("fen",null)})),n.addedNodes.forEach((n=>{if(n.classList.contains(o)){l.disconnect(),t.setAttribute("fen",e());const o=n.querySelector(s);l.observe(o,c)}}))}))})),d=document.querySelector(s);null!==d&&l.observe(d,c),u.observe(r,{childList:!0})}();