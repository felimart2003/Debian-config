/* Copyright 2011 Google Inc. All Rights Reserved. */ (function(){var k=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}},p="function"==typeof Object.defineProperties?Object.defineProperty:function(a,c,b){if(a==Array.prototype||a==Object.prototype)return a;a[c]=b.value;return a},q=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var c=0;c<a.length;++c){var b=a[c];if(b&&b.Math==Math)return b}throw Error("Cannot find global object");
},r=q(this),u=function(a,c){if(c)a:{var b=r;a=a.split(".");for(var d=0;d<a.length-1;d++){var e=a[d];if(!(e in b))break a;b=b[e]}a=a[a.length-1];d=b[a];c=c(d);c!=d&&null!=c&&p(b,a,{configurable:!0,writable:!0,value:c})}};
u("Symbol",function(a){if(a)return a;var c=function(g,h){this.g=g;p(this,"description",{configurable:!0,writable:!0,value:h})};c.prototype.toString=function(){return this.g};var b="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,e=function(g){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new c(b+(g||"")+"_"+d++,g)};return e});
u("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var c="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),b=0;b<c.length;b++){var d=r[c[b]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&p(d.prototype,a,{configurable:!0,writable:!0,value:function(){return v(k(this))}})}return a});
var v=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a},w=function(a,c){a instanceof String&&(a+="");var b=0,d=!1,e={next:function(){if(!d&&b<a.length){var g=b++;return{value:c(g,a[g]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};u("Array.prototype.keys",function(a){return a?a:function(){return w(this,function(c){return c})}});
var x="\" ' ( ) , - . / 0 1 2 : ? a about and are as be but com for from have i in is it like may more my next not of on search that the this to was when with you your".split(" "),y=!1,z={},A={},B=0,C=-1,D=-1,E=!1,F=function(a){a=a.replace(/<[^>]*>/g,"");return a=a.replace(/[<>]/g,"")},G=function(a){a=F(a);return a=a.substring(0,100).toLowerCase()},H=function(a){for(var c=x.length,b=0;b<c;b++)if(a===x[b])return!0;return!1},aa=function(a,c,b){"initialize"===a.type&&b({instanceId:B++})},ba=function(a){"openOptionsPage"===
a.type&&chrome.tabs.create({url:chrome.runtime.getURL("options.html")})},ca=function(a,c,b){"options"===a.type&&b({options:z})},da=function(a,c,b){if("fetch_raw"!==a.type&&"fetch_html"!==a.type)return!1;_gaq&&_gaq.push(["_trackEvent","lookup",a.type]);-1!==C&&D!==a.instanceId&&chrome.tabs.sendMessage(C,{type:"hide",instanceId:D});"fetch_raw"===a.type?(C=c.tab.id,D=a.instanceId):D=C=-1;var d=G(a.query),e=function(){var f={request:a,sanitizedQuery:d,dictRes:null,enDictRes:null,tranRes:null,tabLangTranRes:null,
tabLangTranReqTimedOut:!1,tabLang:null,numResponses:0,callback:b,incognito:!1};I(d,z.language,function(l){f.dictRes=l;J(f)});"en"!==z.language?I(d,"en",function(l){f.enDictRes=l;J(f)}):J(f);K(d,"auto",function(l){f.tranRes=l;J(f)});chrome.tabs.getSelected(null,function(l){f.incognito=l.incognito;var n=window.setTimeout(function(){console.assert(null===f.tabLangTranRes);f.tabLangTranReqTimedOut=!0;J(f)},800);chrome.tabs.detectLanguage(l.id,function(m){f.tabLangTranReqTimedOut||(window.clearTimeout(n),
"und"!==m?(f.tabLang="he"===m?"iw":m,K(d,f.tabLang,function(t){f.tabLangTranRes=t;J(f)})):J(f))})})},g=function(){var f={request:a,sanitizedQuery:d,dictExtResponse:null,isGetTabFailure:!1,tabLangDetectFailure:!1,tabLangDetectTimedOut:!1,tabLang:null,callback:b,incognito:!1},l=window.setTimeout(function(){console.assert(null===f.dictExtResponse);f.tabLangDetectTimedOut=!0;L(d,"",function(n){f.dictExtResponse=n;M(f)})},800);chrome.tabs.getSelected(null,function(n){f.incognito=n.incognito;chrome.tabs.detectLanguage(n.id,
function(m){f.tabLangDetectTimedOut||(window.clearTimeout(l),"und"!==m?(f.tabLang="he"===m?"iw":m,L(d,f.tabLang,function(t){f.dictExtResponse=t;M(f)})):(f.tabLangDetectFailure=!0,L(d,"",function(t){f.dictExtResponse=t;M(f)})))})})};if(y)E?g():e();else{var h=function(f){if(y)return E?g():e();if(10<f)return b({eventKey:a.eventKey,sanitizedQuery:d});window.setTimeout(function(){h(f+1)},200)};h(0)}return!0},I=function(a,c,b){var d=c;"en-uk"==c&&(d="en");var e=window["gdx.LANG_TO_CORPUS"][c];e||(e=c);
a={path:"v1/dictionaryExtensionData",params:{term:a,language:d,corpus:e}};(e=window["gdx.CORPUS_TO_COUNTRY"][e])&&(a.params.country=e);gapi.client.request(a).execute(function(g){var h=g.status;h&&200!=h?b(null):ea(g,b)})},ea=function(a,c){if(a=N(a,"dictionaryData[0]")){var b=function(e){if(!e.senseFamilies)return 0;e=e.senseFamilies;for(var g=e.length,h=0;h<e.length;h++)e[h].senses&&(g+=.1*e[h].senses.length);return g},d=function(e,g){return b(g)-b(e)};a.entries&&(a.entries=a.entries.sort(d));a.webDefinitions&&
(a.hasWebDefinitions=!0);c(a)}else c(null)},K=function(a,c,b){a="https://clients5.google.com/translate_a/single?dj=1&dt=t&dt=sp&dt=ld&dt=bd&client=dict-chrome-ex&sl="+c+"&tl="+z.language+"&q="+encodeURIComponent(a);var d=new XMLHttpRequest;d.open("GET",a,!0);d.onload=function(){var e=null;if(200===this.status)try{e=JSON.parse(d.response)}catch(g){}return b(e)};d.send()},L=function(a,c,b){var d=z.language,e=d;"en-uk"==d&&(e="en");var g=window["gdx.LANG_TO_CORPUS"][d];g||(g=d);a={path:"v1/dictionaryExtensionData",
params:{term:a,language:e,corpus:g,strategy:2}};(g=window["gdx.CORPUS_TO_COUNTRY"][g])&&(a.params.country=g);c&&(a.params.tab_language=c);gapi.client.request(a).execute(function(h){var f=h.status;f&&200!=f?b(null):b(h)})},J=function(a){a.numResponses++;if(4===a.numResponses){var c=O(a.dictRes),b=c;"en"!==z.language&&(b=O(a.enDictRes));var d=P(a.tranRes,!0),e=P(a.tabLangTranRes,!0),g=z.language.toLowerCase(),h=!1,f=null,l=null;e&&a.tabLang!==g?(h=!0,f=a.tabLangTranRes,l=e):!c&&d&&(h=!0,f=a.tranRes,
l=d);(a.preferTran=h)&&b&&b.audio&&"en"===l.srcLang.toLowerCase()&&(l.audio=b.audio);b=h?"translation":"definition";c||l||(b="none");_gaq&&_gaq.push(["_trackEvent","lookup","type_"+b]);e=encodeURIComponent(a.sanitizedQuery);d=b="";h&&(b=Q(l.srcLang,e),d=l.audio);e=R(e);"fetch_html"===a.request.type?S(a,a.dictRes,f,d,e,b):(f=null,h?(f=l,f.moreUrl=b):c&&(f=c,f.moreUrl=e,f.srcLang=z.language),T(a,f))}},S=function(a,c,b,d,e,g){a.preferTran?(c=E?U(b,!1):P(b,!1))?(d&&(c.audio=d),b.tranResSummary=c,b.moreUrl=
g,E&&(b.dict=b.bilingualDictionary),b.hasDict=!!b.dict&&b.dict.length,b=A.browser_action_tran(b)):b="":b=fa(c,e);a.callback({eventKey:a.request.eventKey,sanitizedQuery:a.sanitizedQuery,html:b})},T=function(a,c){var b=null;c&&"true"===z.storeHistory&&!a.incognito&&chrome.storage.local.get("word-history",function(e){b=c.srcLang+"<"+z.language+"<"+a.sanitizedQuery;e["word-history"][b]=c.meaningText;chrome.storage.local.set(e)});c&&!c.prettyQuery&&(c.prettyQuery=a.sanitizedQuery);var d=!1;("true"===z.popupDblclick&&
"none"===z.popupDblclickKey||"true"===z.popupSelect&&"none"===z.popupSelectKey)&&H(a.sanitizedQuery)&&(d=!0);a.callback({eventKey:a.request.eventKey,sanitizedQuery:a.sanitizedQuery,meaningObj:c,showOptionsTip:d})},M=function(a){var c=a.dictExtResponse,b="none",d=null;c&&200===c.status&&c.translateResponse?(b="translation",a.preferTran=!0,a.translateResponse=c.translateResponse,(d=U(c.translateResponse,!0))&&c.oxfordAudio&&(d.audio=V(c.oxfordAudio))):c&&200===c.status&&c.dictionaryData&&(b="definition",
a.dictResponse=c.dictionaryData[0],d=O(a.dictResponse));d||(b="none");_gaq&&_gaq.push(["_trackEvent","lookup","type_"+b]);var e=encodeURIComponent(a.sanitizedQuery),g=c="";"translation"===b?(c=Q(d.srcLang,e),d.moreUrl=c):"definition"===b&&(g=R(e),d.moreUrl=g);"fetch_html"===a.request.type?(b="",d&&(b=d.audio),S(a,a.dictResponse,a.translateResponse,b,g,c)):("definition"===b&&(d.srcLang=z.language),T(a,d))},R=function(a){var c=z.language;var b=(b=window["gdx.LANG_TO_DEFINE"][c])?b.replace("${term}",
a):"";var d=window["gdx.LANG_TO_CORPUS"][z.language];d||(d=z.language);a="https://www.google.com/search?dictcorpus="+d+"&hl="+c+"&forcedict="+a+"&q="+b;"en-uk"===c&&(a+="&gl=gb");return a},Q=function(a,c){return"https://translate.google.com/translate_t?source=dict-chrome-ex&sl="+a+"&tl="+z.language+"&q="+c},P=function(a,c){if(!a||!a.sentences||0===a.sentences.length||a.sentences[0].orig.toLowerCase()==a.sentences[0].trans.toLowerCase())return null;var b=a.sentences[0].orig.toLowerCase(),d=a.sentences[0].trans.toLowerCase();
c=c?W(b,d,a.dict):d;(b=window["gdx.LANG_TO_NAME"][a.src.toLowerCase()])||(b=a.src);return{type:"translation",meaningText:c,attribution:"Translated from "+b,srcLang:a.src}},U=function(a,c){if(!a||!a.translateText||0===a.translateText.length)return null;var b=a.sourceText.toLowerCase(),d=a.translateText.toLowerCase();c=c?W(b,d,a.bilingualDictionary):d;a=a.detectedSourceLanguage;(b=window["gdx.LANG_TO_NAME"][a.toLowerCase()])||(b=a);return{type:"translation",meaningText:c,attribution:"Translated from "+
b,srcLang:a}},W=function(a,c,b){var d=c;if(b)for(var e=b.length,g=0;g<e;g++)for(var h=b[g],f=0,l=h.terms.length,n=0;n<l&&2>f;n++){var m=h.terms[n].toLowerCase();0<m.length&&m!==a&&m!==c&&(d+=", "+m,f++)}return F(d)},N=function(a,c){c=c.split(".");for(var b=0;b<c.length;b++){var d=c[b];console.assert(d);if("]"===d.charAt(d.length-1)){d=d.split("[");console.assert(2===d.length);var e=parseInt(d[1].slice(0,-1),10);a=a[d[0]];if(!a)return null;a=a[e]}else a=a[d];if(!a)return null}return a},V=function(a){return"//"===
a.substr(0,2)?"https:"+a:a},O=function(a){if(!a||a.error)return null;var c,b=null;if(c=N(a,"entries[0]"))b={prettyQuery:c.syllabifiedHeadword||c.headword,meaningText:N(c,"senseFamilies[0].senses[0].definition.text"),attribution:"",audio:N(c,"phonetics[0].oxfordAudio"),type:"licensedDef"},b.meaningText?b.audio&&(b.audio=V(b.audio)):b=null;!b&&(c=N(a,"webDefinitions[0]"))&&(b=c.sourceUrl,b={meaningText:c.definition,attribution:'<a href="'+b+'">'+b+"</a>",type:"webDef"});if(!b)return null;c=b.meaningText;
b.meaningText=c.charAt(0).toUpperCase()+c.slice(1);return b},fa=function(a,c){if(!a||a.error)return"";a.moreUrl=c;a.makeAudioUrl=function(){var d=this.oxfordAudio;return d?V(d):""};var b={};a.showOnlyOnce=function(){return function(d,e){d=e(d);if(b[d])return"";b[d]=!0;return d}};return A.browser_action_dict(a)},ha=function(a){var c={};c.language=a.language||"en";var b=function(e,g){var h=a[e];c[e]=g;"true"===h||"false"===h?c[e]=h:"boolean"===typeof h&&(c[e]=String(h))},d=function(e,g){c[e]=a[e]||
g};b("popupDblclick","true");b("popupSelect","false");b("enableHttps","true");d("popupDblclickKey","none");d("popupSelectKey","ctrl");b("storeHistory","false");b("allowCrossExtensionHistory","false");"pt"===a.language&&(c.language="pt-BR");return c},ia=function(a,c,b){if("false"===z.allowCrossExtensionHistory||"false"===z.storeHistory||!a||!a.getHistory)return!1;chrome.storage.local.get("word-history",function(d){b(d["word-history"])});return!0},X=function(a,c){var b=new XMLHttpRequest;b.open("GET",
a,!0);b.onload=function(){var d=null;200===this.status&&(d=b.response);return c(d)};b.send()},Y=function(){10>Math.floor(1E3*Math.random())&&(E=!0);var a=window.localStorage.options,c={};a&&(c=JSON.parse(a));z=ha(c);window.localStorage.options=JSON.stringify(z);chrome.storage.local.get("word-history",function(b){b["word-history"]||chrome.storage.local.set({"word-history":{}})});chrome.runtime.onMessage.addListener(aa);chrome.runtime.onMessage.addListener(ba);chrome.runtime.onMessage.addListener(ca);
chrome.runtime.onMessage.addListener(da);chrome.runtime.onMessageExternal.addListener(ia)};window["gdx.updateOptions"]=function(){z=JSON.parse(window.localStorage.options)};
window.initBackgroundPageAsync=function(a){gapi.config.update("googleapis.config/root","https://dictionaryextension-pa.googleapis.com");gapi.client.setApiKey("AIzaSyA6EEtrDCfBkHV8uU2lgGY-N383ZgAOo7Y");var c=function(){2>Object.keys(A).length||(y=!0,a&&a())},b=function(d){Mustache.parse(d);return function(e){return Mustache.render(d,e)}};X("templates/browser_action_dict.html",function(d){A.browser_action_dict=b(d);c()});X("templates/browser_action_tran.html",function(d){A.browser_action_tran=b(d);
c()})};window.initBackgroundPage=Y;var Z=Z||!1;Z||Y();})();
