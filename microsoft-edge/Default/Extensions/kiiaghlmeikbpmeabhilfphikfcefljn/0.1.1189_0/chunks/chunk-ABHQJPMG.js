import{a as tn,b as J,c as Oe,d as _e,e as on,f as mt,g as yt}from"./chunk-3H7UDER3.js";import{a as nn}from"./chunk-J6ZEYYTG.js";import{$ as wi,A as ct,Aa as Jo,B as No,Ba as $e,C as Eo,F as Fo,G as zo,H as Qi,I as $o,L as Oo,M as Lo,N as Bo,O as ki,Q as Oi,S as Ji,T as Mo,W as qo,Y as ae,Z as Ho,_ as Wo,aa as Si,b as go,ba as Uo,c as Ei,ca as Vo,d as B,e as oe,ea as Ai,fa as dt,ga as jo,i as Ns,ia as Go,j as fi,ja as Yo,k as Ki,ka as Ne,l as _i,la as Ie,m as vo,ma as Pe,n as Ri,na as De,o as Re,oa as Ee,pa as re,q as xo,qa as Fe,r as Ae,ra as ze,s as se,t as ut,u as Co,ua as Ko,v as To,w as lt,wa as bt,x as Ro,y as So,ya as Li,z as Ao,za as Qo}from"./chunk-XRJW3LFT.js";import{a as Io}from"./chunk-K3HP5COO.js";import{a as Ce,b as Te,e as Po,f as Do,g as pt}from"./chunk-523WHQDT.js";import{a as ne}from"./chunk-2MCFUH3Z.js";import{a as Zo,h as en}from"./chunk-EHJWBWMG.js";import{a as Xo}from"./chunk-BWSZUVAY.js";import{a as Se}from"./chunk-5Q7VJYCY.js";import{a as Cs}from"./chunk-SSIZTBZJ.js";import{a as ji,b as uo}from"./chunk-X7CFCWZC.js";import{a as vs}from"./chunk-P4L2RRIA.js";import{a as fo}from"./chunk-G2MGIWVK.js";import{a as As}from"./chunk-XEDCPNRR.js";import{a as ho}from"./chunk-YZTZIJSB.js";import{a as D}from"./chunk-YU5QULAP.js";import{a as xe}from"./chunk-DGHEKRNY.js";import{a as Z,d as po}from"./chunk-O7OTS7RM.js";import{a as _t}from"./chunk-D2CCZ3BJ.js";import{a as ko}from"./chunk-7YV4JAJK.js";import{a as S,b as ve,c as C,d as Ts,e as Rs,g as bo,h as mo,m as bi,n as yo,o as Ti,p as wo}from"./chunk-R5NGUZ66.js";import{a as Ss}from"./chunk-O4TFJKJQ.js";import{c as g,e as lo,k as N,m as u,q as co,s as ge,t as Yi,u as x}from"./chunk-JJTF2C25.js";import{O as Gi,P as rt,a as Q,c as xs,r as te}from"./chunk-3HBOA5LN.js";import{c as at,e as _}from"./chunk-3GYLW4KZ.js";var kt=at(We=>{"use strict";Object.defineProperty(We,"__esModule",{value:!0});We.Collapse=void 0;var Me=Object.assign||function(n){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},Fs=function(){function n(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}return function(i,t,e){return t&&n(i.prototype,t),e&&n(i,e),i}}(),zs=S(),He=yn(zs),$s=bo(),ui=yn($s),mn=_t();function yn(n){return n&&n.__esModule?n:{default:n}}function Os(n,i){var t={};for(var e in n)i.indexOf(e)>=0||Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t}function Ls(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}function Bs(n,i){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&(typeof i=="object"||typeof i=="function")?i:n}function Ms(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}var qs=1,qe="WAITING",bn="RESIZING",wn="RESTING",Bi="IDLING",ft=function(){return null},Hs={collapse:"ReactCollapse--collapse",content:"ReactCollapse--content"},hn=We.Collapse=function(n){Ms(i,n);function i(t){Ls(this,i);var e=Bs(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return Ws.call(e),e.state={currentState:Bi,from:0,to:0},e}return Fs(i,[{key:"componentDidMount",value:function(){var e=this.props,o=e.isOpened,s=e.forceInitialAnimation,a=e.onRest;if(o){var r=this.getTo();if(s){var l=this.wrapper.clientHeight;this.setState({currentState:bn,from:l,to:r})}else this.setState({currentState:Bi,from:r,to:r})}a()}},{key:"componentWillReceiveProps",value:function(e){e.hasNestedCollapse?e.isOpened!==this.props.isOpened&&this.setState({currentState:qe}):this.state.currentState===Bi&&(e.isOpened||this.props.isOpened)&&this.setState({currentState:qe})}},{key:"componentDidUpdate",value:function(e,o){var s=this.props,a=s.isOpened,r=s.onRest,l=s.onMeasure;if(this.state.currentState===Bi){r();return}o.to!==this.state.to&&l({height:this.state.to,width:this.content.clientWidth});var c=this.wrapper.clientHeight,p=a?this.getTo():0;if(c!==p){this.setState({currentState:bn,from:c,to:p});return}(this.state.currentState===wn||this.state.currentState===qe)&&this.setState({currentState:Bi,from:c,to:p})}},{key:"componentWillUnmount",value:function(){cancelAnimationFrame(this.raf)}},{key:"render",value:function(){return He.default.createElement(mn.Motion,Me({},this.getMotionProps(),{onRest:this.onRest,children:this.renderContent}))}}]),i}(He.default.PureComponent);hn.propTypes={isOpened:ui.default.bool.isRequired,springConfig:ui.default.objectOf(ui.default.number),forceInitialAnimation:ui.default.bool,hasNestedCollapse:ui.default.bool,fixedHeight:ui.default.number,theme:ui.default.objectOf(ui.default.string),style:ui.default.object,onRender:ui.default.func,onRest:ui.default.func,onMeasure:ui.default.func,children:ui.default.node.isRequired};hn.defaultProps={forceInitialAnimation:!1,hasNestedCollapse:!1,fixedHeight:-1,style:{},theme:Hs,onRender:ft,onRest:ft,onMeasure:ft};var Ws=function(){var i=this;this.onContentRef=function(t){i.content=t},this.onWrapperRef=function(t){i.wrapper=t},this.onRest=function(){i.raf=requestAnimationFrame(i.setResting)},this.setResting=function(){i.setState({currentState:wn})},this.getTo=function(){var t=i.props.fixedHeight;return t>-1?t:i.content.clientHeight},this.getWrapperStyle=function(t){if(i.state.currentState===Bi&&i.state.to){var e=i.props.fixedHeight;return e>-1?{overflow:"hidden",height:e}:{height:"auto"}}return i.state.currentState===qe&&!i.state.to?{overflow:"hidden",height:0}:{overflow:"hidden",height:Math.max(0,t)}},this.getMotionProps=function(){var t=i.props.springConfig;return i.state.currentState===Bi?{defaultStyle:{height:i.state.to},style:{height:i.state.to}}:{defaultStyle:{height:i.state.from},style:{height:(0,mn.spring)(i.state.to,Me({precision:qs},t))}}},this.renderContent=function(t){var e=t.height,o=i.props,s=o.isOpened,a=o.springConfig,r=o.forceInitialAnimation,l=o.hasNestedCollapse,c=o.fixedHeight,p=o.theme,b=o.style,y=o.onRender,h=o.onRest,m=o.onMeasure,w=o.children,f=Os(o,["isOpened","springConfig","forceInitialAnimation","hasNestedCollapse","fixedHeight","theme","style","onRender","onRest","onMeasure","children"]),k=i.state,T=k.from,I=k.to;return y({current:e,from:T,to:I}),He.default.createElement("div",Me({ref:i.onWrapperRef,className:p.collapse,style:Me({},i.getWrapperStyle(Math.max(0,e)),b)},f),He.default.createElement("div",{ref:i.onContentRef,className:p.content},w))}}});var vn=at(Ue=>{"use strict";Object.defineProperty(Ue,"__esModule",{value:!0});Ue.UnmountClosed=void 0;var Us=Object.assign||function(n){for(var i=1;i<arguments.length;i++){var t=arguments[i];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e])}return n},Vs=function(){function n(i,t){for(var e=0;e<t.length;e++){var o=t[e];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(i,o.key,o)}}return function(i,t,e){return t&&n(i.prototype,t),e&&n(i,e),i}}(),js=S(),fn=gn(js),Gs=bo(),kn=gn(Gs),Ys=kt();function gn(n){return n&&n.__esModule?n:{default:n}}function Ks(n,i){var t={};for(var e in n)i.indexOf(e)>=0||Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e]);return t}function Qs(n,i){if(!(n instanceof i))throw new TypeError("Cannot call a class as a function")}function Js(n,i){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return i&&(typeof i=="object"||typeof i=="function")?i:n}function Xs(n,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof i);n.prototype=Object.create(i&&i.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(n,i):n.__proto__=i)}var Zs=Ue.UnmountClosed=function(n){Xs(i,n);function i(t){Qs(this,i);var e=Js(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t));return e.componentWillReceiveProps=function(o){var s=o.isOpened;!e.props.isOpened&&s&&e.setState({forceInitialAnimation:!0,shouldUnmount:!1})},e.onRest=function(){var o=e.props,s=o.isOpened,a=o.onRest;s||e.setState({shouldUnmount:!0}),a&&a.apply(void 0,arguments)},e.state={shouldUnmount:!e.props.isOpened,forceInitialAnimation:!e.props.isOpened},e}return Vs(i,[{key:"render",value:function(){var e=this.props,o=e.isOpened,s=e.onRest,a=Ks(e,["isOpened","onRest"]),r=this.state,l=r.forceInitialAnimation,c=r.shouldUnmount;return c?null:fn.default.createElement(Ys.Collapse,Us({forceInitialAnimation:l,isOpened:o,onRest:this.onRest},a))}}]),i}(fn.default.PureComponent);Zs.propTypes={isOpened:kn.default.bool.isRequired,onRest:kn.default.func}});var Cn=at((pr,xn)=>{"use strict";var ia=kt(),ea=ia.Collapse,ta=vn(),Ve=ta.UnmountClosed;Ve.Collapse=ea;Ve.UnmountClosed=Ve;xn.exports=Ve});var an=_(te()),oi=_(Q());var ii=n=>co("rooPouch",n);rt();uo();var Ni=!1,wt=g.select("couponView"),rn=n=>wt.set("currentCouponCode",n);async function _n(){x("track","rooCancelled",{url:document.URL}),await ii({action:"cancel"}),Ni=!1}function un(n){let{originalCoupons:i,bestCoupon:t,preappliedCodes:e}=n;return t&&e?oi.default.find(i,o=>o.code.toLowerCase()===t.toLowerCase()):!0}async function ln({disableAffiliate:n,ignoreCancelled:i,coupons:t,automaticCouponsRun:e,autoFallback:o,passedInClickId:s,couponRunId:a,cashback:r,manuallyActivatedFallback:l,manuallyActivatedSameTabReload:c}){Ni=!0;let p=g.get("couponNotif")==="siteHub",b=s||an.default.v4().replace(/-/g,""),y=N();n||Ne(b),c||x("track","tryCoupons",{clickId:b,redirectId:Gi(b),couponRunId:a,cashback:r,triggerType:De({automaticCouponsRun:e||oi.default.get(g.get("couponView"),"manuallyActivatedAutoRun"),autoFallback:o,isSiteHub:p,manuallyActivatedFallback:l}),couponScriptType:"roo",currentLocation:oi.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),(o||p)&&sessionStorage.setItem("__r_reload_auto","true");let h=await ne(y),m=g.get(["userCouponChecks",y]);await Se.run({callSource:"coupons_start"});let w=new Date().getTime(),f=oi.default.get(h,"siteData.coupons.script"),k=await Go(y,h,m);k&&(t.pop(),t.push(oi.default.clone(k)));let T=ct(),I=oi.default.cloneDeep(t);!e&&T&&(I=oi.default.concat(t,T),I=oi.default.uniqBy(I,M=>M.code.toLowerCase())),await ii({action:"init",ignoreCancelled:o||i,coupons:I,script:f,store:{cashback:r,clickId:b,couponRunId:a,isSiteHub:p,automaticCouponsRun:e,autoFallback:o,couponStartTime:w,manuallyActivatedFallback:l}});let P=await ii({action:"next"});if(!P)return;let z=new Date().getTime();!e&&f.initialAction?(lt(f.initialAction),f.initialActionDelay&&await Ae(f.initialActionDelay)):!e&&f.disableInitialPromoRemove!==!0&&f.promoRemoveAction&&se(f.promoRemoveAction)&&(lt(f.promoRemoveAction),f.postRemoveDelay&&await Ae(f.postRemoveDelay));let $=new Date().getTime()-z||0;await ii({action:"initialAction",initialActionTime:$});let A=await ht(P,{onTryCode:rn});A&&(sessionStorage.getItem("__r_reload_auto")&&sessionStorage.removeItem("__r_reload_auto"),A.automaticCouponsRun=e,A.autoFallback=o,A.isSiteHub=p,A.manuallyActivatedAutoRun=g.get("couponView","manuallyActivatedAutoRun"),A.manuallyActivatedFallback=l,A.couponRunId=a,A.cashback=r,A.originalCoupons=t,A.preappliedCodes=T,A.couponScriptType="roo",f.useCodeEntered&&A.codeEntered&&!A.savings&&(A.requiresInput=f.codeEnteredAction?!!se(f.codeEnteredAction):!0),A.startTime=w,A.duration=new Date().getTime()-w,un(A)||(A.savings=0),await re({result:A,clickId:b})),Ni=!1}function Ua(n){return new Promise(async(i,t)=>{let e=N(),o=await ne(e),s={domain:e,coupons:oi.default.get(o,"siteData.coupons")},{script:a,coupons:r,ignoreAffiliate:l}=s.coupons;if((l||g.get(["couponsAffiliateDisabledSites",`${e}_${g.get("tabId")}`])>ji()||g.get(["couponsAffiliateDisabledSites",`${e}_all`])>ji())&&wt.set("disableAffiliate",!0),!await No(s.coupons.script))return;let p;Re()&&(p=!0);let b=ct(),y={coupons:r,preappliedCodes:b,standDown:p,roo:!0,estimatedRunTime:25e3,runTimePerCoupon:(a.getTotalDelay||0)+(a.preApplyDelay||0)+(a.postRemoveDelay||0),couponCount:r.length,disableAffiliate:l,affiliateLinkCurrentTab:oi.default.get(o,"meta.affiliate_link_current_tab"),autoCoupConfig:oi.default.get(o,"siteData.coupons.config.auto_coup")};u("user_contributed_codes")&&Is(a),await ii({action:"pageLoad"});let h=await ii({action:"next"});if(h){if(Ni=!0,h.action==="cancelled")return;let m=await ii({action:"nextCode"});oi.default.assign(y,{disableDelay:!!m,rooRunning:!0,currentCouponCode:m}),g.set("couponsConfig",y),i(y);let w=await ht(h,{onTryCode:rn});if(w){a.useCodeEntered&&w.codeEntered&&!w.savings&&(w.requiresInput=a.codeEnteredAction?!!se(a.codeEnteredAction):!0);let{clickId:f,couponRunId:k,isSiteHub:T,automaticCouponsRun:I,autoFallback:P,cashback:z,couponStartTime:$,manuallyActivatedFallback:A}=w.store;w.isSiteHub=T,w.automaticCouponsRun=I,w.autoFallback=P,w.manuallyActivatedAutoRun=g.get("couponView","manuallyActivatedAutoRun"),w.manuallyActivatedFallback=A,w.couponRunId=k,w.originalCoupons=r,w.preappliedCodes=b,w.couponScriptType="roo",w.cashback=z,w.startTime=$,w.duration=w.runTime,un(w)||(w.savings=0),await re({result:w,clickId:f})}await fi("rooReloading")&&await _i("rooReloading"),sessionStorage.getItem("__r_reload_auto")&&sessionStorage.removeItem("__r_reload_auto"),wt.set("rooRunning",!1)}else x("track","couponCheck"),g.set("couponsConfig",y),i(y)})}async function ht(n,i){let{onTryCode:t=null}=i;Ni=!0;try{if(n.action==="tryCode"){t&&!n.applyingBestCode&&t(n.code);let o,s=0;if(n.applyingBestCode&&n.auto)o=n.code;else{let a=new Date().getTime();o=await So(n.script,n.code);let r=new Date().getTime()-a;s=n.aggApplyCodeTime+r}await ii({action:"saveCoupon",coupon:o,aggApplyCodeTime:s})}else if(n.action==="getDiscount"){let o=new Date().getTime(),s=await Ao(n.script),a=new Date().getTime()-o,r=n.aggGetTotalTime+a;await ii({action:"saveDiscount",discount:s,aggGetTotalTime:r})}else if(n.action==="getTotal"){let o=new Date().getTime(),s=await Co(n.script,n.options),a=new Date().getTime()-o,r=n.aggGetTotalTime+a;await ii({action:"saveTotal",total:s,aggGetTotalTime:r})}else if(n.action==="codeEntered"){let o=await To(n.script);await ii({action:"saveCodeEntered",codeEntered:o})}else if(n.action==="removePrevious"){let o=new Date().getTime();await Ki("rooReloading",!0);let s=await Ro(n.script,n.lastCodeHadSavings),a=new Date().getTime()-o,r=n.aggRemovePreviousTime+a;await ii({action:"codeRemoved",removed:s,aggRemovePreviousTime:r})}else{if(n.action==="finish")return Ni=!1,n.result;if(n.action==="error")throw Ni=!1,new Error(n.error.message);if(n.action==="cancelled"){Ni=!1;return}else if(n.action==="wait"){let o=new Date().getTime();await Ki("rooReloading",!0),await Ae(1e4);let s=new Date().getTime()-o,a=n.aggWaitForReloadTime+s;await ii({action:"pageLoad",aggWaitForReloadTime:a})}}let e=await ii({action:"next"});return e?await ht(e,i):void 0}catch(e){let o=e.stack.split(`
`),s=(o[0]+o[1]).match(/(.*)\s\(/)[1];return x("track","rooError",{message:s,url:document.URL}),await ii({action:"error"})}}async function sn(n){if(!Ni){let i=ut(n);if(i){let t=i.value;if(oi.default.get(t,"length")){let e="userContributedCode";await Io({action:"getHoneyState",comp:"honey"})&&(e="userContributedCodeH"),x("track",e,{code:t})}}}}async function Is(n){try{if(n.promoApplyAction){let i=se(n.promoApplyAction);i&&i.addEventListener("click",async e=>{await sn(n)});let t=ut(n);t&&t.addEventListener("keydown",async e=>{if(e.code==="Enter"){let o=sn.bind(n);oi.default.debounce(o,200)}})}}catch{}}var Xi=_(Q());var Le=_(Ns());var tr=_(Ss());uo();var Ps=g.select("couponView");function Ds(){return N()==="ebay.com"&&g.get(["selfStandDown",`${N()}_${g.get("tabId")}`])}async function Es(n){let i=document.createElement("iframe");i.src=n,i.style="position: fixed; top: 0; left: 0; border: 0; background: transparent;",i.width=1,i.height=1,i.setAttribute(`data-${g.get("pageViewId")}`,!0),document.body.appendChild(i),await(0,Le.setupIframeMessenger)(i)}async function cn(n={}){return Ee({...n,isAsyncTigger:!0})}async function _r(n={}){let i=N(),t=await ne(i);await bt(t)||await new Promise((T,I)=>{Se.emitter.on("result",async P=>{let z=await bt(t);z&&T(z)})});let{coupons:o,ignoreAffiliate:s}=Xi.default.get(t,"siteData.coupons",{}),a=o&&o.length,r=!1,l=!1,c=!1,p=o&&o.length&&Ds();p&&lo({active:!0}),(s||g.get(["couponsAffiliateDisabledSites",`${i}_${g.get("tabId")}`])>ji()||g.get(["couponsAffiliateDisabledSites",`${i}_all`])>ji())&&!p&&(Ps.set("disableAffiliate",!0),r=!0),Re()&&!p&&(l=!0),Ko({siteAPIData:t,domain:i}),x("track","couponCheck");let b,y;(0,Le.setConfig)(xo);let h=`${po}?site=${Xi.default.get(t,"siteData.tld")}`;if(!a)return c;await Es(h);let m;try{let k=await fi("couponRun");if(m=JSON.parse(k),m){let T={domain:i},{savings:I,originalTotal:P}=await vo(T);m.result.savings=I,m.result.originalTotal=P,m.result.pageReload=void 0,await _i("couponRun")}}catch{_i("couponRun")}y&&(o=[],a=y),c={coupons:o,estimatedRunTime:b,disableAffiliate:r,couponCount:a,affiliateLinkCurrentTab:Xi.default.get(t,"meta.affiliate_link_current_tab"),pageWasReloaded:!!m,standDown:l,standDownOverride:p,autoCoupConfig:Xi.default.get(t,"siteData.coupons.config.auto_coup")};let w=g.get("couponsConfig");return Xi.default.get(w,"pageWasReloaded")&&(c.pageWasReloaded=!0),g.set("couponsConfig",c),m&&re(m),c}var ms=_(S());var ys=_(Ts()),ws=_(te()),hs=_(S()),et=_(_t());var d=_(Q()),fe=_(xs());var pn=({displayable:n})=>typeof n=="boolean"?n:!0,Zi=n=>n&&n.filter(pn),Be=n=>{let i={...n,coupons:Zi(n.coupons)};if((i.couponCount&&n.coupons&&i.coupons?n.coupons.length-i.coupons.length:0)>0&&(i.couponCount=i.coupons?.length),i.autoFallback&&(i.autoFallback={...i.autoFallback,coupons:Zi(i.autoFallback.coupons)},(i.autoFallback.autoFallbackCouponsCount&&n.autoFallback?.coupons&&i.autoFallback.coupons?n.autoFallback.coupons.length-i.autoFallback.coupons.length:0)>0&&(i.autoFallback.autoFallbackCouponsCount=i.autoFallback.coupons?.length)),i.result){let e=(i.result.allCoupons??[]).reduce((o,s)=>pn(s)?o:{...o,[s.code]:!0},{});i.result={...i.result,allCoupons:Zi(i.result.allCoupons),coupons:Zi(i.result.coupons)},i.result.coupons&&Object.keys(e).length>0&&(i.result.coupons=i.result.coupons.filter(({code:o})=>!(o in e)))}return i};var Jt=_(S()),es=_(S());var br=_(S()),Tn=_(S()),gt=_(Q()),Rn=_(Cn());function li(n){var i=document.createElement("textarea");i.style.position="fixed",i.style.top=0,i.style.left=0,i.style.width="1px",i.style.height="1px",i.style.padding=0,i.style.border="none",i.style.outline="none",i.style.boxShadow="none",i.style.background="transparent",i.value=n,document.body.appendChild(i),i.select();let t=!1;try{t=document.execCommand("copy")}catch{}return document.body.removeChild(i),t}var ni=_(C()),ue=class extends Tn.Component{constructor(...i){super(...i),this.state={copied:!1}}render(){let i=this.props.coupon,t=this.props.result&&!this.props.running;return(0,ni.jsx)("div",{className:this.state.copied?"copied":"",children:(0,ni.jsxs)("div",{className:"coupon-list-item-container",onClick:this.onClickCopy.bind(this),children:[(0,ni.jsx)("div",{className:"details",children:(0,ni.jsx)("h4",{className:`code midnight bold ${this.props.noScript?"noscript":""}`,children:i.code})}),(0,ni.jsxs)("div",{className:"savings",children:[this.state.copied?(0,ni.jsx)("span",{className:"copied-text",children:"Copied"}):null,i.success&&!this.props.disableChecks?(0,ni.jsx)("svg",{viewBox:"0 0 150 150",children:(0,ni.jsx)("path",{d:"M10,30 l30,50 l95,-70",fill:"none",strokeWidth:"15",style:{stroke:"#0276b1",strokeDasharray:"180px, 180px",strokeDashoffset:"0px",animationDelay:t?"0ms":`${this.props.stagger*this.props.index}ms`}})}):null]})]})})}onClickCopy(){let i=J();this.setState({copied:li(this.props.coupon.code)},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),x("trackClick","copyCouponCode","code",{clickId:i})}componentWillUnmount(){clearTimeout(this.timeoutId)}};ue.defaultProps={stagger:400};function ie(n){return n.collapsable?(0,ni.jsx)(Rn.default,{isOpened:!!n.show,className:"collapse",children:(0,ni.jsx)("div",{className:`code-list ${n.className||""}`,children:gt.default.map(n.coupons,(i,t)=>(0,ni.jsx)(ue,{running:n.running,result:n.result,index:t,coupon:i,stagger:n.stagger,disableChecks:n.disableChecks,noScript:n.noScript},t))})}):(0,ni.jsx)("div",{className:`code-list ${n.className||""}`,children:gt.default.map(n.coupons,(i,t)=>(0,ni.jsx)(ue,{running:n.running,result:n.result,index:t,coupon:i,stagger:n.stagger,disableChecks:n.disableChecks,noScript:n.noScript},t))})}var E=_(Q());var Sn=_(S());var An=_(S());var ce=_(Q());var xr=_(S()),vt=_(C()),oa=n=>{let i=n.h||60,t=n.w||76;return(0,vt.jsx)("svg",{className:"checkmark-icon",width:t,height:i,viewBox:"0 0 76 60",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,vt.jsx)("path",{d:"M24.323 57.46h0L2.668 35.91l-.002-.002a.79.79 0 01-.235-.563v-.005c0-.217.08-.412.232-.565l.001-.001 5.862-5.86s0 0 0 0a.787.787 0 01.565-.235h.002a.78.78 0 01.562.235h0L23.77 43.027l1.061 1.06 1.06-1.06L66.378 2.541h.001a.785.785 0 01.512-.233 1.5 1.5 0 01.364.088.73.73 0 01.251.147l.001.001 5.836 5.898h0a.8.8 0 01-.003 1.123l1.06 1.06-1.06-1.06L25.447 57.46a.788.788 0 01-.562.231.79.79 0 01-.562-.23z",strokeWidth:"3"})})},le=oa;var R=_(C()),xt=class extends An.Component{constructor(...i){super(...i),this.state={viewCodes:!1}}componentDidMount(){let i=B(N());if(u("coup_modal_auto_dismiss")&&!i){let t=this.props.reward?5e3:3e3;setTimeout(()=>this.props.onClosePopup(),t)}}render(){let{runTimeSeconds:i,couponCount:t,reward:e,codes:o,postCoupons:s,requiresInput:a,view:r}=this.props,l=e&&e.amount&&!e.categories&&!s&&!r.hasDeferredCouponRewards,c=B(N()),p=u("ext_red_cta_202305")&&!c,b=`${u("ext_coupons_streamlined_click")?"primary-btn-small":"primary-btn-large"} ${p?"red-btn-test":""}`,y=u("ext_modal_savings_emphasis")?Te():null,h=!!y;return(0,R.jsxs)("div",{className:"no-savings-wrapper",children:[a&&(0,R.jsxs)("div",{className:"no-savings-header",children:[(0,R.jsx)("h2",{children:"Code Entered"}),o&&o.length&&!u("ext_coupons_streamlined_click")&&(0,R.jsx)("div",{className:"view-codes-link-wrapper",children:(0,R.jsx)("h6",{onClick:l?()=>this.setState({viewCodes:!this.state.viewCodes}):null,className:`${l?"clickable":""} bold"`,children:this.state.viewCodes?(0,R.jsx)("span",{children:"hide codes"}):(0,R.jsxs)("span",{children:[u("coup_fo_202403_test")?"A variety of codes":`${t} ${t===1?"code":"codes"}`," ","tested in ",i," sec."]})})})]}),this.state.viewCodes&&!l?(0,R.jsx)("div",{className:"view-codes",children:ce.default.map(o,(m,w)=>{let f=this.state.copied===m.code;return(0,R.jsx)("div",{onClick:this.onClickCopy.bind(this,m.code),style:{animationDelay:`${(w+1)*50}ms`},className:`coupon-list-item-container gray ${f?"copied":""}`,children:(0,R.jsxs)("h4",{className:"code midnight bold",children:[f?(0,R.jsx)("span",{className:"copied-text",children:"COPIED"}):m.code,(0,R.jsx)("span",{className:"hidden",children:m.code})]})},w)})}):null,l&&a?(0,R.jsx)("div",{className:u("ext_coupons_streamlined_click")?void 0:"center-content",children:(0,R.jsxs)("div",{className:"activation-amount",children:[(0,R.jsxs)("h3",{className:"silver",style:u("ext_coupons_streamlined_click")?{margin:"10px 0"}:void 0,children:[(0,R.jsx)("span",{className:"palmetto bold",children:e.type==="percentage"?`+${e.amount/100}%`:"+"+D(e.amount,{currency:e.currency})})," ",(0,R.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),ce.default.get(this.props,"exclusions")?(0,R.jsx)(ki,{style:u("ext_coupons_streamlined_click")?{display:"flex"}:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]})}):!r.hasDeferredCouponRewards&&!e.categories&&a?(0,R.jsx)("div",{className:"center-content",children:(0,R.jsxs)("h6",{className:"bold",children:[u("coup_fo_202403_test")?"A variety of codes":`${t} ${t===1?"code":"best codes"}`," ","tested in ",i," sec."]})}):!r.hasDeferredCouponRewards&&e.categories&&a?(0,R.jsx)("div",{}):!r.hasDeferredCouponRewards||!a?(0,R.jsxs)("div",{className:u("ext_coupons_streamlined_click")?void 0:"center-column",children:[u("ext_coupons_streamlined_click")&&(0,R.jsx)("div",{className:"best-price-image",style:{width:140,height:140,margin:"0 auto"},children:(0,R.jsx)(le,{w:"100%",h:"100%"})}),(0,R.jsx)("h2",{style:u("ext_coupons_streamlined_click")?{fontSize:20}:void 0,children:"You have a great price."}),!u("ext_coupons_streamlined_click")&&!h&&(0,R.jsx)("div",{className:"best-price-image",children:(0,R.jsx)(le,{})}),u("ext_coupons_streamlined_click")?(0,R.jsx)("h4",{className:"bold left",children:e&&r.hasDeferredCouponRewards?(0,R.jsxs)(R.Fragment,{children:["Activate now to earn"," ",(0,R.jsxs)("span",{className:"brand",children:[e.categories||e.estimated?"up to ":"",e.type==="percentage"?`${e.amount/100}%`:D(e.amount,{currency:e.currency})]})," ","in Shopping Rewards",e.type==="threshold"&&e.threshold?` when you spend ${D(e.threshold,{currency:e.currency})}`:""]}):(0,R.jsxs)(R.Fragment,{children:["We tried"," ",(0,R.jsx)("span",{children:u("coup_fo_202403_test")?"a variety of codes":`${t} ${t===1?"code":"codes"}`})]})}):(0,R.jsxs)("p",{style:h?{textAlign:"center",marginTop:8}:void 0,children:["We tried"," ",(0,R.jsx)("span",{children:u("coup_fo_202403_test")?"a variety of codes":`${t} ${t===1?"code":"codes"}`})," ","to make sure you got a great price, but did not find any additional savings."]}),h&&(0,R.jsxs)("div",{style:{textAlign:"center",marginTop:64},children:[(0,R.jsx)("h6",{className:"bold",children:(0,R.jsx)(Ce,{prefixText:"You've",hoverText:"saved"})}),(0,R.jsx)("h1",{className:"brand",children:y}),(0,R.jsx)("h6",{className:"bold",children:"so far with"}),(0,R.jsx)("h6",{className:"bold",children:"Capital One Shopping"})]})]}):null,(!e||!r.hasDeferredCouponRewards)&&(0,R.jsx)("div",{className:"dismiss-notif",children:wi()&&ce.default.get(this,"props.view.manuallyActivatedAutoRun")&&!(ce.default.get(this,"props.view.result.savings")>0)?(0,R.jsx)(Sn.default.Fragment,{children:(0,R.jsx)(Oe,{view:this.props.view,isCashback:this.props.isCashback,onTryCodes:this.props.onTryCodes,buttonClassName:b})}):(0,R.jsx)("button",{className:b,onClick:this.props.onClosePopup.bind(this),style:u("ext_coupons_streamlined_click")?{width:"100%",marginTop:10}:void 0,children:"Continue to Checkout"})})]})}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}onClickCopy(i){let t=J();li(i),this.setState({copied:i},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),x("trackClick","copyCouponCode","code",{clickId:t})}},Ct=xt;var Jr=_(S()),In=_(S()),Pn=_(vs()),Dn=_(Q());var Nn=_(S()),gi=_(C()),Tt=class extends Nn.default.Component{render(){return this.props.type==="half"?this.half():this.full(this.props.type)}half(){return(0,gi.jsxs)("svg",{className:"nc-icon glyph star",x:"0px",y:"0px",width:"48px",height:"48px",viewBox:"-281 373 48 48",children:[(0,gi.jsx)("g",{children:(0,gi.jsx)("path",{fill:"#E8E8E8",stroke:"#acaaaa",d:`M-256.1,376l6.5,13.2l14.6,2.1c0.8,0.1,1.1,1.1,0.6,1.7l-10.5,10.3l2.5,14.5c0.1,0.8-0.7,1.4-1.5,1.1l-13-6.9
            l-13,6.9c-0.7,0.4-1.6-0.2-1.5-1.1l2.5-14.5l-10.5-10.3c-0.6-0.6-0.3-1.6,0.6-1.7l14.6-2.1l6.5-13.2
            C-257.5,375.2-256.5,375.2-256.1,376z`})}),(0,gi.jsx)("g",{children:(0,gi.jsx)("path",{fill:"#F9C319",d:`M-257,412l-13,6.9c-0.7,0.4-1.6-0.2-1.5-1.1l2.5-14.5l-10.5-10.3c-0.6-0.6-0.3-1.6,0.6-1.7l14.6-2.1l6.5-13.2
            c0.2-0.4,0.5-0.6,0.9-0.6L-257,412z`})})]})}full(i){let t=this.props.type==="empty";return(0,gi.jsx)("svg",{onClick:this.props.onClick?this.props.onClick.bind(this,this.props.rating):null,className:"nc-icon glyph star",x:"0px",y:"0px",width:"48px",height:"48px",viewBox:"0 0 48 48",children:(0,gi.jsx)("g",{children:(0,gi.jsx)("path",{fill:t?"#E8E8E8":"#f9c319",stroke:t?"#acaaaa":"#f9c319",d:"M24.897,2.99l6.521,13.211l14.577,2.119c0.82,0.119,1.148,1.127,0.554,1.706L36,30.307l2.49,14.52 c0.14,0.817-0.717,1.44-1.451,1.054l-13.038-6.854l-13.04,6.856C10.227,46.27,9.37,45.647,9.51,44.83L12,30.307L1.451,20.026 c-0.594-0.578-0.266-1.587,0.554-1.706l14.577-2.119L23.103,2.99C23.47,2.247,24.53,2.247,24.897,2.99z"})})})}},Rt=Tt;var Mi=_(C()),St=class extends In.Component{constructor(...i){super(...i),this.state={deduction:5}}componentDidMount(){x("track","reviewWikibuyVisible",{})}render(){return this.state.confirmation?(0,Mi.jsx)("span",{}):(0,Mi.jsxs)("div",{className:"review-wrapper",children:[(0,Mi.jsx)("h4",{className:"bold charcoal",style:{textAlign:"center",marginBottom:15},children:"How would you rate Capital One Shopping?"}),(0,Mi.jsx)("div",{className:"review-wikibuy",children:Dn.default.map(new Array(5),(i,t)=>(0,Mi.jsx)(Rt,{onClick:this.starWikibuy.bind(this,t),rating:t,type:this.state.deduction<=t?"fill":"empty"},t))})]})}starWikibuy(i){this.setState({deduction:i}),this.rateWikibuy("star",i)}checkStars(i){let t=this.state.deduction;t===0?this.rateWikibuy(i,t):this.rateWikibuy(i,t)}rateWikibuy(i,t){let e=this.props.savings;x("trackClick","rateWikibuy",i,{savings:e,rating:5-t});let s=new Pn.default().getResult().browser.name;if(t===0){if(s==="Edge"){window.open("https://microsoftedge.microsoft.com/addons/detail/capital-one-shopping-add/kiiaghlmeikbpmeabhilfphikfcefljn","_blank");return}else if(s==="Firefox"){window.open("https://addons.mozilla.org/en-US/firefox/addon/wikibuy-for-firefox/","_blank");return}window.open("https://chromewebstore.google.com/detail/capital-one-shopping-save/nenlahapcbofgnanklpelkaejcehkggg/reviews?hl=en-US","_blank")}this.props.onClosePopup("rate capital one shopping")}},je=St;var Ge=_(S());var q=_(C());function na(n){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${n}/coupon`,"_blank")}var En={marginTop:30},At={marginTop:10},Fn="Activate Rewards",sa=({reward:n,payoutProcessingPeriod:i,exclusions:t,tld:e,activateRewardsOnly:o})=>{let[s,a]=(0,Ge.useState)(void 0),r=B(N()),l=u("ext_red_cta_202305")&&!r;return(0,q.jsx)("div",{style:{display:"flex",height:"100%",overflow:"scroll",padding:u("ext_coupons_streamlined_click")?void 0:"0 28px"},children:(0,q.jsxs)("div",{style:{alignSelf:n.categories?"flex-start":"center",flex:u("ext_coupons_streamlined_click")?1:void 0},children:[!u("ext_coupons_streamlined_click")&&(0,q.jsxs)("h2",{children:["Activate now to earn"," ",(0,q.jsxs)("span",{className:"palmetto",children:[n.categories||n.estimated?"up to ":"",n.type==="percentage"?`${n.amount/100}%`:D(n.amount,{currency:n.currency})]})," ","in Shopping Rewards",n.type==="threshold"&&n.threshold?(0,q.jsxs)("span",{children:[" ","when you spend"," ",(0,q.jsx)("span",{className:"palmetto",children:D(n.threshold,{currency:n.currency})})]}):"","!"]}),n.type==="threshold"&&n.threshold?(0,q.jsx)("h6",{style:At,children:(0,q.jsx)(Ji,{direction:mo.DIRECTIONS.RIGHT,text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:"The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied. Exclusions apply, see merchant site for details."})}):(0,q.jsxs)("h6",{style:At,children:["Rewards may vary based on exchange rates.",t&&(0,q.jsxs)(Ge.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,q.jsxs)("span",{className:"tertiary-link-lighter",onClick:()=>na(e),children:[" ","view details."]})]})]}),!u("ext_coupons_streamlined_click")&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)("h5",{style:En,children:["Complete your purchase now to receive your Rewards by"," ",(0,q.jsx)("span",{className:"bold",children:Bo(i)}),"."]}),(0,q.jsx)("h5",{style:At,children:"You can redeem your Rewards for gift cards from top merchants."}),!!n.categories&&(0,q.jsx)("div",{style:En,children:(0,q.jsx)(oe,{reward:n,tld:e,center:!0})})]}),(0,q.jsx)("div",{className:"sticky-cta",children:(0,q.jsx)("button",{className:`primary-btn-large ${l?"red-btn-test":""}`,disabled:s,onClick:()=>{let{clickId:c}=xe();o({clickId:c,label:Fn,fromActivateRewards:!0}),a(!0)},style:u("ext_coupons_streamlined_click")?{width:"100%",marginTop:10}:void 0,children:s?"Activating Rewards...":Fn})})]})})},Nt=sa;var v_=_(S());var zn=_(S()),It=_(Q());var H=_(C()),Pt=class extends zn.Component{constructor(...i){super(...i),this.state={}}render(){let{runTimeSeconds:i,couponCount:t,savings:e,reward:o,workingCoupons:s,postCoupons:a,isBonkersSavings:r,onClosePopup:l,hasDeferredCouponRewards:c}=this.props,p=l?l.bind(this):null,b=o&&o.amount&&!a&&!c,y=B(N()),h=u("ext_red_cta_202305")&&!y;return(0,H.jsxs)("div",{className:`savings-wrapper ${o.categories?"has-categories":""}`,children:[(0,H.jsxs)("div",{className:`coupon-count ${b?"":"no-reward"}`,children:[this.props.requiresInput||r?(0,H.jsx)("h2",{children:"Code Entered"}):(0,H.jsxs)("h2",{className:u("ext_coupons_streamlined_click")?"center":void 0,children:["You saved ",(0,H.jsx)("span",{className:"palmetto",children:e})]}),s.length?(0,H.jsxs)("h6",{className:"bold center",children:[s.length," ",s.length===1?" code ":" codes "," worked in"," ",i," sec."]}):(0,H.jsxs)("h6",{className:"bold center",children:[u("coup_fo_202403_test")?"A variety of codes":`${t} ${t===1?"code":"codes"}`," ","tested in ",i," sec."]})]}),b||s.length?(0,H.jsxs)("div",{className:"center-content",children:[(0,H.jsx)("div",{className:`flex-center savings-breakdown ${b?"reward":""} ${this.props.hideBorder?"hide-border":""}`,children:(0,H.jsx)("div",{className:"code-scroll-container",children:this.renderWorkingCodes(s)})}),b&&!o.categories&&this.props.requiresInput?(0,H.jsxs)("div",{className:"activation-amount",children:[(0,H.jsxs)("h3",{className:"silver",children:[(0,H.jsx)("span",{className:"palmetto bold",children:o.type==="percentage"?`+${o.amount/100}%`:D(o.amount,{currency:o.currency})})," ",(0,H.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),It.default.get(this.props,"exclusions")?(0,H.jsx)(ki,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]}):null]}):null,p?(0,H.jsx)("div",{className:`dismiss-notif ${b&&!o.categories&&this.props.requiresInput?"code-entered-cashback":""}`,children:(0,H.jsx)("button",{className:`primary-btn-large ${h?"red-btn-test":"brand"}`,onClick:p,children:"Continue to Checkout"})}):null]})}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}renderWorkingCodes(i){return It.default.map(i,(t,e)=>{let o=this.state.copied===t.code;return(0,H.jsx)("div",{onClick:this.onClickCopy.bind(this,t.code),style:{animationDelay:`${(e+1)*50}ms`},className:`coupon-list-item-container ${o?"copied":""}`,children:(0,H.jsxs)("h4",{className:"code midnight bold",children:[o?(0,H.jsx)("span",{className:"copied-text",children:"COPIED"}):t.code,(0,H.jsx)("span",{className:"hidden",children:t.code})]})},e)})}onClickCopy(i){let t=J();li(i),this.setState({copied:i},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),x("trackClick","copyCouponCode","code",{clickId:t})}},Dt=Pt;var M_=_(S()),Et=_(S()),$n=_(Q());var Fi=_(C()),Ye=class extends Et.Component{constructor(...i){super(...i),this.state={copied:!1}}render(){let i=this.props.coupon;return(0,Fi.jsx)("div",{className:`coupon-item-wrapper ${this.props.active?"active":""} ${i.success?"success":"finished"} ${this.state.copied?"copied":""}`,children:(0,Fi.jsx)("div",{className:"coupon-list-item-container",onClick:this.onClickCopy.bind(this),children:(0,Fi.jsx)("div",{className:"details",children:(0,Fi.jsx)("h4",{className:"code midnight bold",children:i.code})})})})}onClickCopy(){let i=J();this.setState({copied:li(this.props.coupon.code)},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),x("trackClick","copyCouponCode","code",{clickId:i})}componentWillUnmount(){clearTimeout(this.timeoutId)}};Ye.defaultProps={stagger:400};var pe=class extends Et.Component{constructor(...i){super(...i);let t=0;this.props.roo&&this.props.currentCodeIndex>-1&&(t=this.props.currentCodeIndex),this.state={active:t},this.onEstimatedCouponDuration=({detail:e})=>{let o=e.currentCodeIndex;o>=0&&o<this.props.coupons.length&&o>this.state.active&&this.setState({active:o})}}componentWillReceiveProps(i){i.pause!==this.state.pause&&(i.pause?clearInterval(this.interval):this.startInterval())}componentDidMount(){this.props.roo&&this.startInterval(),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}startInterval(){let i=this.props.runTimePerCoupon||(this.props.estimatedRunTime+1e3)/this.props.coupons.length;this.interval=setInterval(()=>{let t=this.state.active+1;this.setState({active:t}),t===this.props.coupons.length-1&&clearInterval(this.interval)},i)}componentWillUnmount(){clearInterval(this.interval),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}render(){console.log("this.state.active",this.state.active);let i=!!u("ext_coupons_streamlined_click"),t=i?(this.state.active-1)*40:(this.state.active-4)*40,e=u("ext_coupons_streamlined_click")?"reduced-height":"",o=i?this.state.active>2:this.state.active>4,s={WebkitTransform:`translate3d(0px, -${t}px, 0px)`,transform:`translate3d(0px, -${t}px, 0px)`,msTransform:`translate3d(0px, -${t}px, 0px)`,WebkitTransition:"-webkit-transform 0.3ms ease",transition:"transform 0.3s ease"};return(0,Fi.jsx)("div",{className:"code-list-wrapper",children:(0,Fi.jsx)("div",{style:o?s:{},className:`code-list ${this.props.className||""} ${e}`,children:$n.default.map(this.props.coupons,(a,r)=>(0,Fi.jsx)(Ye,{last:r===this.props.coupons.length-1,running:this.props.running,result:this.props.result,index:r,active:this.state.active===r,coupon:a,disableChecks:this.props.disableChecks},r))})})}};var Ke=_(S());var si=_(C()),Ft=class extends Ke.default.Component{constructor(i){super(i),this.state={answered:!1}}componentDidMount(){x("page","ilSurvey")}handleSelection=i=>{i.type==="change"&&(x("track","ilSurveyResponse",{value:i.target.value}),setTimeout(()=>{this.setState({answered:!0},()=>{this.props.dismiss()})},250))};render(){let i=u("il_survey_split")?"Would you be interested in splitting this purchase into 4 payments with 0% interest and no fees?":u("il_survey_apr")?"Would you be interested in splitting this purchase into equal monthly payments with a competitive APR and no fees?":"Would you be interested in splitting this purchase into equal monthly payments at 0% APR and no fees?";return(0,si.jsx)("div",{className:"installment-survey",children:this.state.answered?(0,si.jsxs)(Ke.default.Fragment,{children:[(0,si.jsx)("h3",{children:"Thank you for letting us know!"}),(0,si.jsx)("p",{children:"We're exploring this as a feature of Capital One Shopping and will let you know if it becomes available!"})]}):(0,si.jsxs)(Ke.default.Fragment,{children:[(0,si.jsx)("h3",{children:i}),(0,si.jsxs)("div",{children:[(0,si.jsxs)("div",{className:"answer",children:[(0,si.jsx)("input",{type:"radio",className:"default",name:"survey-response",id:"survey-response-yes",onChange:this.handleSelection,value:"yes"}),(0,si.jsx)("label",{htmlFor:"survey-response-yes",children:"Yes"})]}),(0,si.jsxs)("div",{className:"answer",children:[(0,si.jsx)("input",{type:"radio",className:"default",name:"survey-response",id:"survey-response-no",onChange:this.handleSelection,value:"no"}),(0,si.jsx)("label",{htmlFor:"survey-response-no",children:"No"})]})]})]})})}},zt=Ft;var du=_(S()),Mn=_(S()),qn=_(te()),qi=_(Q());var $t=_(S()),On=_(te()),mi=_(Q());var Ot=class extends $t.default.Component{constructor(...i){super(...i),this.state={},this.impressionMap=[]}componentWillMount(){mi.default.get(this.props,"children.length")&&!this.props.ignoreImpression&&this.setState({children:this.attachProps(this.props.children)})}componentDidMount(){this.props.logOnMount&&this.logImpression(mi.default.map(this.state.children,(i,t)=>({type:"impression",props:{...i.mirageData.trackProps,displayIndex:String(t)}})))}componentWillReceiveProps(i){!this.props.ignoreImpression&&mi.default.get(i.children,"length")&&!mi.default.get(this.props.children,"length")&&!this.state.children&&this.setState({children:this.attachProps(i.children)})}render(){let i=this.props.children;return this.state.children?(i=this.state.children,mi.default.map(i,t=>t.component)):i}attachProps(i){let t=this.logImpression.bind(this);return mi.default.map(i,e=>{if(!e||!e.props)throw new Error("Children Must Be A Component");let o=mi.default.clone(mi.default.get(e.props,"__mirage",{}));o.trackProps.view_id=On.default.v4();let s={...e.props,__mirage:o,logImpression:t};return{mirageData:o,component:$t.default.cloneElement(e,s)}})}logImpression(i){i=mi.default.isArray(i)?i:[i];let t=mi.default.filter(i,e=>!mi.default.find(this.impressionMap,{type:e.type,props:{contentInstanceId:e.props.contentInstanceId}}));t.length&&(this.impressionMap=this.impressionMap.concat(t),en(i))}},Lt=Ot;var ru=_(S()),Ln=_(S()),ci=_(Q());var vi=_(C()),Bt=class extends Ln.Component{constructor(...i){super(...i),this.state={}}render(){let i=ci.default.get(this.props,"image.style",{});return(0,vi.jsx)("div",{style:this.props.style||{},onClick:this.props.onClickContentCard.bind(this,this.props),className:"store-content-card-a",children:(0,vi.jsxs)("div",{className:"flex",children:[(0,vi.jsx)("div",{className:"image-wrapper",children:(0,vi.jsx)("div",{className:`image ${ci.default.get(this.props,"image.className","")}`,style:{...i,backgroundImage:`url("${ci.default.get(this.props,"image.url")||this.props.image}")`}})}),(0,vi.jsxs)("div",{className:"content",children:[(0,vi.jsx)("h4",{className:`${ci.default.get(this.props,"title.className","")} charcoal`,style:ci.default.get(this.props,"title.style",{}),children:ci.default.get(this.props,"title.value")}),(0,vi.jsx)("h5",{className:`silver ${ci.default.get(this.props,"subtitle.className","")}`,style:ci.default.get(this.props,"subtitle.style",{}),children:ci.default.get(this.props,"subtitle.value")}),(0,vi.jsx)("h6",{className:`palmetto ${ci.default.get(this.props,"cta.className","")}`,style:ci.default.get(this.props,"cta.style",{}),children:ci.default.get(this.props,"cta.value")})]})]})})}},Bn=Bt;var Hi=_(C()),Mt=class extends Mn.Component{constructor(...i){super(...i),this.state={}}render(){return(0,Hi.jsxs)("div",{className:"store-content-data",children:[(0,Hi.jsx)("div",{children:(0,Hi.jsx)("h2",{className:"bold",children:"Personalized Offers"})}),(0,Hi.jsx)(Lt,{logOnMount:!0,children:qi.default.map(qi.default.get(this.props.data,"items"),(i,t)=>(0,Hi.jsx)(Bn,{onClickContentCard:this.onClickContentCard.bind(this),index:t,...i},t))})]})}onClickContentCard(i){let t=qn.default.v4(),e=qi.default.get(i,"__mirage.trackProps",{});i.logImpression({type:"click",props:{...e,clickId:t,displayIndex:String(i.index)}}),i.actions&&qi.default.forEach(i.actions,o=>{if(o.type==="openUrl"){let s=qi.default.get(o.props,"href").replace("__WBCLICKID__",t);window.open(s,qi.default.get(o.props,"target","_blank"))}})}},qt=Mt;var Wi=_(C()),aa=n=>(0,Wi.jsx)("div",{className:"try-codes-wrapper",style:{textAlign:"center"},children:(0,Wi.jsxs)("div",{children:[(0,Wi.jsx)("h2",{children:"Trying Coupon Codes"}),(0,Wi.jsx)("h5",{className:"silver",children:"Capital One Shopping automatically tries coupon codes to save you money."}),n.renderProgressRunning(),(0,Wi.jsx)("div",{className:"streamlined",children:n.renderProgressBar()})]})}),Hn=aa;var Au=_(S()),Ui=_(S());var zi=_(Q()),Vn=_(Cs());var ku=_(S()),Ii=_(Rs());var Qe=_(As()),V=_(C()),ra=(0,Ii.default)(bi)`
  ${(0,Qe.cssNamespace)(Ii.css`
    padding: 10px;
    margin-left: 18px;
    margin-right: 19px;
    margin-bottom: 12px;
    border-radius: 5px;
    border: ${({theme:n})=>n.colors.borderNeutralEmphasisLow} solid 2px;
    background-color: #fff;
    &:hover {
      border-color: ${({theme:n})=>n.colors.borderInteractiveHover};
      cursor: pointer;
    }
  `)}
`,_a=Ii.default.ul`
  ${(0,Qe.cssNamespace)(Ii.css`
    margin-bottom: 10px;
    padding-left: 15px;
    list-style: disc;

    li {
      font-weight: ${({theme:n})=>n.fontWeights.light};
      list-style-position: outside;
    }
  `)}
`,ua=(0,Ii.default)(Ti).attrs({fontSize:"small",fontWeight:"light",lineHeight:"small"})``,la=(0,Ii.default)(bi)`
  ${(0,Qe.cssNamespace)(Ii.css`
    display: flex;
    justify-content: center;
    width: 100%;
    min-width: inherit;
    min-height: inherit;
    height: 24px;
    background-color: ${({theme:n})=>n.colors.objectInteractiveEmphasisLow};
    color: ${({theme:n})=>n.colors.objectInteractiveEmphasisHigh};
  `)}
`,ca=({children:n})=>(0,V.jsx)(Ti,{tag:"h1",variant:"medium",bold:!0,mb:"medium",children:n}),pa=({card:n,handleClick:i})=>{let t=n.pillText&&n.pillText!=="";return(0,V.jsxs)(ra,{onClick:()=>i(n),children:[(0,V.jsxs)(bi,{row:!0,justifyContent:"space-between",alignItems:"center",mb:"small",children:[(0,V.jsx)(Ti,{bold:!0,tag:"h2",fontSize:"small",children:n.name}),t&&(0,V.jsx)(wo,{backgroundColor:"gray15",color:"black",secondary:!0,label:(0,V.jsx)(Ti,{fontSize:"small",lineHeight:"tiny",children:n.pillText})})]}),(0,V.jsxs)(bi,{row:!0,mb:"small",children:[(0,V.jsx)(bi,{display:"flex",width:"115px",height:"70px",mr:"10px",children:(0,V.jsx)("img",{src:n.imageUrl,alt:n.name})}),(0,V.jsxs)(bi,{marginLeft:5,column:!0,justifyContent:"space-between",width:165,children:[(0,V.jsx)(_a,{children:n.featureList.map((e,o)=>(0,V.jsx)("li",{children:(0,V.jsx)(ua,{children:e})},o))}),(0,V.jsx)(la,{children:(0,V.jsx)(Ti,{interaction:!0,children:n.ctaText})})]})]})]})},Wn=({content:n,handleCardClick:i})=>(0,V.jsxs)(bi,{children:[(0,V.jsx)(bi,{row:!0,justifyContent:"center",children:(0,V.jsx)(ca,{children:n.header})}),(0,V.jsx)(bi,{children:n.cards.map(t=>(0,V.jsx)(pa,{card:t,handleClick:i},t.key))})]});var Un=_(S());var de=class extends Un.Component{constructor(i){super(i)}componentDidCatch(i,t){if(Yi("fpError",{name:"financialProductsError",error:i.toString(),label:t.componentStack}),this.props.onFail&&typeof this.props.onFail=="function")return this.props.onFail()}render(){return this.props.children}};var ee=_(C()),da="fp_ext_coupon_modal_and_order_confirmation",ba="fp_ext_coupon_modal_only",ma=n=>{try{let i=zi.default.get(n,"pageData.products");if(i&&i.length>0){let t=zi.default.find(i,e=>zi.default.get(e,"list_price")!==null&&zi.default.get(e,"list_price")>0);if(t)return zi.default.get(t,"list_price")}return null}catch{return null}},ya=n=>{let i=N(),t=zi.default.get(n,"session.id",null),{deweyResult:e,onFail:o,couponResult:s}=n,[a,r]=(0,Ui.useState)(null),[l,c]=(0,Ui.useState)(!0),[p,b]=(0,Ui.useState)(!1),y=(m,w)=>new Promise(f=>(0,Vn.default)(async()=>{let k={domain:w};return m&&(k.purchasedAmount=m),await Xo({contentSlug:"fp-coupon-card-content",contentProps:k})}).then(k=>{f(k)})),h=({landingPageUrl:m,attributionTestSegment:w,metricData:f})=>{console.log({landingPageUrl:m,attributionTestSegment:w,metricData:f});let k={...f,pageLocation:"modal"},T=f.cardName.replace(" ","-").replace(/[\u{0080}-\u{FFFF}]/gu,"").toLowerCase(),I="";u(ba)?I="coupon-only":u(da)&&(I="both");let P=["ext","CMA_SHOP",t,"coupon",i,w,I,T].join("_"),z=`${m}?external_id=${P}`;f.cardKey==="venture-one"&&(z+="&ptgDisable=1"),window.open(z),Yi("financialProductsClickCard",k)};return(0,Ui.useEffect)(()=>{(async()=>{try{c(!0);let w=zi.default.get(e,"pageData.order.total"),f=ma(e),k=await y(w||f,i);(!k||Object.keys(k).length===0||k.cards&&!k.cards.length||k.error)&&(k.error&&(Yi("fpError",{name:"fetchBestCardsError",error:k.error}),b(!0)),o()),r(k)}catch(w){Yi("fpError",{name:"fetchBestCardsError",error:w.toString()}),b(!0),o()}finally{c(!1)}})()},[]),(0,Ui.useEffect)(()=>{s&&!l&&!p&&ge("couponCardList",{pageLocation:"modal",pagePath:location.pathname,couponRunId:s.couponRunId})},[l,p,s]),p?null:(0,ee.jsx)(de,{onFail:o,children:(0,ee.jsx)("div",{children:l?(0,ee.jsx)("div",{className:"card-list",children:(0,ee.jsx)("h3",{className:"loading-text",children:"Loading..."})}):(0,ee.jsx)(Wn,{content:a,handleCardClick:h})})})},jn=ya;function Vi(n){return parseInt(n.replace(/[^0-9]/gi,""))}var Hu=_(S());var xi=_(C());function wa(){let n=Te();return(0,xi.jsxs)("div",{style:{border:"none",borderTop:"2px dashed lightgray",borderBottom:"2px dashed lightgray",padding:6,margin:"12px 0"},children:[(0,xi.jsxs)("div",{children:[(0,xi.jsxs)("h4",{style:{display:"inline-block",width:"75%",textAlign:"left",marginBottom:0},children:[(0,xi.jsx)(Ce,{}),":"]}),(0,xi.jsx)("h4",{style:{display:"inline-block",width:"25%",textAlign:"end"},children:n})]}),(0,xi.jsxs)("div",{children:[(0,xi.jsx)("h4",{className:"palmetto",style:{display:"inline-block",width:"75%",textAlign:"left",marginBottom:0},children:"Transaction Savings:"}),(0,xi.jsx)("h4",{className:"palmetto",style:{display:"inline-block",width:"25%",textAlign:"end"},children:"???"})]})]})}var Gn=wa;var Yn=_(Q()),pi=_(C()),ha=n=>{let{couponCount:i,showReward:t,reward:e}=n,o,s=e.type==="percentage"?`${e.amount/100}%`:D(e.amount,{currency:e.currency});e.type==="threshold"&&e.threshold&&(o=D(e.threshold,{currency:e.currency}));let a=e.type==="percentage"?`${s} back`:`${s} in Rewards`,r=g.get("lifetimeSavings"),l=Yn.default.get(r,"lifetimeSavings.amount",0)*100,c,p,b=u("ext_shorten_notif_text")?"Test codes in seconds.":"Capital One Shopping tests codes in seconds.",y=u("ext_coupon_savings_emphasis")&&l>=1e3;y?(c=(0,pi.jsx)(Gn,{}),p=(0,pi.jsxs)("span",{style:{textAlign:"center",display:"block"},children:["Found"," ",(0,pi.jsxs)("span",{className:"palmetto",children:[i," ",i===1?"code":"codes"]})]})):(c=(0,pi.jsx)("h4",{className:"bold left",children:Fe()||b}),p=$e({couponCount:i}));let h=!0;return(Si()||Uo())&&(h=!1),h?(0,pi.jsxs)("div",{children:[(0,pi.jsxs)("h2",{className:"left",children:[(0,pi.jsx)("span",{children:p}),t&&!y?(0,pi.jsxs)("span",{children:[" ","and ",(0,pi.jsx)("br",{}),"get ",e.categories||e.estimated?"up to ":"",(0,pi.jsx)("span",{className:"palmetto",children:a}),(0,pi.jsx)("br",{}),e.type==="threshold"&&e.threshold?`when you spend ${o}`:""]}):null]}),c]}):null},be=ha;var Pi=_(S()),Xe=_(Q());var Kn=_(S()),Ht=_(C()),Je=class extends Kn.default.Component{constructor(...i){super(...i),this.state={progress:0,end:0}}componentWillMount(){let i=this.props.coupons.length||0,t,e;this.props.currentCodeIndex===-1?(t=0,e=1/i*100):(e=(this.props.currentCodeIndex+1)/i*100,this.props.currentCodeIndex===0?t=15:t=this.props.currentCodeIndex/i*100),t>this.state.progress&&(this.setState({progress:Math.round(t)}),this.setState({end:Math.round(e)}),this.initInterval())}componentWillUnmount(){clearInterval(this.intervalId)}componentWillReceiveProps(i){if(!this.props.complete&&i&&i.complete)clearInterval(this.intervalId),this.setState({progress:100});else if(!this.props.complete&&i&&i.currentCodeIndex){if(clearInterval(this.intervalId),this.props.coupons.length){let t=i.currentCodeIndex/this.props.coupons.length*100;if(t>this.state.progress){let e=(i.currentCodeIndex+1)/this.props.coupons.length*100;this.setState({progress:Math.round(t)}),this.setState({end:Math.round(e)})}}this.initInterval()}}initInterval(){let i=Math.round(this.props.runTimePerCoupon*this.props.coupons.length/100);this.intervalId=setInterval(()=>{this.state.progress<this.state.end?this.setState({progress:this.state.progress+1}):clearInterval(this.intervalId)},i)}render(){return(0,Ht.jsx)("div",{className:this.props.rounded?"rounded progress-bar":"progress-bar",children:(0,Ht.jsx)("div",{className:"progress",style:{width:`${Math.min(this.state.progress||10,100)}%`}})})}};Je.defaultProps={estimatedDuration:3e3};var Wt=Je;var di=_(C()),fa=n=>{let{currentCodeIndex:i,coupons:t}=n,e=u("coup_checkpoint_202401_test")?"Finding great deals...":"Trying Coupon Codes",[o,s]=(0,Pi.useState)(e),[a,r]=(0,Pi.useState)(0),[l,c]=(0,Pi.useState)(0),[p,b]=(0,Pi.useState)(0);return(0,Pi.useEffect)(()=>(c(Date.now()),()=>{c(0),b(0)}),[]),yo(()=>{let y=(Date.now()-l)/1e3;b(y)},4e3,l>0),(0,Pi.useEffect)(()=>{if(u("coup_checkpoint_202401_test")&&i){if(i>1){let y=(Date.now()-l)/1e3;b(y)}r(i/t.length)}},[i]),(0,Pi.useEffect)(()=>{u("coup_checkpoint_202401_test")&&(t.length>1&&a<.8&&p>4&&s("Checking for savings..."),(a>=.8||t.length===1&&p>4)&&s("Wrapping up..."))},[a,p]),(0,di.jsx)("h2",{children:o})},ka=n=>{let{coupons:i,couponCount:t,currentCouponCode:e,roo:o}=n,s=(0,Xe.default)(i).take(t).map((r,l)=>(r.success=!0,r)).value(),a;return o&&(a=Xe.default.findIndex(s,r=>r.code===e),s=Xe.default.map(s,(r,l)=>(l<a?r.success=!0:r.success=!1,r))),a},Qn=({currentCodeIndexTigger:n,view:i}={})=>{let t=ka(i);return n||t},Ut=n=>{let{estimatedRunTime:i,barIsComplete:t,coupons:e,currentCodeIndexTigger:o,pause:s,runTimePerCoupon:a,estimatedDuration:r,estimatedTimeLeft:l,resetProgressBarState:c,roo:p,view:b}=n,y=Qn({currentCodeIndexTigger:o,view:b}),h=u("ext_coupons_streamlined_click")?"streamlined":"";return(0,di.jsx)("div",{className:`progress-bar ${h}`,children:p?(0,di.jsx)(Wt,{estimatedDuration:i,complete:t,currentCodeIndex:y,coupons:e,runTimePerCoupon:a}):(0,di.jsx)(nn,{pause:s,estimatedDuration:r,complete:t,estimatedTimeLeft:l,resetProgressBarState:c})})},ga=n=>{let{couponCount:i,currentCodeIndexTigger:t,coupons:e,view:o}=n;if(!e)return null;let s=Qn({currentCodeIndexTigger:t,view:o});return(0,di.jsx)("div",{className:"try-codes-wrapper",children:(0,di.jsxs)("div",{children:[(0,di.jsx)(fa,{currentCodeIndex:s,coupons:e}),(0,di.jsx)("h5",{className:"silver",children:"Capital One Shopping automatically tries coupon codes to save you money."}),(0,di.jsx)(Ut,{...n,currentCodeIndex:s}),s>-1?(0,di.jsx)("h5",{style:{textAlign:"center",marginTop:15},className:"bold",children:u("coup_fo_202403_test")?"Trying Coupon Codes":`Trying ${s+1} of ${i} Codes`}):(0,di.jsx)("h5",{style:{height:"20px"}})]})})},Jn=ga;var Xn=_(S());var Zn=_(S());var Vt=_(Q());var F=_(C()),jt=class extends Zn.Component{constructor(...i){super(...i),this.state={viewCodes:!1}}componentDidMount(){let i=B(N());if(u("coup_modal_auto_dismiss")&&!i){let t=this.props.reward?5e3:3e3;setTimeout(()=>this.props.onClosePopup(),t)}}render(){let{runTimeSeconds:i,couponCount:t,reward:e,codes:o,postCoupons:s,requiresInput:a}=this.props,r=e&&e.amount&&!s&&!e.categories,l=o&&o.length;return(0,F.jsxs)("div",{className:"no-savings-wrapper",children:[a?(0,F.jsxs)("div",{className:"no-savings-header",children:[a?(0,F.jsx)("h2",{children:"Code Entered"}):r?null:(0,F.jsx)("h2",{children:"You have a great price."}),l?(0,F.jsx)("div",{className:"view-codes-link-wrapper",children:(0,F.jsx)("h6",{onClick:r?()=>this.setState({viewCodes:!this.state.viewCodes}):null,className:`${r?"clickable":""} bold"`,children:this.state.viewCodes?(0,F.jsx)("span",{children:"hide codes"}):(0,F.jsxs)("span",{children:[u("coup_fo_202403_test")?"A variety of codes":`${t} ${t===1?"code":"codes"}`," ","tested in ",i," sec."]})})}):null]}):null,this.state.viewCodes&&!r?(0,F.jsx)("div",{className:"view-codes",children:Vt.default.map(o,(c,p)=>{let b=this.state.copied===c.code;return(0,F.jsx)("div",{onClick:this.onClickCopy.bind(this,c.code),style:{animationDelay:`${(p+1)*50}ms`},className:`coupon-list-item-container gray ${b?"copied":""}`,children:(0,F.jsxs)("h4",{className:"code midnight bold",children:[b?(0,F.jsx)("span",{className:"copied-text",children:"COPIED"}):c.code,(0,F.jsx)("span",{className:"hidden",children:c.code})]})},p)})}):null,r&&a?(0,F.jsx)("div",{className:"center-content",children:(0,F.jsxs)("div",{className:"activation-amount",children:[(0,F.jsxs)("h3",{className:"silver",children:[(0,F.jsx)("span",{className:"palmetto bold",children:e.type==="percentage"?`+${e.amount/100}%`:"+"+D(e.amount,{currency:e.currency})})," ",(0,F.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Vt.default.get(this.props,"exclusions")?(0,F.jsx)(ki,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]})}):!e.categories&&a?(0,F.jsx)(Xn.default.Fragment,{children:l?null:(0,F.jsx)("div",{className:"center-content",children:(0,F.jsxs)("h6",{className:"bold",children:[u("coup_fo_202403_test")?"A variety of codes":`${t} ${t===1?"code":"best codes"}`," ","tested in ",i," sec."]})})}):e.categories&&a?(0,F.jsx)("div",{}):(0,F.jsxs)("div",{className:"center-column",children:[(0,F.jsxs)("div",{className:"flex-row best-price-title",children:[(0,F.jsx)("h2",{children:"You have the best price."}),(0,F.jsx)("div",{className:"best-price-image",children:(0,F.jsx)(le,{h:24,w:30})})]}),(0,F.jsxs)("p",{children:["We tried"," ",(0,F.jsx)("span",{children:u("coup_fo_202403_test")?"a variety of codes":`${t} ${t===1?"code":"codes"}`})," ","to make sure you got a great price, but did not find any additional savings."]})]})]})}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}onClickCopy(i){let t=J();li(i),this.setState({copied:i},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),x("trackClick","copyCouponCode","code",{clickId:t})}},Gt=jt;var Tl=_(S());var is=_(S()),Yt=_(Q());var j=_(C()),Kt=class extends is.Component{constructor(...i){super(...i),this.state={}}render(){let{runTimeSeconds:i,couponCount:t,savings:e,reward:o,workingCoupons:s,postCoupons:a,isBonkersSavings:r}=this.props,l=o&&o.amount&&!a;return(0,j.jsxs)("div",{className:`savings-wrapper ${o.categories?"has-categories":""}`,children:[(0,j.jsxs)("div",{className:`coupon-count ${l?"":"no-reward"}`,children:[this.props.requiresInput||r?(0,j.jsx)("h2",{children:"Code Entered"}):(0,j.jsx)("h2",{children:(0,j.jsxs)("span",{children:["You saved ",(0,j.jsx)("span",{className:"palmetto",children:e})]})}),s.length?(0,j.jsxs)("h6",{className:"bold center",children:[s.length," ",s.length===1?" code ":" codes "," worked in"," ",i," sec."]}):(0,j.jsxs)("h6",{className:"bold center",children:[t," ",t===1?" code ":" codes "," tested in ",i," ","sec."]})]}),l||s.length?(0,j.jsxs)("div",{className:"center-content",children:[(0,j.jsx)("div",{className:`flex-center savings-breakdown ${l?"reward":""} ${this.props.hideBorder?"hide-border":""}`,children:(0,j.jsx)("div",{className:"code-scroll-container",children:this.renderWorkingCodes(s)})}),l&&!o.categories&&this.props.requiresInput?(0,j.jsxs)("div",{className:"activation-amount",children:[(0,j.jsxs)("h3",{className:"silver",children:[(0,j.jsx)("span",{className:"palmetto bold",children:o.type==="percentage"?`+${o.amount/100}%`:D(o.amount,{currency:o.currency})})," ",(0,j.jsx)("span",{className:"antialiased",children:"Shopping Rewards"})]}),Yt.default.get(this.props,"exclusions")?(0,j.jsx)(ki,{style:{height:"19px",marginTop:"1px",display:"flex",alignItems:"center",justifyContent:"center"},onDetailsClick:this.onShowExclusion.bind(this)}):null]}):null]}):null]})}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}renderWorkingCodes(i){return Yt.default.map(i,(t,e)=>{let o=this.state.copied===t.code;return(0,j.jsx)("div",{onClick:this.onClickCopy.bind(this,t.code),style:{animationDelay:`${(e+1)*50}ms`},className:`coupon-list-item-container ${o?"copied":""}`,children:(0,j.jsxs)("h4",{className:"code midnight bold",children:[o?(0,j.jsx)("span",{className:"copied-text",children:"COPIED"}):t.code,(0,j.jsx)("span",{className:"hidden",children:t.code})]})},e)})}onClickCopy(i){let t=J();li(i),this.setState({copied:i},()=>{this.timeoutId=setTimeout(()=>{this.setState({copied:!1})},1e3)}),x("trackClick","copyCouponCode","code",{clickId:t})}},Qt=Kt;var v=_(C()),Xt=class extends es.Component{constructor(...i){super(...i),this.state={viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1,currentCodeIndexTigger:0,couponQtTigger:null,viewedInstallmentSurvey:!1,failBackToFinDefault:!1,ctaColorClass:""},this.onInitTryCoupons=()=>{this.setState({willEstimateDuration:!0})},this.onEstimatedCouponDuration=({detail:t})=>{this.setState({estimatedTimeLeft:t.estimatedTimeLeft,currentCodeIndexTigger:t.currentCodeIndex,couponQtTigger:t.couponQt})},this.onFinProductsFail=this.onFinProductsFail.bind(this)}componentDidMount(){document.addEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration);let i=B(N()),t=u("ext_red_cta_202305")&&!i;this.setState({ctaColorClass:t?"red-btn-test":""})}componentWillUnmount(){document.removeEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}resetProgressBarState(){this.setState({viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1,currentCodeIndexTigger:0,couponQtTigger:null,viewedInstallmentSurvey:!1,failBackToFinDefault:!1})}determineCouponCount(){let{view:i}=this.props,t=i.couponCount;return i.manuallyActivatedAutoRun&&(t=i.automaticCoupons&&i.automaticCoupons.length,!t&&i.result&&(t=i.result.coupons&&i.result.coupons.length)),t}getCurrentIndexRoo(){let{coupons:i,couponCount:t,currentCouponCode:e,roo:o}=this.props.view,s=(0,E.default)(i).take(t).map((r,l)=>(r.success=!0,r)).value(),a;return o&&(a=E.default.findIndex(s,r=>r.code===e),s=E.default.map(s,(r,l)=>(l<a?r.success=!0:r.success=!1,r))),a}renderProgressRunning(){let{pause:i,barComplete:t}=this.props,e=Be(g.get("couponView")),{currentCodeIndexTigger:o,couponQtTigger:s,estimatedTimeLeft:a}=this.state,r=this.state.willEstimateDuration?8e4:e.estimatedRunTime,l=e.couponCount,c=e.coupons,p=E.default.get(e,"autoFallback.autoFallbackCouponsCount");p&&Li({autoFallbackCouponsCount:p})&&(l=p,c=E.default.get(e,"autoFallback.coupons")),this.props.manuallyActivatedAutoRun&&(l=e.automaticCoupons&&e.automaticCoupons.length,c=e.automaticCoupons,!l&&e.result&&(l=e.result.coupons&&e.result.coupons.length,c=e.result.coupons));let b={pause:i,estimatedRunTime:e.estimatedRunTime,estimatedDuration:r,estimatedTimeLeft:a,barIsComplete:t,view:e,currentCodeIndexTigger:o,couponCount:l,resetProgressBarState:this.resetProgressBarState.bind(this),roo:e.roo,coupons:c,runTimePerCoupon:e.runTimePerCoupon,couponQtTigger:s};return u("ext_coupons_streamlined_click")?(0,v.jsx)(Ut,{...b}):(0,v.jsx)(Jn,{...b})}renderLeft(){let{running:i,barComplete:t,reward:e,postCoupons:o,pause:s,vendor:a,payoutProcessingPeriod:r,creditsActivated:l,activatingCredits:c,activateRewardsOnly:p,onShowExclusion:b,view:y}=this.props,{result:h,couponCount:m,roo:w}=y,f=E.default.get(h,"pageReload"),k=E.default.filter(E.default.get(h,"coupons"),Di=>Di.savings>0||Di.generatedFreeGift||Di.generatedFreeShipping),T=h&&h.savings&&h.savings>0?D(Math.trunc(h.savings)):0,I=E.default.get(h,"savings")>1e6||typeof T=="string"&&Vi(T)>1e6,P=E.default.get(h,"bestCoupon.code"),z=(E.default.get(h,"runTime",0)/1e3).toFixed(2),$=t&&!s,A=i||f||$,M=h&&(!P||!T)&&!i,W=!$&&!i&&h&&!s,K=h&&h.requiresInput,L=this.props.exclusions,ti=this.props.tld,U=e&&e.amount&&!o&&!y.hasDeferredCouponRewards,yi=!A&&!s&&!i&&!h&&U&&this.props.eligibleForNewUserBonus,ri=!Si()&&u("ext_cnc_img_logo")&&!B(N()),Ci=(!u("ext_coupons_streamlined_click")||!h)&&(0,v.jsxs)(Jt.default.Fragment,{children:[(0,v.jsx)(mt,{domain:this.props.domain,onTryCodes:this.props.onTryCodes.bind(this),onClosePopup:this.props.onClosePopup.bind(this),onToggleSubscribe:this.props.onToggleSubscribe.bind(this),renderViewCodes:this.renderViewCodes.bind(this),renderPostResultCtaInUi:W,loading:this.props.ctaLoading,settings:this.props.settings,roo:w,hideExclusions:this.props.fullPageModal&&this.props.fullPageModal.length>0,creditsActivated:l,activatingCredits:c,activateRewardsOnly:p,exclusions:L,onShowExclusion:b,running:i,result:h,couponCount:m,pageReload:f,savings:T,reward:e,showReward:U}),yi&&(0,v.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,v.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,v.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]});return(0,v.jsx)("div",{className:"left",children:(0,v.jsxs)("div",{className:`result-column ${E.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[A||s?this.renderProgressRunning():!i&&!h||i||f||$?(0,v.jsx)("div",{children:(0,v.jsxs)("div",{className:"found-codes",children:[ri&&(0,v.jsx)(Oi,{domain:N(),cursor:"auto"}),(0,v.jsx)(be,{couponCount:m,showReward:U,reward:e})]})}):M?!y.hasDeferredCouponRewards&&e.categories&&!K?(0,v.jsx)(_e,{reward:e,payoutProcessingPeriod:r,exclusions:L,tld:ti,showDismiss:!0,noSavingsAvailable:!0,vendor:a,couponCount:this.determineCouponCount(),onClosePopup:this.props.onClosePopup.bind(this),onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):(0,v.jsx)(Ct,{exclusions:L,tld:ti,runTimeSeconds:z,roo:w,reward:e,postCoupons:o,requiresInput:K,workingCoupons:k,vendor:a,couponCount:this.determineCouponCount(),manuallyActivatedAutoRun:this.props.manuallyActivatedAutoRun,codes:E.default.get(h,"coupons"),onClosePopup:this.props.onClosePopup.bind(this),onTryCodes:this.props.onTryCodes.bind(this),view:this.props.view}):(0,v.jsx)(Dt,{activateRewardsOnly:p,exclusions:L,tld:ti,runTimeSeconds:z,couponCount:m,savings:T,reward:e,postCoupons:o,workingCoupons:k,requiresInput:K,isBonkersSavings:I,hideBorder:e.categories,onClosePopup:this.props.onClosePopup.bind(this),hasDeferredCouponRewards:y.hasDeferredCouponRewards}),Ci]})})}renderProgressBar(){let{view:i,autoFallback:t}=this.props,{result:e,pageWasReloaded:o,estimatedRunTime:s,runTimePerCoupon:a,roo:r}=this.props.view,l=B(N()),c=i.couponCount,p=i.coupons;this.props.manuallyActivatedAutoRun&&(c=i.automaticCoupons&&i.automaticCoupons.length,p=i.automaticCoupons,!c&&i.result&&(c=i.result.coupons&&i.result.coupons.length,p=i.result.coupons)),u("coupon_non_rerun")&&!l&&t&&i.autoFallback&&(c=E.default.get(i,"autoFallback.autoFallbackCouponsCount",c),p=E.default.get(i,"autoFallback.coupons",p));let{running:b,barComplete:y,pause:h}=this.props,m=this.props.getRunAnimation(this.state.willEstimateDuration),w=(0,E.default)(p).take(c).map((P,z)=>(P.success=!0,P)).value(),f=this.getCurrentIndexRoo(),k=E.default.get(e,"pageReload");return b||k||y&&!h||h?(0,v.jsx)("div",{className:"run-codes",children:(0,v.jsx)(pe,{pause:h,runTimePerCoupon:a,currentCodeIndex:f,estimatedRunTime:s,roo:r,disableChecks:!0,show:b||e,result:e,running:b,coupons:w,stagger:o?0:m.stagger,collapsable:!0})}):null}renderRightComponent(){let{activateRewardsOnly:i,view:t}=this.props,{result:e}=t,{running:o,barComplete:s,reward:a,postCoupons:r,pause:l,payoutProcessingPeriod:c}=this.props,p=e&&e.savings&&e.savings>0?D(Math.trunc(e.savings)):0,b=E.default.get(e,"bestCoupon.code"),y=s&&!l,h=e&&(!b||!p)&&!o,m=!y&&!o&&e&&!l,w=e&&e.requiresInput,f=this.props.exclusions,k=this.props.tld,T=u("il_survey_split")||u("il_survey_no_apr")||u("il_survey_apr"),I=!u("show_rewards")&&!u("show_price_comparison");return m&&!this.props.reportAProblem&&T&&!this.state.viewedInstallmentSurvey?(0,v.jsx)(zt,{dismiss:this.dismissInstallmentSurvey}):m&&t.hasDeferredCouponRewards&&h&&a&&a.amount&&!this.props.reportAProblem?(0,v.jsx)(Nt,{reward:a,payoutProcessingPeriod:c,exclusions:f,tld:k,activateRewardsOnly:i}):u("ext_coupons_streamlined_click")?null:m&&a.categories&&h&&!I&&!this.props.reportAProblem?(0,v.jsx)(oe,{displayInModal:!0,reward:a,tld:k,center:!0,onClosePopup:this.props.onClosePopup.bind(this)}):!t.hasDeferredCouponRewards&&(h&&!a.categories||!h)&&a&&a.amount&&m&&!this.props.reportAProblem&&!w?(0,v.jsx)(_e,{postCoupons:r,reward:a,payoutProcessingPeriod:c,exclusions:f,tld:k,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):this.props.reportAProblem?(0,v.jsx)(yt,{email:this.props.email,onClosePopup:this.props.onClosePopup.bind(this),forceReportCoupon:this.props.forceReportCoupon,toggleReportAProblem:this.props.toggleReportAProblem}):m&&E.default.get(this.props.storeContentApiData,"items.length")?(0,v.jsx)(qt,{data:this.props.storeContentApiData}):m?(0,v.jsx)(je,{onClosePopup:this.props.onClosePopup.bind(this),savings:E.default.get(this.props,"view.savings",0)}):null}renderRight(){return this.props.hideRight?null:(0,v.jsxs)("div",{className:"right",style:u("ext_coupons_streamlined_click")?{display:"block"}:void 0,children:[this.renderProgressBar(),this.renderRightComponent()]})}renderFinLeft(){let{running:i,barComplete:t,reward:e,postCoupons:o,pause:s,vendor:a,payoutProcessingPeriod:r,manuallyActivatedAutoRun:l,creditsActivated:c,activatingCredits:p,activateRewardsOnly:b,onShowExclusion:y,view:h}=this.props,{result:m,couponCount:w,roo:f}=h,k=E.default.get(m,"bestCoupon.code"),T=E.default.get(m,"pageReload"),I=E.default.filter(E.default.get(m,"coupons"),$i=>$i.savings>0||$i.generatedFreeGift||$i.generatedFreeShipping),P=m&&m.savings&&m.savings>0?D(Math.trunc(m.savings)):0,z=E.default.get(m,"savings")>1e6||typeof P=="string"&&Vi(P)>1e6,$=(E.default.get(m,"runTime",0)/1e3).toFixed(2),A=t&&!s,M=i||T||A,W=m&&(!k||!P)&&!i,K=!A&&!i&&m&&!s,L=m&&m.requiresInput,ti=this.props.exclusions,U=this.props.tld,yi=e&&e.amount&&!o,ri=!M&&!s&&!i&&!m&&yi&&this.props.eligibleForNewUserBonus,Ci=u("il_survey_split")||u("il_survey_no_apr")||u("il_survey_apr"),Di=M||s;return(0,v.jsx)("div",{className:"left",children:(0,v.jsxs)("div",{className:`result-column fin-result-column ${E.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[Di?this.renderProgressRunning():!i&&!m||i||T||A?(0,v.jsx)("div",{children:(0,v.jsxs)("div",{className:"found-codes",children:[u("ext_cnc_img_logo")&&N()!=="amazon.com"&&(0,v.jsx)(Oi,{domain:N(),cursor:"auto"}),(0,v.jsx)(be,{couponCount:w,showReward:yi,reward:e})]})}):W?e.categories&&!L?(0,v.jsx)(_e,{reward:e,payoutProcessingPeriod:r,exclusions:ti,tld:U,showDismiss:!0,noSavingsAvailable:!0,vendor:a,couponCount:this.determineCouponCount(),isFinComponent:!0,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):(0,v.jsx)(Gt,{exclusions:ti,tld:U,runTimeSeconds:$,couponCount:w,roo:f,reward:e,postCoupons:o,requiresInput:L,workingCoupons:I,vendor:a,manuallyActivatedAutoRun:l,codes:E.default.get(m,"coupons"),onClosePopup:this.props.onClosePopup.bind(this)}):(0,v.jsx)(Qt,{exclusions:ti,tld:U,runTimeSeconds:$,couponCount:w,savings:P,reward:e,postCoupons:o,workingCoupons:I,requiresInput:L,isBonkersSavings:z,hideBorder:e.categories,onClosePopup:this.props.onClosePopup.bind(this)}),(0,v.jsx)(mt,{domain:this.props.domain,onTryCodes:this.props.onTryCodes.bind(this),onClosePopup:this.props.onClosePopup.bind(this),onToggleSubscribe:this.props.onToggleSubscribe.bind(this),renderViewCodes:this.renderViewCodes.bind(this),renderPostResultCtaInUi:K,loading:this.props.ctaLoading,settings:this.props.settings,roo:f,hideExclusions:this.props.fullPageModal&&this.props.fullPageModal.length>0,creditsActivated:c,activatingCredits:p,activateRewardsOnly:b,exclusions:ti,onShowExclusion:y,running:i,result:m,couponCount:w,pageReload:T,savings:P,reward:e,showReward:yi}),ri&&(0,v.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,v.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,v.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]}),K&&!this.props.reportAProblem&&Ci&&!this.state.viewedInstallmentSurvey?(0,v.jsx)(zt,{dismiss:this.dismissInstallmentSurvey}):K&&e.categories&&W&&!this.props.reportAProblem?(0,v.jsx)(oe,{displayInModal:!0,reward:e,tld:U,center:!0,onClosePopup:this.props.onClosePopup.bind(this)}):(W&&!e.categories||!W)&&e&&e.amount&&K&&!this.props.reportAProblem&&!L?(0,v.jsx)(_e,{postCoupons:o,reward:e,payoutProcessingPeriod:r,exclusions:ti,tld:U,onTryCodes:this.props.onTryCodes.bind(this),ctaColorClass:this.state.ctaColorClass,view:this.props.view}):this.props.reportAProblem?(0,v.jsx)(yt,{email:this.props.email,onClosePopup:this.props.onClosePopup.bind(this),forceReportCoupon:this.props.forceReportCoupon,toggleReportAProblem:this.props.toggleReportAProblem}):K&&E.default.get(this.props.storeContentApiData,"items.length")?(0,v.jsx)(qt,{data:this.props.storeContentApiData}):K?(0,v.jsx)(je,{onClosePopup:this.props.onClosePopup.bind(this),savings:E.default.get(this.props,"view.savings",0)}):null,!Di&&!i&&m?(0,v.jsx)("div",{className:"sticky-cta",children:wi()&&E.default.get(this,"props.view.manuallyActivatedAutoRun")&&!(E.default.get(this,"props.view.result.savings")>0)?(0,v.jsx)(Jt.default.Fragment,{children:(0,v.jsx)(Oe,{view:this.props.view,isCashback:this.props.isCashback,onTryCodes:this.props.onTryCodes.bind(this),buttonClassName:`primary-btn-small ${this.state.ctaColorClass}`})}):(0,v.jsx)("button",{className:`primary-btn-small ${this.state.ctaColorClass}`,onClick:this.props.onClosePopup.bind(this),children:"Continue to Checkout"})}):null]})})}renderFinRight(){if(this.props.hideRight)return null;let{result:t}=this.props.view,{running:e,barComplete:o,pause:s}=this.props,a=E.default.get(t,"pageReload");return(0,v.jsx)("div",{className:"right",children:e||a||o&&!s||s?this.renderProgressBar():(0,v.jsx)(jn,{...this.props,onFail:this.onFinProductsFail})})}renderLayout(){let{view:i}=this.props,t=u("fp_ext_coupon_modal_only")||u("fp_ext_coupon_modal_and_order_confirmation"),e=u("show_financial_products")&&t&&!i.hasDeferredCouponRewards,{failBackToFinDefault:o}=this.state;return e&&!o?(0,v.jsxs)("div",{className:"financial-container",children:[this.renderFinLeft(),this.renderFinRight()]}):(0,v.jsxs)("div",{className:"base",children:[this.renderLeft(),this.renderRight()]})}render(){let{view:i}=this.props;return(0,v.jsx)("div",{className:`render-result-layout ${u("coupon_lg_cta")?"large-notif":""} ${i.hasDeferredCouponRewards?"activate-rewards":""}`,children:(this.props.running||this.props.barComplete)&&u("ext_coupons_streamlined_click")?(0,v.jsx)(Hn,{renderProgressBar:this.renderProgressBar.bind(this),renderProgressRunning:this.renderProgressRunning.bind(this)}):this.renderLayout()})}onFinProductsFail(){this.setState({failBackToFinDefault:!0})}renderViewCodes(){let{coupons:i,result:t,couponCount:e}=this.props.view,o=t?i.slice(e,i.length):i;return o&&o.length>0?(0,v.jsxs)("div",{children:[(0,v.jsx)("h4",{className:"bold",style:{marginBottom:"8px",marginTop:"8px",textAlign:"center"},children:(0,v.jsx)("span",{className:"tertiary-link",onClick:this.onClickViewCode.bind(this),children:this.state.viewCodes?"hide codes":"view codes"})}),(0,v.jsx)(ie,{running:this.props.running,show:!!this.state.viewCodes,coupons:o,collapsable:!0,result:t,disableChecks:!0})]}):null}onClickViewCode(){x("trackClick","toggleCodes",this.state.viewCodes?"hide codes":"view codes"),this.state.viewCodes||ze(),this.setState({viewCodes:!this.state.viewCodes})}onShowNewUserDetails(){x("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}dismissInstallmentSurvey=()=>{setTimeout(()=>{this.setState({viewedInstallmentSurvey:!0})},4e3)}},Zt=Xt;var yp=_(S()),us=_(S()),ai=_(Q());var ts=_(te()),os=_(S());var ns=_(S()),me=_(Q());rt();var Y=_(C()),io=class extends ns.Component{constructor(...i){super(...i)}async componentDidMount(){wi()&&!await fi("couponNotifiedImmediately")&&await Ki("couponNotifiedImmediately",JSON.stringify({notifiedImmediate:!0})),B(N())&&(this.closeTimeout=setTimeout(()=>this.props.onClosePopup(),5e3))}componentWillUnmount(){clearTimeout(this.closeTimeout)}sendCtaEvent({ctaText:i,clickId:t,couponRunId:e,manuallyActivatedAutoRun:o}={}){let s=Gi(t);x("track","couponsModalClickCta",{coupons:this.props.couponsFromResult,bestCoupon:this.props.bestCode,savings:this.props.rawSavings,cashback:this.props.isCashback,triggerType:o?"auto":"auto_fallback",ctaText:i,runDuration:me.default.get(this,"props.runDuration"),clickId:t,redirectId:s,couponRunId:e}),Ei(o?"couponNotification":"couponNotificationResult",i,"cta","primary",{redirect:!0,cashback:this.props.isCashback&&!this.props.hasDeferredCouponRewards,coupons:this.props.couponsFromResult,bestCoupon:this.props.bestCode,savings:this.props.rawSavings,triggerType:o?"auto":"auto_fallback",runDuration:me.default.get(this,"props.runDuration"),clickId:t,redirectId:s,couponRunId:e})}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}async autoCoupNotifClick({manuallyActivatedAutoRun:i,continueCtaText:t,hasReward:e}){let{activateCredits:o,manuallyActivateAutocoupRun:s}=this.props,a=J(),r=ts.default.v4();i&&sessionStorage.getItem("__cos_coupon_run_id")&&(r=sessionStorage.getItem("__cos_coupon_run_id")),this.sendCtaEvent({ctaText:t,clickId:a,couponRunId:r,manuallyActivatedAutoRun:i});let l=g.get("couponsConfig"),c=me.default.get(l,"affiliateLinkCurrentTab")||Ri();if(i)await Ki("manuallyActivatedAutoRun",JSON.stringify({manuallyActivatedAutoRun:!0})),_i("couponNotifiedImmediately"),s({clickId:a,couponRunId:r}),c||(e?o({clickId:a,fromAutoRun:!0,savings:!0,manuallyActivatedAutoRun:!0}):Ie({clickId:a,fromAutoRun:!0}));else{_i("couponNotifiedImmediately");let p={fromAutoRun:!0,clickId:a,couponRunId:r};this.props.onTryCodes({disableAutomatic:!0,disableCookieDrop:!1,config:p})}}determineTryCodeCount(){let{autoFallbackCouponsCount:i,couponCount:t}=this.props;return i&&Li({autoFallbackCouponsCount:i})?i:t}render(){let{activateRewardsOnly:i,reward:t,postCoupons:e,activatingCredits:o,creditsActivated:s,manuallyActivatedAutoRun:a,hasDeferredCouponRewards:r,onShowExclusion:l,vendorName:c}=this.props,p=t&&t.amount&&!e&&!r,b=u("ext_notif_animation")?"btn-wiggle":"",y=this.determineTryCodeCount(),h=me.default.get(this.props,"exclusions"),m=B(N()),w=u("ext_red_cta_202305")&&!m,f=u("coupon_bau_notif_underline"),k={display:"flex",flexDirection:"column",justifyContent:"center"};Si()&&(k={...k,paddingLeft:10,paddingRight:10});let T=$e({couponCount:y,isTryCodesButton:!0}),I=c||N(),P=(0,Y.jsxs)("div",{children:[(0,Y.jsx)("button",{className:`primary-btn-large ${w?"red-btn-test":""} ${b}`,onClick:async()=>{this.autoCoupNotifClick({manuallyActivatedAutoRun:a,continueCtaText:T,hasReward:p})},children:T}),Vo()?(0,Y.jsx)(on,{creditsActivated:s,activatingCredits:o,activateRewardsOnly:i,underlineAndHover:f,ctaText:T,fromAutoCoupImmediateNotif:a}):null,p&&t.type==="threshold"&&t.threshold?(0,Y.jsx)("div",{style:{marginTop:"12px",textAlign:"left"},children:(0,Y.jsx)(Ji,{text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:"The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied. Exclusions apply, see merchant site for details."})}):null,s||o?(0,Y.jsx)("div",{className:`exclusions-wrapper ${o||s?"visible":"invisible"}`,children:(0,Y.jsxs)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px"},children:[(0,Y.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,Y.jsxs)("span",{children:["Rewards may vary based on exchange rates.",h?(0,Y.jsxs)(os.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,Y.jsxs)("span",{className:"tertiary-link-lighter",onClick:l,children:[" ","view details."]})]}):null]})]})}):null]});return(0,Y.jsx)("div",{className:`no-savings-wrapper automatic${m?" amazon":""}`,children:(0,Y.jsxs)("div",{children:[m?(0,Y.jsx)("h2",{className:"left",children:(0,Y.jsx)("span",{children:"Coupon Clipped"})}):(0,Y.jsxs)("div",{children:[!Si()&&(0,Y.jsx)(Oi,{domain:N(),cursor:"auto",autocoup:!0}),(0,Y.jsx)("div",{"data-testid":"right-content",style:k,children:(0,Y.jsx)(be,{couponCount:y,showReward:p,reward:t,vendor:I})})]}),P]})})}},Ze=ve({vendorName:["siteAPIData","meta","name"]},io);var rs=_(S());var _s=_(S());var eo=_(Q());rt();var ss=_(S());var ye=_(C()),va=({activateRewardsOnly:n,toggleHideSecondaryCta:i,hideSecondaryCta:t,activatingCredits:e,creditsActivated:o,ctaText:s}={})=>{let a=B(N()),r=u("ext_red_cta_202305")&&!a,l=u("ext_notif_animation")?"btn-wiggle":"";return(0,ye.jsx)(ss.default.Fragment,{children:e&&t?(0,ye.jsx)("button",{className:`bold primary-btn-large ${r?"red-btn-test":""}`,children:"Activating..."}):o&&t?(0,ye.jsx)("button",{className:`bold primary-btn-large ${r?"red-btn-test":""}`,children:"Activated!"}):(0,ye.jsx)("button",{className:`bold primary-btn-large ${r?"red-btn-test":""} ${l}`,onClick:async()=>{n({ctaText:"dismissCouponNotification",label:s}),i()},children:s})})},as=va;var O=_(C()),to=class extends _s.Component{constructor(...i){super(...i),this.state={hideSecondaryCta:!1},this.onShowExclusion=this.onShowExclusion.bind(this)}componentDidMount(){B(N())?this.closeTimeout=setTimeout(()=>this.props.onClosePopup(),5e3):this.props.noDismissApplySavings()&&this.autoDismissSavingsAvailableModal(),_i("couponNotifiedImmediately")}autoDismissSavingsAvailableModal(){this.closeTimeout=setTimeout(()=>this.props.onClosePopup(null,{autoDismissNotif:!0,runAutomatically:!0}),1e5)}async sendCtaEvent({ctaText:i,notificationText:t,clickId:e}={}){let o=Gi(e);x("track","couponsModalClickCta",{coupons:this.props.couponsFromResult,savings:this.props.rawSavings,bestCoupon:this.props.bestCode,cashback:this.props.isCashback,triggerType:"auto",ctaText:i.toLowerCase(),notificationText:t,runDuration:eo.default.get(this,"props.runDuration"),clickId:e,redirectId:o,couponRunId:g.get(["couponView","result","couponRunId"])}),Ei("couponNotificationResult",i,"cta","primary",{redirect:!0,cashback:this.props.isCashback&&!this.props.hasDeferredCouponRewards,coupons:this.props.couponsFromResult,savings:this.props.rawSavings,bestCoupon:this.props.bestCode,triggerType:"auto",notificationText:t,runDuration:eo.default.get(this,"props.runDuration"),clickId:e,redirectId:o,couponRunId:g.get(["couponView","result","couponRunId"])})}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}componentWillUnmount(){clearTimeout(this.timeout),clearTimeout(this.closeTimeout)}render(){let{activateRewardsOnly:i,savings:t,reward:e,exclusions:o,postCoupons:s,requiresInput:a,didTryCodes:r,running:l,onClosePopup:c,activateCredits:p,activatingCredits:b,creditsActivated:y,isBonkersSavings:h,hasDeferredCouponRewards:m}=this.props,w=e&&e.amount&&!s&&(!m||a),f=e.type==="percentage"?`${e.amount/100}%`:D(e.amount,{currency:e.currency}),k=e&&(!!e.categories||e.estimated),T=e&&e.type==="threshold"&&e.threshold,I=B(N()),P=u("ext_red_cta_202305")&&!I,z=u("ext_notif_animation")?"btn-wiggle":"",$=!1,A="Apply Savings",M="Apply Savings",W=e&&e.amount&&(u("apply_savings_rewards_option")||u("apply_savings_rewards_option_2")),K=W&&!h&&!a?"rewards-only-btn":"";W&&(A="Check for Rewards"),u("apply_savings_rewards_option_2")&&(M="Dismiss with Savings"),(I||h)&&(A="Continue",$=!0);let L=()=>$?`Continue to get ${k?"up to an additional":"an additional"}`:`Click to get ${k?"up to an additional":"an additional"}`,ti=()=>{this.setState({hideSecondaryCta:!0})},U=()=>T?` when you spend ${D(e.threshold,{currency:e.currency})}`:"",yi=`${a||h?"code entered":`you saved ${t} automatically!`} ${w?`${L().toLowerCase()} ${f} back${U()}`:""}`;return(0,O.jsxs)("div",{className:`savings-wrapper automatic ${w?"has-reward":""} ${o?"has-exclusions":""} ${I?" amazon":""}`,children:[(0,O.jsx)(Oi,{domain:N(),cursor:"auto",autocoup:!0}),(0,O.jsxs)("div",{children:[(0,O.jsx)("div",{className:`coupon-count ${w?"":"no-reward"}`,children:a||h?(0,O.jsx)("div",{children:(0,O.jsxs)("h2",{children:["Code Entered",w?(0,O.jsxs)("span",{className:"credits-text",children:[(0,O.jsx)("br",{}),L(),(0,O.jsxs)("span",{className:"palmetto",children:[" ",f," back",U(),"."]})]}):null]})}):(0,O.jsxs)("h2",{className:"result-text",children:[(0,O.jsxs)("span",{children:["You saved",(0,O.jsxs)("span",{className:"palmetto",children:[" ",t," "]})," automatically!"]}),w?(0,O.jsxs)("span",{className:"credits-text",children:[L(),(0,O.jsxs)("span",{className:"palmetto",children:[" ",f," back",U(),"."]})]}):null]})}),(0,O.jsxs)("div",{children:[r&&!l&&(0,O.jsxs)("div",{style:{marginTop:"25px"},children:[W&&!h&&!a&&(0,O.jsx)(as,{creditsActivated:y,activatingCredits:b,activateRewardsOnly:i,toggleHideSecondaryCta:ti,hideSecondaryCta:this.state.hideSecondaryCta,ctaText:A}),!this.state.hideSecondaryCta&&(0,O.jsx)("button",{className:`primary-btn-large ${K} ${P?"red-btn-test":""} ${K?"":z} `,disabled:l||y||b,onClick:async()=>{let ri=J();this.sendCtaEvent({ctaText:A,notificationText:yi,clickId:ri}),w||m&&e&&e.amount?(p({clickId:ri,fromAutoRun:!0,savings:!0,codeEntered:a}),this.timeout=setTimeout(()=>{c()},750)):(Ie({clickId:ri,fromAutoRun:!0,autoSavings:!0}),c())},children:W?M:A})]}),w&&e.type==="threshold"&&e.threshold?(0,O.jsx)("div",{style:{marginTop:"12px",textAlign:"left"},children:(0,O.jsx)(Ji,{text:"*Terms and Conditions Apply",hoverTitle:"This limited time offer is available for one use only.",hoverText:"The spend requirement must be met in a single transaction, on non-excluded items, after discounts, store credits, and redemption dollars are applied, and before taxes and shipping fees are applied. Exclusions apply, see merchant site for details."})}):null,(b||y)&&(!W||W&&this.state.hideSecondaryCta)?(0,O.jsx)("div",{className:"exclusions-wrapper visible",children:(0,O.jsxs)("h4",{style:{fontSize:"12px"},className:"try-more-link",children:["*Rewards may vary based on exchange rates.",o?(0,O.jsxs)(rs.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,O.jsxs)("span",{className:"tertiary-link-lighter",onClick:this.onShowExclusion,children:[" ","view details."]})]}):null]})}):null]})]})]})}},oo=to;var hi=_(C()),no=class extends us.Component{constructor(...i){super(...i),this.state={viewCodes:!1,estimatedTimeLeft:null,willEstimateDuration:!1},this.onInitTryCoupons=()=>{this.setState({willEstimateDuration:!0})},this.onEstimatedCouponDuration=({detail:t})=>{this.setState({estimatedTimeLeft:t.estimatedTimeLeft})}}componentDidMount(){document.addEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.addEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration),!this.props.didTryCodes&&!this.props.running&&this.props.onTryCodes({ignoreCancelled:!0,disableAutomatic:!1,disableCookieDrop:!0})}componentWillUnmount(){document.removeEventListener("__iv_init_try_coupons",this.onInitTryCoupons),document.removeEventListener("__iv_estimated_coupon_try_duration",this.onEstimatedCouponDuration)}render(){let{result:i,couponCount:t,roo:e,hasDeferredCouponRewards:o}=this.props.view,{activateRewardsOnly:s,activateCredits:a,activatingCredits:r,barComplete:l,creditsActivated:c,didTryCodes:p,isCashback:b,manuallyActivateAutocoupRun:y,onShowExclusion:h,onTryCodes:m,pause:w,postCoupons:f,reward:k,running:T}=this.props,I=ai.default.get(i,"pageReload"),P=ai.default.get(i,"originalTotal"),z=ai.default.filter(ai.default.get(i,"coupons"),st=>st.savings>0||st.generatedFreeGift||st.generatedFreeShipping),$=i&&i.savings&&i.savings>0?D(Math.trunc(i.savings)):0,A=ai.default.get(i,"savings")>=1e5||typeof $=="string"&&Vi($)>=1e5,M=ai.default.get(i,"savings")>1e6||typeof $=="string"&&Vi($)>1e6,W=ai.default.get(i,"bestCoupon.code"),K=(ai.default.get(i,"runTime",0)/1e3).toFixed(2),ti=T||I||l&&!w,U=i&&i.requiresInput,yi=i&&(!W||!$)&&!T&&!U,ri=this.props.exclusions,Ci=this.props.tld,Di=k&&k.amount&&!f,$i=ai.default.get(i,"savings"),tt=ai.default.get(i,"coupons"),ot=ai.default.get(this,"props.view.autoCoupConfig.codeCount")||(e?1:2),fs=ai.default.get(this,"props.view.couponCount")-ot,ke=t-Math.min(t,ot),nt=ai.default.get(this,"props.view.result.runTime"),ks=!T&&!i||T||I,gs=!ti&&!w&&!T&&Di&&this.props.eligibleForNewUserBonus;return(0,hi.jsx)("div",{className:"auto-render-result render-result-layout auto",children:(0,hi.jsx)("div",{className:"left full",children:(0,hi.jsxs)("div",{className:`result-column ${ai.default.get(this.props.googleData,"contacts.length")?"has-contacts":""}`,children:[ks?(0,hi.jsx)(Ze,{activateRewardsOnly:s,activateCredits:a,activatingCredits:r,autoCoupTryMoreCount:ke,bestCode:W,couponCount:t,couponsFromResult:tt,creditsActivated:c,didTryCodes:p,exclusions:ri,hasDeferredCouponRewards:o,isCashback:b,manuallyActivateAutocoupRun:y,onShowExclusion:h,onTryCodes:m,postCoupons:f,rawSavings:$i,requiresInput:U,result:i,reward:k,roo:e,runDuration:nt,running:T,runTimeSeconds:K,tld:Ci,couponCount:ot,manuallyActivatedAutoRun:!0,onClosePopup:this.props.onClosePopup.bind(this)}):yi&&!Ai()||ke<0?(0,hi.jsx)(Ze,{activateRewardsOnly:s,activateCredits:a,activatingCredits:r,autoCoupTryMoreCount:ke,autoFallbackCouponsCount:fs,bestCode:W,couponCount:t,couponsFromResult:tt,creditsActivated:c,didTryCodes:p,exclusions:ri,hasDeferredCouponRewards:o,isCashback:b,onShowExclusion:h,onTryCodes:m,postCoupons:f,rawSavings:$i,requiresInput:U,result:i,reward:k,roo:e,runDuration:nt,running:T,runTimeSeconds:K,tld:Ci,onClosePopup:this.props.onClosePopup.bind(this)}):(0,hi.jsx)(oo,{activateCredits:a,activatingCredits:r,activateRewardsOnly:s,autoCoupTryMoreCount:ke,bestCode:W,couponCount:t,couponsFromResult:tt,creditsActivated:c,didTryCodes:p,exclusions:ri,hasDeferredCouponRewards:o,isBigSavings:A,isBonkersSavings:M,isCashback:b,onTryCodes:m,originalTotal:P,postCoupons:f,rawSavings:$i,requiresInput:U,reward:k,runDuration:nt,running:T,runTimeSeconds:K,savings:$,tld:Ci,workingCoupons:z,noDismissApplySavings:this.props.noDismissApplySavings,onClosePopup:this.props.onClosePopup.bind(this)}),gs&&(0,hi.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,hi.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,hi.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]})]})})})}onClickViewCode(){x("trackClick","toggleCodes",this.state.viewCodes?"hide codes":"view codes"),this.state.viewCodes||ze(),this.setState({viewCodes:!this.state.viewCodes})}onShowNewUserDetails(){x("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}},so=no;var he=_(_t()),ls=_(S()),we=_(C());function it({hideNotification:n,shouldDisableCouponNotifAnimation:i,styles:t,children:e}){let{width:o,minHeight:s,marginRight:a,className:r,left:l,right:c,translate:p}=t;return(0,we.jsx)(ls.default.Fragment,{children:i&&!n?(0,we.jsx)("div",{className:r,style:{transform:"translate3d(0,0%,0)",opacity:"1",width:o,minHeight:s,marginRight:a,left:l,right:c,translate:p},children:e}):(0,we.jsx)(he.Motion,{style:{opacity:(0,he.spring)(n?0:1,{stiffness:180,damping:20}),y:(0,he.spring)(n?-100:0,{stiffness:180,damping:20})},children:({opacity:b,y})=>(0,we.jsx)("div",{className:r,style:{transform:`translate3d(0,${y}%,0)`,opacity:`${b}`,width:o,minHeight:s,marginRight:a,left:l,right:c,translate:p},children:e})})})}var Ep=_(S()),cs=_(S());var G=_(C()),ao=class extends cs.Component{state={showCodes:!1};componentDidMount(){localStorage.getItem("__wb_redirecting")&&this.setUpPostRedirect()}setUpPostRedirect(){this.setState({showCodes:!0}),localStorage.removeItem("__wb_redirecting")}render(){let{coupons:i,result:t,couponCount:e}=this.props.view,{reward:o,postCoupons:s,onShowExclusion:a,exclusions:r}=this.props,l=o&&o.amount&&!s,c=!t&&l&&this.props.eligibleForNewUserBonus,p;return o.type==="threshold"&&o.threshold&&(p=D(o.threshold,{currency:o.currency})),(0,G.jsxs)("div",{className:`${u("coupon_lg_cta")?"large-notif":""}`,children:[(0,G.jsxs)("div",{className:"found-codes",children:[u("coupon_lg_cta")&&!this.state.showCodes?(0,G.jsx)("div",{className:"icon-credit"}):null,this.props.reward&&this.state.showCodes?(0,G.jsxs)("h2",{children:["Activated"," ",(0,G.jsxs)("span",{className:"palmetto",children:[o.type==="percentage"?`${o.amount/100}% back`:`${D(o.amount,{currency:o.currency})} in Rewards`,o.type==="threshold"&&o.threshold?` when you spend ${p}`:""]})]}):(0,G.jsxs)("h2",{children:[(0,G.jsxs)("span",{children:["Found ",e," ",e===1?"code":"codes"]}),l?(0,G.jsxs)("span",{children:[" ","and ",(0,G.jsx)("br",{}),"get"," ",(0,G.jsxs)("span",{className:"palmetto",children:[o.type==="percentage"?`${o.amount/100}% back`:`${D(o.amount,{currency:o.currency})} in Rewards`,(0,G.jsx)("br",{}),o.type==="threshold"&&o.threshold?` when you spend ${p}`:""]})]}):null]}),this.state.showCodes?(0,G.jsx)("h4",{className:"bold",children:"click code to copy to clipboard."}):(0,G.jsxs)("h4",{className:"bold",children:["click show ",e===1?"code":"codes"," to save."]})]}),this.state.showCodes?(0,G.jsx)("div",{children:(0,G.jsx)(ie,{show:!0,result:t,running:!1,coupons:i,stagger:0,noScript:!0,collapsable:!0})}):(0,G.jsxs)("button",{className:`primary-btn-large ${u("ext_red_cta_202305")?"red-btn-test":""}`,style:{width:"100%",fontWeight:"bold",marginTop:"20px"},onClick:this.onShowCodes.bind(this),children:["Show ",e===1?"Code":"Codes"]}),c&&(0,G.jsxs)("div",{className:"new-user-bonus",children:["Get an ",(0,G.jsx)("span",{className:"bold",children:"additional $10 in Shopping Rewards"})," today with a qualifying purchase of $25."," ",(0,G.jsx)("span",{className:"primary-link",onClick:this.onShowNewUserDetails.bind(this),children:"Details"})]}),o&&this.state.showCodes&&(0,G.jsx)(ki,{exclusions:r,onDetailsClick:a,style:{display:"flex"}})]})}onShowCodes(){let i=this.props.reward,t=N();x("trackClick","showCodesButton","show codes",{domain:t,cashback:this.props.isCashback}),Ei("couponNotification","show codes","cta","primary",{redirect:!0,cashback:this.props.isCashback,domain:t}),this.props.reward&&(Qi(),x("track","activateCashbackRedirect",{rewardAmount:i.amount,rewardDisplay:i.type}));let{clickId:e}=xe();Ne(e),x("track","showCodes",{cashback:this.props.isCashback,clickId:e}),this.setState({showCodes:!0})}onShowNewUserDetails(){x("trackClick","viewNewUserBonusDetails","Details",{view:"cashbackNotificiation"}),window.open("https://help.capitaloneshopping.com/hc/en-us/articles/360047681572-How-do-I-earn-a-New-Member-Bonus-of-10-in-Wikibuy-Credits-on-my-first-purchase-","_blank")}},ro=ao;var ps=_(S()),ds=_(S());var ei=_(C()),xa=({reward:n,activateRewardsOnly:i,exclusions:t,onShowExclusion:e,onClosePopup:o,activatingCredits:s,creditsActivated:a,onLoad:r})=>{(0,ds.useEffect)(()=>{r(),ge("couponDismissConfirmation")},[]);let l=u("ext_red_cta_202305")?"red-btn-test":"",c=u("ext_red_cta_202305")?"unfavorable-text":"primary-text",p=!s&&!a,b=n.type==="percentage"?`${n.amount/100}%`:D(n.amount,{currency:n.currency}),y=n.type==="threshold"&&n.threshold?` when ${D(n.threshold,{currency:n.currency})} spent`:"",h=`Dismiss with ${b} back${y}`,m="Decline Offer",w;u("notif_areyousure_message")&&(h=`Oops! Activate my ${b} back${y}`,w="Rewards are free and take one click.",m="Yes, close without Rewards");let f=()=>{i({label:h,pageLocation:"couponDismissConfirmation"})},k=()=>{u("notif_areyousure_throttling")&&Mo("areyousure_throttling"),o(m,{pageLocation:"couponDismissConfirmation"})};return(0,ei.jsxs)(bi,{column:!0,alignItems:"center",justifyContent:"center",className:"button-wrapper",children:[(0,ei.jsx)("h2",{style:{marginTop:16,marginBottom:16},children:"Are you sure?"}),w?(0,ei.jsx)(Ti,{variant:"medium",mb:"medium",children:w}):null,s?(0,ei.jsx)("h5",{className:`bold ${c}`,children:"Activating..."}):a?(0,ei.jsx)("h5",{className:`bold ${c}`,children:"Activated!"}):(0,ei.jsx)("button",{className:`primary-btn-large ${l}`,onClick:f,children:h}),p&&(0,ei.jsx)("a",{onClick:k,style:{textDecoration:"none"},children:(0,ei.jsx)(Ti,{secondary:!0,mt:"medium",tag:"h5",style:{fontWeight:700},children:m})}),a||s?(0,ei.jsx)("div",{className:`exclusions-wrapper ${s||a?"visible":"invisible"}`,children:(0,ei.jsxs)("h6",{style:{height:"30px",display:"flex",marginTop:"10px",paddingLeft:"3px"},children:[(0,ei.jsx)("span",{style:{marginRight:"3px"},children:"*"}),(0,ei.jsxs)("span",{children:["Rewards may vary based on exchange rates.",t?(0,ei.jsxs)(ps.default.Fragment,{children:[" ","Terms and exclusions apply,",(0,ei.jsxs)("span",{className:"tertiary-link-lighter",onClick:e,children:[" ","view details."]})]}):null]})]})}):null]})},bs=xa;var X=_(C()),_o=class extends hs.Component{constructor(...i){super(...i),this.state={hideNotification:!0,isThrottled:!1,viewCodes:!1,running:this.props.view.rooRunning,rooRunning:this.props.view.rooRunning,didTryCodes:this.props.view.rooRunning||this.props.view.pageWasReloaded||!1,result:this.props.view.result,roo:this.props.view.roo,showThrottleToolTip:this.props.view.showThrottleToolTip,settings:this.props.settings,ctaLoading:!1,autoFallback:d.default.get(this.props,"affiliateRedirect.autoFallback.autoFallback"),automaticCouponsEnabled:Wo(),manuallyActivatedAutoRun:this.props.view.manuallyActivatedAutoRun||!1,scriptType:d.default.get(g.get("siteAPIData"),"siteData.coupons.type"),showDismissConfirmation:!1,dismissConfirmationDisplayed:!1},this.activateCreditsAfterAutomatic=this.activateCreditsAfterAutomatic.bind(this),this.activateRewardsOnly=this.activateRewardsOnly.bind(this),this.isRewardSite=this.isRewardSite.bind(this),this.boundCloseModal=this.closeModalOnClickOutside.bind(this),this.determineIfCouponsNotifiedImmediately=this.determineIfCouponsNotifiedImmediately.bind(this)}async getContentAPiData(){let i=await Zo();this.setState({storeContentApiData:i})}onDismissConfirmationPageLoad(){this.setState({dismissConfirmationDisplayed:!0})}async componentWillMount(){let i=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun,t=wi()&&i;t&&!this.state.result&&this.sendCouponNotificationEvent({runAutomatically:i,notifyImmediate:t});let e=g.get("siteAPIData"),s=d.default.get(e,"siteData.coupons.type")==="eeyore"&&Ri();localStorage.getItem("__wb_redirecting")?(s||(localStorage.removeItem("__wb_redirecting"),this.setState({redirectInCurrentTab:!1},()=>{let a={manuallyActivatedSameTabReload:this.state.manuallyActivatedAutoRun};this.onTryCodes({disableCookieDrop:!0,config:a})})),await fi("manuallyActivatedAutoRun")&&this.setState({manuallyActivatedAutoRun:!0})):(d.default.get(this.props,"view.affiliateLinkCurrentTab")||Ri())&&this.setState({redirectInCurrentTab:!0})}async componentDidMount(){this.getContentAPiData(),this.isAutoFallback(),fi("manuallyActivatedAutoRun").then(s=>{s&&(this.setState({manuallyActivatedAutoRun:!0}),this.setAutomaticCouponCursor(),g.select("couponView").set("manuallyActivatedAutoRun",!0),this.state.result&&_i("manuallyActivatedAutoRun"))}),await this.determineIfCouponsNotifiedImmediately(),await this.checkThrottledForAutoCoup(),this.checkForCompetitorNotifs(),Do(this.setState.bind(this));let i=!!d.default.get(this.props,"cashbackView.reward.amount");Ai()&&this.state.result&&!this.state.automaticCouponsEnabled&&g.select("couponView").set("isQuietSavingsMiss",!1),this.state.autoFallback&&this.couponsNonRerun(),Ai()&&!this.state.automaticCouponsEnabled&&!this.state.didTryCodes&&!this.state.running&&!this.preparingToRun&&!this.state.result&&!g.get("cashbackVisible")&&(i&&dt({isFromNonAutoRun:!0}),this.setState({hideNotification:!0})),this.props.view.shouldTryCoupons&&!this.state.didTryCodes&&!this.state.running&&!this.preparingToRun&&(this.preparingToRun=!0,this.setState({hideNotification:!1,didTryCodes:!1,result:null,running:!0,barComplete:!1},()=>{this.onTryCodes({ignoreCancelled:!0,disableAutomatic:!1,disableCookieDrop:!1}),this.preparingToRun=!1}));let t=d.default.get(this.props,"view.affiliateLinkCurrentTab")&&this.state.manuallyActivatedAutoRun,e=g.get("couponNotif")==="siteHub",o=this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;o&&this.state.result?this.sendCouponNotificationEvent({runAutomatically:o,isSiteHub:e}):!o&&!t&&this.sendCouponNotificationEvent({runAutomatically:o,isSiteHub:e})}async componentDidUpdate(i,t){let e=this.isRewardSite();if(e&&i.warnAboutStandDown!==this.props.warnAboutStandDown&&this.props.warnAboutStandDown&&!g.get("throttleCreditsReactivation")){let o=await Fo();g.merge({cashback:o}),this.props.router.push("reactivate")}if(this.props.affiliateRedirect!==i.affiliateRedirect&&this.isAutoFallback(),this.state.autoFallback!==t.autoFallback&&this.couponsNonRerun(),this.state.result!==t.result){this.isAutoFallback(),Ai()&&e&&this.state.automaticCouponsEnabled&&d.default.once(()=>dt({result:this.state.result}))();let o,s=g.get("couponNotif")==="siteHub",a=!this.state.manuallyActivatedAutoRun&&this.state.automaticCouponsEnabled||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;this.state.result&&!this.state.manuallyActivatedAutoRun&&(o=this.state.result.autoFallback),a||o?this.sendCouponNotificationEvent({runAutomatically:a,isSiteHub:s}):a||(this.sendCouponNotificationEvent({runAutomatically:a,isSiteHub:s}),this.state.result&&s&&(g.unset("couponNotif"),s=!1))}!i.cashbackView.autoActivate&&this.props.cashbackView.autoActivate&&this.onClosePopup(null,{pageLocation:"shopifyButton"})}componentWillReceiveProps(i){if((!this.preparingToRun&&!this.state.running&&!this.state.didTryCodes&&i.view.shouldTryCoupons&&!this.props.view.shouldTryCoupons||this.state.didTryCodes&&i.view.forceTryCoupons&&!this.props.view.forceTryCoupons)&&(this.preparingToRun=!0,this.setState({hideNotification:!1,didTryCodes:!1,result:null,running:!0,barComplete:!1,roo:i.view.roo,automaticCouponsEnabled:!1},()=>{this.onTryCodes({ignoreCancelled:!0}),this.preparingToRun=!1}),i.view.forceTryCoupons))return;let t={};this.state.rooRunning&&this.props.view.rooRunning&&!i.view.rooRunning&&(t.running=!1,t.rooRunning=!1),!this.props.view.shouldDismissTooltip&&i.view.shouldDismissTooltip&&!this.state.running&&!this.state.result&&this.onDismissTooltip(),i.view.result&&(t.result=i.view.result),i.view.roo&&(t.roo=i.view.roo),d.default.has(i,"view.showThrottleToolTip")&&(t.showThrottleToolTip=i.view.showThrottleToolTip),d.default.has(i,"view.hideThrottleToolTip")&&(t.hideThrottleToolTip=i.view.hideThrottleToolTip),this.setState(t),d.default.has(i,"shouldHidePrompt")&&i.shouldHidePrompt===!0&&!i.shouldShowSPAPrompt&&!this.state.hideNotification&&!this.state.running&&!this.state.results&&(g.unset("shouldHidePrompt"),this.setState({hideNotification:!0}),x("track","hideSPAPrompt",{currentLocation:d.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])})),d.default.has(i,"shouldShowSPAPrompt")&&i.shouldShowSPAPrompt===!0&&this.state.hideNotification&&!this.state.running&&!this.state.result&&(g.unset("shouldShowSPAPrompt"),this.setState({hideNotification:!1}),x("track","showSPAPrompt",{currentLocation:d.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}))}async determineIfCouponsNotifiedImmediately(){let i=await fi("couponNotifiedImmediately");return i&&(this.state.disableAutomatic||this.setState({couponsHasNotifiedInitially:!0}),this.state.result&&_i("couponNotifiedImmediately")),i}couponsNonRerun(){let{autoFallbackCouponsCount:i}=this.determineCouponTryCount();this.setState({couponsNonRerunCreditNotif:!0});let t=Yo(),e=this.isRewardSite(),o=B(N());if(!(u("coupon_non_rerun")&&u("coupon_selective_non_rerun")&&i<=0&&!d.default.get(this.state,"result.errored"))&&u("coupon_non_rerun")&&!o&&i<=0&&!d.default.get(this.state,"result.errored")&&!this.state.couponsNonRerunCreditNotif){if(t&&!e)return;g.set("couponsVisible",!1),this.setState({hideNotification:!0,isThrottled:!0}),ae(),e&&jo()}}isAutoFallback(){if(d.default.get(this.state,"automaticCouponsEnabled")&&this.state.result&&d.default.get(this.state.result,"automaticCouponsRun"))return this.setState({autoFallback:!0}),!0;this.props.affiliateRedirect&&d.default.get(this.props,"affiliateRedirect.autoFallback.autoFallback")&&this.setState({autoFallback:!0})}async checkThrottledForAutoCoup(){if(this.state.automaticCouponsEnabled&&wi()){let i=await ko({domain:N(),message:"isThrottled",fromAutoCoupImmediateNotif:!0});if(i){let{isThrottled:t,fromAutoCoupImmediateNotif:e}=i;e&&t&&this.setState({hideNotification:!0,didTryCodes:!0,isThrottled:!0})}}}async checkForCompetitorNotifs(){this.state.isThrottled||this.setState({hideNotification:!1});let i=200,t=1;for(;i<7e3;){let e=document.querySelector("#honeyContainer"),o=document.querySelector("#piggyWrapper");if(e){let s=e.shadowRoot.querySelector("#honey-shadow").style;e.shadowRoot.querySelector("#cornerContent")&&(s.opacity==="1"||s.visibility==="visible")&&(this.setState({compNotifLoaded:!0,rightOffset:"310px"}),this.setState({compNotifLoaded:!0,rightOffset:"455px"}))}if(o&&(o.offsetWidth>0||o.offsetHeight>0)&&this.setState({compNotifLoaded:!0,rightOffset:"340px"}),(document.querySelector(".ebates-notification")||document.querySelector(".ebates-hover.ebates-hover-top"))&&this.setState({compNotifLoaded:!0,rightOffset:"420px"}),await fo(i),t>25&&(i*=1.5),(this.state.running||this.state.results)&&!this.state.automaticCouponsEnabled)break;t+=1}}async manuallyActivateAutocoupRun({clickId:i,couponRunId:t}={}){this.setState({manuallyActivatedAutoRun:!0,disableAutomatic:!0}),g.select("couponView").set("manuallyActivatedAutoRun",!0),sessionStorage.removeItem("__cos_coupon_run_id"),this.state.rooRunning&&sessionStorage.setItem("__r_reload_auto",JSON.stringify({reload:!0,manuallyActivatedAutoRun:!0}));let o=d.default.get(this.props,"cashbackView.reward")?d.default.get(this.props,"cashbackView.reward"):!1,s=d.default.get(this.props.cashbackView,"postCoupons"),a=!1;o&&o.amount&&!s&&(a=!0),await this.determineShouldRespectSameTab()&&(Ri()||this.state.redirectInCurrentTab)&&(a||!this.props.view.disableAffiliate)&&await Pe(a,{couponRunId:t,clickId:i,fromAutoRun:!1,manuallyActivatedAutoRun:!0})}isRewardSite(){return!!d.default.get(this.props,"cashbackView.reward")}onShowExclusion(){x("trackClick","viewExclusionDetails","view details"),window.open(`${Z}/s/${this.props.tld}/coupon`,"_blank")}isResultWithSavings(){let{result:i,running:t}=this.state;if(i){let e=i.savings&&i.savings>0?D(Math.trunc(i.savings)):0,o=i.requiresInput;return!((!d.default.get(i,"bestCoupon.code")||!e)&&!t&&!o)}return!1}noDismissTest(){return this.isResultWithSavings()&&u("apply_savings_no_dismissal")&&this.isRewardSite()}trackFirstDragEnd=d.default.once((i,t)=>{Eo("couponNotification",i,t)});render(){let{roo:i,reportAProblem:t,forceReportCoupon:e}=this.state,{hideNotification:o}=this.state,s=!this.state.running&&!this.props.view.result,a=this.props.view.noScript,r=!!d.default.get(this.props,"cashbackView.reward.amount"),l=d.default.get(this.props,"vendorName",this.props.tld),c=d.default.get(this.props,"cashbackView.payoutProcessingPeriod",{}),p=B(N()),b=!!(this.state.manuallyActivatedAutoRun||this.shouldShowFullPage()),y=b?"full-page":"",h=p&&(this.state.running||d.default.get(this.state.result,"pageReload")||this.state.barComplete)&&d.default.get(this.props.deweyResult,"pageType")!=="checkoutPage",m=s||h||this.state.running===!1&&u("ext_coupons_streamlined_click")?"hide-right":"",w=u("ext_coupons_streamlined_click")?"streamlined-running":"",f=this.isRewardSite()?d.default.get(this.props,"cashbackView.reward"):!1,k=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun,T=!!(this.state.couponsHasNotifiedInitially&&k||u("ext_notif_appear_no_transition")),{running:I,result:P,pageReload:z}=this.state;if(!wi()&&k&&(!I&&!P||I||z||p&&P.savings<=0||Ai()&&(P.savings<=0||!P.savings))&&(o=!0),wi()&&k&&Ai()&&P&&(P.savings<=0||!P.savings)&&(o=!0),pt(this.state))return null;let A=Lo(this.state.compNotifLoaded),M=Be(this.props.view),W=this.state.showDismissConfirmation?null:(0,X.jsx)(tn,{noDismissApplySavings:this.noDismissTest.bind(this),fullPageModal:y,determineIfCouponsNotifiedImmediately:this.determineIfCouponsNotifiedImmediately.bind(this),noScript:a,onClosePopup:this.onClosePopup.bind(this),reportAProblem:({forceCoupon:L}={})=>{this.setState({reportAProblem:!this.state.reportAProblem,forceReportCoupon:L&&!this.state.reportAProblem})},reportAProblemOpen:this.state.reportAProblem,roo:i,runAutomatically:k,running:this.state.running,didTryCodes:this.state.didTryCodes,view:M,isRewardSite:this.isRewardSite()}),K=(0,X.jsxs)(ms.default.Fragment,{children:[(0,X.jsx)("section",{className:"result-section-wrapper",children:a?(0,X.jsx)(ro,{view:M,reward:f,isCashback:r,postCoupons:d.default.get(this.props,"cashbackView.postCoupons"),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,onShowExclusion:this.onShowExclusion.bind(this),exclusions:this.props.exclusions}):this.state.showDismissConfirmation?(0,X.jsx)("div",{children:(0,X.jsx)(bs,{reward:f,activateRewardsOnly:this.activateRewardsOnly,exclusions:this.props.exclusions,onShowExclusion:this.onShowExclusion.bind(this),onClosePopup:this.onClosePopup.bind(this),activatingCredits:this.state.activatingCredits,creditsActivated:this.state.creditsActivated,onLoad:this.onDismissConfirmationPageLoad.bind(this)})}):k?(0,X.jsx)("div",{children:(0,X.jsx)(so,{activateRewardsOnly:this.activateRewardsOnly,activateCredits:this.activateCreditsAfterAutomatic,activatingCredits:this.state.activatingCredits,barComplete:this.state.barComplete,creditsActivated:this.state.creditsActivated,ctaLoading:this.state.ctaLoading,deweyResult:this.props.deweyResult,didTryCodes:this.state.didTryCodes,domain:N(),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,exclusions:this.props.exclusions,getRunAnimation:this.getRunAnimation.bind(this),isCashback:r,noDismissApplySavings:this.noDismissTest.bind(this),onClosePopup:this.onClosePopup.bind(this),onShowExclusion:this.onShowExclusion.bind(this),onTryCodes:this.onTryCodes.bind(this),manuallyActivateAutocoupRun:this.manuallyActivateAutocoupRun.bind(this),postCoupons:d.default.get(this.props,"cashbackView.postCoupons"),reportAProblem:t,reward:f,running:this.state.running,settings:this.props.settings,tld:this.props.tld,view:M})}):(0,X.jsx)(Zt,{activateRewardsOnly:this.activateRewardsOnly,activatingCredits:this.state.activatingCredits,autoFallback:this.state.autoFallback,barComplete:this.state.barComplete,couponResult:this.state.result,creditsActivated:this.state.creditsActivated,ctaLoading:this.state.ctaLoading,deweyResult:this.props.deweyResult,domain:N(),eligibleForNewUserBonus:this.props.settings.eligibleForNewUserBonus,email:d.default.get(this.props,"session.email"),exclusions:this.props.exclusions,forceReportCoupon:e,fullPageModal:y,getRunAnimation:this.getRunAnimation.bind(this),googleData:this.props.googleData,hideRight:h,isCashback:r,manuallyActivatedAutoRun:this.state.manuallyActivatedAutoRun,onClosePopup:this.onClosePopup.bind(this),onShowExclusion:this.onShowExclusion.bind(this),onToggleSubscribe:this.onToggleSubscribe.bind(this),onTryCodes:this.onTryCodes.bind(this),payoutProcessingPeriod:c,postCoupons:d.default.get(this.props,"cashbackView.postCoupons"),reportAProblem:t,reward:f,running:this.state.running,session:this.props.session,settings:this.state.settings,shortCode:d.default.get(this.props,"session.short_code"),storeContentApiData:this.state.storeContentApiData,tld:this.props.tld,toggleReportAProblem:({forceCoupon:L}={})=>{this.setState({reportAProblem:!this.state.reportAProblem,forceReportCoupon:L&&!this.state.reportAProblem})},vendor:l,view:M})}),y?null:(0,X.jsx)(go,{hasInteractedWithNameChange:this.props.hasInteractedWithNameChange})]});return this.state.showThrottleToolTip?(0,X.jsx)("div",{children:(0,X.jsx)(et.Motion,{style:{opacity:(0,et.spring)(this.state.hideThrottleToolTip?0:1,{stiffness:180,damping:20})},children:({opacity:L})=>(0,X.jsx)(Oo,{tip:!0,tipLabel:"Capital One Shopping tip:",message:(0,X.jsx)("span",{children:'click the "S" above if you want to try codes again.'}),style:{top:"15px",bottom:"auto",width:"461px",left:"auto",right:"310px"},innerStyle:{opacity:`${L}`},onDismissTooltip:this.onDismissTooltip.bind(this)})})}):(0,X.jsx)(ho,{onClick:L=>{this.boundCloseModal(L)},className:o?`disabled coupon-page ${m} ${this.state.resetNotification?y:""} ${k?"run-automatically":""}`:`coupon-page ${w} ${m} ${k?"run-automatically":""} ${y}`,style:{top:0,bottom:"auto",left:A.left??"auto",right:A.right??0,translate:!b&&A.translateX},dragSelector:"header.coupon-header",isDraggable:!b&&u("ext_notif_drag"),onDragEnd:this.trackFirstDragEnd,children:(0,X.jsxs)(it,{hideNotification:o,shouldDisableCouponNotifAnimation:T,styles:{className:`coupon-notification ${k&&Si()||P&&u("ext_coupons_streamlined_click")||p?"":"notification-min-height"}`},children:[W,K]})})}shouldShowFullPage(){if(u("ext_coupons_streamlined_click")||!this.state.manuallyActivatedAutoRun&&!this.state.disableAutomatic&&this.state.automaticCouponsEnabled)return!1;let t=g.get("siteAPIData");return d.default.get(t,"siteData.coupons.type")==="eeyore"?!1:!this.state.barComplete&&!this.state.running&&d.default.get(this.state.result,"savings",0)>0&&(!this.state.qualified||this.state.qualified&&this.state.activated)||this.state.running||!!this.state.result||d.default.get(this.props.view,"forceTryCoupons")}onDismissTooltip({type:i}={}){this.state.tooltipDismissed||(this.setState({hideThrottleToolTip:!0}),this.setState({hideNotification:!0}),this.setState({tooltipDismissed:!0}),zo("hasSeenCouponsThrottleToolTip"))}dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:i,label:t,runAutomatically:e,eventName:o,category:s,pageLocation:a,modalType:r,activateRewardsOnly:l=!1,fromActivateRewards:c=!1,fromAutoCoupImmediateNotif:p=!1}={}){let b=Math.trunc((performance.now()-window.__wb_timing.couponsRequireAt)/1e3),y=g.get(["siteAPIData","siteData","coupons","type"]);c||x("trackClick",o,t,{pageLocation:a,triggerType:e?"auto":null,savings:d.default.get(this,"props.view.result.savings"),bestCoupon:d.default.get(this,"props.view.result.bestCoupon.code"),coupons:d.default.get(this,"props.view.result.coupons"),ctaText:i,runDuration:d.default.get(this,"props.view.result.runTime"),dismissalTimeSeconds:b,category:s,engine:y,modalType:r}),s!=="auto"&&Ei(e&&!p||c?"couponNotificationResult":"couponNotification",t,l?"cta":"dismiss",l?c?"primary":"secondary":"primary",{redirect:l,cashback:l,pageLocation:a,triggerType:e?"auto":null,savings:d.default.get(this,"props.view.result.savings"),bestCoupon:d.default.get(this,"props.view.result.bestCoupon.code"),coupons:d.default.get(this,"props.view.result.coupons"),runDuration:d.default.get(this,"props.view.result.runTime"),dismissalTimeSeconds:b,category:s,engine:y,modalType:r})}async showDismissConfirmationModal(){let i=this.state.scriptType==="eeyore",t=!1;return u("notif_areyousure_throttling")&&(t=await qo("areyousure_throttling")),u("notif_areyousure_inplace")&&this.isRewardSite()&&!t&&!this.state.showDismissConfirmation&&!this.shouldShowFullPage()&&!this.state.showDismissConfirmation&&!this.state.creditsActivated&&!i&&!this.props.cashbackView.autoActivate}async onClosePopup(i,t={}){let{ctaText:e,fromTooltip:o,urlChange:s,fromAutoCoupImmediateNotif:a,autoDismissNotif:r,sameTab:l,pageLocation:c,skipEvent:p}=t,b=await this.showDismissConfirmationModal();if(l||this.setState({hideNotification:!b,resetNotification:!b,showDismissConfirmation:b},()=>{this.timeout=setTimeout(()=>{this.setState({resetNotification:!1})},1e3)}),b&&!this.state.dismissConfirmationDisplayed)return;this.state.rooRunning&&_n(),s||ae();let y=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;y&&a&&ae({fromAutoCoupImmediateNotif:a});let h=c==="couponDismissConfirmation",m=c==="shopifyButton";if(!p){if(this.state.running&&i==="x")return this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:e,label:i,runAutomatically:y,eventName:"dismissCouponNotification",modalType:"runningModal",pageLocation:c,fromAutoCoupImmediateNotif:a});y&&r?this.dismissOrActivateRewardsOnlyCouponNotificationEvent({label:null,runAutomatically:y,eventName:"autoDismissCouponNotification",category:"auto",pageLocation:c,fromAutoCoupImmediateNotif:a}):(!this.state.didTryCodes||y&&(i==="x"||o||h||m))&&this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:e,label:i,runAutomatically:y,eventName:"dismissCouponNotification",pageLocation:c,fromAutoCoupImmediateNotif:a})}}async onToggleSubscribe(){let i=N(),t=this.state.settings.emailPreferences.coupons.domainSubscriptions,e=d.default.includes(t,i),o;e?(x("track","couponSubscribe",{action:"unsubscribed"}),o=d.default.reject(t,a=>a===i)):(x("track","couponSubscribe",{action:"subscribed"}),o=[...t,i]),this.setState({ctaLoading:!0});let s=await Qo(o);if(this.setState({ctaLoading:!1}),s){let a=d.default.clone(this.state.settings);a.emailPreferences.coupons.domainSubscriptions=o,this.setState({settings:a})}}async determineShouldRespectSameTab(){if(!d.default.get(this.props,"view.affiliateLinkCurrentTab")&&!Ri())return!1;let i=!0,t=d.default.get(this,"props.deweyResult.pageData.meta");return t&&d.default.has(t,"disable_aff_link_current_tab")&&(i=!1),i}determineCouponTryCount({disableAutomatic:i,autoFallback:t}={}){let e=this.props.affiliateRedirect,o=d.default.get(g.get("siteAPIData"),"siteData.coupons.type")==="roo",s=d.default.get(this,"props.view.autoCoupConfig.codeCount")||(o?1:2),a=d.default.get(e,"autofallback.autoFallbackCouponsCount")||d.default.get(this,"props.view.couponCount")-s,r=null;return(!i&&this.state.automaticCouponsEnabled||this.state.manuallyActivatedAutoRun)&&(r=s),Li({autoFallbackCouponsCount:a})&&(this.state.autoFallback||t)&&(r=a,this.setFallbackCouponCursor({autoFallbackCouponsCount:a})),{autoCoupTryCount:s,autoFallbackCouponsCount:a,couponTryCount:r}}setAutomaticCouponCursor(){let{autoCoupTryCount:i}=this.determineCouponTryCount(),t=g.select("couponView"),e=Zi(t.get("coupons"));t.set("automaticCoupons",d.default.take(e,i))}setFallbackCouponCursor({autoFallbackCouponsCount:i}){let t=g.select("couponView"),e=d.default.takeRight(t.get("coupons"),i);t.set("autoFallback",{coupons:e,autoFallbackCouponsCount:i})}couponsToTry(i={}){let t=g.select("couponView"),e=t.get("coupons"),{automaticCouponsRun:o,couponTryCount:s,autoFallbackCouponsCount:a}=i,r=o||this.state.manuallyActivatedAutoRun?d.default.take(t.get("coupons"),s):e;return a&&Li({autoFallbackCouponsCount:a})&&this.state.autoFallback&&(r=d.default.takeRight(t.get("coupons"),a),this.setFallbackCouponCursor({autoFallbackCouponsCount:a,coupons:r})),o&&this.setAutomaticCouponCursor(),r}async onTryCodes({ignoreCancelled:i,disableAutomatic:t,disableCookieDrop:e,config:o={}}={}){let{fromAutoRun:s,manuallyActivatedFallback:a,manuallyActivatedSameTabReload:r}=o,{clickId:l,couponRunId:c,isFallbackRun:p}=o,b=g.get("couponNotif")==="siteHub",y=s&&!b,h=!!d.default.get(this.props,"cashbackView.reward.amount"),m=this.props.affiliateRedirect;m&&(y=d.default.get(m,"autoFallback.autoFallback",y)&&!b),this.setState({autoFallback:y}),c=c||sessionStorage.getItem("__wb_amz_coup_id")||d.default.get(m,"couponRunId")||ws.default.v4(),l=l||sessionStorage.getItem("__wb_clickId")||J();let w=d.default.get(g.get("siteAPIData"),"siteData.coupons.type"),f=w==="roo",k=w==="asyncTigger";(b&&this.state.manuallyActivatedAutoRun||p||a)&&(g.select("couponView").set("manuallyActivatedAutoRun",!1),this.setState({manuallyActivatedAutoRun:!1}));let{couponTryCount:T,autoFallbackCouponsCount:I}=this.determineCouponTryCount({disableAutomatic:t,autoFallback:y}),P=d.default.get(this.props,"cashbackView.reward")?d.default.get(this.props,"cashbackView.reward"):!1,z=d.default.get(this.props.cashbackView,"postCoupons"),$=!1;if(P&&P.amount&&!z&&($=!0),await this.determineShouldRespectSameTab()&&(this.state.redirectInCurrentTab||Ri())&&($||!this.props.view.disableAffiliate)&&!e){await Pe($,{clickId:l,couponRunId:c,fromAutoRun:s,autoFallback:{autoFallback:y,autoFallbackCouponsCount:I}});return}this.setState({didTryCodes:!0,running:!0,rooRunning:!!this.props.view.roo,disableAutomatic:t===!0});let M;f?M=ln:k?M=cn:M=Ee;let W=this.getRunAnimation();if(Ho()===!1){sessionStorage.setItem("__wb_amz_coup_id",c),document.querySelector("#nav-link-accountList .nav-line-1").click();return}let L=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled,ti=this.couponsToTry({automaticCouponsRun:L,couponTryCount:T,autoFallbackCouponsCount:I});fe.default.all([M({ignoreCancelled:i,disableAffiliate:e||$||this.props.view.disableAffiliate,coupons:ti,automaticCouponsRun:L,autoFallback:y,manuallyActivatedFallback:a,manuallyActivatedSameTabReload:r,isSiteHub:b,passedInClickId:l,couponRunId:c,cashback:h}),$&&!e?Qi({clickId:l,coupons:!0,fromAutoRun:s,isSiteHub:b}):fe.default.resolve(),f?fe.default.resolve().delay(W.duration):fe.default.resolve()]).then(([U,yi,ri])=>{yi&&x("track","activateCashbackRedirect",{rewardAmount:P.amount,rewardDisplay:P.type}),sessionStorage.removeItem("__wb_clickId"),sessionStorage.removeItem("__wb_amz_coup_id");let Ci=d.default.get(U,"finishWithoutResult")||d.default.get(U,"pageReload")||d.default.get(U,"changePageLocation");setTimeout(()=>{g.unset("affiliateRedirectData"),this.setState({running:!1,barComplete:!0,rooRunning:!1},()=>{setTimeout(()=>this.setState({barComplete:!1,manuallyActivatedAutoRun:!1,currentCodeIndexTigger:0,autoFallback:!1}),300)})},Ci?2400:200)})}async activateCreditsAfterAutomatic({clickId:i,fromAutoRun:t,fromActivateRewards:e,savings:o,codeEntered:s,manuallyActivatedAutoRun:a}={}){let r=await this.determineShouldRespectSameTab(),l=d.default.get(this.props.cashbackView,"postCoupons");this.setState({creditsActivated:!0}),(Ri()||this.state.redirectInCurrentTab||e)&&r&&!a?await Pe(!l,{clickId:i,fromAutoRun:t,fromActivateRewards:e,autoSavings:o,codeEntered:s}):await Qi({clickId:i,coupons:!0,codeEntered:s,fromAutoRun:t,fromActivateRewards:e})}async activateRewardsOnly({clickId:i,fromAutoRun:t,fromActivateRewards:e,ctaText:o,label:s,pageLocation:a,fromAutoCoupImmediateNotif:r}={}){let l=await this.determineShouldRespectSameTab(),c=s||Jo();this.setState({activatingCredits:!0});let p=d.default.get(this.props,"cashbackView.reward"),b=this.state.automaticCouponsEnabled&&!this.state.manuallyActivatedAutoRun||!this.state.disableAutomatic&&this.state.automaticCouponsEnabled;if(ae(),this.dismissOrActivateRewardsOnlyCouponNotificationEvent({ctaText:o,label:c,runAutomatically:b,eventName:"dismissCouponNotification",pageLocation:a,activateRewardsOnly:!0,fromActivateRewards:e,fromAutoCoupImmediateNotif:r}),(this.state.redirectInCurrentTab||e||u("also_pin_202401_test"))&&l){let y=await $o();x("track","activateCashbackRedirect",d.default.assign({rewardAmount:p.amount,rewardDisplay:p.type},y)),this.onClosePopup(c,{skipEvent:!0}),location.href=y.affiliateUrl;return}await Qi({clickId:i,coupons:!0,fromAutoRun:t,fromActivateRewards:!0}),this.setState({activatingCredits:!1,creditsActivated:!0}),x("track","activateCashbackRedirect",{rewardAmount:p.amount,rewardDisplay:p.type}),this.onClosePopup(c,{skipEvent:!0})}getRunAnimation(){let{roo:i,estimatedRunTime:t}=this.props.view,e;return i?e={duration:0,stagger:0}:t<=5e3?e={class:"fast",stagger:500,duration:5500}:t<=1e4?e={class:"medium",stagger:1e3,duration:10500}:t<=15e3?e={class:"slow",stagger:1500,duration:15500}:t<=2e4?e={class:"extra-slow",stagger:2e3,duration:20500}:e={class:"extra-extra-slow",stagger:2500,duration:25500},e}closeModalOnClickOutside(i){let t=!this.state.disableAutomatic&&this.state.automaticCouponsEnabled,e=i.path||i.nativeEvent.composedPath&&i.nativeEvent.composedPath();!d.default.find(e,s=>s.className&&d.default.isString(s.className)&&s.className.includes("coupon-notification"))&&i.isTrusted&&!this.state.hideNotification&&(this.shouldShowFullPage()||t)&&!this.state.running&&this.state.result&&!t&&this.onClosePopup()}async sendCouponNotificationEvent({isSiteHub:i,notifyImmediate:t}={}){await new Promise(z=>setTimeout(z,300));let e=(0,ys.findDOMNode)(this),o="",s="",a="",r="";if(e){let z=e.querySelector("button"),$=e.querySelector("h2"),A=e.querySelector("h4");z&&z.textContent&&(s=z.textContent.toLowerCase()),$&&$.textContent&&(a=$.textContent.toLowerCase()),A&&A.textContent&&(r=A.textContent.toLowerCase())}o=`${a} ${r}`,a==="trying coupon codes"&&(o="");let l=await Po(),c=g.get("affiliateRedirect"),p=d.default.get(c,"redirected"),b=d.default.get(this,"state.result"),y=d.default.get(b,"couponRunId"),h=De({automaticCouponsRun:d.default.get(b,"automaticCouponsRun")||t,autoFallback:d.default.get(b,"autoFallback"),isSiteHub:d.default.get(b,"isSiteHub")||i,manuallyActivatedFallback:d.default.get(b,"manuallyActivatedFallback"),sameTabAffiliateRedirect:p}),m=this.state.result?"couponNotificationResult":"couponNotification",w,f=g.get("lifetimeSavings"),k=d.default.get(f,"lifetimeSavings.amount",0)*100;if(u("ext_coupon_savings_emphasis")&&k>=1e3?w="":m==="couponNotification"&&!p&&(w=Fe()),Ai()){let z=d.default.get(this.state,"result.savings");if(this.state.result&&z<=0&&!i||!this.state.result&&!i)return}let T=d.default.get(b,"savings");T>0&&!d.default.get(b,"bestCoupon")&&(T=0);let I=!!d.default.get(this.props,"cashbackView.reward.amount");d.default.get(this.props,"view.hasDeferredCouponRewards")&&(h==="auto"||h==="auto_fallback"&&T>0)&&(I=!1),x("page",m,{view:m,type:"notification",source:"coupons",cashback:I,cashbackAmount:I?d.default.get(this.props,"cashbackView.reward.amount"):void 0,cashbackType:I?d.default.get(this.props,"cashbackView.reward.type"):void 0,vendorMetaId:d.default.get(this.props,"cashbackView.id"),savings:T,triggerType:h,copyTestVariant:w,couponRunId:y,engine:g.get(["siteAPIData","siteData","coupons","type"]),hasCredits:pt(l),ctaText:s,notificationText:o})}componentWillUnmount(){this.timeout&&clearTimeout(this.timeout),g.get("couponNotif")&&g.unset("couponNotif"),window.removeEventListener("click",this.boundCloseModal)}},Ca=ve({affiliateRedirect:["affiliateRedirect"],view:["couponView"],deweyResult:["deweyResult"],cashbackView:["cashbackView"],exclusions:["siteAPIData","siteData","merchantPage","exclusions"],tld:["siteAPIData","meta","domain"],vendorName:["siteAPIData","meta","name"],giftCardView:["giftCardView"],session:["session"],settings:["settings"],googleData:["googleData"],events:["events"],shouldHidePrompt:["shouldHidePrompt"],shouldShowSPAPrompt:["shouldShowSPAPrompt"],hasInteractedWithNameChange:["hasInteractedWithNameChange"],warnAboutStandDown:["warnAboutStandDown"]},_o);export{Cn as a,li as b,Zi as c,Ua as d,_r as e,Rt as f,qt as g,Ca as h};
