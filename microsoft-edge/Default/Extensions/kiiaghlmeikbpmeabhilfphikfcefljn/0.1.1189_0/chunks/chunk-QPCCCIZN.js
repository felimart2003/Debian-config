import{a as bt}from"./chunk-LZHBEYN5.js";import{a as U,b as lt,c as ut,d as pt,e as dt}from"./chunk-A6E4WAVS.js";import{a as H}from"./chunk-T6N25VDY.js";import{a as V}from"./chunk-IQFNOK3G.js";import{a as E}from"./chunk-YU5QULAP.js";import{a as at}from"./chunk-DGHEKRNY.js";import{a as _t}from"./chunk-VGIBV4EV.js";import{a as st}from"./chunk-65VGUSSD.js";import{a as q,e as F}from"./chunk-O7OTS7RM.js";import{a as rt}from"./chunk-2SFZECRB.js";import{a as g,b as nt,c as k,d as $t,e as Bt,k as ct,m as B,r as mt,v as wt}from"./chunk-R5NGUZ66.js";import{c as D,m as $,o as ot,q as v,u as h}from"./chunk-JJTF2C25.js";import{M as et,N as Mt,a as M,c as At}from"./chunk-3HBOA5LN.js";import{e as _}from"./chunk-3GYLW4KZ.js";var ge=_(g());var Gi=_(g()),It=_(g()),i=_(M());var G=a=>v("getEstimate",a);var yt=a=>v("getCart",a);var Pt=_(At());var si=_(g()),ht=_(g()),p=_(M());function X(a){return v("showFollow",a)}var Jt=_(g()),kt=_(g());var C=_(k()),j=class extends kt.Component{render(){return(0,C.jsx)("div",{className:`annotation-tooltip-component ${this.props.classes||""}`,onClick:t=>{t.stopPropagation()},children:(0,C.jsxs)("div",{className:"annotation-tooltip-container",children:[(0,C.jsxs)("div",{className:"header",children:[(0,C.jsx)(rt,{}),(0,C.jsx)(st,{onClick:this.props.onCloseTooltip.bind(this,"x")})]}),this.props.children]})})}},Y=j;var n=_(k()),Ot={"amazon.com":"Amazon","homedepot.com":"Home Depot","bestbuy.com":"Best Buy","target.com":"Target"},P=class extends ht.Component{componentDidMount(){h("page",`offersListAnnotationTooltip${this.props.deweyPC?"_runv4":""}`,{view:this.props.view||"serpProductAnnotation",type:"notificationHover",searchIndex:this.props.searchIndex})}render(){let t=!p.default.get(this.props,"deweyPC",!1),o=!!p.default.find(this.props.filteredResults,e=>p.default.get(e,"pricing.coupons.length")&&!p.default.get(e,"meta.paymentsSupport")||p.default.get(e,"pricing.reward"));return(0,n.jsx)(Y,{classes:`result-table-tooltip ${(this.props.originVendor||"").replace(".com","")}`,onCloseTooltip:()=>this.props.hideSavingsDetails(),children:(0,n.jsxs)("div",{className:`${o?"special-offers":""} result-list`,children:[(0,n.jsxs)("div",{className:"list-header",children:[(0,n.jsx)("h3",{className:"seller",children:"Seller"}),(0,n.jsx)("h3",{className:"delivery",children:"Delivery"}),(0,n.jsx)("h3",{className:"offer",children:"Special Offer"}),(0,n.jsx)("h3",{className:"total",children:"Est. Total"})]}),p.default.map(this.props.filteredResults,e=>{let r=p.default.get(e,"pricing.afterRewardTotal")||p.default.get(e,"pricing.total"),s=p.default.get(e,"pricing.credits.qualifyToRedeemCredits",!1),w=s?p.default.get(e,"pricing.credits.creditAmount",0):0,y=p.default.get(e,"product.vendor"),l=p.default.get(e,"product.vendorName")||Ot[y]||y;p.default.get(e,"meta.paymentsSupport")&&(l="Capital One Shopping");let u=p.default.get(e,"pricing.reward");u&&(u=u.type==="percentage"?(0,n.jsxs)("span",{className:"palmetto",children:[`+${u.amount/100}% `," ",(0,n.jsx)("span",{className:"reward-break",children:"back"})]}):(0,n.jsxs)("span",{children:[`+${E(u.amount,{currency:u.currency})}`," ",(0,n.jsx)("span",{className:"reward-break",children:"in Rewards"})]}));let c,x=`Automatically redeem ${E(w)} in Capital One Shopping credits toward this purchase. A ${E(w)} ${l} gift card will be automatically issued and applied during your checkout.`;s&&(c=(0,n.jsx)("span",{className:"palmetto",title:x,children:"with rewards"}));let N=p.default.get(e,"pricing.coupons.length")?"use code":"",b=p.default.get(e,"meta.verificationClassifierOutput.verified"),z=p.default.get(e,"details.estimatedDeliveryMinDays"),R=p.default.get(e,"details.estimatedDeliveryMaxDays"),W=z===R?R?`${R} days`:"":`${z} - ${R} days`;return(0,n.jsxs)("div",{className:"result-list-item",onClick:f=>{f.stopPropagation(),this.visitMerchant(e)},children:[(0,n.jsx)("h3",{className:`seller ${b?"verified":""}`,children:l==="Amazon"&&!e.origin?"Amz. Marketplace":l}),(0,n.jsx)("h3",{className:"delivery",children:(0,n.jsx)("span",{children:W})}),(0,n.jsx)("h3",{className:"offer",children:(0,n.jsx)("span",{children:s?c:N&&!p.default.get(e,"meta.paymentsSupport")?(0,n.jsx)("span",{className:"icon-coupon coupon",children:N}):u?(0,n.jsx)("span",{children:u}):null})}),(0,n.jsx)("h3",{className:"total primary-btn-large",children:E(r)})]},e.id)}),this.props.fullRunComplete?null:(0,n.jsxs)("h5",{className:"finding-more bold",children:["Finding more offers"," ",(0,n.jsxs)("div",{className:"wave",children:[(0,n.jsx)("span",{className:"dot"}),(0,n.jsx)("span",{className:"dot"}),(0,n.jsx)("span",{className:"dot"})]})]}),t&&this.props.wbid?(0,n.jsxs)("span",{children:[(0,n.jsx)("div",{className:"rule"}),(0,n.jsx)("h5",{style:{textAlign:"center",marginTop:"10px"},children:(0,n.jsx)("span",{className:"primary-link",onClick:e=>{e.preventDefault(),this.props.viewProductPage("view")},children:"View all offers"})})]}):null]})})}visitMerchant(t){X({details:t,run:this.props.run,productData:t.product}),this.props.visitMerchant(t,!0)}};var K=_(M());function gt(a){let t=K.default.get(a,"savingsWithRewards")||K.default.get(a,"savings")||0;return Math.max(0,t)}var ft=_($t()),O=_(g());var vt=_(Bt()),zi=_(g()),xt=_(k()),L=a=>{let{containerNamespace:t,children:o}=a,e=D.get(["additionalContentNamespace",t])();if(!e)return null;let r=".__wikibuy",s=(0,O.useRef)();return s.current||(s.current=document.createElement("div"),e.querySelector(r).appendChild(s.current)),(0,O.useEffect)(()=>()=>e.querySelector(r).removeChild(s.current),[]),ft.default.createPortal((0,xt.jsx)(vt.StyleSheetManager,{target:s.current,children:o}),s.current)};var Li=_(g());var Ct=_(g()),S=_(k()),Lt=({annotationType:a,content:t,onDismissAnnotation:o})=>((0,Ct.useEffect)(()=>{h("page",`${a}Tooltip`,{type:"notificationHover",label:t.deviceType||t.label,view:t.view})},[]),(0,S.jsxs)(B,{className:"server-driven-annotation-container",onClick:e=>{e.stopPropagation()},children:[(0,S.jsx)(B,{display:"flex",justifyContent:"end",children:(0,S.jsx)(B,{style:{cursor:"pointer"},onClick:()=>{o&&(o(),h("page",`${a}Tooltip`,{type:"notificationDismiss",label:t.deviceType||t.label,view:t.view}))},children:(0,S.jsx)(ct,{name:"close",fill:"borderNeutralEmphasisLow",width:13,height:13})})}),(0,S.jsx)(bt,{content:t})]})),St=Lt;var d=_(k()),T="product-estimate-annotation-addtl-content",Rt=a=>{let{saveButtonDomElem:t,children:o,showSavingsDetails:e,hideSavingsDetails:r}=a;if(!t)return null;let w=!!D.get(["additionalContentNamespace",T])().querySelector(`.__${T}.open-right`),{bottom:y,right:l,left:u}=t.getBoundingClientRect(),c=document.documentElement;return(0,d.jsx)("div",{className:"product-estimate-annotation",onMouseEnter:e,onMouseLeave:r,style:{position:"absolute",top:y+window.scrollY,...w?{right:c.clientWidth-l+window.scrollX,left:"auto"}:{right:"auto",left:u+window.scrollX},zIndex:2147483647,width:"min-content"},children:o})},J=class extends It.Component{constructor(...t){super(...t),this.state={runId:null,deweyPC:i.default.get(this.props.input,"deweyPC",!1)}}pollingRetriesCount=0;componentWillMount(){this.props.asin?G({asin:i.default.get(this.props,"asin"),originMerchantId:i.default.get(this.props,"originMerchantId"),discount:i.default.get(this.props,"discount"),sellerId:i.default.get(this.props,"sellerId"),product:i.default.get(this.props,"product"),price:i.default.get(this.props,"price")}).then(t=>{let o=i.default.get(t,"pricing.updatedPricingRunId");this.setState({runId:o});let e;o!==i.default.get(t.cart,"items[0].id")?this.pollForComplete(o):e=!0,this.setState({error:t.error,cart:t.cart,pricing:t.pricing,product:t.product,fullRunComplete:e})}):this.props.input&&G({product:i.default.get(this.props.input,"product"),gtin:i.default.get(this.props.input,"product.gtin"),unpricedResults:i.default.get(this.props.input,"unpricedResults"),meta:i.default.get(this.props.input,"meta"),deweyPC:this.state.deweyPC}).then(t=>{let o=i.default.get(t,"pricing.updatedPricingRunId");this.setState({runId:o});let e;o!==i.default.get(t.cart,"items[0].id")?this.pollForComplete(o):e=!0,this.setState({error:t.error,cart:t.cart,pricing:t.pricing,product:t.product,fullRunComplete:e})})}componentDidMount(){h("page",`productEstimateAnnotation${this.state.deweyPC?"_runv4":""}`,{view:"productEstimateNotificaton",type:"annotation",searchIndex:this.props.searchIndex}),this.pollingRetriesCount=0,this.isInteractingWithTooltip=!1,this.isInteractingWithSaveButton=!1,this.saveButton.addEventListener("mouseenter",this.onEnterSavingsButton.bind(this)),this.saveButton.addEventListener("mouseleave",this.onLeaveSavingsButton.bind(this));try{document.querySelector("#web .reg").style.setProperty("overflow","visible","important")}catch{}this.props.simulateResize&&window.dispatchEvent(new Event("resize"))}savingsButtonOnClick(t,o,e,r){return t&&o?this.viewWirelessDevicePage.bind(this,e):t&&!r?this.viewProductPage.bind(this,"savingsButton"):()=>{}}render(){let t=(this.props.waitForFullRun?this.state.fullRunComplete:this.state.cart)||!!this.state.error,o=i.default.get(this.state,"cart.items[0]"),e=i.default.get(this.state,"cart.items[0].results"),r=i.default.get(this.props.input,"unpricedResults[0].vendor"),s=i.default.get(o,"inputData.vendor");t&&this.props.runCompleteCb&&this.props.runCompleteCb(),ot()&&this.state.runId&&h("page","disableNotifPcTest",{quoteId:this.state.runId,view:"productEstimateAnnotation",type:"test"});let w=0,y=[],l=i.default.filter(e,m=>{let I=i.default.get(m,"product.vendorName"),Et=i.default.get(m,"origin");if(s!=="amazon.com"&&Et)return!1;if(I==="eBay"&&!i.default.get(m,"meta.paymentsSupport")){if(w<3)return w++,y.push(I),!0}else if(i.default.get(m,"pricing.total")&&y.indexOf(I)===-1&&(y.length<12||i.default.get(m,"product.vendor")===r))return i.default.get(m,"meta.paymentsSupport")||y.push(I),!0}),u=i.default.get(this.state,"cart.items[0].originResult")||i.default.find(e,{origin:!0});if(u){i.default.set(u,"meta.verificationClassifierOutput.verified",!0),i.default.set(u,"origin",!0);let m=i.default.findIndex(l,I=>I.id===u.id);m&&(l[m]=u)}let c=i.default.get(this.state,"cart.items[0].result")||i.default.find(e,{heroOffer:!0}),x=i.default.get(c,"pricing.afterRewardTotal")||i.default.get(c,"pricing.total")||i.default.get(l,"[0].pricing.afterRewardTotal")||i.default.get(l,"[0].pricing.total")||i.default.get(l,"[1].pricing.afterRewardTotal")||i.default.get(l,"[1].pricing.total"),N=i.default.find(l,m=>m&&m.vendor===i.default.get(this.props.input,"unpricedResults[0].vendor")),b;i.default.get(u,"pricing.total")&&(i.default.get(c,"pricing.afterRewardTotal")||i.default.get(c,"pricing.total"))?b=gt(c):N&&(b=i.default.get(N,"pricing.total")-x,b=x&&b>0?b:0);let z=i.default.get(c,"pricing.afterRewardTotal")<i.default.get(this.props,"notification.run.originResult.pricing.total")?i.default.get(c,"pricing.reward.amount"):null,R=D.get("deweyResult")||{},{pageType:W}=R,f=i.default.get(this.props,W==="productPage"?"notification.wirelessPriceComparison":`notification.wirelessPriceComparisonCart.${this.props.asin}`),A=t&&!b&&f&&!!f.ui,Tt=`${t?`${A||(b||z)&&(l.length>1||l.length&&i.default.get(l,"[0].product.vendor")!==r)?"savings":"no-savings"}`:"searching"}`,Nt=this.state.showSavingsDetails,zt=i.default.get(c,"pricing.credits.qualifyToRedeemCredits",!1),Dt=i.default.get(this.state,"product.wbid");return(0,d.jsx)("div",{className:`product-estimate-annotation ${Nt?"tooltip-open":""}`,children:(0,d.jsxs)("div",{className:`savings-button ${Tt}`,onClick:this.savingsButtonOnClick(t,A,f&&f.link,this.state.deweyPC),ref:m=>this.saveButton=m,children:[(0,d.jsx)(H,{}),t?zt&&b>0?(0,d.jsx)(pt,{savings:b}):b&&x?(0,d.jsx)(dt,{savings:b,reward:z}):A?(0,d.jsx)(lt,{data:f}):(0,d.jsx)(ut,{productNotFound:!u}):(0,d.jsx)(U,{}),b&&l.length&&this.state.showSavingsDetails?(0,d.jsx)(L,{containerNamespace:T,children:(0,d.jsx)(Rt,{saveButtonDomElem:this.saveButton,showSavingsDetails:()=>this.isInteractingWithTooltip=!0,hideSavingsDetails:this.onLeaveToolTip.bind(this),children:(0,d.jsx)(P,{wbid:Dt,originVendor:this.props.originVendor,view:"productEstimateAnnotation",hideSavingsDetails:()=>{this.isInteractingWithTooltip=!1,this.hideSavingsDetails()},viewProductPage:this.viewProductPage.bind(this),visitMerchant:this.visitMerchant.bind(this),filteredResults:l,searchIndex:this.props.searchIndex,fullRunComplete:this.state.fullRunComplete,run:o,deweyPC:this.state.deweyPC})})}):A&&this.state.showSavingsDetails?(0,d.jsx)(L,{containerNamespace:T,children:(0,d.jsx)(Rt,{saveButtonDomElem:this.saveButton,showSavingsDetails:()=>this.isInteractingWithTooltip=!0,hideSavingsDetails:this.onLeaveToolTip.bind(this),children:(0,d.jsx)(St,{annotationType:"wireless",content:f,onDismissAnnotation:()=>this.hideSavingsDetails(),...this.props})})}):null]})})}onEnterSavingsButton(){this.isInteractingWithSaveButton=!0,this.showSavingsDetails()}onLeaveSavingsButton(){this.isInteractingWithSaveButton=!1,this.scheduledHidingSavingsDetails()}onLeaveToolTip(){this.isInteractingWithTooltip=!1,this.scheduledHidingSavingsDetails()}showSavingsDetails(){this.setState({showSavingsDetails:!0})}hideSavingsDetails(){this.setState({showSavingsDetails:!1})}scheduledHidingSavingsDetails(){setTimeout(()=>{this.isInteractingWithTooltip||this.isInteractingWithSaveButton||this.hideSavingsDetails()},500)}viewWirelessDevicePage(t){t&&V(t)}viewProductPage(t){if(i.default.get(this.state,"deweyPC"))return;let e=i.default.get(this.state,"product.wbid"),r=i.default.get(this.state,"product.url"),s=this.state.useEstimateRun?i.default.get(this.state,"pricing.estimateRunId"):i.default.get(this.state,"pricing.updatedPricingRunId");if(h("trackClick","viewProductPage","",{view:this.props.view,pageLocation:"annotation",productId:e,productUrl:r,label:String(t),searchIndex:this.props.searchIndex}),r&&s){if(!e)return;V(`${q}${r}?extReq=true${s?`&run=${s}`:""}${this.props.originVendor?`&originVendor=${this.props.originVendor}`:""}`)}}visitMerchant(t){let o=this.state.useEstimateRun?i.default.get(this.state,"pricing.estimateRunId"):i.default.get(this.state,"pricing.updatedPricingRunId"),e=i.default.get(t,"id"),r=i.default.get(t,"resultId"),s=i.default.get(t,"meta.paymentsSupport"),w=i.default.get(t,"product.url");if(s)window.open(`${q}/run/${o}/place-order/${e}`),h("trackClick","checkout","",{view:"resultListTooltip",pageLocation:"annotation",matchDomain:i.default.get(t,"product.vendor"),matchUrl:w,matchId:e,resultId:r,quoteId:o,searchIndex:this.props.searchIndex});else{let y="visitMerchant",{clickId:l,redirectId:u}=at(),c=!!i.default.get(t,"pricing.reward.amount"),x=_t({params:{channel:c?"cashback-ims":"cart",clickEvent:y,destUrl:w,destDomain:i.default.get(t,"product.vendor"),redirectId:u,subExperience:"product_view_offer",vendorMetaId:i.default.get(t,"pricing.reward.id"),runId:o},isWbPublisher:!0});window.open(x),h("track",y,{view:"resultListTooltip",pageLocation:"annotation",matchDomain:i.default.get(t,"product.vendor"),matchUrl:w,matchId:e,resultId:r,quoteId:o,clickId:l,redirectId:u,searchIndex:this.props.searchIndex})}}async pollForComplete(t){if(t&&this.pollingRetriesCount<F){let o=await yt({runId:t});o?(!i.default.get(o,"items[0].originResult.pricing.total")&&i.default.get(o,"items[0].results.length")===1?this.setState({fullRunComplete:!0,useEstimateRun:!0}):this.setState({cart:o,fullRunComplete:!0}),this.pollingRetriesCount=0):(this.pollingRetriesCount+=1,await Pt.default.resolve().delay(2e3),this.pollForComplete(t))}else this.pollingRetriesCount>=F&&this.setState({cart:{items:[]},fullRunComplete:!0})}},Q=nt({notification:["notification"]},J);Mt();function Z(a=0,t=0){return $("disable_price_run")&&t>0&&a<=t?(et([`***price run is disabled for items <= $${Math.round(t)/100}***`]),!0):!1}var tt=_(M()),it=_(k()),Wt="/offers";function qt(a){return a.disablePriceRun?a.disablePriceRun():Z(tt.default.get(a,"input.product.price")||tt.default.get(a,"price"),a.cutOffPriceForPriceRunsInCents)}function Ft({insertAfterElement:a,additionalClass:t,cssUrl:o,removeExistingApp:e=!1},r={}){if(qt(r))return;function s(w){return $("show_price_comparison")?(0,it.jsx)(mt,{children:(0,it.jsx)(Q,{...w})}):null}return wt({initialRoute:Wt,cssUrl:o||"offers.css",disableDelay:!0,additionalClass:`__product-estimate-annotation ${t||""}`,app:s(r),insertAfterElement:a,removeExistingApp:e,additionalContent:{namespace:T}},()=>{})}var Te=a=>v("getConquestConfig",a);export{X as a,Y as b,gt as c,St as d,Z as e,Wt as f,Ft as g,Te as h};
