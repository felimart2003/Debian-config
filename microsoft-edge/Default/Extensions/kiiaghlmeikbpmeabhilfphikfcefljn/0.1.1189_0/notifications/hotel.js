import{a as ei}from"../chunks/chunk-YC7SMHXH.js";import{a as M,b as yi,c as O,d as wi}from"../chunks/chunk-YSNSTAAB.js";import{a as K,c as Q}from"../chunks/chunk-A6E4WAVS.js";import{a as J}from"../chunks/chunk-T6N25VDY.js";import{a as _i}from"../chunks/chunk-RQD6OPCK.js";import{a as ii}from"../chunks/chunk-MV4HDL2S.js";import{a as Z}from"../chunks/chunk-BWSZUVAY.js";import{a as h}from"../chunks/chunk-YU5QULAP.js";import{a as U}from"../chunks/chunk-DGHEKRNY.js";import{a as V}from"../chunks/chunk-VGIBV4EV.js";import{a as P}from"../chunks/chunk-65VGUSSD.js";import{f as G}from"../chunks/chunk-O7OTS7RM.js";import{a as X}from"../chunks/chunk-2SFZECRB.js";import{a as di}from"../chunks/chunk-D2CCZ3BJ.js";import{a as D,b as j,c as v,d as ki,r as R,u as Y,v as H}from"../chunks/chunk-R5NGUZ66.js";import"../chunks/chunk-O4TFJKJQ.js";import{c as f,e as L,m as S,q,u as d}from"../chunks/chunk-JJTF2C25.js";import"../chunks/chunk-6LTHT6DZ.js";import"../chunks/chunk-JV3JVBWM.js";import{E as li,M as E,N as si,a as B}from"../chunks/chunk-3HBOA5LN.js";import"../chunks/chunk-4NTWQHWX.js";import"../chunks/chunk-YHJJDH4X.js";import{e as s}from"../chunks/chunk-3GYLW4KZ.js";var m=s(B());var l_=s(D());var Hi=s(D()),ti=s(D()),oi=s(ki()),z=s(di());var c=s(B());var N=n=>q("visitHotel",n);var y=s(v()),F=class extends ti.Component{state={};constructor(...i){super(...i),this.state={hideNotification:!0}}componentDidMount(){let i=c.default.get(this.props,"view.hotel");if(i){let _=this.getWikibuyHotelEventData(i);_.searchId=c.default.get(this.props.view,"searchId"),d("page","wbHotelNotification",_)}setTimeout(()=>{this.setState({hideNotification:!1})},500)}render(){let{hideNotification:i}=this.state,{hotel:_,url:t,discount:o,rewards:r,headerText:a,subheaderText:e,imageUrl:b,buttonText:l,footerText:k}=c.default.get(this.props,"view",{}),{stars:p,distance:g}=_,x=!0,C=!0;if(a)return(0,y.jsx)("div",{className:i?"disabled hotel-page":"hotel-page",style:{top:x?"0":"auto",bottom:x?"auto":"0",left:C?"auto":"0",right:C?"0":"auto"},children:(0,y.jsx)(z.Motion,{style:{opacity:S("ext_notif_appear_no_transition")?(0,z.spring)(i?0:1,{stiffness:400,damping:25}):(0,z.spring)(i?0:1,{stiffness:180,damping:20}),y:S("ext_notif_appear_no_transition")?i?x?-100:100:0:(0,z.spring)(i?x?-100:100:0,{stiffness:180,damping:20})},children:({opacity:ui,y:bi})=>(0,y.jsxs)("div",{className:"hotel-notification",style:{transform:`translate3d(0,${bi}%,0)`,opacity:`${ui}`},children:[(0,y.jsxs)("header",{children:[(0,y.jsx)(X,{}),(0,y.jsx)(P,{onClick:this.onClosePopup.bind(this,"x")})]}),(0,y.jsxs)("section",{children:[(0,y.jsx)("h2",{children:this.formatHeader(a,_,o,r)}),e&&(0,y.jsx)("h4",{style:{marginBottom:0},children:e.replace("{stars}",p).replace("{distance}",g)}),b&&(0,y.jsx)("img",{src:b,style:{width:"100%",marginTop:10},onError:W=>{W.target.onError=null,W.target.src=G+"/images/upload_content/hotel_placeholder_light.jpeg"}}),(0,y.jsx)("div",{className:"button-wrapper",children:(0,y.jsx)("button",{className:"primary-btn-large",onClick:()=>this.onClickDeal(t),children:l})}),k&&(0,y.jsx)("h6",{style:{fontStyle:"italic",marginTop:5},children:k})]})]})})})}formatHeader(i,_,t,o){let r,a=_.address;return r=i.replace("{discount}",h(t,{removeCents:!0})).replace("{title}",_.name).replace("{city}",a.cityName).replace("{state}",a.stateCode!==""?a.stateCode:a.stateName),o&&o.amount&&o.type=="fixed"&&(r=r.replace("{rewards}",h(o.amount*100,{removeCents:!0}))),o&&o.amount&&o.type=="percentage"&&(r=r.replace("{rewards}",`${Math.floor(o.amount)}%`)),r}getTextProperties(){let i=oi.default.findDOMNode(this),_=i.querySelector("section"),o=i.querySelector("button").innerText;return{notificationText:_.innerText.replace(`
${o}`,""),ctaText:o}}async onClickDeal(i,_){let t=c.default.get(this.props,"view.hotel");t&&(d("trackClick","wbViewHotelDeal","view hotel",{...this.getWikibuyHotelEventData(t),dest_domain:"capitaloneshopping.com",dest_url:i,searchId:c.default.get(this.props.view,"searchId")}),N({redirect:i})),_||this.setState({hideNotification:!0})}onClosePopup(i){this.setState({hideNotification:!0});let _=c.default.get(this.props,"view.hotel.wikibuyHotel");if(_){let t=this.getWikibuyHotelEventData(_);t.searchId=c.default.get(this.props.view,"hotel.searchId"),d("trackClick","wbDismissHotelNotification",i,t)}else d("trackClick","dismissHotelNotification",i,{...this.getTextProperties(),type:"notification",view:"hotelNotification",searchId:c.default.get(this.props.view,"hotel.searchId")})}getWikibuyHotelEventData(i){let{address:_,id:t,name:o,offers:r}=i,a=c.default.get(this.props,"view.hotel.searchParams"),e={...this.getTextProperties(),...a,hotelId:t,hotelLocation:`${_.cityName}, ${_.stateCode}`,hotelName:o,pricePostDiscount:r[0].pricing.pricePostDiscount.toString(),pricePreDiscount:r[0].pricing.pricePreDiscount.toString(),type:"notification",url:location.href,view:"hotelNotification",searchId:c.default.get(this.props.view,"hotel.searchId")};return e.latitude=e.latitude?e.latitude.toString():e.latitude,e.longitude=e.longitude?e.longitude.toString():e.longitude,e}},$=j({view:["hotelView"],events:["events"],session:["session"]},F);var Vi=s(D()),ni=s(D()),w=s(B());var A=n=>q("findHotel",n);var u=s(v()),ci=({savings:n,rewards:i,savingsBtn:_,rewardsBtn:t,onClickDeal:o})=>{let r;if(n){let a=h(n,{removeCents:!0});r=_?_.replace("{discount}",a):`Save ${a}`}else if(i){let a=h(i,{removeCents:!0});r=t?t.replace("{rewards}",a):`Earn ${a} in rewards`}return(0,u.jsx)("div",{className:"wikibuy-savings-component",onClick:o,children:(0,u.jsx)("h4",{children:r})})},pi=({displayData:n,savings:i,rewards:_,hotel:t,onClickDeal:o,onClose:r})=>{let a,e,b,l,k,p,g="",x="",C=w.default.get(t,"photoUrl");if(i)({headerText:a,subheaderText:e,showImage:b,showHotelImage:l,buttonText:k,footerText:p}=n.savings),g=h(i,{removeCents:!0});else if(_)({headerText:a,subheaderText:e,showImage:b,showHotelImage:l,buttonText:k,footerText:p}=n.rewards),x=h(_,{removeCents:!0});else return;return(0,u.jsx)("section",{className:"annotation-tooltip-component",children:(0,u.jsxs)("div",{className:"annotation-tooltip-container",children:[(0,u.jsxs)("div",{className:"annotation-tooltip-header",children:[(0,u.jsx)("h2",{children:g?a.replace("{discount}",g):(0,u.jsx)("span",{className:"green-text",children:a.replace("{rewards}",`${x} in Rewards`)})}),(0,u.jsx)(P,{onClick:r.bind(void 0,"x")})]}),(0,u.jsxs)("div",{onClick:o,children:[e&&(0,u.jsx)("h4",{className:"text",style:{marginBottom:0},children:e.replace("{discount}",g).replace("{hotel_name}",t.name)}),b&&(0,u.jsx)(ei,{className:"credits-icon"}),l&&C&&(0,u.jsx)("img",{src:C,style:{width:"100%",margin:"5px"}}),(0,u.jsx)("div",{className:"button-wrapper",children:(0,u.jsx)("button",{className:"primary-btn-large",children:k})}),p&&(0,u.jsx)("h6",{style:{fontStyle:"italic",marginTop:5},children:p})]})]})})},T=class extends ni.Component{state={isComplete:!1,savings:!1,rewards:!1,showSavingsDetails:!1};componentWillMount(){let i=this.props.inputData;A(i).then(_=>{this.setState({isComplete:!0}),f.set("hotelView",{data:_}),this.setState({responseData:_});let{discount:t,showNotif:o,wikibuyCreditsPerNight:r,wikibuyCredits:a,cashback:e,wikibuyHotel:b,url:l}=_,k={...b,url:l};this.setState({hotel:k}),o&&t?this.setState({savings:t}):r>0&&e&&this.setState({rewards:a})})}componentDidMount(){let i=this.state.responseData;d("page","hotelNotification",{type:"notification",view:"hotelNotification_inline",credits:!!w.default.get(i,"cashback.reward.amount"),creditsAmount:w.default.get(i,"cashback.reward.amount"),creditsType:w.default.get(i,"cashback.reward.type")})}onEnterSavingsButton(){this.props.hideDetails||(this.savingsDetailsLeaveTimeout&&clearTimeout(this.savingsDetailsLeaveTimeout),this.showSavingsDetails())}onLeaveSavingsButton(){this.savingsDetailsLeaveTimeout=setTimeout(()=>{this.hideSavingsDetails(),this.setState({preventInitialShow:!0})},500)}hideSavingsDetails(){this.setState({showSavingsDetails:!1,preventInitialShow:!0})}showSavingsDetails(){this.setState({showSavingsDetails:!0})}render(){let{displayData:i,hideDetails:_,btnStyle:t}=this.props,{savingsBtn:o,rewardsBtn:r}=i,{isComplete:a,savings:e,rewards:b,hotel:l}=this.state,k=this.state.showSavingsDetails;!this.state.preventInitialShow&&a&&(e||b)&&!_&&(k=!0,setTimeout(()=>{this.hideSavingsDetails()},2e3));let p=this.state.showSavingsDetails;return(0,u.jsx)("div",{className:`hotel-page-annotation ${p?"tooltip-open":""}`,children:(0,u.jsxs)("div",{className:`savings-button ${`${a?`${e||b?"savings":"no-savings"}`:"searching"}`}`,style:t||{},onMouseEnter:this.onEnterSavingsButton.bind(this),onMouseLeave:this.onLeaveSavingsButton.bind(this),children:[(0,u.jsx)(J,{}),a?e||b?(0,u.jsx)(ci,{savings:e,rewards:b,savingsBtn:o,rewardsBtn:r,onClickDeal:()=>{l&&(e||b)&&this.onClickDeal(l.url)}}):(0,u.jsx)(Q,{}):(0,u.jsx)(K,{}),a&&(e||b)&&k?(0,u.jsx)(pi,{savings:e,rewards:b,displayData:i,url:l.url,hotel:l,onClickDeal:()=>this.onClickDeal(l.url),onClose:this.hideSavingsDetails.bind(this)}):null]})})}async onClickDeal(i,_){let t=w.default.get(this.state,"hotel"),o=w.default.get(this.state,"responseData.searchId"),r=w.default.get(this.state);if(t)d("trackClick","wbViewHotelDeal","view hotel",{...this.getWikibuyHotelEventData(t),dest_domain:"capitaloneshopping.com",dest_url:i,searchId:o}),N({redirect:i});else{let{clickId:a,redirectId:e}=U(),b=w.default.get(this.props,"view.hotel.source");d("trackClick","viewHotelDeal","view hotel",{type:"notification",view:"hotelNotification_inline",source:b,redirectId:e,clickId:a,credits:!!w.default.get(r,"cashback.reward.amount"),creditsAmount:w.default.get(r,"cashback.reward.amount"),creditsType:w.default.get(r,"cashback.reward.type"),searchId:o});let l=`${i}&wsid=${a}`;l=V({params:{clickEvent:"viewHotelDeal",destUrl:l,redirectId:e,subExperience:"hotels_view_offer"},isWbPublisher:!0}),N({redirect:l})}_||this.setState({showSavingsDetails:!0})}getWikibuyHotelEventData(i){let{address:_,id:t,name:o,offers:r}=i,e={...w.default.get(this.state.responseData,"searchParams"),hotelId:t,hotelLocation:`${_.cityName}, ${_.stateCode}`,hotelName:o,pricePostDiscount:r[0].pricing.pricePostDiscount.toString(),pricePreDiscount:r[0].pricing.pricePreDiscount.toString(),type:"notification",url:location.href,view:"hotelNotification_inline",searchId:w.default.get(this.props.view,"hotel.searchId")};return e.latitude=e.latitude?e.latitude.toString():e.latitude,e.longitude=e.longitude?e.longitude.toString():e.longitude,e}componentWillUnmount(){this.savingsDetailsLeaveTimeout&&clearTimeout(this.savingsDetailsLeaveTimeout)}};si();yi();wi();var ai=s(li()),I=s(v());window.__wb_timing.hotelRequireAt=performance.now();async function fi(){let n=await ii();_i(n)}function mi(n){return(0,I.jsx)(R,{children:(0,I.jsx)($,{...n})})}async function hi(n){let{props:i,..._}=n,t=location.hostname.replace(/^www\./,""),o=await A(m.default.assign({domain:t,pagePath:location.pathname},_));if(f.set("checkingHotels",!1),o&&(o.discount||o.rewards))L({active:!0}),f.set("hotelView",o),H({initialRoute:"/hotel",cssUrl:"hotel.css",app:mi(i)});else{let r=f.get("displayDealsViewIfDeal");typeof r=="function"&&r()}}function gi(n){let{domain:i,contentData:_,...t}=n,o=m.default.assign({domain:i,pagePath:location.pathname},t),r=_&&_.selectorsByDomain?m.default.get(_.selectorsByDomain,i,null):null;if(!r)return;let a=_&&_.displayByDomain?m.default.get(_.displayByDomain,i,null):null;function e(b){return(0,I.jsx)(R,{children:(0,I.jsx)(T,{...b})})}if(L({active:!0}),i=="airbnb.com"){let[b,l]=r,k=document.querySelector(b.selector),p=document.querySelector(l.selector);H({initialRoute:"/hotel",cssUrl:"hotel.css",app:e({inputData:o,displayData:a,btnStyle:b.btnStyle}),insertAfterElement:k}),H({initialRoute:"/hotel",cssUrl:"hotel.css",app:e({inputData:o,displayData:a,hideDetails:!0,btnStyle:l.btnStyle}),insertAfterElement:p,mountClass:"_14f4nnk",allowToHide:!0})}else H({initialRoute:"/hotel",cssUrl:"hotel.css",app:e({inputData:o,displayData:a,btnStyle:r.btnStyle}),insertBeforeElement:document.querySelector(r.selector)})}var xi=(n,i)=>{let _={...n};_.title=M(n.name),_.address=n.address?M(n.address):"",_.rooms=parseInt(n.room_count),_.adults=parseInt(n.adults_stay),_.children=parseInt(n.children_stay),_.latitude=n.latitude?n.latitude.toString():"",_.longitude=n.longitude?n.longitude.toString():"",E(["loading dewey hotel:",_]),d("track","deweyHotelSearch",{..._,url:i})},vi=n=>{let i=[];for(let _ of n){let t=_.key.toLowerCase();if(t=="hotels"&&(t="hcom"),_.value){let o={};o[t]=_.value,i.push(o)}}return i};async function ri(){f.set("checkingHotels",!0),await fi();let n=ai.default.getDomain(window.location.href);Y("/hotel");try{let i={},_=[],t=m.default.cloneDeep(f.get("deweyResult")||{});if(E(["dewey page type",t.pageType]),t.pageType==="hotelsPage"){i=m.default.get(t,"pageData.hotel");let a=m.default.get(t,"pageData.meta");E(["dewey meta",a]),a&&(i={...a,...i}),i.domain=n,i.checkIn=O(i.check_in_date?i.check_in_date:i.checkIn),i.checkOut=O(i.check_out_date?i.check_out_date:i.checkOut);let e=m.default.get(i,"meta_partner_id[0]");e&&(_=vi(e),i.exactMatchMap=_),xi(i,location.href)}else return;i.domain=n;let o=S("hotel_inline_conquesting"),r;o&&(n==="airbnb.com"||n==="google.com")&&(r=await Z({contentSlug:"hotel-inline-conquesting",contentProps:{domain:n}})),r?gi({data:i,domain:n,deweyResult:t,exactMatchMap:_,inlineConquestingContentData:r}):hi({data:i,deweyResult:t,exactMatchMap:_})}catch(i){f.set("checkingHotels",!1),console.error(i)}}document.readyState!=="loading"?ri():document.addEventListener("DOMContentLoaded",ri);
