import{f as v,g as E,h as T}from"../chunks/chunk-QPCCCIZN.js";import"../chunks/chunk-LZHBEYN5.js";import"../chunks/chunk-A6E4WAVS.js";import"../chunks/chunk-T6N25VDY.js";import{a as x}from"../chunks/chunk-X6B2H4I3.js";import"../chunks/chunk-IQFNOK3G.js";import{a as M}from"../chunks/chunk-ED2QSM3M.js";import{a as A}from"../chunks/chunk-RQD6OPCK.js";import{a as Z}from"../chunks/chunk-5LUD7HVS.js";import{a as q}from"../chunks/chunk-ZL5H3TML.js";import{a as V}from"../chunks/chunk-MV4HDL2S.js";import{a as F}from"../chunks/chunk-2MCFUH3Z.js";import{a as y}from"../chunks/chunk-5Q7VJYCY.js";import"../chunks/chunk-G2MGIWVK.js";import"../chunks/chunk-YZTZIJSB.js";import"../chunks/chunk-YU5QULAP.js";import"../chunks/chunk-DGHEKRNY.js";import"../chunks/chunk-VGIBV4EV.js";import"../chunks/chunk-IYAFYZRF.js";import"../chunks/chunk-F2BE3OL5.js";import"../chunks/chunk-65VGUSSD.js";import"../chunks/chunk-O7OTS7RM.js";import"../chunks/chunk-2SFZECRB.js";import"../chunks/chunk-D2CCZ3BJ.js";import"../chunks/chunk-KZL57NC7.js";import{u as k}from"../chunks/chunk-R5NGUZ66.js";import{a as X}from"../chunks/chunk-O4TFJKJQ.js";import{c as l,e as L,k as D,l as P,m as g,q as C,u as _}from"../chunks/chunk-JJTF2C25.js";import"../chunks/chunk-6LTHT6DZ.js";import"../chunks/chunk-NYTRMFGH.js";import"../chunks/chunk-HY2GWXPO.js";import"../chunks/chunk-JV3JVBWM.js";import{M as d,N as J,_ as Q,a as S,c as j,r as z}from"../chunks/chunk-3HBOA5LN.js";import"../chunks/chunk-4NTWQHWX.js";import"../chunks/chunk-YHJJDH4X.js";import{e as p}from"../chunks/chunk-3GYLW4KZ.js";var c=p(S()),w=p(Z());var s=p(S());var R=p(Q());var $=p(z());J();var N=(e,r)=>C("deweyPriceComparisonWithoutNotif",{priceComparisonKey:e,product:r});var h,O;function I(e){return e.url}function U(e,r){if(!e.price)return console.error("Dewey PC - unable to retrieve the origin product price"),!1;if(r){if(!s.default.map(r.featureFlags,g).every(a=>a))return console.error("Dewey PC - user not in feature groups"),!1;let o=R.engineValidator.validate(r,R.engineValidator.schemas["/engines/input/conquest"]);if(!o.valid)return console.error("Dewey PC - Rules schema validation failed",o.errors),!1}return{priceComparisonKey:I(e)}}var ee=250;function K(e){O||(O=s.default.debounce(te,ee)),O(e)}async function te(e){if(!(!x()&&g("dewey_price_comparison")&&s.default.get(e,"pageTypeBehaviors.deweyPC",!1)))return;let t=s.default.cloneDeep(s.default.get(e,"pageData.products[0]",{}));t.vendor=s.default.get(e,"domain"),t.price=t.list_price,t.mpn=t.manufacturer_number,delete t.list_price,delete t.manufacturer_number;let o=s.default.get(await T({domain:t.vendor}),"config");if(!o){let n=U(t);return n&&N(n.priceComparisonKey,t)}let a=U(t,o);if(!a){h="",k(v);return}let{priceComparisonKey:m}=a;if(m===h){d([`*** Skipping dewey price comparison alreday in progress for request - ${m} ***`]);return}d([`*** Starting dewey price comparison. Request - ${m} ***`]),h=m,k(v),L({active:!0}),s.default.forEach(o.runOptions.input.unpricedResults,n=>{n.product=t,n.id=$.default.v4()}),o.runOptions.input.product=t;let i;s.default.forEach(o.buttonOptions.insertAfterElement,n=>{if(i=document.querySelector(n),i)return!1}),o.buttonOptions.insertAfterElement=i,s.default.set(o.runOptions.input,"meta.conquestOrigin",!0),s.default.set(o.runOptions.input,"meta.simpleOriginPricing",!0),s.default.set(o.runOptions.input,"deweyPC",!0),E(o.buttonOptions,{...o.runOptions,cutOffPriceForPriceRunsInCents:o.CUT_OFF_PRICE_FOR_PRICE_RUN_IN_CENTS,runCompleteCb:()=>{d([`*** Request - ${m} - completed ***`]),h===m&&(h="",d([`*** Active Dewey price comparison was reset after request - ${m}. ***`]))}})}var B=e=>(K(e),C("deweyResult",e));var G=p(j());var u=p(S());function H(e){try{let r=document.URL,t,o;if(r.match(/\.fastspring\.com/)){t="FastSpring";let a=document.querySelector(".store-order-action-more .store-action-command").href;o=u.default.get(a.match(/\w+\.(com|ca)/),"[0]",e)}else if(r.match(/\.foxycart\.com/)){t="FoxyCart";let a=document.querySelector(".fc-cancel-continue-shopping a").href;o=u.default.get(a.match(/\w+\.(com|ca)/),"[0]",e)}else if(r.match(/poweredbygps\.com\/Checkout/)){t="PoweredByGps";let a=document.querySelector(".logo-div a.header-logo").href;o=u.default.get(a.match(/\w+\.(com|ca)/),"[0]",e)}else if(r.match(/checkout\.stripe\.com|billing\.stripe\.com/)){t="Stripe";let a=document.querySelector('.Header-businessLink, [data-testid="return-to-business-link"]').href;o=u.default.get(a.match(/\w+\.(com|ca)/),"[0]",e)}else if(r.match(/sso\.teachable\.com/)){t="Teachable";let a=document.querySelector(".header-logo").href;o=u.default.get(a.match(/\w+\.(com|ca)/),"[0]",e)}else if(r.match(/chargifypay\.com/)){t="Chargify";let a=document.querySelector(".header__logo a, .disclaimer a").href;o=u.default.get(a.match(/\w+\.(com|ca)/),"[0]",e)}return{separatePlatform:t,separatePlatformDomain:o}}catch{return{separatePlatform:void 0,separatePlatformDomain:void 0}}}var Y=p(X());window.__wb_timing.deweyRequireAt=performance.now();function oe(){return G.default.all([V(),F()]).spread((e,r)=>{A(e),l.merge({siteAPIData:r})})}async function W(){await oe();let e=l.get("siteAPIData"),r=c.default.get(e,"tld");P(r),e=await re(e)||e;let t=c.default.cloneDeep(e);t.document=document,t.document.deweyParser=Y.default,t.document.html=document.documentElement.innerHTML,c.default.set(t,"siteData.tld",t.tld),y.setDefaultConfig(t);let o=g("log_all_dewey"),a=new Date,m=new Set(c.default.map(c.default.get(e,"siteData.tigger.coupons")||c.default.get(e,"siteData.roo.coupons")||[],"code"));y.emitter.on("result",i=>{if(i.callSource==="internal"&&(l.set(["deweyResult"],i),B(i),c.default.get(i,"pageType")||o)){let b=new Date-a,f=c.default.cloneDeep(i);f&&f.pageData&&f.pageData.meta&&(f.pageData.meta=[f.pageData.meta]),_("track","deweyResult",c.default.assign({},f,{url:window.location.href,flags:c.default.get(e,"siteData.flags"),logAllDewey:o,totalTimeElapsed:b,deweyAttempt:y.startAttempt}))}c.default.get(i,"pageData.coupons.length")&&c.default.forEach(i.pageData.coupons,n=>{m.has(n)||(_("track","codeApplied",{code:n,currentLocation:c.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])}),m.add(n))})}),y.start()}async function re(e){let r=c.default.get(e,"siteData.coupons.type"),t=await M(),o=q(D()),{separatePlatform:a,separatePlatformDomain:m}=H(D()),i=o?"Shopify":t||a,n=o||m||D();if(i&&n)return P(n),l.set(["platform"],i),l.set(["platformDomain"],n),e=c.default.has(e,"siteData.tigger")?e:{...e,siteData:{...e.siteData,tigger:{}}},e.siteData.tigger[`${i.toLowerCase()}`]=!0,e.siteData.pageTypesV2=e.siteData.pageTypesV2||{},e.siteData.pageTypesV2.checkoutPage=(0,w.getSiteData)(i,"checkoutPage"),e.siteData.pageTypesV2.confirmationPage=(0,w.getSiteData)(i,"confirmationPage"),(0,w.getSiteData)(i,"roo")&&r!=="roo"&&(e.siteData.roo=(0,w.getSiteData)(i,"roo")),e}document.readyState!=="loading"?W():document.addEventListener("DOMContentLoaded",W);
