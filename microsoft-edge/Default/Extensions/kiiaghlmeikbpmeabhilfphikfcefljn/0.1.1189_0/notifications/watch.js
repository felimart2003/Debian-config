import{a as p}from"../chunks/chunk-ILCDTXM2.js";import{a as m}from"../chunks/chunk-K3HP5COO.js";import{a as W}from"../chunks/chunk-ZL5H3TML.js";import"../chunks/chunk-G2MGIWVK.js";import{a as g}from"../chunks/chunk-BCG2KUGW.js";import"../chunks/chunk-KZL57NC7.js";import{a as I}from"../chunks/chunk-O4TFJKJQ.js";import{c as f,k as F,m as y,q as G,u as s}from"../chunks/chunk-JJTF2C25.js";import"../chunks/chunk-HY2GWXPO.js";import{a as T,c as mt,e as C,m as v,o as b,q as A}from"../chunks/chunk-3HBOA5LN.js";import"../chunks/chunk-YHJJDH4X.js";import{e as w}from"../chunks/chunk-3GYLW4KZ.js";var c=w(T()),D=w(mt()),k=w(I());var S=(t,e)=>G("hasActivatedCompetitor",t);var O=w(T());var U=w(I());A();async function $(){let t=await m({action:"getHoneyState",comp:"honey"}),e=await m({action:"getCompState",comp:"piggy"});!t&&!e&&p(ht,o=>{s("track","ebatesNotif",{url:location.href,cashbackRate:H()}),f.set(["compPopup"],{type:"ebates"});let n=gt(o);n&&n.addEventListener("click",()=>{let i=location.hostname.replace(/^www\./,""),u=`ebatesWarningNotif-${i}`;chrome.storage.local.get(u,l=>{let h=O.default.get(l,u);f.get(["cashback","user","activated"])&&(b(C(v(h),{days:1}),new Date)||!h)&&y("notif_reactivation_base")&&S({domain:i,comp:"rakuten"}),s("track","ebatesActivate",{url:location.href,cashbackRate:H()})})});let r=o.querySelector(".rr-button-close");r&&r.addEventListener("click",()=>{s("track","ebatesDismiss",{url:location.href,cashbackRate:H()})})})}async function K(){await m({action:"getHoneyState",comp:"honey"})||p(yt,e=>{s("track","ebatesCouponNotif",{url:location.href});let o=[...e.querySelectorAll(".r-button")].find(r=>r.textContent.includes("Apply Coupons"));o&&o.addEventListener("click",()=>{s("track","ebatesTryCoupons",{url:location.href})});let n=e.querySelector(".rr-button-close");n&&n.addEventListener("click",()=>{s("track","ebatesCouponDismiss",{url:location.href})})})}function ht(){try{return B().shadowRoot.querySelector(".ebates-notification")}catch{return!1}}function yt(){try{let t=B().shadowRoot;return[...t.querySelectorAll(".r-button")].find(o=>o.textContent.includes("Apply Coupons"))?t.querySelector(".rr-caa__flag"):!1}catch{return!1}}function gt(t){let e=t.querySelector(".rr-button-primary, button.r-button");return e&&/activate/i.test(e.innerText)?e:t.querySelector(".ebates-notification-button.ebates-notification-button-activate")||t.querySelector("ebates-notification-button.ebates-notification-button-login")}function H(){try{let t=B().shadowRoot.querySelector(".ebates-notification .ebates-notification-button-activate")||B().shadowRoot.querySelector(".rr-button-primary, button.r-button");return(0,U.default)(t).text()}catch{return!1}}function B(){return[...document.querySelectorAll("html > *")].find(t=>{if(t.shadowRoot&&t.shadowRoot.querySelector(".rr-caa__flag, .ebates-notification"))return!0})}var V=w(T());async function M(t,e,o,n){let r=setTimeout(n,e),i=t();for(;!i;)await Ct(o),i=t();clearTimeout(r),n(i)}function Ct(t){return new Promise(e=>{setTimeout(e,t)})}A();async function j(){p(St,async t=>{f.set(["compPopup"],{type:"rmn"});let e=kt(t),o=await m({action:"getCompState",comp:"rmn"});e&&!o&&(s("track","rmnNotification",{name:"cashback",url:location.href,ctaText:_()}),e.addEventListener("click",()=>{Y({channel:"cashback"}),s("track","rmnActivate",{url:location.href,cashbackRate:_()})}))})}function Y({channel:t}={}){let e=q(),o=`rmnWarningNotif-${e}`;chrome.storage.local.get(o,n=>{let r=V.default.get(n,o);(t==="cashback"&&f.get(["cashback","user","activated"])||t==="coupons")&&(b(C(v(r),{days:1}),new Date)||!r)&&y("notif_reactivation_base")&&S({domain:e,comp:"rmn"})})}function vt(){return R().querySelector(".qa-results-container.results-container")}function bt(t){if(!t)return;m({action:"endSavingsCheck",comp:"rmn"});let e=t.querySelector(".qa-codes-amount"),o=e?g(e.innerText):null,n=t.querySelector("qa-best-codes"),r=n?n.innerText:null,i=[];r&&i.push(r),s("track","rmnTryCouponsResult",{savings:o,coupons:i,url:location.href}),_(),Y({channel:"coupons"})}async function z(){p(wt,t=>{let e=t.querySelector(".button-primary.qa-apply-savings-button"),o=t.querySelector(".button-secondary.qa-code-button"),n=e||o;if(n){let r=n.innerText;s("track","rmnNotification",{name:"coupon",ctaText:r,url:location.href}),e&&e.addEventListener("click",()=>{m({action:"initSavingsCheck",comp:"rmn"}),s("track","rmnTryCoupons",{url:location.href}),M(vt,4e4,500,bt)})}})}function St(){try{return R()}catch{return!1}}function wt(){try{let t=R();return[...t.querySelectorAll(".bbb-container.bbb-codes-img")].find(o=>o.textContent.includes("Codes Found"))?t:!1}catch{return!1}}function kt(t){let e=t.querySelector(".button-primary.cbo-activate-button");if(e&&/activate/i.test(e.innerText))return e}function _(){try{let t=R().querySelector(".button-primary.cbo-activate-button")||R().querySelector(".primary-text.qa-cbo-amount-unactivated");return t?t.innerText:null}catch{return!1}}function R(){return document.querySelector("#__genieContainer").shadowRoot.querySelector('#rmnGenieWrappingDiv:not([style*="display: none;"])')}var x=w(T());A();var d,J=!1;async function xt(){return p(tt,t=>(d=t,Q()))}function Q(){let t=[...d.querySelectorAll('div[style*="color: initial;"] div div > div')].find(e=>{let o=e.querySelector('[style="position: relative;"]');if(o)return o.textContent.includes("Apply Rewards")});if(t)return J||X(),Rt(t),t}function Rt(t){t.addEventListener("click",()=>{it({channel:"cashback"}),s("track","coupertActivate",{url:location.href,cashbackRate:P()})})}function P(){d||(d=N());let t=[...d.querySelectorAll('div[style*="color: initial;"] div div > div > div')].find(o=>o.textContent.includes("Rewards Found!"));if(t){let o=t.nextElementSibling&&t.nextElementSibling.innerText;return o||null}let e=[...d.querySelectorAll('div[style*="color: initial;"] div div > div span')].find(o=>o.textContent.includes("Cash Back"));if(e){let o=e.previousElementSibling&&e.previousElementSibling.innerText;return o||null}}function X(){J=!0;let t=P();s("track","coupertNotification",{name:"cashback",url:location.href,ctaText:t})}async function Z(){p(tt,async t=>{d||(d=t),f.set(["compPopup"],{type:"coupert"});let e=!1,o={childList:!0};new MutationObserver(u=>{x.default.forEach(u,async l=>{x.default.get(l,"type")==="childList"&&e===!1&&(e=!0,await xt())})}).observe(t,o);let r=Q(),i=await m({action:"getCompState",comp:"coupert"});r&&!i&&X()})}function tt(){try{let t=N();return d=t,t}catch{return!1}}function et(){if([...d.querySelectorAll("div span")].find(e=>e.textContent.includes("Continue to Checkout")))return d.querySelector('div[style*="color: initial;"]')}function qt(t){if(!t)return;m({action:"endSavingsCheck",comp:"coupert"});let e=[...t.querySelectorAll("div p")].find(o=>o.textContent.includes("Congratulations!"));if(e){let o=e.previousElementSibling,r=[...o.querySelectorAll("span")].find(i=>i.textContent==="With the code:").nextElementSibling.textContent;if(o){let i=o.previousElementSibling.textContent,u;i&&(u=g(i));let l=[];r&&l.push(r),s("track","coupertTryCouponsResult",{savings:u,coupons:l,url:location.href}),P(),it({channel:"coupons"})}}}async function Tt(){return p(rt,t=>(d=t,ot()))}function ot(){let t=[...d.querySelectorAll('div[style*="color: initial;"] div div > div')].find(e=>e.textContent.includes("Apply Coupons"));if(t)return At(t),t}function At(t){let e=t.innerText;t.addEventListener("click",()=>{m({action:"initSavingsCheck",comp:"coupert"}),s("track","coupertTryCoupons",{ctaText:e,url:location.href}),M(et,4e4,500,qt)})}async function nt(){p(rt,t=>{d||(d=t);let e=!1,o={childList:!0};new MutationObserver(i=>{x.default.forEach(i,async u=>{x.default.get(u,"type")==="childList"&&e===!1&&(e=!0,await Tt())})}).observe(t,o);let r=ot();if(r){let i=r.innerText;s("track","coupertNotification",{name:"coupon",ctaText:i,url:location.href})}})}function rt(){try{let t=N();d=t;let e=[...d.querySelectorAll('div[style*="color: initial;"] div')].find(o=>o.textContent.includes("Apply Coupons"));return et(),e?t:!1}catch{return!1}}function N(){let e=[...document.querySelectorAll('div[style="display: block;"]')].find(o=>{let n=o.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(o);if(n&&n.querySelector('[href="chrome-extension://mfidniedemcgceagapgdekdbmanojomk/css/content.css"]'))return n});if(e)return e.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(e)}function it({channel:t}={}){let e=q(),o=`coupertWarningNotif-${e}`;chrome.storage.local.get(o,n=>{let r=x.default.get(n,o);(t==="cashback"&&f.get(["cashback","user","activated"])||t==="coupons")&&(b(C(v(r),{days:1}),new Date)||!r)&&y("notif_reactivation_base")&&S({domain:e,comp:"coupert"})})}A();var a;function at(){try{let t=a.querySelectorAll("#honey button");return t.length&&t}catch{return!1}}function st(){try{let t=a.querySelector("#honey-shadow"),e;if(t){let o=(0,k.default)(t).find("[id*=HoneyGoldAmount]").text()||(0,k.default)(t).find("[class*=DescriptiveGold] span[class*=textBold]").text()||(0,k.default)(t).find("[class^=ctaColumn] [class^=container] [class^=title]").text()||(0,k.default)(t).find('[class*=goldText] span:contains("Gold")').text();e=o&&o.match(/(\d+[,]?\d* to \d+[,]?\d*(?:%|\sHoney Gold|\sGold))/)?o.match(/(\d+[,]?\d* to \d+[,]?\d*(?:%|\sHoney Gold|\sGold))/)[1]:null}return e}catch{return null}}async function Bt(){return await new D.default((e,o)=>{p(at,n=>{let r=c.default.last(n);e(r)})})}function ut(){let t=a.querySelector("#honey-shadow"),e;return t&&(e=(0,k.default)(t).find('[class*=bodyContentGreen] p:contains("Cart Total")').text(),e=g(e)),e}function Mt(){let t=a.querySelector("#honey-shadow"),e;return t&&(e=(0,k.default)(t).find("div:contains('re-activate Honey')").text()),!!e}function ct(){let t=location.hostname.replace(/^www\./,""),e=`honeyWarningNotif-${t}`;chrome.storage.local.get(e,async o=>{let n=c.default.get(o,e);f.get(["cashback","user","activated"])&&(b(C(v(n),{days:1}),new Date)||!n)&&y("notif_reactivation_base")&&S({domain:t,comp:"honey"})})}function Et(){p(at,t=>{let e=[...t].find(r=>r.innerText==="Apply Coupons"),o=_t(t),n=Pt(t);if(e){let r=ut(),i=e.textContent,u=st();e.addEventListener("click",()=>{o&&s("track","honeyTryCoupons",{url:location.href,cartTotal:r,ctaText:i,cashbackRate:u}),m({action:"initSavingsCheck",comp:"honey"}),lt(ft,4e4,500,dt)})}o&&o.addEventListener("click",ct),n&&n.addEventListener("click",ct)})}async function Lt(){try{await m({action:"getHoneyState",comp:"honey"})&&lt(ft,4e4,500,dt),p(()=>{let o=[...document.querySelectorAll("#honeyContainer, div[data-reactroot]")].find(n=>{let r=n.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(n);return r&&r.getElementById("honey-shadow")});if(o)return o.openOrClosedShadowRoot||chrome.dom.openOrClosedShadowRoot(o)},async e=>{a=e,f.set(["compPopup"],{type:"honey"}),Et();let o=await Bt(),n=o?o.textContent:null,r=ut(),i=c.default.debounce(h=>{s("track",h?"showHoney":"hideHoney",{url:location.href,cartTotal:r,ctaText:n,cashbackRate:st(),reactivation:Mt()})},1e3),u=new MutationObserver(h=>{c.default.forEach(h,E=>{let L=c.default.get(E,"target.style.visibility");L==="hidden"?i(!1):(L==="initial"||L==="visible")&&i(!0)})}),l=a.querySelector("#honey-shadow");if(l){u.observe(l,{attributes:!0,attributeFilter:["style"]});let h=l.style.visibility;h==="hidden"?i(!1):(h==="initial"||h==="visible")&&i(!0)}})}catch{}}async function lt(t,e,o,n){let r=setTimeout(n,e),i=t();for(;!i;)await Ht(o),i=t();clearTimeout(r),n(i)}function Ht(t){return new D.default(e=>{setTimeout(e,t)})}function dt(t){if(!t)return;m({action:"endSavingsCheck",comp:"honey"});let e=c.default.get(t,"savings")&&typeof c.default.get(t,"savings")=="number"?+t.savings:null,o=c.default.get(t,"originalPrice")&&typeof c.default.get(t,"originalPrice")=="number"?+t.originalPrice:null,n=c.default.get(t,"withHoneyPrice")&&typeof c.default.get(t,"withHoneyPrice")=="number"?+t.withHoneyPrice:null,r=q(),i=`honeyWarningNotif-${r}`;s("track","honeyTryCouponsResult",{savings:e,rewardsSavings:c.default.get(t,"rewards",null),originPrice:o,finalPrice:n,codeApplied:c.default.get(t,"workingCode",null),url:location.href}),chrome.storage.local.get(i,u=>{let l=c.default.get(u,i);(b(C(v(l),{days:1}),new Date)||!l)&&y("notif_reactivation_base")&&(f.set(["warnAboutStandDown"],!0),S({domain:r,comp:"honey"}))})}function _t(t){return c.default.find(t,e=>/coupon(?:s)?|code(?:s)?/i.test(e.innerHTML))||c.default.find(a.querySelector("#honey").querySelectorAll("span"),e=>e.innerHTML==="Coupon codes")}function Pt(t){return c.default.find(t,e=>/claim honey gold|claim rewards/i.test(e.innerHTML))}var Nt=[()=>{try{let t=/You saved|youâ€™re saving/i;if(a.innerHTML.match(t)){let o=c.default.get(a.querySelector("[class*=savingsPrice], [class^=savingsText]"),"textContent"),n=o?g(o):null,r=c.default.get(a.querySelector("[id*=OriginalPrice], [class^=originalTotal]"),"textContent"),i=r?g(r):null,u=c.default.get(a.querySelector("[id*=WithHoneyPrice], [class^=price].price5"),"textContent"),l=u?g(u):null,h=c.default.get(a.querySelector("[id*=HoneyGoldAmount], [class^=valueContainer] > [class^=value]"),"textContent"),E=c.default.get(a.querySelector("[class*=workingCode], [class*=bestCode-]"),"textContent");return{foundModal:!0,savings:n,rewards:h,originalPrice:i,withHoneyPrice:l,workingCode:E}}}catch{return!1}},()=>{try{let t=/Honey Gold.+activated/i;if(a.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(a.querySelector("[class*=DescriptiveGold] span[class*=textBold]"),"textContent")}}catch{return!1}},()=>{try{let t=/forget your free sample/i;if(a.innerHTML.match(t)){let o=c.default.get(a.querySelector("[id*=FreeItemReceipt][id*=titleContent]"),"textContent"),n=o?g(o):null,r=c.default.get(a.querySelector("[id*=honeyGoldContainer] [class*=bold]"),"textContent"),i=a.querySelectorAll("[class*=couponsContainer] [class*=couponPointer] [class*=couponTitle]"),u=c.default.map(i,l=>l.textContent);return{foundModal:!0,savings:n,rewards:r,workingCode:u}}}catch{return!1}},()=>{try{let t=/have the best/i;if(a.innerHTML.match(t))return{foundModal:!0}}catch{return!1}},()=>{try{let t=/Get.+Gold back/;if(a.innerHTML.match(t))return{foundModal:!0,rewards:c.default.get(a.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{return!1}},()=>{try{let t=/\d+% back|activated/,e=a.innerHTML.match(t);if(a.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]").textContent,e)return{foundModal:!0,rewards:c.default.get(a.querySelector("[id*=bonusCashContentContainer] [id*=span-bonusCashContent]"),"textContent")}}catch{return!1}}];function ft(){let t;return c.default.forEach(Nt,e=>{let o=e();if(c.default.has(o,"foundModal")){t=o;return}}),t}function Dt(){function t(){p(()=>document.querySelector('form[action*="i.clean.gg"]'),e=>{s("track","extensionError",{type:"possible_error",source:"clean"})})}document.readyState!=="loading"?t():document.addEventListener("DOMContentLoaded",t)}function q(){let t=F();return t=y("ext_separate_domain_platform")?f.get("platformDomain"):W(t)||t,t}var pt=t=>{Lt(),$(),K(),j(),z(),Z(),nt(),Dt()};window.__wb_timing.couponCheckingRequireAt=performance.now();f.set("pageViewId",window.__wb_page_view_id);pt();
