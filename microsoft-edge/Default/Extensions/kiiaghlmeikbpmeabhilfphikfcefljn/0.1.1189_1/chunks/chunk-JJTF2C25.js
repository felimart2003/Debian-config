import{E as ft,L as lt,M as V,N as mt,R as pt,_ as gt,a as w,b as ut,c as N,k as re,m as oe,q as dt,r as ne}from"./chunk-3HBOA5LN.js";import{f as ie,l as ht}from"./chunk-YHJJDH4X.js";import{c as b,d as ct,e as d}from"./chunk-3GYLW4KZ.js";var $=b((jt,E)=>{var ce=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);ce?(H=new Uint8Array(16),E.exports=function(){return ce(H),H}):(B=new Array(16),E.exports=function(){for(var t=0,r;t<16;t++)t&3||(r=Math.random()*4294967296),B[t]=r>>>((t&3)<<3)&255;return B});var H,B});var j=b((Gt,de)=>{var ue=[];for(I=0;I<256;++I)ue[I]=(I+256).toString(16).substr(1);var I;function wt(e,t){var r=t||0,o=ue;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}de.exports=wt});var me=b((Qt,le)=>{var vt=$(),xt=j(),fe,G,Q=0,W=0;function kt(e,t,r){var o=t&&r||0,i=t||[];e=e||{};var a=e.node||fe,m=e.clockseq!==void 0?e.clockseq:G;if(a==null||m==null){var l=vt();a==null&&(a=fe=[l[0]|1,l[1],l[2],l[3],l[4],l[5]]),m==null&&(m=G=(l[6]<<8|l[7])&16383)}var p=e.msecs!==void 0?e.msecs:new Date().getTime(),k=e.nsecs!==void 0?e.nsecs:W+1,te=p-Q+(k-W)/1e4;if(te<0&&e.clockseq===void 0&&(m=m+1&16383),(te<0||p>Q)&&e.nsecs===void 0&&(k=0),k>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Q=p,W=k,G=m,p+=122192928e5;var _=((p&268435455)*1e4+k)%4294967296;i[o++]=_>>>24&255,i[o++]=_>>>16&255,i[o++]=_>>>8&255,i[o++]=_&255;var S=p/4294967296*1e4&268435455;i[o++]=S>>>8&255,i[o++]=S&255,i[o++]=S>>>24&15|16,i[o++]=S>>>16&255,i[o++]=m>>>8|128,i[o++]=m&255;for(var C=0;C<6;++C)i[o+C]=a[C];return t||xt(i)}le.exports=kt});var ge=b((Wt,pe)=>{var bt=$(),It=j();function Rt(e,t,r){var o=t&&r||0;typeof e=="string"&&(t=e==="binary"?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||bt)();if(i[6]=i[6]&15|64,i[8]=i[8]&63|128,t)for(var a=0;a<16;++a)t[o+a]=i[a];return t||It(i)}pe.exports=Rt});var ve=b((Xt,we)=>{var yt=me(),he=ge(),X=he;X.v1=yt;X.v4=he;we.exports=X});var q=d(ut()),ae=q.default;window.Baobab?ae=window.Baobab:window.Baobab=q.default;var se=ae;var U=d(w()),L=[],z=window.tree||new se({notification:{run:null,relatedRuns:null,lastSavings:0,currentSavings:0,updating:!1,showModal:!1,details:null,showOnboarding:!1,activeRunId:!1},messages:[],shadowRootsByRoute:{}},{immutable:!1});window.tree||(window.tree=z);z.on("get",e=>{let t=e.data.solvedPath,r=t?t.join("."):!1,o=e.data.data,i=U.default.find(L,{path:r});i&&i.loader&&i.loader(o,e.data.solvedPath)});function Et(e,t){if(U.default.find(L,{path:e}))throw new Error("Only one loader per path");L.push({path:e,loader:t})}var n=z;var at=d(lt()),st=d(ve());var ee={};ct(ee,{abortRun:()=>D,addPriceRun:()=>Re,amazonResultsReceived:()=>ye,communityDealReceived:()=>Le,feedbackDataReceived:()=>Ue,getCookie:()=>He,hideFollow:()=>Be,modalDetailsReceived:()=>Ee,notifyXHRIsQuiet:()=>it,platformSelectors:()=>je,setupPriceRunPusherBindings:()=>Ie,showFollow:()=>Qe,showOnboarding:()=>We,showSiteHub:()=>et,terminatePriceRun:()=>tt,updatePriceRun:()=>rt,warnAboutStandDown:()=>ot});var D=e=>{g("abortRun",e)};var R=e=>c("pusherEvents",e);var xe=d(gt()),Z=d(N());var v={},f={};function ke(e,t){f[e]&&(f[e]={...f[e],...t})}function Pt(e,t){return setTimeout(()=>{A(e,t)},3e4)}function _t(e,t){if(e)return setTimeout(()=>{D({run:{runId:t}}),R({eventType:"run-aborted",response:{runId:t}})},3e4)}function be(e,t){let r=Pt(t.userId,e),o=_t(t.meta.isAmzProductPage,e);f[e]={input:t,inTabTimeoutIds:{abortAmzProductPageRunId:o,terminateRunId:r}}}function A(e,t){f[t]&&delete f[t],St(e)}async function St(e){if(Object.keys(f).length>0)return;let t=await v[e];t&&(t.disconnect(),delete v[e])}var Ie=e=>{let{userId:t}=e;return v[t]?v[t].then(()=>Z.default.resolve()):(v[t]=(0,xe.setupPriceRunPusherBindings)(e,Ct(t),Dt,At),v[t].then(()=>Z.default.resolve()))};function Ct(e){return async t=>{let{runId:r}=t;try{if(!f[r])return;clearTimeout(f[r].inTabTimeoutIds.terminateRunId),clearTimeout(f[r].inTabTimeoutIds.abortAmzProductPageRunId),R({eventType:"run-finished-v2",response:t,additionalData:f[r]})}catch{}finally{A(e,r)}}}function Dt(e){try{let{runId:t}=e;if(!f[t])return;R({eventType:"run-instantOffers",response:e,additionalData:f[t]})}catch{}}function At(e){try{if(!f[e.runId])return;R({eventType:"run-priceRequest-v2",response:e,additionalData:f[e.runId]})}catch{}}var Re=(e,t)=>be(e,t);var ye=e=>{g("amazonResultsReceived",e)};var O=d(w());function Pe(e,t){let r=e.exec(t);return r&&r.length?r[1]:null}var Se=d(ne()),J=d(w());var _e=d(ft()),T;window.__wbCurrentDomain&&(T=window.__wbCurrentDomain);var h=()=>T||_e.default.getDomain(location.href);function cr(e){T=e,window.__wbCurrentDomain=T}mt();var Ce=e=>({domain:h(),pagePath:location.pathname,pageViewId:n.get("pageViewId"),docStartAt:window.__wb_timing.docStartAt,DOMContentLoadedAt:window.__wb_timing.DOMContentLoadedAt,sendMetricAt:performance.now(),...e});function pr(e,t={}){if(!e){V("pageName parameter is required");return}let r=Ce(t);c("wbAnalytics",{method:"page",priceCheckId:window.priceCheckId,args:[e,r]})}function gr(e,t={}){if(!e){V("eventName parameter is required");return}let r=Ce(t);c("wbAnalytics",{method:"track",priceCheckId:window.priceCheckId,args:[e,r]})}function x(e,...t){let r=J.default.find(t,o=>!J.default.isString(o));r?(r.domain=r.domain||h(),r.pagePath=r.pagePath||location.pathname,r.pageViewId=n.get("pageViewId"),r.docStartAt=window.__wb_timing.docStartAt,r.DOMContentLoadedAt=window.__wb_timing.DOMContentLoadedAt,r.sendMetricAt=performance.now(),e==="page"&&r.source&&((!window.__wb_contentId||window.__wb_contentId.constructor!==Object)&&(window.__wb_contentId={}),r.contentId=(0,Se.v4)(),window.__wb_contentId[r.source]=r.contentId)):t.push({domain:h(),pagePath:location.pathname}),c("wbAnalytics",{method:e,priceCheckId:window.priceCheckId,args:t})}var Te=d(ne()),s=d(w()),Oe=d(N());var Tt=e=>c("completeTooltipSteps",{step:e});var De=e=>c("loadProduct",e);var Ae=e=>c("addToAmazonCart",e);pt();dt();var u=n.select("notification");function Ot(e){if((e.asin||s.default.get(e,"gtins[0]"))!==n.get("currentASIN")&&!n.get("ignoreCurrentASIN")&&!e.instantOffers)return;e.instantOffers&&x("track","instantOffersReceived",{parentQuoteId:e.instantOffers.runId,quoteId:e.instantOffers.instantOffersRunId,trigger:n.get("trigger"),currentLocation:s.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])});let r=s.default.clone(u.get("run")||{});s.default.get(e,"run.runId")===s.default.get(r,"runId")&&e.modal&&(r.betterResults=s.default.map(s.default.get(r,"betterResults"),o=>(o.id===e.modal.id&&(o=e.modal),o))),u.merge({details:e.modal,run:s.default.isEmpty(r)?e.run:r,lastChance:!1,cartPricing:e.cartPricing}),Y(e)}function Mt(e){let t=s.default.get(e.run,"betterResults[0]");u.merge({details:t,run:e.run,lastChance:!0,cartPricing:e.cartPricing}),Y(e,!0)}function Y(e,t){let r=s.default.get(e,"cartPricing.savings")||e.run.savings;if((s.default.get(e,"run.inputData.asin")||s.default.get(e,"run.inputData.gtins[0]"))!==n.get("currentASIN")&&!t||u.get("activeRunId")===s.default.get(e.run,"runId"))return;e.run.status==="complete"&&(x("page","quoteCompleteNotification",{view:"quoteCompleteNotification",type:"notification",matchDomain:s.default.get(e.run,"betterResults[0].vendor",null),matchUrl:s.default.get(e.run,"betterResults[0].product.url",null),savings:r>0?r:null,paymentsSupport:!!s.default.get(e,"cartPricing.paymentsSupport")}),Fe(e.run),u.merge({activeRunId:s.default.get(e.run,"runId")}));let a=r>0;u.merge({run:e.run,currentSavings:r,updating:!0,lastSavings:u.get("currentSavings"),showPopup:a,resetting:!1,ignoreRun:!1})}function Me(e){window.priceCheckId=Te.default.v4(),u.set(["priceCheckStarted"],!0),x("track","priceCheckStart",{quoteId:e,priceCheckId:window.priceCheckId,trigger:n.get("trigger"),currentLocation:s.default.pick(window.location,["hash","host","hostname","href","origin","pathname","port","search"])})}function Fe(e){u.get("priceCheckStarted")||(Me(e.runId),u.set(["endFiredFirst"],e.runId)),u.set(["priceCheckStarted"],!1),x("track","priceCheckEnd",{quoteId:e.runId,category:s.default.get(e,"originResult.product.vendorCategory"),priceCheckId:window.priceCheckId,matchId:s.default.get(e,"betterResults[0].id")})}function Ft(){u.merge({run:{},details:null,cartPricing:null,currentSavings:0,updating:!0,lastSavings:u.get("currentSavings"),showPopup:!1,resetting:!0,ignoreRun:!1,communityDeal:null}),n.set("bestAmazonResult",null)}function Jr(){u.merge({ignoreRun:!0})}async function Yr(){n.set("appReady",!0);let e=n.get("messages");await Oe.default.delay(1e3),s.default.forEach(e,t=>{t.type!=="resetNotification"&&Ne(t)}),n.set("messages",[])}function Nt(e,t){let r=s.default.find(e,a=>!!s.default.get(a,"meta.isOrigin")),o=s.default.get(r,"pricing.total");if(!r||!o)return!1;let i=(0,s.default)(e).map(a=>{let m=s.default.get(a,"pricing.total")?o-s.default.get(a,"pricing.total"):0;if(a.savings=m>0?m:0,!a.product.wbpid)try{let l=a.product.url.match(/gp\/product\/(.*)\/|dp\/(.*)\?/),p=l[2]||l[1];p&&(a.product.wbpid=`amazon.com_${p}`)}catch{}return a}).filter(a=>!!a.savings).sortBy(["savings",a=>oe(re(a?.details?.arrival_date,"ccc. MMM. d"))],["desc","asc"]).reverse().value();i&&i.length&&n.set("bestAmazonResult",i[0])}function Ne(e){if(!n.get("appReady")){n.push(["messages"],e);return}let{type:t,...r}=e;if(r)switch(t){case"setInputData":u.merge({inputData:r.inputData});break;case"modalDetailsReceived":Ot(r);break;case"lastChanceDetailsReceived":Mt(r);break;case"showOnboarding":setTimeout(()=>{u.merge({showOnboarding:!0,hasAccount:!!r.hasAccount})});break;case"runUpdated":Y(r);break;case"abortRun":u.merge({run:{status:"complete",runId:s.default.get(r,"run.runId"),aborted:!0},currentSavings:0,updating:!1,lastSavings:u.get("currentSavings"),showPopup:!1,resetting:!1}),r.run&&Fe(r.run);break;case"resetNotification":Ft();break;case"setRunId":{u.get("endFiredFirst")!==r.runId&&(Me(r.runId),u.set(["endFiredFirst"],null));break}case"amazonResultsReceived":Nt(e.amazonResults,e.runId);break;default:console.log("unknown message",e)}}window.handleMessage=Ne;async function Ve(e){if(n.get(["ProductPage","lastRunId"])===e.runId)return;n.get(["ProductPage"])?n.merge("ProductPage",{isFetching:!0,lastRunId:e.runId}):n.set("ProductPage",{isFetching:!0,lastRunId:e.runId});let r=await De(e);r?(r.isFetching=!1,n.merge("ProductPage",r)):n.merge("ProductPage",{isFetching:!1})}function Kr(e){return Ae(e)}var P;async function qe(e){P=e,n.set(["siteHubView","primaryDeal"],e),Vt([]);let t=e.id,r=e.runId,o=e.asin;Ve({id:t,asin:o,runId:r})}function Vt(e){e=O.default.filter(e,r=>r.savings);let t=n.get(["siteHubView","deals"]);if(t?t=(0,O.default)(t.concat(e)).uniq("asin").filter(r=>r.asin!==O.default.get(P,"asin")).value():t=e,n.set(["siteHubView","deals"],t),P)P.savings>0?y({active:!0,text:"1"}):y({active:!0,text:""});else if(t.length){let r=t.length+(P?1:0);y({active:!0,text:r.toString()})}else y({active:!1,text:""})}var Le=e=>{if(e&&!e.error&&e.deal.asin===n.get("currentASIN")){n.set(["notification","communityDeal"],e);let t=e.deal;qe(t)}else e&&e.error&&n.set(["notification","communityDeal"],e)};var Ue=e=>{n.set(["notification","feedbackData"],e)};var ze=e=>{let t=`${e}=`,o=decodeURIComponent(document.cookie).split(";");for(let i=0;i<o.length;i++){let a=o[i].trim();if(a.indexOf(t)===0)return a.substring(t.length,a.length)}return""};var He=({cookieKey:e}={})=>{if(e)return ze(e)};var Be=async e=>{n.merge("followView",{hiddenFromWebApp:!0})};var Ee=e=>{g("modalDetailsReceived",e)};var $e=d(w()),je=e=>$e.default.map(e,t=>({selector:t,present:!!document.querySelector(t)}));var Ge=e=>c("initNotificationApp",e);var Qe=async e=>{n.set("followView",{resultData:e}),Ge({name:"follow"})};var We=e=>{g("showOnboarding",e)};var Ke=d(N()),K=d(w());var Xe=d(w());function M(e){return Ze().indexOf(e)>-1}function Ze(){return n.get(["session","features"])||[]}function Je(e,t){return!!Ze().find(o=>o.startsWith(e)&&o.endsWith("_"+Xe.default.snakeCase(t)))}var Oo=()=>M("is_pc_notif_off");function Ye(e){let t=n.get(["siteHubView","deals"]),r=n.get(["siteHubView","primaryDeal"]);return K.default.get(e,"site.siteData.flags.siteHubStandDown")||n.set(["couponsDisabledSites",`${h()}_${n.get("tabId")}`],0),n.get(["siteHubView","shown"])?(n.set(["siteHubView","visible"],!0),n.set(["siteHubView","site"],e.site)):n.set("siteHubView",{shown:!0,visible:!0,site:e.site,deals:t,primaryDeal:r}),h()==="ebay.com"&&K.default.get(e,"site.siteData.coupons.coupons.length")&&!(n.get(["deweyResult","pageType"])==="checkoutPage")||Je("mit_isqualified",h())?!1:!n.get(["siteHubScriptLoaded"])}var et=async e=>document.readyState==="interactive"||document.readyState==="complete"||document.readyState==="loaded"?Ye(e):new Ke.default(t=>{document.addEventListener("DOMContentLoaded",()=>{t(Ye(e))})});var tt=(e,t)=>A(e,t);var rt=(e,t)=>ke(e,t);var ot=async()=>n.set(["warnAboutStandDown"],!0);ht();var nt=new ie,Go=nt.asObservable(),it=()=>{M("ext_fast_roo_totals")&&nt.next()};var qt="__wikibuy_instant_content",Lt="__wikibuy_instant_bg",Ut="__wikibuy_instant_external_messages";function zt(e){return ee[e]}var F=window.wb_messenger;if(!F){let e=chrome.runtime.connect(chrome.runtime.id,{name:Ut});F=window.wb_messenger=(0,at.default)(zt,t=>{chrome.runtime.sendMessage({src:qt,data:t})},{getId:()=>(0,st.v4)({rng:()=>{for(var t=new Array(16),r=0,o;r<16;r++)r&3||(o=Math.random()*4294967296),t[r]=o>>>((r&3)<<3)&255;return t}})}),chrome.runtime.onMessage.addListener(t=>{t.src===Lt&&F.handleMessage(t.data)})}function c(e,t={}){return F.invoke(e,[t])}function g(e,t={}){window.handleMessage&&window.handleMessage({type:e,...t})}var y=e=>c("setBrowserAction",e);export{ve as a,Et as b,n as c,Pe as d,y as e,Tt as f,Ft as g,Jr as h,Yr as i,Kr as j,h as k,cr as l,M as m,Ze as n,Oo as o,Go as p,c as q,g as r,pr as s,gr as t,x as u};
