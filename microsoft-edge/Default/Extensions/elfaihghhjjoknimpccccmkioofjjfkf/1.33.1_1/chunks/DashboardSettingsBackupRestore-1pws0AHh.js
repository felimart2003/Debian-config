import{o as l,g as k,i as u,c3 as ie,c4 as m,c5 as A,aa as B,b1 as q,c6 as p,c7 as W,c8 as N,c9 as y,ca as g,cb as w,cc as O,aZ as ne,cd as oe,ce as re,cf as ce,cg as me,ch as le,a8 as ue,b0 as de,ci as fe,aE as he,aR as pe,a as ye,aK as S,cj as b,ck as ge,cl as we,ah as x,c as T,cm as n,f as Se,a0 as be,n as Te,q as _e,w as De,k as P,j as E}from"./defineAppConfig-_73fm9CR.js";import{d as ke}from"./define-preference-list-7Lt6F3Si.js";import{n as Ce,s as c}from"./useAddAppToIgnoreListDialogStore-gHGl-4Ba.js";import{u as o}from"./useRequirePin-prOa10D6.js";import{r as _}from"./min-search-date-s1KccwK4.js";import{_ as Re}from"./SettingsBreadcrumbs.vue_vue_type_script_setup_true_lang-oMIV03qE.js";import"./DurationPreference.vue_vue_type_script_setup_true_lang-w840PD0r.js";import"./recent-apps-provider-H_KyoG2W.js";import"./new-tab-light-diPYHp27.js";import"./menu-right-KVxkRuog.js";const ve={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},We=u("path",{fill:"currentColor",d:"M6.5 20q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48q1.18-1.53 3.08-1.95q.58-2.02 2.14-3.4Q8.95 4.38 11 4.08v8.07L9.4 10.6L8 12l4 4l4-4l-1.4-1.4l-1.6 1.55V4.08q2.58.35 4.29 2.31T19 11q1.73.2 2.86 1.5q1.14 1.28 1.14 3q0 1.88-1.31 3.19T18.5 20Z"},null,-1),Oe=[We];function xe(e,s){return l(),k("svg",ve,Oe)}const G={name:"mdi-cloud-download",render:xe},Pe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ee=u("path",{fill:"currentColor",d:"M11 20H6.5q-2.28 0-3.89-1.57Q1 16.85 1 14.58q0-1.95 1.17-3.48q1.18-1.53 3.08-1.95q.63-2.3 2.5-3.72Q9.63 4 12 4q2.93 0 4.96 2.04Q19 8.07 19 11q1.73.2 2.86 1.5q1.14 1.28 1.14 3q0 1.88-1.31 3.19T18.5 20H13v-7.15l1.6 1.55L16 13l-4-4l-4 4l1.4 1.4l1.6-1.55Z"},null,-1),Ge=[Ee];function Le(e,s){return l(),k("svg",Pe,Ge)}const L={name:"mdi-cloud-upload",render:Le},Fe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Ie=u("path",{fill:"currentColor",d:"M19 4h-3.5l-1-1h-5l-1 1H5v2h14M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6v12Z"},null,-1),Ae=[Ie];function Be(e,s){return l(),k("svg",Fe,Ae)}const D={name:"mdi-delete",render:Be},F=".usage_backup",I=ie({theme:m(A),startWeekOn:m(B),timeFormat:m(q),dailyResetTime:p().int().nonnegative(),trackTabs:W(),dailySummary:W(),sendDailySummary:p().int().nonnegative(),popupPosition:m(N),ignoreWebsites:y(g()),focusWebsites:y(g()),focusSchedules:w(O),websiteLimits:w(ne),limitsOnTheGoWebsites:y(g()),limitsOnTheGoSchedules:w(O),limitsOnTheGoCoolDown:p().int().nonnegative()}),qe=ke(e=>{const{t:s}=e,{state:C}=oe(),{state:R}=re(),{state:d}=ce(),{state:M}=me(),{state:$}=le(),{state:U}=ue(),{state:H}=de(),{state:j}=fe(),Q=Ce(),f=he(),i=pe(),h=ye("ExportHistory"),V=o(async()=>{const t=await i.exportUsageBackup(),a=document.createElement("a");a.href=`data:*/*;base64,${t}`,a.download=`StayFree ${new Date().toISOString()}${F}`,a.click()}),Z=o(async t=>{try{e.showLoading(),await i.importUsageBackup(t),await _(i,f),e.hideLoading(),e.showAlert(e.t("preferences.importSuccess"))}catch(a){e.showAlert(e.t("genericErrorWithMessage",{message:c(a)}))}}),K=o(()=>{e.confirmDestroy({title:s("preferences.resetConfirmTitle"),message:s("preferences.resetConfirmMessage"),onConfirm(){J().catch(t=>S("[main-preferences] Failed to reset history",t))}})});async function J(){var t;try{e.showLoading();const a=((t=Q.deviceGroup)==null?void 0:t.key)??"";await i.resetDatabase(a),await _(i,f);const r=s("preferences.resetSuccess");b({message:r}),e.hideLoading(),e.showAlert(r)}catch(a){e.showAlert(s("genericErrorWithMessage",{message:c(a)}))}}const X=o(()=>{e.confirmDestroy({title:s("preferences.generatedResetConfirmTitle"),message:s("preferences.generatedResetConfirmMessage"),onConfirm(){z().catch(t=>S("[main-preferences] Failed to reset generated history",t))}})});async function z(){try{e.showLoading(),await i.resetGeneratedDatabase(),await _(i,f);const t=s("preferences.generatedResetSuccess");b({message:t}),e.hideLoading(),e.showAlert(t)}catch(t){e.showAlert(s("genericErrorWithMessage",{message:c(t)}))}}async function Y(){const t={theme:$.value,startWeekOn:U.value,timeFormat:H.value,dailyResetTime:d.value,trackTabs:M.value,dailySummary:R.value,sendDailySummary:C.value,popupPosition:j.value,ignoreWebsites:await e.prefs.getIgnoredWebsites(),focusWebsites:await e.prefs.getFocusWebsites(),focusSchedules:await e.prefs.getFocusSchedules(),websiteLimits:await e.prefs.getUsageLimitsMap(),limitsOnTheGoWebsites:await e.prefs.getLimitsOnTheGoWebsites(),limitsOnTheGoSchedules:await e.prefs.getLimitsOnTheGoSchedules(),limitsOnTheGoCoolDown:await e.prefs.getLotgCoolDownPeriod()};return I.parse(t)}async function v(t){await e.prefs.setTheme(t.theme),await e.prefs.setStartWeekOn(t.startWeekOn),await e.prefs.setTimeFormat(t.timeFormat),await e.prefs.setDailyResetTime(t.dailyResetTime),await e.prefs.setIsTabActiveWhenPlayingAudio(t.trackTabs),await e.prefs.setIsDailySummaryNotificationEnabled(t.dailySummary),await e.prefs.setDailySummaryNotificationTime(t.sendDailySummary),await e.prefs.setPopupPosition(t.popupPosition),await e.prefs.setIgnoredWebsites(t.ignoreWebsites),await e.prefs.setFocusWebsites(t.focusWebsites),await e.prefs.setFocusSchedules(t.focusSchedules),await e.prefs.setUsageLimitsMap(t.websiteLimits),await e.prefs.setLimitsOnTheGoWebsites(t.limitsOnTheGoWebsites),await e.prefs.setLimitsOnTheGoSchedules(t.limitsOnTheGoSchedules),await e.prefs.setLotgCoolDownPeriod(t.limitsOnTheGoCoolDown)}const ee=o(async()=>{const t=await Y(),a=document.createElement("a"),r=new Blob([JSON.stringify(t)],{type:"application/json"});a.href=URL.createObjectURL(r),a.download=`StayFree Settings ${new Date().toISOString()}.json`,a.click()}),te=o(async t=>{try{if(!ge(t))throw Error("Invalid base64 encoding");const a=we(t),r=I.parse(JSON.parse(a));await v(r),e.showAlert(e.t("preferences.importSuccess"))}catch(a){e.showAlert(e.t("genericErrorWithMessage",{message:c(a)}))}}),se=o(()=>{e.confirmDestroy({title:s("preferences.factoryResetConfirmTitle"),message:s("preferences.factoryResetConfirmMessage"),onConfirm(){ae().catch(t=>S("[main-preferences] Failed to reset factory",t))}})});async function ae(){try{const t={theme:A.Auto,startWeekOn:B.Sunday,timeFormat:q.Hour12,dailyResetTime:x*3,trackTabs:!0,dailySummary:!0,sendDailySummary:x*21,popupPosition:N.Center,appGroups:!0,ignoreWebsites:[],focusWebsites:[],focusSchedules:{},websiteLimits:{},limitsOnTheGoWebsites:[],limitsOnTheGoSchedules:{},limitsOnTheGoCoolDown:0};await v(t);const a=s("preferences.factoryResetSuccess");b({message:a}),e.showAlert(a)}catch(t){e.showAlert(s("genericErrorWithMessage",{message:c(t)}))}}return[{type:"group",name:s("preferences.historyGroup"),preferences:[{when:T(()=>h),id:n.ExportData,name:s("preferences.exportName"),description:s("preferences.exportDescription"),icon:G,type:"button",buttonText:s("preferences.exportButton"),onClick:V},{when:T(()=>h),id:n.ImportData,name:s("preferences.importName"),description:s("preferences.importDescription"),icon:L,type:"file-upload",acceptExtensions:[F],onFileContents:Z},{id:n.Reset,name:s("preferences.resetName"),description:s("preferences.resetDescription"),icon:D,type:"button",buttonText:s("preferences.resetButton"),onClick:K},{when:T(()=>h),id:n.Reset,name:s("preferences.generatedResetName"),description:s("preferences.generatedResetDescription"),icon:D,type:"button",buttonText:s("preferences.generatedResetButton"),onClick:X}]},{type:"group",name:s("preferences.settingsGroup"),preferences:[{id:n.ExportSettings,name:s("preferences.exportSettings"),description:s("preferences.exportSettingsDescription"),icon:G,type:"button",buttonText:s("preferences.exportButton"),onClick:ee},{id:n.ImportSettings,name:s("preferences.importSettings"),description:s("preferences.importSettingsDescription"),icon:L,type:"file-upload",acceptExtensions:["json"],onFileContents:te},{id:n.FactoryReset,name:s("preferences.factoryResetName"),description:s("preferences.factoryResetDescription"),icon:D,type:"button",buttonText:s("preferences.factoryResetButton"),onClick:se}]}]}),Ne={class:"section section-sticky"},Xe=Se({name:"DashboardSettingsBackupRestore",__name:"DashboardSettingsBackupRestore",setup(e){const{t:s}=be();return(C,R)=>{const d=Te("page-layout-content-container");return l(),_e(d,null,{default:De(()=>[u("section",Ne,[P(Re,{title:E(s)("backupRestore.title")},null,8,["title"])]),P(E(qe))]),_:1})}}});export{Xe as default};
