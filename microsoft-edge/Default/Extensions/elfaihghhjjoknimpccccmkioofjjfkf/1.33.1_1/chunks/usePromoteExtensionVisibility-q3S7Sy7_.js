import{aT as E,c as n,al as G,E as U,bX as V,bk as $,f as L,o as y,g as C,l as x,F as B,i as R,aB as M,a0 as S,aU as j,bI as _,ar as H,W as Q,Y as q,q as D,w as k,j as u,k as w,X as N,aM as O,aF as W,t as Y,Q as K,I as X,bd as Z,bY as z,r as J,b as ee,a as te}from"./defineAppConfig-_73fm9CR.js";import{u as se}from"./useGetSessionSummaries-MLl_K4v8.js";import{I as ie}from"./pencil-outline-YZ9DKWrK.js";import{a as ae,I as oe}from"./plus-AonKDMmz.js";import{n as F,p as ne,i as re,h as le,L as ue,M as ce,r as me}from"./useAddAppToIgnoreListDialogStore-gHGl-4Ba.js";import{_ as P,u as pe}from"./AppListItem.vue_vue_type_script_setup_true_lang-nyh4YDtP.js";import{l as de,m as fe,j as ge,k as ye}from"./recent-apps-provider-H_KyoG2W.js";import{u as h}from"./useRequirePin-prOa10D6.js";function Ie(){const{deviceGroup:a}=E(F());return n(()=>!!a.value)}function ve(){return G(U.RelatedAppsPlatform)}function be(a){const o=Ie(),s=ve();return n(()=>V($(a),o.value,s))}const we=R("p",null,"TODO",-1),A=L({__name:"CategoryListItem",props:{appId:{},subtitle:{},platform:{},disableAppGroups:{type:Boolean},limit:{},usage:{}},setup(a){return(o,s)=>(y(),C(B,null,[x(" eslint-disable-next-line @intlify/vue-i18n/no-raw-text "),we],2112))}}),Le=L({components:{AppListItem:P,CategoryListItem:A},render(){const a=this.$props.platform==="category"?A:P;return M(a,this.$props,this.$slots.default)}}),Te=L({name:"UsageLimitListItem",__name:"UsageLimitListItem",props:{limit:{}},emits:["edit","delete"],setup(a,{emit:o}){const s=a,{t:r}=S(),I=n(()=>{if(s.limit.duration===0)return r("dashboard.completelyBlockedSection");const t=j(s.limit.duration,{excludeTrailingZeros:!0}),i=r(`enums.WarningType.${s.limit.warningType}Action`);return r("dashboard.websiteLimitSubtitle",{duration:t,warningTypeAction:i})}),c=n(()=>s.limit.appId),p=n(()=>_(s.limit.limitType)),v=pe(c,p),d=H(),m=Q(),b=m+N,f=be(v),g=n(()=>({startDate:m,endDate:b,appIds:f.value.length===0?[c.value]:f.value.map(t=>t.id),installIds:s.limit.isCrossPlatform?void 0:[d.value],myInstallId:d.value})),{data:e}=se(q.UsageTime,g),l=n(()=>{var t,i;return((i=(t=e==null?void 0:e.value)==null?void 0:t[0])==null?void 0:i.primaryMetricValue)??0});return(t,i)=>(y(),D(u(Le),{"data-testid":`usage-limit-${t.limit.appId}`,"app-id":t.limit.appId,subtitle:u(I),platform:u(p),limit:t.limit.duration,usage:u(l)},{default:k(()=>[w(u(ie),{class:"icon-button text-on-surface text-opacity-icon",onClick:i[0]||(i[0]=T=>o("edit",t.limit))}),w(u(ae),{"data-testid":`delete-usage-limit-${t.limit.appId}`,class:"icon-button text-on-surface text-opacity-icon",onClick:i[1]||(i[1]=T=>o("delete",t.limit))},null,8,["data-testid"])]),_:1},8,["data-testid","app-id","subtitle","platform","limit","usage"]))}});function Ce(){const a=ne(),o=O();return W(async({limitId:s,isCrossPlatform:r})=>await a.removeUsageLimit(s,r),{onSuccess:()=>{o.invalidateQueries(de)}})}const _e=L({name:"UsageLimitList",__name:"UsageLimitList",props:{items:{},showInlineButton:{type:Boolean},editDefaults:{}},setup(a){const o=a,{t:s}=S(),r=re(),I=fe(),c=ge(),{reportEvent:p}=Y(),{mutateAsync:v}=Ce(),d=h(e=>{I.show({title:s("genericConfirmation"),positiveButtonText:s("delete"),negativeButtonText:s("cancel"),async onClickPositive(){const l=_(e.limitType);p("DELETE_USAGE_LIMIT",{...e,limitPlatform:l});try{await v({limitId:e.id,isCrossPlatform:e.isCrossPlatform})}catch(t){z(t),r.show({message:s("genericError")})}return!0}})}),m=le(),b=h(e=>{var t;const l=[...((t=o.editDefaults)==null?void 0:t.allowedHostnames)??[e.appId]];l.sort(),c.show({warningType:e.warningType,duration:e.duration,id:e.id,appId:e.appId,allowedHostnames:l,limitType:m,isCrossPlatform:e.isCrossPlatform})}),f=ye();function g(){var e;c.show({allowedHostnames:(e=o.editDefaults)==null?void 0:e.allowedHostnames,warningType:f,limitType:m})}return(e,l)=>(y(),D(Z,{tag:"ul",name:"fade",class:"grid grid-flow-row gap-4 sm:grid-cols-2",duration:300},{default:k(()=>[(y(!0),C(B,null,K(e.items,t=>(y(),D(Te,{key:t.id,limit:t,onDelete:u(d),onEdit:u(b)},null,8,["limit","onDelete","onEdit"]))),128)),e.showInlineButton?(y(),C("button",{key:0,"data-testid":"add-limit-website",class:"h-14 flex items-center justify-center space-x-2 rounded-lg ring-1 ring-on-background ring-opacity-divider ring-inset clickable",onClick:g},[w(u(oe),{class:"icon text-on-background text-opacity-secondary"}),w(X,{tag:"p",keypath:"newLimit"})])):x("v-if",!0)]),_:1}))}});function ke(a){const o=J(!1);ee(()=>{o.value=!0},(a==null?void 0:a.autoShowTimeout)??1e3);const s=te("PromoteExtension"),{state:r,mutateAsync:I}=ue(),c=n(()=>o.value&&r.value&&s);function p(){return I(!1)}const{state:v,mutateAsync:d}=ce(),m=F(),{deviceGroup:b}=E(m),{data:f}=me(b);function g(i){return i.toLowerCase().includes("chrome")||i.toLowerCase().includes("firefox")||i.toLowerCase().includes("safari")}const e=n(()=>{var i;return((i=f.value)==null?void 0:i.find(T=>g(T.name)))!=null});function l(i){return n(()=>!e.value&&g(i.value)&&v.value&&s)}function t(){return d(!1)}return{isPromoteExtensionForLimitsVisible:c,isPromoteExtensionForBrowserDetailsVisible:l,dismissPromoteExtensionForLimits:p,dismissPromoteExtensionForBrowserDetails:t}}export{_e as _,ve as a,be as b,ke as c,Ie as u};
