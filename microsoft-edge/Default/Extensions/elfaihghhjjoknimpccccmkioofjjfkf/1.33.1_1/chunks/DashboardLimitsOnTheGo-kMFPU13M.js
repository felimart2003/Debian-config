import{I as j}from"./timer-Tx1ppbqt.js";import{b5 as M,cw as oe,f as K,aT as A,a0 as Q,au as B,b0 as H,c as l,b1 as $,o as b,q as E,w as U,g as C,Q as ne,F as ce,k as r,j as s,I as D,bd as le,bY as re,A as J,bU as Y,cx as de,aA as X,b2 as Z,cy as R,cz as q,cA as ue,cB as me,cC as he,aK as P,al as pe,E as fe,t as ge,ah as w,cm as ve,i as m,U as I,T as z,ad as _e,l as be}from"./defineAppConfig-_73fm9CR.js";import{I as Te}from"./plus-AonKDMmz.js";import{i as ye,b as ee,z as te}from"./useAddAppToIgnoreListDialogStore-gHGl-4Ba.js";import{m as Oe,n as Le,o as Se,f as Ge}from"./recent-apps-provider-H_KyoG2W.js";import{_ as we,a as Ae}from"./SfOptionsButton.vue_vue_type_script_setup_true_lang-sLoZr9ys.js";import{u as F}from"./useRequirePin-prOa10D6.js";import{_ as De}from"./AppList.vue_vue_type_script_setup_true_lang-IEQyGgY1.js";import{_ as Ee}from"./SidebarContentContainer.vue_vue_type_script_setup_true_lang-OG8Rv2IB.js";import{i as ke,b as xe,c as Ie,a as Ue}from"./schedules-4-rrdO9H.js";import{u as Ne}from"./useWalkthrough-19MmNOCw.js";import{_ as Pe}from"./DurationPreference.vue_vue_type_script_setup_true_lang-w840PD0r.js";import"./new-tab-light-diPYHp27.js";import"./pencil-outline-YZ9DKWrK.js";import"./chevron-down-V4TyRDK2.js";import"./AppListItem.vue_vue_type_script_setup_true_lang-nyh4YDtP.js";import"./useGetAppMetadataQuery-8068_Rw4.js";import"./useVibrantColor-SQN7_oFR.js";import"./sleep-9Kq7Tjeg.js";import"./useIsNewTabPage-b1xF2Z3f.js";const W=M("website-limits-on-the-go",()=>{const{state:t}=oe();return{hostnames:t}}),Ce=K({name:"FocusScheduleList",__name:"LotgScheduleList",props:{schedules:{},activeSchedules:{}},setup(t){const n=t,{hostnames:T}=A(W()),{t:c}=Q(),v=ye(),e=Oe(),h=B(),i=ee(),{state:_}=H(),p=Le(),d=l(()=>_.value==$.Hour24);function L(u,O,o,G){const k=G.map(x=>x.charAt(0).toUpperCase()).join("");return u?k+" - "+c("schedules.allDay"):k+` - ${Y(O,{is24HourFormat:d.value})} - ${Y(o,{is24HourFormat:d.value})}`}function f(){p.show({onSubmit:y})}const g=F(u=>{p.show({schedule:u,onSubmit:y})});function y(u){h.addLimitsOnTheGoSchedule(u),T.value.length||N()}const S=F(u=>{e.show({title:c("genericConfirmation"),positiveButtonText:c("delete"),negativeButtonText:c("cancel"),destructive:!0,async onClickPositive(){try{await h.removeLimitsOnTheGoSchedule(u)}catch(O){re(O),v.show({message:c("genericError")})}return!0}})});function N(){i.show(J.LimitsOnTheGoRequiredSitesWarning)}return(u,O)=>(b(),E(le,{tag:"ul",name:"fade",class:"grid grid-flow-row gap-4 sm:grid-cols-2",duration:300},{default:U(()=>[(b(!0),C(ce,null,ne(n.schedules,o=>(b(),E(we,{key:o.id,id:o.id,"schedule-name":o.name,"schedule-time":L(o.allDay,o.startTime,o.endTime,o.days),"is-active":n.activeSchedules.includes(o.id),onEdit:G=>s(g)(o),onDelete:G=>s(S)(o.id)},null,8,["id","schedule-name","schedule-time","is-active","onEdit","onDelete"]))),128)),(b(),C("button",{class:"h-14 flex items-center justify-center space-x-2 rounded-lg ring-1 ring-on-background ring-opacity-divider ring-inset clickable","data-testid":"add-schedule",key:s(c)("schedules.addSchedule"),onClick:f},[r(s(Te),{class:"icon text-on-background text-opacity-secondary"}),r(D,{tag:"p",keypath:"schedules.addSchedule"})]))]),_:1}))}}),Fe=M("lotg-schedule",()=>{const{state:t}=de(),n=te({interval:X}),{state:T}=H(),c=l(()=>ke(n.value,t.value)),v=l(()=>xe(n.value,t.value)),e=l(()=>v.value==null?[0,0]:Ie(n.value,v.value)),h=l(()=>Z(e.value[1],{is24HourFormat:T.value==$.Hour24})),i=l(()=>Ue(n.value,t.value)),_=l(()=>i.value.map(p=>p.id));return{schedules:t,activeScheduleIds:_,anyScheduleActive:c,displayEnabledUntil:h}});function We(t,n){return t===R?!1:t===q?!0:n<t}const Me=M("lotg",()=>{const{state:t,mutateAsync:n}=ue(),{state:T,mutateAsync:c}=me(),{state:v}=H(),{mutateAsync:e}=he(),h=te({interval:X}),i=l(()=>We(t.value,h.value)),_=l(()=>Z(t.value,{is24HourFormat:v.value==$.Hour24}));async function p(){return await e(!0),n(q).catch(g=>{P("Failed to enable limits-on-the-go indefinitely",g)})}const d=B();async function L(g,y){return y?await d.setUserActivatedLotg(!1):await d.setUserActivatedLotg(!0),d.setLotgEnabledUntil(Date.now()+g).catch(S=>{P("Failed to enable lotg for a duration",S)})}async function f(){return await d.setUserActivatedLotg(!1),d.setLotgEnabledUntil(R).catch(g=>{P("Failed to disable lotg",g)})}return{isEnabled:i,enabledUntil:t,displayEnabledUntil:_,coolDownPeriod:T,enableIndefinitely:p,enableFor:L,disable:f,setCoolDownPeriod:c}});function Be(){Ne("LOTG","lotg",[{stepName:"limitsOnTheGoEnableManually",selector:"#activate-lotg-button",eventName:"LOTG_ENABLE_MANUALLY",popoverOptions:{side:"left"}},{stepName:"limitsOnTheGoSchedule",selector:'[data-testid="add-schedule"]',eventName:"LOTG_SCHEDULE"},{stepName:"limitsOnTheGoAddWebsites",selector:'[data-testid="add-website"]',eventName:"LOTG_ADD_WEBSITES"}])}function He(){return pe(fe.LotgSessionManager)}const $e={"data-testid":"lotg-mode",class:"section section-sticky"},Re={class:"GenericPref flex space-x-4 py-4 pl-2 items-center"},qe={class:"flex flex-col flex-1 space-y-1"},Ve={class:"text-on-background text-opacity-primary text-lg"},je={class:"text-on-background text-opacity-secondary pr-8"},Ye={class:"flex-shrink-0 pr-4 items-center content-center"},ze={key:1},Ke=m("div",{class:"w-1 h-1 overflow-visible relative"},null,-1),Qe={class:"section"},Je={class:"section"},Xe={class:"section"},Tt=K({name:"DashboardLimitsOnTheGo",__name:"DashboardLimitsOnTheGo",setup(t){const{schedules:n,activeScheduleIds:T,anyScheduleActive:c,displayEnabledUntil:v}=A(Fe()),{t:e}=Q(),h=B(),i=Me(),{isEnabled:_,coolDownPeriod:p}=A(i),{hostnames:d}=A(W()),L=ee(),{reportEvent:f}=ge(),g=He(),y=[{display:e("limitsOnTheGo.option1"),value:1*w},{display:e("limitsOnTheGo.option2"),value:2*w},{display:e("limitsOnTheGo.option3"),value:3*w}],S={id:ve.LotgCoolDownPeriod,type:"duration",name:e("limitsOnTheGo.coolDownPeriodTitle"),description:e("limitsOnTheGo.coolDownPeriodDescription"),requirePin:!0,icon:j,useValue:()=>l({get:()=>p.value,set:async a=>{a!==p.value&&(await i.setCoolDownPeriod(a),a==0?f("LOTG_UNSET_COOLDOWN"):f("LOTG_SET_COOLDOWN",{durationInHours:a/w}))}})};async function N(){f("ENABLED_LOTG_INDEFINITELY"),await i.enableIndefinitely(),x.value&&V()}function u(a){f("ENABLED_LOTG_FOR_DURATION",{durationInHours:a/w}),i.enableFor(a).then(()=>{x.value&&V()})}const O=F(async()=>{await i.disable(),f("LOTG_DISABLE_MANUALLY")}),o=l(()=>c.value?e("limitsOnTheGo.activeUntilMessage",{timeOfDay:v.value}):i.enabledUntil==R?e("limitsOnTheGo.disableMessage"):i.enabledUntil==q?e("limitsOnTheGo.activeMessage"):i.isEnabled?e("limitsOnTheGo.activeUntilMessage",{timeOfDay:i.displayEnabledUntil}):e("limitsOnTheGo.disableMessage"));async function G(a){await h.addLimitsOnTheGoWebsite(a)}async function k(a){await h.removeLimitsOnTheGoWebsite(a),await g.deleteSession(a)}const x=l(()=>_.value&&!d.value.length);function V(){L.show(J.LimitsOnTheGoRequiredSitesWarning)}Be();const{hostnames:se}=A(W()),ie=Se(),ae=l(()=>se.value.map(a=>({appId:a,platform:ie,disableAppGroups:!0})));return(a,Ze)=>(b(),E(Ee,null,{default:U(()=>[m("section",$e,[r(D,{tag:"h1",class:"dashboard-page-title",keypath:"limitsOnTheGo.title"})]),m("div",Re,[m("div",qe,[m("p",Ve,I(s(e)("limitsOnTheGo.activateLimitsOnTheGo")),1),m("p",je,I(s(e)("limitsOnTheGo.description")),1)]),m("div",Ye,[s(c)?(b(),E(s(j),{key:0,class:"icon-lg text-primary"})):s(_)?(b(),C("div",ze,[r(_e,{"data-testid":"disable-button",color:"transparent",class:"clickable",onClick:s(O)},{default:U(()=>[z(I(s(e)("limitsOnTheGo.disable")),1)]),_:1},8,["onClick"]),be(" This line has been added to make it the same size as the options button. "),Ke])):(b(),E(Ae,{key:2,id:"activate-lotg-button","button-text":s(e)("limitsOnTheGo.activate"),"dropdown-title":s(e)("limitsOnTheGo.optionTitle"),items:y,onClick:N,onClickOption:u},null,8,["button-text","dropdown-title"]))])]),r(Ge,{type:"info"},{default:U(()=>[z(I(s(o)),1)]),_:1}),m("section",Qe,[r(D,{tag:"h2",keypath:"schedules.schedules",class:"section-title"}),r(Ce,{schedules:s(n),"active-schedules":s(T)},null,8,["schedules","active-schedules"])]),m("section",Je,[r(D,{tag:"h2",keypath:"limitsOnTheGo.blockedWebsites",class:"section-title"}),r(De,{apps:s(ae),"show-add-button":"","add-app-description":s(e)("limitsOnTheGo.addWebsiteDescription"),onAdd:G,onRemove:k},null,8,["apps","add-app-description"])]),m("section",Xe,[r(D,{tag:"h2",keypath:"settings",class:"section-title"}),r(Pe,{pref:S,"data-testid":"edit-cooldown-button"})])]),_:1}))}});export{Tt as default};
