import{aO as E,c as n,aj as G,I as U,bX as k,bl as $,f as L,o as y,g as C,l as x,F as S,i as R,ay as j,Y as _,aS as N,bI as B,ap as O,T as q,V as H,q as D,w as F,j as u,k as w,U as M,aJ as Q,aC as W,t as Y,N as K,bd as J,bY as X,r as Z,b as z,a as ee}from"./defineAppConfig-GTQ5Bvuh.js";import{I as te}from"./new-tab-light-6CDZBy0y.js";import{u as se}from"./useGetSessionSummaries--e-QKgL-.js";import{I as ie}from"./pencil-outline-S-laxNsu.js";import{a as oe,I as ae}from"./plus-kS_YE9tP.js";import{o as V,q as ne,j as re,i as le,N as ue,O as me}from"./useAddAppToIgnoreListDialogStore-Ki2J31d-.js";import{_ as P,u as ce}from"./AppListItem.vue_vue_type_script_setup_true_lang-xBVAs2BQ.js";import{l as pe,m as de,j as fe,k as ge,h as ye}from"./recent-apps-provider-OWite7eM.js";import{u as h}from"./useRequirePin-V8f6W3iF.js";function Ie(){const{deviceGroup:o}=E(V());return n(()=>!!o.value)}function ve(){return G(U.RelatedAppsPlatform)}function be(o){const a=Ie(),s=ve();return n(()=>k($(o),a.value,s))}const we=R("p",null,"TODO",-1),A=L({__name:"CategoryListItem",props:{appId:{},subtitle:{},platform:{},disableAppGroups:{type:Boolean},limit:{},usage:{}},setup(o){return(a,s)=>(y(),C(S,null,[x(" eslint-disable-next-line @intlify/vue-i18n/no-raw-text "),we],2112))}}),Le=L({components:{AppListItem:P,CategoryListItem:A},render(){const o=this.$props.platform==="category"?A:P;return j(o,this.$props,this.$slots.default)}}),Te=L({name:"UsageLimitListItem",__name:"UsageLimitListItem",props:{limit:{}},emits:["edit","delete"],setup(o,{emit:a}){const s=o,{t:r}=_(),I=n(()=>{if(s.limit.duration===0)return r("dashboard.completelyBlockedSection");const t=N(s.limit.duration,{excludeTrailingZeros:!0}),i=r(`enums.WarningType.${s.limit.warningType}Action`);return r("dashboard.websiteLimitSubtitle",{duration:t,warningTypeAction:i})}),m=n(()=>s.limit.appId),p=n(()=>B(s.limit.limitType)),v=ce(m,p),d=O(),c=q(),b=c+M,f=be(v),g=n(()=>({startDate:c,endDate:b,appIds:f.value.length===0?[m.value]:f.value.map(t=>t.id),installIds:s.limit.isCrossPlatform?void 0:[d.value],myInstallId:d.value})),{data:e}=se(H.UsageTime,g),l=n(()=>{var t,i;return((i=(t=e==null?void 0:e.value)==null?void 0:t[0])==null?void 0:i.primaryMetricValue)??0});return(t,i)=>(y(),D(u(Le),{"data-testid":`usage-limit-${t.limit.appId}`,"app-id":t.limit.appId,subtitle:u(I),platform:u(p),limit:t.limit.duration,usage:u(l)},{default:F(()=>[w(u(ie),{class:"icon-button text-neutral-content text-opacity-icon",onClick:i[0]||(i[0]=T=>a("edit",t.limit))}),w(u(oe),{"data-testid":`delete-usage-limit-${t.limit.appId}`,class:"icon-button text-neutral-content text-opacity-icon",onClick:i[1]||(i[1]=T=>a("delete",t.limit))},null,8,["data-testid"])]),_:1},8,["data-testid","app-id","subtitle","platform","limit","usage"]))}});function Ce(){const o=ne(),a=Q();return W(async({limitId:s,isCrossPlatform:r})=>await o.removeUsageLimit(s,r),{onSuccess:()=>{a.invalidateQueries(pe)}})}const Fe=L({name:"UsageLimitList",__name:"UsageLimitList",props:{items:{},showInlineButton:{type:Boolean},editDefaults:{}},setup(o){const a=o,{t:s}=_(),r=re(),I=de(),m=fe(),{reportEvent:p}=Y(),{mutateAsync:v}=Ce(),d=h(e=>{I.show({title:s("genericConfirmation"),positiveButtonText:s("delete"),negativeButtonText:s("cancel"),async onClickPositive(){const l=B(e.limitType);p("DELETE_USAGE_LIMIT",{...e,limitPlatform:l});try{await v({limitId:e.id,isCrossPlatform:e.isCrossPlatform})}catch(t){X(t),r.show({message:s("genericError")})}return!0}})}),c=le(),b=h(e=>{var t;const l=[...((t=a.editDefaults)==null?void 0:t.allowedHostnames)??[e.appId]];l.sort(),m.show({warningType:e.warningType,duration:e.duration,id:e.id,appId:e.appId,allowedHostnames:l,limitType:c,isCrossPlatform:e.isCrossPlatform})}),f=ge();function g(){var e;m.show({allowedHostnames:(e=a.editDefaults)==null?void 0:e.allowedHostnames,warningType:f,limitType:c})}return(e,l)=>(y(),D(J,{tag:"ul",name:"fade",class:"grid grid-flow-row gap-4 sm:grid-cols-2",duration:300},{default:F(()=>[(y(!0),C(S,null,K(e.items,t=>(y(),D(Te,{key:t.id,limit:t,onDelete:u(d),onEdit:u(b)},null,8,["limit","onDelete","onEdit"]))),128)),e.showInlineButton?(y(),C("button",{key:0,"data-testid":"add-limit-website",class:"h-14 flex items-center justify-center space-x-2 rounded-lg ring-1 ring-base-content ring-opacity-divider ring-inset clickable",onClick:g},[w(u(ae),{class:"icon text-base-content text-opacity-secondary"}),w(te,{tag:"p",keypath:"newLimit"})])):x("v-if",!0)]),_:1}))}});function Ve(o){const a=Z(!1);z(()=>{a.value=!0},(o==null?void 0:o.autoShowTimeout)??1e3);const s=ee("PromoteExtension"),{state:r,mutateAsync:I}=ue(),m=n(()=>a.value&&r.value&&s);function p(){return I(!1)}const{state:v,mutateAsync:d}=me(),c=V(),{deviceGroup:b}=E(c),{data:f}=ye(b);function g(i){return i.toLowerCase().includes("chrome")||i.toLowerCase().includes("firefox")||i.toLowerCase().includes("safari")}const e=n(()=>{var i;return((i=f.value)==null?void 0:i.find(T=>g(T.name)))!=null});function l(i){return n(()=>!e.value&&g(i.value)&&v.value&&s)}function t(){return d(!1)}return{isPromoteExtensionForLimitsVisible:m,isPromoteExtensionForBrowserDetailsVisible:l,dismissPromoteExtensionForLimits:p,dismissPromoteExtensionForBrowserDetails:t}}export{Fe as _,ve as a,be as b,Ve as c,Ie as u};
